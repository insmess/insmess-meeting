(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-005c6442"],{1610:function(e,t,n){},1875:function(e,t,n){},"1efe":function(e,t,n){},"1f6b":function(e,t,n){},"2a06":function(e,t,n){},"2b15":function(e,t,n){"use strict";n("a74f")},"3d11":function(e,t,n){},"420d":function(e,t,n){"use strict";n.d(t,"h",(function(){return o})),n.d(t,"f",(function(){return a})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return r})),n.d(t,"e",(function(){return c})),n.d(t,"i",(function(){return l})),n.d(t,"d",(function(){return u})),n.d(t,"g",(function(){return d})),n.d(t,"a",(function(){return h})),n.d(t,"j",(function(){return m}));var i=n("b775");function o(e){return Object(i["a"])({url:"/room/getRole",method:"get",params:e})}function a(e){return Object(i["a"])({url:"/room/recording/stop",method:"post",data:e})}function s(e){return Object(i["a"])({url:"/room/recording/start",method:"post",data:e})}function r(e){return Object(i["a"])({url:"/room/checkPassword?roomId="+e.roomId+"&password="+e.password,method:"post"})}function c(e){return Object(i["a"])({url:"/room/disconnect",method:"post",data:e})}function l(e){return Object(i["a"])({url:"/room/findById?id="+e,method:"get"})}function u(e){return Object(i["a"])({url:"/room/checkRoomPermission?roomId="+e,method:"get"})}function d(){return Object(i["a"])({url:"/room/findPublicRoomPage",method:"get"})}function h(e){return Object(i["a"])({url:"/room/save",method:"post",data:e})}function m(e){return Object(i["a"])({url:"/room/update",method:"post",data:e})}},4213:function(e,t,n){e.exports=n.p+"static/img/mcf.fa95e4b9.png"},4945:function(e,t,n){},"4c4e":function(e,t,n){"use strict";n("1efe")},"5c34":function(e,t,n){"use strict";n("3d11")},"5e0d":function(e,t,n){},"6ba2":function(e,t,n){},"6d8d":function(e,t,n){},"715e":function(e,t,n){},"7ce6":function(e,t,n){"use strict";n("1875")},"81e1":function(e,t,n){"use strict";n("1610")},"84d5":function(e,t,n){"use strict";n("2a06")},"8a87":function(e,t,n){"use strict";n("6ba2")},"90ab":function(e,t,n){"use strict";n("ce55")},"993e":function(e,t,n){"use strict";n("6d8d")},"9b86":function(e,t,n){"use strict";n("5e0d")},"9c3c":function(e,t,n){e.exports=n.p+"static/img/mcf-off.7f92c781.png"},"9d7c":function(e,t,n){"use strict";n("f931")},a21bd:function(e,t,n){"use strict";n("1f6b")},a74f:function(e,t,n){},a8aa:function(e,t,n){},b3fc:function(e,t,n){"use strict";n("a8aa")},b672:function(e,t,n){"use strict";n("4945")},ce55:function(e,t,n){},e724:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app"},[e.showWhiteBoardStatus?n("TinyWhiteboard",{attrs:{whiteboardData:e.whiteboardData,session:e.session},on:{closeWhiteBoard:e.closeWhiteBoard}}):e._e(),e.showScreenStatus?n("screen",{attrs:{streamManager:e.screenSubcriber},on:{closeShowScreen:e.closeShowScreen}}):e._e(),e.showWhiteBoardStatus||e.showScreenStatus?e._e():n("el-container",[n("el-main",[n("div",{staticClass:"app-video"},[n("div",{staticClass:"room-title"},[e._v(" "+e._s(e.roomInfo.name)+" ")]),n("el-divider",{staticClass:"room-line"}),n("video-board",{attrs:{mainStreamManager:e.mainStreamManager,screenSubcriber:e.screenSubcriber,speakingNameList:e.speakingNameList,publisher:e.publisher,subscribers:e.subscribers,connectionList:e.connectionList},on:{showScreen:function(t){e.showScreenStatus=!0}}}),n("div",{staticClass:"app-video-tool"},[n("div",{staticClass:"app-video-tool-item",on:{click:e.switchMcf}},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[e.audioStatus?n("use",{attrs:{"xlink:href":"#icon-maikefeng"}}):n("use",{attrs:{"xlink:href":"#icon-maikefeng-off"}})]),n("span",{staticClass:"app-video-tool-item-font"},[e._v("讲话")])]),n("div",{staticClass:"app-video-tool-item",on:{click:e.switchSxt}},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[e.videoStatus?n("use",{attrs:{"xlink:href":"#icon-shexiangtou_shiti"}}):n("use",{attrs:{"xlink:href":"#icon-shexiangtou_shiti_off"}})]),n("span",{staticClass:"app-video-tool-item-font"},[e._v("视频")])]),n("div",{staticClass:"app-video-tool-item",class:e.showMemberManagementStatus?"selected-item":"",on:{click:function(t){e.showMemberManagementStatus=!e.showMemberManagementStatus}}},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#icon-chengyuan"}})]),n("span",{staticClass:"app-video-tool-item-font"},[e._v("成员管理")])]),n("div",{staticClass:"app-video-tool-item",class:e.showChatStatus?"selected-item":"",on:{click:function(t){e.showChatStatus=!e.showChatStatus}}},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#icon-liaotian"}})]),n("span",{staticClass:"app-video-tool-item-font"},[e._v("聊天")])]),n("div",{staticClass:"app-video-tool-item",on:{click:e.leaveSession}},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#icon-tuichu"}})]),n("span",{staticClass:"app-video-tool-item-font"},[e._v("退出")])])])],1)]),e.rightTabes.length?n("el-aside",{staticClass:"right-aside",attrs:{width:"23%"}},[n("el-tabs",{attrs:{type:"card",closable:""},on:{"tab-remove":e.closeRightTab},model:{value:e.rightTabeTabsValue,callback:function(t){e.rightTabeTabsValue=t},expression:"rightTabeTabsValue"}},e._l(e.rightTabes,(function(t,i){return n("el-tab-pane",{key:i,attrs:{label:t.title,name:t.name}},["chat"==t.name?n("chat",{ref:"chatComponent",refInFor:!0,attrs:{connectionList:e.connectionList,session:e.session,chatItemList:e.chatItemList}}):e._e(),"memberManagement"==t.name?n("member-management",{attrs:{connectionList:e.connectionList,session:e.session,publisher:e.publisher,role:e.role},on:{sendPrivateMessage:e.sendPrivateMessage}}):e._e(),"meetingFile"==t.name?n("meeting-file",{attrs:{roomId:e.roomId}}):e._e(),"audioChat"==t.name?n("audio-chat",{ref:"chatComponent",refInFor:!0,attrs:{connectionList:e.connectionList,session:e.session,chatItemList:e.audioItemList}}):e._e()],1)})),1)],1):e._e()],1)],1)},o=[],a=n("c7eb"),s=n("1da1"),r=n("b85c"),c=(n("4de4"),n("a434"),n("c19f"),n("ace4"),n("b0c0"),n("4ec9"),n("b64b"),n("d3b7"),n("8a79"),n("3ca3"),n("2ca0"),n("159b"),n("ddb0"),n("2b3d"),n("bf19"),n("9861"),n("3d9c")),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",{staticClass:"chat"},[n("el-header",{staticClass:"chat-history"},e._l(e.chatItemList,(function(t,i){return n("div",{key:i,staticClass:"chat-history-item"},[n("Avatar",{class:t.mine?"chat-history-item-avt-right":"chat-history-item-avt",staticStyle:{"vertical-align":"middle"},attrs:{username:t.name,src:t.name,"background-color":e.extractColorByName(t.name),color:"#fff"}}),n("div",{class:t.mine?"chat-history-item-content-right":"chat-history-item-content"},[n("div",{class:t.mine?"chat-history-item-content-right-name":"chat-history-item-content-name"},[n("span",[e._v(" "+e._s(t.name)+" "),"chat-private"==t.type?n("el-tag",{attrs:{type:"danger"}},[e._v("私")]):e._e()],1)]),"text"==t.contentType?n("div",{class:t.mine?"chat-history-item-content-right-bubble":"chat-history-item-content-bubble"},[n("span",[e._v(" "+e._s(t.content)+" ")])]):"file"==t.contentType?n("div",{staticClass:"click",class:t.mine?"chat-history-item-content-right-bubble":"chat-history-item-content-bubble",on:{click:function(n){return e.downloadFile(t.content)}}},[n("span",[e._v(" "+e._s(e._f("getFilename")(t.content))+" "),n("i",{staticClass:"el-icon-document"})])]):"image"==t.contentType?n("div",{staticClass:"click",class:t.mine?"chat-history-item-content-right-bubble":"chat-history-item-content-bubble",on:{click:function(n){return e.downloadFile(t.content)}}},[n("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e.getUrl(t.content),fit:e.fit}})],1):e._e()])],1)})),0),n("el-main",{staticClass:"chat-input"},[n("div",{staticClass:"chat-input-bar"},[n("span",[e._v("发送至：")]),n("el-select",{staticClass:"noborder",attrs:{filterable:"",size:"mini",placeholder:"请选择成员"},model:{value:e.chatSelectedUserConnection,callback:function(t){e.chatSelectedUserConnection=t},expression:"chatSelectedUserConnection"}},[n("el-option",{attrs:{label:"所有人",value:""}}),e._l(e.connectionList,(function(t){return n("el-option",{key:t.connectionId,attrs:{label:e._f("getRealname")(t.data),value:t.connectionId}})}))],2),n("el-upload",{staticClass:"upload",attrs:{action:e.fileUploadUrl,"before-upload":e.checkImage,"on-success":e.finalUploadImage,accept:"","file-list":[]}},[n("i",{staticClass:"el-icon-picture"})]),n("el-upload",{staticClass:"upload",attrs:{action:e.fileUploadUrl,"on-success":e.finalUploadFile,"file-list":[]}},[n("i",{staticClass:"el-icon-folder-opened"})])],1),n("div",[n("el-input",{staticClass:"noborder",attrs:{type:"textarea",placeholder:"请输入聊天内容",maxlength:"30",rows:"6",resize:"none"},model:{value:e.msgContent,callback:function(t){e.msgContent=t},expression:"msgContent"}})],1),n("div",[n("el-link",{staticClass:"send",attrs:{type:"info",underline:!1},on:{click:function(t){return e.sendMsg("text",e.msgContent)}}},[e._v("发送")]),n("el-link",{staticClass:"send",attrs:{type:"info",underline:!1},nativeOn:{mousedown:function(t){return e.startTextTranscription()},mouseup:function(t){return e.stopTextTranscription()}}},[e._v("语音输入")])],1)])],1)},u=[],d=(n("caad"),n("a15b"),n("fb6a"),n("e9c4"),n("25f0"),n("4a89")),h=n.n(d),m=n("bc3a"),p=n.n(m),f={props:{connectionList:{type:Array},session:{type:Object},chatItemList:{type:Array}},components:{Avatar:h.a},data:function(){return{memberList:[],msgContent:"",chatSelectedUserConnection:"",fileUploadUrl:"http://localhost:8380/storage/upload",socket:null,sampleRate:16e3,chunks:[],realStream:null,ac:null}},filters:{getRealname:function(e){var t=JSON.parse(e);return t.clientData},getFilename:function(e){var t=e.split("|");return console.log(t),t[0]}},mounted:function(){this.init()},methods:{init:function(){var e=sessionStorage.getItem("chat-select-conId");e&&(this.chatSelectedUserConnection=e)},extractColorByName:function(e){var t=[];t.push("#");for(var n=0;n<e.length;n++)t.push(parseInt(e[n].charCodeAt(0),10).toString(16));return t.slice(0,5).join("").slice(0,4)},finalUploadFile:function(e){if(200==e.code){var t=e.data.fileName+"|"+e.data.url;this.sendMsg("file",t)}},finalUploadImage:function(e){if(200==e.code){var t=e.data.fileName+"|"+e.data.url;this.sendMsg("image",t)}},sendMsg:function(e,t){var n=this,i=[];this.chatSelectedUserConnection&&i.push(this.chatSelectedUserConnection),this.session.signal({data:t,to:i,type:0!=i.length?"chat-private-"+e:"chat-mass-"+e}).then((function(){console.log("Message successfully sent"),n.msgContent=""})).catch((function(e){console.error(e)}))},downloadFile:function(e){window.open(e.split("|")[1])},getUrl:function(e){var t=e.split("|");return console.log(t),t[1]},checkImage:function(e){var t=["image/jpeg","image/png","image/gif"],n=t.includes(e.type);return!!n||(this.$message.error("只能上传JPG/PNG/GIF格式的图片"),!1)},selectChatUser:function(e){this.chatSelectedUserConnection=e},startTextTranscription:function(){var e=this;console.log("开始转写了"),this.socket=new WebSocket(window.baseUrl.issmessSpeechStream+"/paddlespeech/asr/streaming"),this.socket.onopen=function(t){var n={name:"zh.wav",signal:"start",nbest:1},i=JSON.stringify(n);e.socket.send(i)},this.socket.onmessage=function(t){var n=JSON.parse(t.data);e.msgContent=n.result};var t={audio:!0};navigator.mediaDevices.getUserMedia(t).then((function(t){console.log(t),e.realStream=t,e.ac=new AudioContext({sampleRate:16e3});var n=e.ac.createMediaStreamSource(t),i=e.ac.createScriptProcessor(4096,1,1),o=e.ac.createMediaStreamDestination();n.connect(i),i.connect(o),i.onaudioprocess=function(t){for(var n=t.inputBuffer,i=t.outputBuffer,o=0;o<i.numberOfChannels;o++){var a=n.getChannelData(o);e.socket.send(e.encodeWAV(a))}}})).catch((function(e){console.log(e)}))},stopTextTranscription:function(){var e=this;return Object(s["a"])(Object(a["a"])().mark((function t(){var n;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.socket.close(),e.socket=null,e.chunks=[],e.realStream.getTracks().forEach((function(e){e.stop()})),e.ac.close(),t.next=7,p.a.post(window.baseUrl.issmessSpeechAsr+"/paddlespeech/text",{text:e.msgContent});case 7:n=t.sent,200==n.data.code&&(e.msgContent=n.data.result.punc_text);case 9:case"end":return t.stop()}}),t)})))()},processPCMData:function(){var e=this.encodeWAV(this.chunks),t=new Blob([e]),n=URL.createObjectURL(t),i=document.createElement("audio");i.style="display: block",i.controls=!0,i.src=n,document.body.appendChild(i)},encodeWAV:function(e){var t=new ArrayBuffer(44+2*e.length),n=new DataView(t);return this.writeString(n,0,"RIFF"),n.setUint32(4,36+2*e.length,!0),this.writeString(n,8,"WAVE"),this.writeString(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,1,!0),n.setUint32(24,this.sampleRate,!0),n.setUint32(28,4*this.sampleRate,!0),n.setUint16(32,2,!0),n.setUint16(34,16,!0),this.writeString(n,36,"data"),n.setUint32(40,2*e.length,!0),this.floatTo16BitPCM(n,44,e),n},writeString:function(e,t,n){for(var i=0;i<n.length;i++)e.setUint8(t+i,n.charCodeAt(i))},floatTo16BitPCM:function(e,t,n){for(var i=0;i<n.length;i++,t+=2){var o=Math.max(-1,Math.min(1,n[i]));e.setInt16(t,o<0?32768*o:32767*o,!0)}}}},b=f,v=(n("9b86"),n("2877")),g=Object(v["a"])(b,l,u,!1,null,"744b5bf1",null),y=g.exports,S=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"screen"},[n("ov-video",{staticClass:"screen-video",attrs:{"stream-manager":e.streamManager}}),n("div",{staticClass:"screen-option"},[n("el-button",{attrs:{type:"text"},on:{click:e.cancelMeeting}},[e._v("返回会议")])],1)],1)},C=[],w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("video",{attrs:{autoplay:""}})},x=[],k={name:"OvVideo",props:{streamManager:Object},mounted:function(){this.streamManager.addVideoElement(this.$el)}},_=k,O=Object(v["a"])(_,w,x,!1,null,null,null),I=O.exports,T={name:"Screen",components:{OvVideo:I},props:{streamManager:Object},mounted:function(){},methods:{cancelMeeting:function(){this.$emit("closeShowScreen")}}},N=T,j=(n("b672"),Object(v["a"])(N,S,C,!1,null,"398485a9",null)),E=j.exports,M=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"member"},[n("el-row",{staticClass:"member-item"},[n("el-col",{attrs:{span:12}},[n("Avatar",{staticClass:"member-item-avt",staticStyle:{"vertical-align":"middle"},attrs:{username:e._f("getRealname")(e.publisher.session.connection.data),src:e._f("getRealname")(e.publisher.session.connection.data),"background-color":e.extractColorByName(e.publisher.session.connection.data),color:"#fff"}}),n("span",{staticClass:"member-item-realname"},[e._v(e._s(e._f("getRealname")(e.publisher.session.connection.data))+"（自己）")])],1),n("el-col",{attrs:{span:12}})],1),e._l(e.connectionList,(function(t,i){return n("el-row",{key:i,staticClass:"member-item"},[n("el-col",{attrs:{span:12}},[n("Avatar",{staticClass:"member-item-avt",staticStyle:{"vertical-align":"middle"},attrs:{username:e._f("getRealname")(t.data),src:e._f("getRealname")(t.data),"background-color":e.extractColorByName(t.data),color:"#fff"}}),n("span",{staticClass:"member-item-realname"},[e._v(e._s(e._f("getRealname")(t.data)))])],1),n("el-col",{staticClass:"member-item-option",attrs:{span:12}},["host"==e.role?[n("el-button",{staticClass:"member-item-option-btn",attrs:{plain:"",size:"mini",type:"danger"},on:{click:function(n){return e.muteMember(t)}}},[e._v("静音")]),n("el-dropdown",[n("el-button",{staticClass:"member-item-option-btn",attrs:{plain:"",size:"mini"}},[e._v(" 更多"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{nativeOn:{click:function(n){return e.kickOutMember(t.connectionId)}}},[e._v("踢出会议")]),n("el-dropdown-item",{nativeOn:{click:function(n){return e.stopVideoMember(t)}}},[e._v("停止视频")]),n("el-dropdown-item",{nativeOn:{click:function(n){return e.sendPrivateMessage(t)}}},[e._v("私聊")])],1)],1)]:[n("el-button",{staticClass:"member-item-option-btn",attrs:{plain:"",size:"mini"},on:{click:function(n){return e.sendPrivateMessage(t)}}},[e._v("私聊")])]],2)],1)})),n("div",{staticClass:"member-tool"},[n("el-divider"),n("el-button",{staticClass:"member-tool-btn",attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.muteAll()}}},[e._v("全员静音")])],1)],2)},F=[],B=n("420d"),L={props:{connectionList:{type:Array},session:{type:Object},publisher:{type:Object},role:{type:String}},components:{Avatar:h.a},data:function(){return{memberList:[],msgContent:"",chatSelectedUserConnection:""}},filters:{getRealname:function(e){var t=JSON.parse(e);return t.clientData}},mounted:function(){},methods:{extractColorByName:function(e){var t=JSON.parse(e).clientData,n=[];n.push("#");for(var i=0;i<t.length;i++)n.push(parseInt(t[i].charCodeAt(0),10).toString(16));return n.slice(0,5).join("").slice(0,4)},kickOutMember:function(e){var t=this;console.log("踢出会议"),console.log(e);var n=new FormData;n.append("sessionId",this.session.sessionId),n.append("connectionId",e),Object(B["e"])(n).then((function(e){200==e.code&&t.$message({message:"踢出成功",type:"success"})}))},muteMember:function(e){this.session.signal({data:"mute",to:[e],type:"meeting-manager"}).then((function(){})).catch((function(e){console.error(e)}))},stopVideoMember:function(e){this.session.signal({data:"stopVideo",to:[e],type:"meeting-manager"}).then((function(){})).catch((function(e){console.error(e)}))},muteAll:function(){this.session.signal({data:"mute",to:[this.connectionList],type:"meeting-manager"}).then((function(){})).catch((function(e){console.error(e)}))},isMemberConnection:function(e){var t=JSON.parse(e.data);return"normal"==t.streamType},sendPrivateMessage:function(e){this.$emit("sendPrivateMessage",e.connectionId)}}},U=L,R=(n("ef63"),Object(v["a"])(U,M,F,!1,null,"19829d3a",null)),D=R.exports,A=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-video-chat"},[n("div",{staticClass:"app-video-chat-speaking"},[e._v(" 正在讲话： "),e._l(e.speakingNameList,(function(t,i){return n("span",{key:i},[e._v(" "+e._s(t)+e._s(i===e.speakingNameList.length-1?" ":",")+" ")])}))],2),e.screenSubcriber?n("div",{staticClass:"app-video-chat-screen-status"},[e._v(" "+e._s(e._f("getRealname")(e.screenSubcriber.stream.connection.data))+" 正在共享屏幕 "),n("el-button",{attrs:{type:"text"},on:{click:e.toScreen}},[e._v("进入")])],1):e._e(),e.hasVideo?[n("my-user-video",{attrs:{"stream-manager":e.publisher}}),e._l(e.connectionList,(function(t){return n("user-video",{key:t.connectionId,attrs:{subscribers:e.subscribers,connection:t}})}))]:[void 0!=e.publisher?n("div",{staticClass:"user-group"},[n("Avatar",{staticClass:"user-group-useravt",staticStyle:{"vertical-align":"middle"},attrs:{username:e._f("getRealname")(e.publisher.stream.connection.data),src:e._f("getRealname")(e.publisher.stream.connection.data),"background-color":e.extractColorByName(e.publisher.stream.connection.data),color:"#fff"}}),n("div",{staticClass:"user-group-username"},[n("span",{staticClass:"user-group-username-name"},[e._v(e._s(e._f("getRealname")(e.publisher.stream.connection.data)))]),void 0!=e.publisher.stream&&e.publisher.stream.audioActive?n("mcf-icon",{staticClass:"user-group-username-icon",attrs:{id:"mcf-icon-"+e.publisher.stream.connection.connectionId,iconStatus:0}}):n("mcf-icon",{staticClass:"user-group-username-icon",attrs:{id:"mcf-icon-"+e.publisher.stream.connection.connectionId,iconStatus:1}})],1)],1):e._e(),e._l(e.connectionList,(function(t,i){return n("div",{key:i,staticClass:"user-group"},[n("Avatar",{staticClass:"user-group-useravt",staticStyle:{"vertical-align":"middle"},attrs:{username:e._f("getRealname")(t.data),src:e._f("getRealname")(t.data),"background-color":e.extractColorByName(t.data),color:"#fff"}}),n("div",{staticClass:"user-group-username"},[n("span",{staticClass:"user-group-username-name"},[e._v(e._s(e._f("getRealname")(t.data)))]),void 0!=t.stream&&t.stream.audioActive?n("mcf-icon",{staticClass:"user-group-username-icon",attrs:{id:"mcf-icon-"+t.connectionId,iconStatus:0}}):n("mcf-icon",{staticClass:"user-group-username-icon",attrs:{id:"mcf-icon-"+t.connectionId,iconStatus:1}})],1)],1)}))]],2)},V=[],W=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.streamManager?n("div",{staticClass:"container"},[n("div",{staticClass:"container-main"},[n("ov-video",{directives:[{name:"show",rawName:"v-show",value:e.streamManager.stream.videoActive,expression:"streamManager.stream.videoActive"}],staticClass:"container-main-video",attrs:{"stream-manager":e.streamManager}}),e.streamManager.stream.videoActive?e._e():n("Avatar",{staticClass:"container-main-avt",staticStyle:{"vertical-align":"middle"},attrs:{username:e.clientData,src:e.clientData,"background-color":e.extractColorByName(e.clientData),color:"#fff"}})],1),n("div",{staticClass:"container-username"},[n("i",{staticClass:"iconfont icon-ziji"}),e._v(" "+e._s(e.clientData)+" "),e.streamManager.stream.audioActive?n("i",{staticClass:"iconfont icon-maikefeng"}):n("i",{staticClass:"iconfont icon-maikefeng-off"})])]):e._e()},P=[],J={name:"MyUserVideo",components:{OvVideo:I,Avatar:h.a},data:function(){return{}},props:{streamManager:Object},mounted:function(){},computed:{clientData:function(){var e=this.getConnectionData(),t=e.clientData;return t}},filters:{getRealname:function(e){var t=JSON.parse(e);return t.clientData}},methods:{getConnectionData:function(){var e=this.streamManager.stream.connection;return JSON.parse(e.data)},extractColorByName:function(e){var t=[];t.push("#");for(var n=0;n<e.length;n++)t.push(parseInt(e[n].charCodeAt(0),10).toString(16));return t.slice(0,5).join("").slice(0,4)}}},$=J,z=(n("8a87"),Object(v["a"])($,W,P,!1,null,"8090f910",null)),G=z.exports,Y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.connection?n("div",{staticClass:"container"},[n("div",{staticClass:"container-main"},[e.connection.stream&&e.connection.stream.videoActive?n("ov-video",{staticClass:"container-main-video",attrs:{"stream-manager":e.connection.stream.streamManager}}):n("Avatar",{staticClass:"container-main-avt",staticStyle:{"vertical-align":"middle"},attrs:{username:e._f("getRealname")(e.connection.data),src:e._f("getRealname")(e.connection.data),"background-color":e.extractColorByName(e.connection.data),color:"#fff"}})],1),n("div",{staticClass:"container-username"},[e._v(" "+e._s(e._f("getRealname")(e.connection.data))+" "),void 0!=e.connection.stream&&e.connection.stream.audioActive?n("i",{staticClass:"iconfont icon-maikefeng"}):n("i",{staticClass:"iconfont icon-maikefeng-off"})])]):e._e()},H=[],K={name:"MyUserVideo",components:{OvVideo:I,Avatar:h.a},data:function(){return{isPublisher:!1}},props:{connection:Object,subscribers:Array},watch:{subscribers:function(){console.log("subscribers变化了"),this.$forceUpdate()}},mounted:function(){console.log("UserVideo-connection"),console.log(Object.keys(this.connection)),console.log(this.connection),console.log(this.connection.stream)},computed:{realname:function(){var e=this.getConnectionData(),t=e.clientData;return t}},filters:{getRealname:function(e){var t=JSON.parse(e);return t.clientData}},methods:{extractColorByName:function(e){var t=JSON.parse(e).clientData,n=[];n.push("#");for(var i=0;i<t.length;i++)n.push(parseInt(t[i].charCodeAt(0),10).toString(16));return n.slice(0,5).join("").slice(0,4)}}},X=K,Z=(n("b3fc"),Object(v["a"])(X,Y,H,!1,null,"7c7bea9e",null)),q=Z.exports,Q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return 0===e.iconStatus?n("img",{attrs:{src:e.mcfIcon}}):1===e.iconStatus?n("img",{attrs:{src:e.mcfOffIcon}}):n("img",{attrs:{src:e.mcfGifIcon}})},ee=[],te=(n("a9e3"),{name:"McfIcon",props:{iconStatus:{type:Number,required:!0}},data:function(){return{mcfIcon:n("4213"),mcfOffIcon:n("9c3c"),mcfGifIcon:n("f37d")}},mounted:function(){}}),ne=te,ie=(n("9d7c"),Object(v["a"])(ne,Q,ee,!1,null,"d2df7ada",null)),oe=ie.exports,ae={props:{subscribers:{type:Array},publisher:{type:Object},connectionList:{type:Array},mainStreamManager:{type:Object},speakingNameList:{type:Array},screenSubcriber:Object},components:{Avatar:h.a,MyUserVideo:G,UserVideo:q,McfIcon:oe},data:function(){return{otherConnections:[],hasVideo:!1}},watch:{publisher:function(){this.updateExixtVideoStatus(),this.$forceUpdate()},subscribers:function(){this.updateExixtVideoStatus(),this.$forceUpdate()}},filters:{getRealname:function(e){var t=JSON.parse(e);return t.clientData}},mounted:function(){},methods:{extractColorByName:function(e){var t=JSON.parse(e),n=t.clientData,i=[];i.push("#");for(var o=0;o<n.length;o++)i.push(parseInt(n[o].charCodeAt(0),10).toString(16));return i.slice(0,5).join("").slice(0,4)},updateExixtVideoStatus:function(){var e,t=Object(r["a"])(this.subscribers);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(console.log(n),void 0!=n.stream&&n.stream.videoActive)return void(this.hasVideo=!0)}}catch(i){t.e(i)}finally{t.f()}void 0!=this.publisher&&void 0!=this.publisher.stream&&this.publisher.stream.videoActive?this.hasVideo=!0:this.hasVideo=!1},toScreen:function(){this.$emit("showScreen")}}},se=ae,re=(n("2b15"),Object(v["a"])(se,A,V,!1,null,"cb805c08",null)),ce=re.exports,le=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-container",[n("el-header",{staticClass:"meeting-file-header"},[n("el-button",{attrs:{size:"mini",round:""},on:{click:e.mkRootDir}},[e._v("新建根目录")]),n("el-button",{attrs:{size:"mini",round:""},on:{click:function(t){return e.getListByParentId("0")}}},[e._v("刷新")])],1),n("el-main",e._l(e.roomFileNodeList,(function(t){return n("meeting-file-node",{key:t.id,ref:"subMeetingFile",refInFor:!0,attrs:{roomFileNodeSub:t,roomId:e.roomId,deep:0},on:{flushChildren:e.flushChildren}})})),1)],1)],1)},ue=[],de=n("b775");function he(e){return Object(de["a"])({url:"/roomFile/findList",method:"get",params:e})}function me(e){return Object(de["a"])({url:"/roomFile/treeList",method:"get",params:e})}function pe(e){return Object(de["a"])({url:"/roomFile/deleteById?id="+e,method:"post"})}function fe(e){return Object(de["a"])({url:"/roomFile/update",method:"post",data:e})}function be(e){return Object(de["a"])({url:"/roomFile/mkdir",method:"post",headers:{"Content-Type":"multipart/form-data"},data:e})}var ve=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-row",{staticClass:"meeting-file-row",nativeOn:{mouseenter:function(t){e.mouseMoved=!0},mouseleave:function(t){e.mouseMoved=!1}}},[n("el-col",{style:{"margin-left":10*e.deep+"px"},attrs:{span:14}},[n("div",{staticClass:"file-row"},[0==e.roomFileNodeSub.entityType?[e.roomFileNodeSub.show?n("i",{staticClass:"el-icon-arrow-down",on:{click:e.expand}}):n("i",{staticClass:"el-icon-arrow-right",on:{click:e.expand}}),n("i",{staticClass:"el-icon-folder-opened"})]:[n("i",{staticClass:"el-icon-document"})],e.isFilenameEdit?n("input",{directives:[{name:"model",rawName:"v-model",value:e.roomFileNodeSub.filename,expression:"roomFileNodeSub.filename"}],ref:"filenameInputRef",staticClass:"filename-input",attrs:{type:"text"},domProps:{value:e.roomFileNodeSub.filename},on:{blur:function(t){return e.filenameInputBlur()},input:function(t){t.target.composing||e.$set(e.roomFileNodeSub,"filename",t.target.value)}}}):n("el-tooltip",{attrs:{effect:"light",content:e.roomFileNodeSub.filename,placement:"top-start"}},[n("span",{staticClass:"filename"},[e._v(e._s(e.roomFileNodeSub.filename))])])],2)]),e.mouseMoved?n("div",{staticClass:"meeting-file-option"},[0!=e.roomFileNodeSub.entityType||e.isFilenameEdit?e._e():n("i",{staticClass:"el-icon-edit",on:{click:e.handEditFileName}}),0==e.roomFileNodeSub.entityType&&e.isFilenameEdit?n("i",{staticClass:"el-icon-check",on:{mousedown:e.updateDirName}}):e._e(),0==e.roomFileNodeSub.entityType?n("el-upload",{staticClass:"meeting-file-option-upload",attrs:{action:e.fileUploadUrl,data:{parentId:e.roomFileNodeSub.id,roomId:e.roomId},"on-success":e.getListByParent,"file-list":e.fileList}},[n("i",{staticClass:"el-icon-upload2"})]):e._e(),0!=e.roomFileNodeSub.entityType||e.isFilenameEdit?e._e():n("i",{staticClass:"el-icon-folder-add",on:{click:e.addDirectory}}),0!=e.roomFileNodeSub.entityType||null!=e.roomFileNodeSub.children&&void 0!=e.roomFileNodeSub.children&&0!=e.roomFileNodeSub.children.length?e._e():n("i",{staticClass:"el-icon-delete",on:{click:e.removeMeetingFile}}),1==e.roomFileNodeSub.entityType?n("i",{staticClass:"el-icon-view"}):e._e(),1==e.roomFileNodeSub.entityType?n("i",{staticClass:"el-icon-download",on:{click:e.downloadFile}}):e._e(),1==e.roomFileNodeSub.entityType?n("i",{staticClass:"el-icon-delete",on:{click:e.removeMeetingFile}}):e._e()],1):e._e()],1),e._l(e.roomFileNodeSub.children,(function(t){return e.roomFileNodeSub.show?n("meeting-file-node",{key:t.id,attrs:{roomFileNodeSub:t,deep:e.deep+1,roomId:e.roomId},on:{flushChildren:e.flushChildren}}):e._e()}))],2)},ge=[],ye={name:"MeetingFileNode",props:{roomFileNodeSub:Object,deep:Number,roomId:String},components:{MeetingFileNode:we},data:function(){return{fileUploadUrl:"http://localhost:8380roomFile/upload",mouseMoved:!1,fileList:[],isFilenameEdit:!1,oldfileName:"",timmer:""}},filters:{},mounted:function(){console.log(this.roomId)},methods:{expand:function(){console.log(this.roomFileNodeSub.show),this.roomFileNodeSub.show?this.roomFileNodeSub.show=!1:this.roomFileNodeSub.show=!0,this.$forceUpdate()},getListByParent:function(){var e=this;return Object(s["a"])(Object(a["a"])().mark((function t(){return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,he({parentId:e.roomFileNodeSub.id,roomId:e.roomId}).then((function(t){200==t.code&&(e.roomFileNodeSub.children=t.data)}));case 2:case"end":return t.stop()}}),t)})))()},removeMeetingFile:function(){var e=this;return Object(s["a"])(Object(a["a"])().mark((function t(){return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,pe(e.roomFileNodeSub.id).then((function(t){200==t.code&&e.$message({message:"删除成功",type:"success"})}));case 2:return t.next=4,he({parentId:e.roomFileNodeSub.parentId,roomId:e.roomId}).then((function(t){200==t.code&&e.$emit("flushChildren",t.data)}));case 4:e.$forceUpdate();case 5:case"end":return t.stop()}}),t)})))()},flushChildren:function(e){this.roomFileNodeSub.children=e,this.$forceUpdate()},handEditFileName:function(){var e=this;this.isFilenameEdit=!0,this.oldfileName=this.roomFileNodeSub.filename,setTimeout((function(){e.$refs.filenameInputRef.focus()}),100)},filenameInputBlur:function(){var e=this;this.timmer=setTimeout((function(){e.isFilenameEdit=!1,e.roomFileNodeSub.filename=e.oldfileName}),100)},updateDirName:function(){var e=this;event.preventDefault(),fe({id:this.roomFileNodeSub.id,filename:this.roomFileNodeSub.filename}).then((function(t){200==t.code?(e.$message({message:"修改成功",type:"success"}),e.isFilenameEdit=!1):e.roomFileNodeSub.filename=e.oldfileName}))},addDirectory:function(){var e=this;this.roomFileNodeSub.show=!0;var t=new FormData;t.append("dirName","新建文件夹"),t.append("parentId",this.roomFileNodeSub.id),t.append("roomId",this.roomId),be(t).then((function(t){200==t.code&&e.roomFileNodeSub.children.push(t.data)}))},downloadFile:function(){var e=this;return Object(s["a"])(Object(a["a"])().mark((function t(){var n,i,o;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,p()({url:e.roomFileNodeSub.fileUrl,method:"GET",responseType:"blob"});case 3:n=t.sent,i=window.URL.createObjectURL(new Blob([n.data])),o=document.createElement("a"),o.href=i,o.setAttribute("download",e.roomFileNodeSub.filename),document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(i),document.body.removeChild(o),t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](0),console.error("下载文件时出错:",t.t0);case 17:case"end":return t.stop()}}),t,null,[[0,14]])})))()}}},Se=ye,Ce=(n("81e1"),Object(v["a"])(Se,ve,ge,!1,null,"38c544ac",null)),we=Ce.exports,xe={props:{roomId:String},components:{MeetingFileNode:we},data:function(){return{roomFileNodeList:[],selectedRoomFile:{}}},filters:{},mounted:function(){this.getListByParentId("0")},methods:{getListByParentId:function(e){var t=this;me({parentId:e,roomId:this.roomId}).then((function(e){t.roomFileNodeList=e.data;var n,i=Object(r["a"])(t.roomFileNodeList);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.show=!0}}catch(a){i.e(a)}finally{i.f()}}))},mkRootDir:function(){var e=this,t=new FormData;t.append("dirName","新建文件夹"),t.append("parentId","0"),t.append("roomId",this.roomId),be(t).then((function(t){200==t.code&&e.getListByParentId("0")}))},flushChildren:function(){this.getListByParentId("0")}}},ke=xe,_e=(n("993e"),Object(v["a"])(ke,le,ue,!1,null,"3bcdb83c",null)),Oe=_e.exports,Ie=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",{staticClass:"chat"},[n("el-header",{staticClass:"chat-history"},e._l(e.chatItemList,(function(t,i){return""!=t.content?n("div",{key:i,staticClass:"chat-history-item"},[n("Avatar",{class:t.mine?"chat-history-item-avt-right":"chat-history-item-avt",staticStyle:{"vertical-align":"middle"},attrs:{username:t.name,src:t.name,"background-color":e.extractColorByName(t.name),color:"#fff"}}),n("div",{class:t.mine?"chat-history-item-content-right":"chat-history-item-content"},[n("div",{class:t.mine?"chat-history-item-content-right-name":"chat-history-item-content-name"},[n("span",[e._v(" "+e._s(t.name)+" "),"chat-private"==t.type?n("el-tag",{attrs:{type:"danger"}},[e._v("私")]):e._e()],1)]),"text"==t.contentType?n("div",{class:t.mine?"chat-history-item-content-right-bubble":"chat-history-item-content-bubble"},[n("span",[e._v(" "+e._s(t.content)+" ")])]):"file"==t.contentType?n("div",{staticClass:"click",class:t.mine?"chat-history-item-content-right-bubble":"chat-history-item-content-bubble",on:{click:function(n){return e.downloadFile(t.content)}}},[n("span",[e._v(" "+e._s(e._f("getFilename")(t.content))+" "),n("i",{staticClass:"el-icon-document"})])]):"image"==t.contentType?n("div",{staticClass:"click",class:t.mine?"chat-history-item-content-right-bubble":"chat-history-item-content-bubble",on:{click:function(n){return e.downloadFile(t.content)}}},[n("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e.getUrl(t.content),fit:e.fit}})],1):e._e()])],1):e._e()})),0)],1)},Te=[],Ne={props:{connectionList:{type:Array},session:{type:Object},chatItemList:{type:Array}},components:{Avatar:h.a},data:function(){return{memberList:[],msgContent:"",chatSelectedUserConnection:"",fileUploadUrl:"http://localhost:8380/storage/upload",socket:null,isRecording:!1,sampleRate:16e3,chunks:[],realStream:null,ac:null}},filters:{getRealname:function(e){var t=JSON.parse(e);return t.clientData},getFilename:function(e){var t=e.split("|");return console.log(t),t[0]}},mounted:function(){this.init()},methods:{init:function(){var e=sessionStorage.getItem("chat-select-conId");e&&(this.chatSelectedUserConnection=e)},extractColorByName:function(e){var t=[];t.push("#");for(var n=0;n<e.length;n++)t.push(parseInt(e[n].charCodeAt(0),10).toString(16));return t.slice(0,5).join("").slice(0,4)},finalUploadFile:function(e){if(200==e.code){var t=e.data.fileName+"|"+e.data.url;this.sendMsg("file",t)}},finalUploadImage:function(e){if(200==e.code){var t=e.data.fileName+"|"+e.data.url;this.sendMsg("image",t)}},sendMsg:function(e,t){var n=this,i=[];this.chatSelectedUserConnection&&i.push(this.chatSelectedUserConnection),this.session.signal({data:t,to:i,type:0!=i.length?"chat-private-"+e:"chat-mass-"+e}).then((function(){console.log("Message successfully sent"),n.msgContent=""})).catch((function(e){console.error(e)}))},downloadFile:function(e){window.open(e.split("|")[1])},getUrl:function(e){var t=e.split("|");return console.log(t),t[1]},checkImage:function(e){var t=["image/jpeg","image/png","image/gif"],n=t.includes(e.type);return!!n||(this.$message.error("只能上传JPG/PNG/GIF格式的图片"),!1)},selectChatUser:function(e){this.chatSelectedUserConnection=e},startTextTranscription:function(){var e=this;console.log("开始转写了"),this.socket=new WebSocket(window.baseUrl.issmessSpeechStream+"/paddlespeech/asr/streaming"),this.socket.onopen=function(t){var n={name:"zh.wav",signal:"start",nbest:1},i=JSON.stringify(n);e.socket.send(i)},this.socket.onmessage=function(t){var n=JSON.parse(t.data);e.msgContent=n.result};var t={audio:!0};navigator.mediaDevices.getUserMedia(t).then((function(t){console.log(t),e.realStream=t,e.ac=new AudioContext({sampleRate:16e3});var n=e.ac.createMediaStreamSource(t),i=e.ac.createScriptProcessor(4096,1,1),o=e.ac.createMediaStreamDestination();n.connect(i),i.connect(o),i.onaudioprocess=function(t){for(var n=t.inputBuffer,i=t.outputBuffer,o=0;o<i.numberOfChannels;o++){var a=n.getChannelData(o);e.socket.send(e.encodeWAV(a))}}})).catch((function(e){console.log(e)}))},stopTextTranscription:function(){var e=this;return Object(s["a"])(Object(a["a"])().mark((function t(){var n;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.socket.close(),e.socket=null,e.chunks=[],e.realStream.getTracks().forEach((function(e){e.stop()})),e.ac.close(),t.next=7,p.a.post(window.baseUrl.issmessSpeechAsr+"/paddlespeech/text",{text:e.msgContent});case 7:n=t.sent,200==n.data.code&&(e.msgContent=n.data.result.punc_text);case 9:case"end":return t.stop()}}),t)})))()},processPCMData:function(){var e=this.encodeWAV(this.chunks),t=new Blob([e]),n=URL.createObjectURL(t),i=document.createElement("audio");i.style="display: block",i.controls=!0,i.src=n,document.body.appendChild(i)},encodeWAV:function(e){var t=new ArrayBuffer(44+2*e.length),n=new DataView(t);return this.writeString(n,0,"RIFF"),n.setUint32(4,36+2*e.length,!0),this.writeString(n,8,"WAVE"),this.writeString(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,1,!0),n.setUint32(24,this.sampleRate,!0),n.setUint32(28,4*this.sampleRate,!0),n.setUint16(32,2,!0),n.setUint16(34,16,!0),this.writeString(n,36,"data"),n.setUint32(40,2*e.length,!0),this.floatTo16BitPCM(n,44,e),n},writeString:function(e,t,n){for(var i=0;i<n.length;i++)e.setUint8(t+i,n.charCodeAt(i))},floatTo16BitPCM:function(e,t,n){for(var i=0;i<n.length;i++,t+=2){var o=Math.max(-1,Math.min(1,n[i]));e.setInt16(t,o<0?32768*o:32767*o,!0)}}}},je=Ne,Ee=(n("4c4e"),Object(v["a"])(je,Ie,Te,!1,null,"5931ce4c",null)),Me=Ee.exports,Fe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"container",staticClass:"container"},[n("div",{ref:"box",staticClass:"canvasBox"}),n("div",{staticClass:"option"},[n("el-button",{attrs:{size:"small",round:""}},[e._v("协同")]),n("el-button",{attrs:{size:"small",round:""},on:{click:function(t){return e.test()}}},[e._v("测试")]),n("el-button",{attrs:{size:"small",round:""},on:{click:e.cancelMeeting}},[e._v("返回")])],1),e.readonly?e._e():n("div",{staticClass:"toolbar"},[n("el-radio-group",{on:{change:e.onCurrentTypeChange},model:{value:e.currentType,callback:function(t){e.currentType=t},expression:"currentType"}},[n("el-radio-button",{attrs:{label:"selection"}},[e._v("选择")]),n("el-radio-button",{attrs:{label:"rectangle"}},[e._v("矩形")]),n("el-radio-button",{attrs:{label:"diamond"}},[e._v("菱形")]),n("el-radio-button",{attrs:{label:"triangle"}},[e._v("三角形")]),n("el-radio-button",{attrs:{label:"circle"}},[e._v("圆形")]),n("el-radio-button",{attrs:{label:"line"}},[e._v("线段")]),n("el-radio-button",{attrs:{label:"arrow"}},[e._v("箭头")]),n("el-radio-button",{attrs:{label:"freedraw"}},[e._v("自由画笔")]),n("el-radio-button",{attrs:{label:"text"}},[e._v("文字")]),n("el-radio-button",{attrs:{label:"image"}},[e._v("图片")])],1)],1),n("Transition",[n("div",{directives:[{name:"show",rawName:"v-show",value:e.activeElement||e.hasSelectedElements,expression:"activeElement || hasSelectedElements"}],staticClass:"sidebar"},[n("div",{staticClass:"elementStyle"},[n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:12}},[!["text","image"].includes(e.activeElementType)||e.hasSelectedElements?n("div",{staticClass:"styleBlock"},[n("div",{staticClass:"styleBlockTitle"},[e._v("描边")]),n("div",{staticClass:"styleBlockContent"},[n("el-color-picker",{attrs:{size:"small"},on:{change:function(t){return e.updateStyle("strokeStyle",t)}},model:{value:e.activeElementStyle,callback:function(t){e.activeElementStyle=t},expression:"activeElementStyle"}})],1)]):e._e()]),n("el-col",{attrs:{span:12}},[!["image","line","arrow","freedraw"].includes(e.activeElementType)||e.hasSelectedElements?n("div",{staticClass:"styleBlock"},[n("div",{staticClass:"styleBlockTitle"},[e._v("填充")]),n("div",{staticClass:"styleBlockContent"},[n("el-color-picker",{attrs:{size:"small"},on:{change:function(t){return e.updateStyle("fillStyle",t)}},model:{value:e.activeElementFillStyle,callback:function(t){e.activeElementFillStyle=t},expression:"activeElementFillStyle"}})],1)]):e._e()])],1),["text"].includes(e.activeElementType)||e.hasSelectedElements?n("div",{staticClass:"styleBlock"},[n("div",{staticClass:"styleBlockTitle"},[e._v("字体")]),n("div",{staticClass:"styleBlockContent"},[n("el-select",{attrs:{size:"mini",placeholder:"字体"},on:{change:function(t){return e.updateStyle("fontFamily",t)}},model:{value:e.fontFamily,callback:function(t){e.fontFamily=t},expression:"fontFamily"}},e._l(e.fontFamilyList,(function(e){return n("el-option",{key:e.value,style:{fontFamily:e.value},attrs:{label:e.name,value:e.value}})})),1)],1)]):e._e(),["text"].includes(e.activeElementType)||e.hasSelectedElements?n("div",{staticClass:"styleBlock"},[n("div",{staticClass:"styleBlockTitle"},[e._v("字号")]),n("div",{staticClass:"styleBlockContent"},[n("el-select",{attrs:{size:"mini",placeholder:"字号"},on:{change:function(t){return e.updateStyle("fontSize",t)}},model:{value:e.fontSize,callback:function(t){e.fontSize=t},expression:"fontSize"}},e._l(e.fontSizeList,(function(e){return n("el-option",{key:e.value,style:{fontSize:e.value},attrs:{label:e.name,value:e.value}})})),1)],1)]):e._e(),!["image","text"].includes(e.activeElementType)||e.hasSelectedElements?n("div",{staticClass:"styleBlock"},[n("div",{staticClass:"styleBlockTitle"},[e._v("描边宽度")]),n("div",{staticClass:"styleBlockContent"},[n("el-radio-group",{attrs:{size:"mini"},on:{change:function(t){return e.updateStyle("lineWidth",t)}},model:{value:e.lineWidth,callback:function(t){e.lineWidth=t},expression:"lineWidth"}},[n("el-radio-button",{attrs:{label:"small"}},[n("div",{staticClass:"lineWidthItem small"},[n("div",{staticClass:"bar"})])]),n("el-radio-button",{attrs:{label:"middle"}},[n("div",{staticClass:"lineWidthItem middle"},[n("div",{staticClass:"bar"})])]),n("el-radio-button",{attrs:{label:"large"}},[n("div",{staticClass:"lineWidthItem large"},[n("div",{staticClass:"bar"})])])],1)],1)]):e._e(),!["freedraw","image","text"].includes(e.activeElementType)||e.hasSelectedElements?n("div",{staticClass:"styleBlock"},[n("div",{staticClass:"styleBlockTitle"},[e._v("边框样式")]),n("div",{staticClass:"styleBlockContent"},[n("el-radio-group",{attrs:{size:"mini"},on:{change:function(t){return e.updateStyle("lineDash",t)}},model:{value:e.lineDash,callback:function(t){e.lineDash=t},expression:"lineDash"}},[n("el-radio-button",{attrs:{label:0}},[n("div",[e._v("实线")])]),n("el-radio-button",{attrs:{label:5}},[n("div",[e._v("大虚线")])]),n("el-radio-button",{attrs:{label:2}},[n("div",[e._v("小虚线")])])],1)],1)]):e._e(),n("div",{staticClass:"styleBlock"},[n("div",{staticClass:"styleBlockTitle"},[e._v("透明度")]),n("div",[n("el-slider",{attrs:{min:0,max:1,step:.1},on:{change:function(t){return e.updateStyle("globalAlpha",t)}},model:{value:e.globalAlpha,callback:function(t){e.globalAlpha=t},expression:"globalAlpha"}})],1)]),e.hasSelectedElements?e._e():n("div",{staticClass:"styleBlock"},[n("div",{staticClass:"styleBlockTitle"},[e._v("角度")]),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:16}},[n("el-slider",{attrs:{min:0,max:360,step:1},on:{input:e.onRotateChange},model:{value:e.rotate,callback:function(t){e.rotate=t},expression:"rotate"}})],1),n("el-col",{attrs:{span:8}},[n("el-input-number",{staticStyle:{width:"60px"},attrs:{size:"mini",controls:!1,min:0,max:360},on:{focus:e.onInputNumberFocus,blur:e.onInputNumberBlur,change:e.onRotateChange},model:{value:e.rotate,callback:function(t){e.rotate=t},expression:"rotate"}})],1)],1)],1),n("div",{staticClass:"styleBlock"},[n("div",{staticClass:"styleBlockTitle"},[e._v("操作")]),n("div",{staticClass:"styleBlockContent"},[n("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:e.deleteElement}}),n("el-button",{attrs:{type:"primary",icon:"el-icon-document-copy",circle:""},on:{click:e.copyElement}})],1)])],1)])]),n("div",{staticClass:"TinyWhiteboard-footerLeft",staticStyle:{display:"flex"},on:{click:function(e){e.stopPropagation()}}},[n("div",{staticClass:"blockBox"},[n("el-tooltip",{attrs:{effect:"light",content:"缩小",placement:"top"}},[n("el-button",{attrs:{icon:"el-icon-zoom-out",circle:""},on:{click:e.zoomOut}})],1),n("el-tooltip",{attrs:{effect:"light",content:"重置缩放",placement:"top"}},[n("span",{staticClass:"zoom",on:{click:e.resetZoom}},[e._v(e._s(e.currentZoom)+"%")])]),n("el-tooltip",{attrs:{effect:"light",content:"放大",placement:"top"}},[n("el-button",{attrs:{icon:"el-icon-zoom-in",circle:""},on:{click:e.zoomIn}})],1)],1),e.readonly?e._e():n("div",{staticClass:"blockBox"},[n("el-tooltip",{attrs:{effect:"light",content:"回退",placement:"top"}},[n("el-button",{attrs:{icon:"el-icon-refresh-left",circle:"",disabled:!e.canUndo},on:{click:e.undo}})],1),n("el-tooltip",{attrs:{effect:"light",content:"前进",placement:"top"}},[n("el-button",{attrs:{icon:"el-icon-refresh-right",circle:"",disabled:!e.canRedo},on:{click:e.redo}})],1)],1),n("div",{staticClass:"blockBox"},[n("el-tooltip",{attrs:{effect:"light",content:"eraser"===e.currentType?"关闭橡皮擦":"橡皮擦",placement:"top"}},[e.readonly?e._e():n("el-button",{attrs:{icon:"el-icon-partly-cloudy",circle:"",type:"eraser"===e.currentType?"primary":null},on:{click:e.toggleEraser}})],1),n("el-tooltip",{attrs:{effect:"light",content:e.showGrid?"隐藏网格":"显示网格",placement:"top"}},[n("el-button",{attrs:{icon:"el-icon-s-grid",circle:"",type:e.showGrid?"primary":null},on:{click:e.toggleGrid}})],1),n("el-tooltip",{attrs:{effect:"light",content:e.readonly?"切换到编辑模式":"切换到只读模式",placement:"top"}},[n("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}],attrs:{icon:e.readonly?"el-icon-view":"el-icon-edit-outline",circle:""},on:{click:e.toggleMode}})],1),n("el-tooltip",{attrs:{effect:"light",content:"清空",placement:"top"}},[e.readonly?e._e():n("el-button",{attrs:{icon:"el-icon-delete",circle:""},on:{click:e.empty}})],1)],1),n("div",{staticClass:"blockBox"},[n("el-tooltip",{attrs:{effect:"light",content:"从json文件导入",placement:"top"}},[e.readonly?e._e():n("el-button",{staticStyle:{"margin-right":"10px"},attrs:{icon:"el-icon-upload2",circle:""},on:{click:e.importFromJson}})],1),n("el-dropdown",{on:{command:e.handleExportCommand},scopedSlots:e._u([{key:"dropdown",fn:function(){return[n("el-dropdown-menu",[n("el-dropdown-item",{attrs:{command:"png"}},[e._v("导出为图片")]),n("el-dropdown-item",{attrs:{command:"json"}},[e._v("导出为json")])],1)]},proxy:!0}])},[n("span",{staticClass:"el-dropdown-link"},[n("el-button",{attrs:{icon:"el-icon-download",circle:""}})],1)])],1),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.readonly,expression:"!readonly"}],staticClass:"blockBox"},[n("el-tooltip",{attrs:{effect:"light",content:"背景颜色",placement:"top"}},[n("el-color-picker",{attrs:{size:"small"},on:{change:e.setBackgroundColor},model:{value:e.backgroundColor,callback:function(t){e.backgroundColor=t},expression:"backgroundColor"}})],1)],1),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}],staticClass:"blockBox"},[n("el-tooltip",{attrs:{effect:"light",content:"帮助",placement:"top"}},[n("el-button",{staticStyle:{"margin-right":"10px"},attrs:{icon:"el-icon-question",circle:""},on:{click:function(t){e.helpDialogVisible=!e.helpDialogVisible}}})],1)],1),n("div",{staticClass:"blockBox"},[n("el-tooltip",{attrs:{effect:"light",content:"滚动至中心",placement:"top"}},[n("el-button",{on:{click:e.scrollToCenter}},[e._v("X:"+e._s(e.scroll.x)+" Y:"+e._s(e.scroll.y)+" ")])],1)],1)]),n("el-dialog",{attrs:{visible:e.exportImageDialogVisible,title:"导出为图片","append-to-body":"",width:"800"},on:{"update:visible":function(t){e.exportImageDialogVisible=t}}},[n("div",{staticClass:"exportImageContainer"},[n("div",{staticClass:"imagePreviewBox"},[n("img",{attrs:{src:e.exportImageUrl,alt:""}})]),n("div",{staticClass:"handleBox"},[n("el-checkbox",{staticStyle:{"margin-right":"10px"},attrs:{label:"仅导出被选中",size:"large"},on:{change:e.reRenderExportImage},model:{value:e.exportOnlySelected,callback:function(t){e.exportOnlySelected=t},expression:"exportOnlySelected"}}),n("el-checkbox",{staticStyle:{"margin-right":"10px"},attrs:{label:"背景",size:"large"},on:{change:e.reRenderExportImage},model:{value:e.exportRenderBackground,callback:function(t){e.exportRenderBackground=t},expression:"exportRenderBackground"}}),n("el-input",{staticStyle:{width:"150px","margin-right":"10px"},model:{value:e.exportFileName,callback:function(t){e.exportFileName=t},expression:"exportFileName"}}),n("el-input-number",{staticStyle:{"margin-right":"10px"},attrs:{min:10,max:100,step:5,"controls-position":"right"},on:{change:e.reRenderExportImage},model:{value:e.exportImagePaddingX,callback:function(t){e.exportImagePaddingX=t},expression:"exportImagePaddingX"}}),n("el-input-number",{staticStyle:{"margin-right":"10px"},attrs:{min:10,max:100,step:5,"controls-position":"right"},on:{change:e.reRenderExportImage},model:{value:e.exportImagePaddingY,callback:function(t){e.exportImagePaddingY=t},expression:"exportImagePaddingY"}}),n("el-button",{attrs:{type:"primary"},on:{click:e.downloadExportImage}},[e._v("下载")])],1)])]),n("el-dialog",{attrs:{visible:e.exportJsonDialogVisible,title:"导出为json","append-to-body":"",width:"800"},on:{"update:visible":function(t){e.exportJsonDialogVisible=t}}},[n("div",{staticClass:"exportJsonContainer"},[n("div",{ref:"jsonPreviewBox",staticClass:"jsonPreviewBox"}),n("div",{staticClass:"handleBox"},[n("el-input",{staticStyle:{width:"150px","margin-right":"10px"},model:{value:e.exportFileName,callback:function(t){e.exportFileName=t},expression:"exportFileName"}}),n("el-button",{attrs:{type:"primary"},on:{click:e.downloadExportJson}},[e._v("下载")])],1)])]),n("el-dialog",{attrs:{visible:e.helpDialogVisible,title:"帮助","append-to-body":"",width:"500"},on:{"update:visible":function(t){e.helpDialogVisible=t}}},[n("div",{staticClass:"helpDialogContent"},[n("p",[e._v("移动画布：按住空格键进行拖动")]),n("h2",[e._v("快捷键")]),n("el-table",{attrs:{data:e.shortcutKeyList}},[n("el-table-column",{attrs:{property:"name",label:"操作"}}),n("el-table-column",{attrs:{property:"value",label:"快捷键"}})],1)],1)]),e.Whiteboard?n("Contextmenu",{attrs:{app:e.Whiteboard}}):e._e()],1)},Be=[],Le=n("ade3"),Ue=(n("d81d"),n("ab23")),Re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isShow?n("div",{staticClass:"contextmenuContainer",style:{left:e.left+"px",top:e.top+"px"}},[e.isHasActiveElements?[n("div",{staticClass:"item",class:{disabled:!e.canMoveLevel},on:{click:function(t){return e.exec("moveUp")}}},[e._v(" 上移一层 ")]),n("div",{staticClass:"item",class:{disabled:!e.canMoveLevel},on:{click:function(t){return e.exec("moveDown")}}},[e._v(" 下移一层 ")]),n("div",{staticClass:"item",class:{disabled:!e.canMoveLevel},on:{click:function(t){return e.exec("moveTop")}}},[e._v(" 置于顶层 ")]),n("div",{staticClass:"item",class:{disabled:!e.canMoveLevel},on:{click:function(t){return e.exec("moveBottom")}}},[e._v(" 置于底层 ")]),n("div",{staticClass:"splitLine"}),n("div",{staticClass:"item danger",on:{click:function(t){return e.exec("del")}}},[e._v("删除")]),n("div",{staticClass:"item",on:{click:function(t){return e.exec("copy")}}},[e._v("复制")]),n("div",{staticClass:"item",class:{disabled:"disabled"===e.groupStatus},on:{click:function(t){return e.exec(e.groupStatus)}}},[e._v(" "+e._s(e.groupBtnText)+" ")])]:[n("div",{staticClass:"item",on:{click:function(t){return e.exec("selectAll")}}},[e._v("全部选中")]),n("div",{staticClass:"item",on:{click:function(t){return e.exec("backToCenter")}}},[e._v("回到中心")]),n("div",{staticClass:"item",on:{click:function(t){return e.exec("fit")}}},[e._v("显示全部")]),n("div",{staticClass:"item",on:{click:function(t){return e.exec("resetZoom")}}},[e._v("重置缩放")])]],2):e._e()},De=[],Ae={props:{app:{type:Object}},data:function(){return{isShow:!1,left:0,top:0,isHasActiveElements:!1,canMoveLevel:!1,groupStatus:"disabled"}},watch:{groupStatus:function(e,t){switch(e){case"disabled":this.groupBtnText="编组";break;case"dogroup":this.groupBtnText="编组";break;case"ungroup":this.groupBtnText="取消编组";break;default:break}}},mounted:function(){this.init()},methods:{init:function(){this.app.on("contextmenu",this.show),document.body.addEventListener("click",this.hide)},hide:function(){this.isShow=!1,this.left=0,this.top=0},exec:function(e){switch(e){case"moveUp":this.app.moveUpCurrentElement();break;case"moveDown":this.app.moveDownCurrentElement();break;case"moveTop":this.app.moveTopCurrentElement();break;case"moveBottom":this.app.moveBottomCurrentElement();break;case"del":this.app.deleteCurrentElements();break;case"copy":this.app.copyPasteCurrentElements();break;case"selectAll":this.app.selectAll();break;case"backToCenter":this.app.scrollToCenter();break;case"fit":this.app.fit();break;case"resetZoom":this.app.setZoom(1);case"dogroup":this.app.dogroup();break;case"ungroup":this.app.ungroup();break;default:break}},show:function(e,t){this.isHasActiveElements=t.length>0,this.canMoveLevel=1===t.length,this.left=e.clientX+10,this.top=e.clientY+10,this.isShow=!0,this.handleGroup(t)},handleGroup:function(e){var t=!0;e.forEach((function(e){e.hasGroup()||(t=!1)})),t?this.groupStatus="ungroup":e.length>1&&(this.groupStatus="dogroup")}}},Ve=Ae,We=(n("90ab"),Object(v["a"])(Ve,Re,De,!1,null,"4b36a8ac",null)),Pe=We.exports,Je=n("53ca"),$e=(n("4e82"),n("ac1f"),n("1276"),function(){var e={getClass:function(e){return Object.prototype.toString.call(e)},getType:function(t){if(null===t)return"null";switch(Object(Je["a"])(t)){case"number":return"number";case"string":return"string";case"boolean":return"boolean"}switch(e.getClass(t)){case"[object Array]":return"array";case"[object Object]":return"object"}throw new Error("Bad type: "+e.getClass(t))},forEachNode:function(t,n){var i,o=e.getType(t);switch(o){case"array":i=t.length-1,t.forEach((function(e,t){n(t,e,t===i)}));break;case"object":var a=Object.keys(t).sort();i=a.length-1,a.forEach((function(e,o){n(e,t[e],o===i)}));break}},inherits:function(){var e=function(){};return function(t,n){e.prototype=n.prototype,t.prototype=new e,t.prototype.constructor=t}}(),isValidRoot:function(t){switch(e.getType(t)){case"object":case"array":return!0;default:return!1}},extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}};function t(n,i,o){var a=e.getType(i);if(a in t.CONSTRUCTORS)return new t.CONSTRUCTORS[a](n,i,o);throw new Error("Bad type: "+e.getClass(i))}function n(e,t,i){if(this.constructor===n)throw new Error("This is abstract class");var o,a=this,s=document.createElement("li"),r=function(e,t){var n='                    <span class="jsontree_label-wrapper">                        <span class="jsontree_label">"'+e+'"</span> :                     </span>                    <span class="jsontree_value-wrapper">                        <span class="jsontree_value jsontree_value_'+a.type+'">'+t+"</span>"+(i?"":",")+"</span>";return n};a.label=e,a.isComplex=!1,s.classList.add("jsontree_node"),s.innerHTML=r(e,t),a.el=s,o=s.querySelector(".jsontree_label"),o.addEventListener("click",(function(e){if(!e.altKey)return e.shiftKey?(document.getSelection().removeAllRanges(),void alert(a.getJSONPath())):void 0;a.toggleMarked()}),!1)}function i(e,t,i){this.type="boolean",n.call(this,e,t,i)}function o(e,t,i){this.type="number",n.call(this,e,t,i)}function a(e,t,i){this.type="string",n.call(this,e,'"'+t+'"',i)}function s(e,t,i){this.type="null",n.call(this,e,t,i)}function r(n,i,o){if(this.constructor===r)throw new Error("This is abstract class");var a,s,c,l=this,u=document.createElement("li"),d=function(e,t){var n=o?"":",",i='                        <div class="jsontree_value-wrapper">                            <div class="jsontree_value jsontree_value_'+l.type+'">                                <b>'+t[0]+'</b>                                <span class="jsontree_show-more">&hellip;</span>                                <ul class="jsontree_child-nodes"></ul>                                <b>'+t[1]+"</b></div>"+n+"</div>";return null!==e&&(i='                        <span class="jsontree_label-wrapper">                            <span class="jsontree_label"><span class="jsontree_expand-button"></span>"'+e+'"</span> :                         </span>'+i),i},h=[];l.label=n,l.isComplex=!0,u.classList.add("jsontree_node"),u.classList.add("jsontree_node_complex"),u.innerHTML=d(n,l.sym),a=u.querySelector(".jsontree_child-nodes"),null!==n?(s=u.querySelector(".jsontree_label"),c=u.querySelector(".jsontree_show-more"),s.addEventListener("click",(function(e){if(!e.altKey)return e.shiftKey?(document.getSelection().removeAllRanges(),void alert(l.getJSONPath())):void l.toggle(e.ctrlKey||e.metaKey);l.toggleMarked()}),!1),c.addEventListener("click",(function(e){l.toggle(e.ctrlKey||e.metaKey)}),!1),l.isRoot=!1):(l.isRoot=!0,l.parent=null,u.classList.add("jsontree_node_expanded")),l.el=u,l.childNodes=h,l.childNodesUl=a,e.forEachNode(i,(function(e,n,i){l.addChild(new t(e,n,i))})),l.isEmpty=!Boolean(h.length),l.isEmpty&&u.classList.add("jsontree_node_empty")}function c(e,t,n){this.sym=["{","}"],this.type="object",r.call(this,e,t,n)}function l(e,t,n){this.sym=["[","]"],this.type="array",r.call(this,e,t,n)}function u(e,t){this.wrapper=document.createElement("ul"),this.wrapper.className="jsontree_tree clearfix",this.rootNode=null,this.sourceJSONObj=e,this.loadData(e),this.appendTo(t)}return t.CONSTRUCTORS={boolean:i,number:o,string:a,null:s,object:c,array:l},n.prototype={constructor:n,mark:function(){this.el.classList.add("jsontree_node_marked")},unmark:function(){this.el.classList.remove("jsontree_node_marked")},toggleMarked:function(){this.el.classList.toggle("jsontree_node_marked")},expandParent:function(e){this.parent&&(this.parent.expand(),this.parent.expandParent(e))},getJSONPath:function(e){return this.isRoot?"$":(t="array"===this.parent.type?"["+this.label+"]":e?"."+this.label:"['"+this.label+"']",this.parent.getJSONPath(e)+t);var t}},e.inherits(i,n),e.inherits(o,n),e.inherits(a,n),e.inherits(s,n),e.inherits(r,n),e.extend(r.prototype,{constructor:r,addChild:function(e){this.childNodes.push(e),this.childNodesUl.appendChild(e.el),e.parent=this},expand:function(e){this.isEmpty||(this.isRoot||this.el.classList.add("jsontree_node_expanded"),e&&this.childNodes.forEach((function(t,n){t.isComplex&&t.expand(e)})))},collapse:function(e){this.isEmpty||(this.isRoot||this.el.classList.remove("jsontree_node_expanded"),e&&this.childNodes.forEach((function(t,n){t.isComplex&&t.collapse(e)})))},toggle:function(e){if(!this.isEmpty&&(this.el.classList.toggle("jsontree_node_expanded"),e)){var t=this.el.classList.contains("jsontree_node_expanded");this.childNodes.forEach((function(n,i){n.isComplex&&n[t?"expand":"collapse"](e)}))}},findChildren:function(e,t,n){this.isEmpty||this.childNodes.forEach((function(i,o){e(i)&&t(i),i.isComplex&&n&&i.findChildren(e,t,n)}))}}),e.inherits(c,r),e.inherits(l,r),u.prototype={constructor:u,loadData:function(n){e.isValidRoot(n)?(this.sourceJSONObj=n,this.rootNode=new t(null,n,"last"),this.wrapper.innerHTML="",this.wrapper.appendChild(this.rootNode.el)):alert("The root should be an object or an array")},appendTo:function(e){e.appendChild(this.wrapper)},expand:function(e){this.rootNode.isComplex&&("function"==typeof e?this.rootNode.childNodes.forEach((function(t,n){t.isComplex&&e(t)&&t.expand()})):this.rootNode.expand("recursive"))},collapse:function(){"function"===typeof this.rootNode.collapse&&this.rootNode.collapse("recursive")},toSourceJSON:function(e){if(!e)return JSON.stringify(this.sourceJSONObj);var t="[%^$#$%^%]",n=JSON.stringify(this.sourceJSONObj,null,t);return n=n.split("\n").join("<br />"),n=n.split(t).join("&nbsp;&nbsp;&nbsp;&nbsp;"),n},findAndHandle:function(e,t){this.rootNode.findChildren(e,t,"isRecursive")},unmarkAll:function(){this.rootNode.findChildren((function(e){return!0}),(function(e){e.unmark()}),"isRecursive")}},{create:function(e,t){return new u(e,t)}}}()),ze={jsonTree:$e},Ge={name:"TinyWhiteboard",props:{value:{type:String,default:""},readOnly:{type:Boolean,default:!1},whiteboardData:{type:String},session:{type:Object}},components:{Contextmenu:Pe},data:function(){return{Whiteboard:null,currentType:"selection",activeElement:null,selectedElements:[],lineWidth:"small",fontFamily:"微软雅黑, Microsoft YaHei",fontFamilyList:[{name:"微软雅黑",value:"微软雅黑, Microsoft YaHei"},{name:"宋体",value:"宋体, SimSun, Songti SC"},{name:"楷体",value:"楷体, 楷体_GB2312, SimKai, STKaiti"},{name:"黑体",value:"黑体, SimHei, Heiti SC"},{name:"隶书",value:"隶书, SimLi"},{name:"Andale Mono",value:"andale mono"},{name:"Arial",value:"arial, helvetica, sans-serif"},{name:"arialBlack",value:"arial black, avant garde"},{name:"Comic Sans Ms",value:"comic sans ms"},{name:"Impact",value:"impact, chicago"},{name:"Times New Roman",value:"times new roman"},{name:"Sans-Serif",value:"sans-serif"},{name:"serif",value:"serif"}],fontSize:18,fontSizeList:[10,12,16,18,24,32,48].map((function(e){return{name:e,value:e}})),lineDash:0,globalAlpha:.1,rotate:0,currentZoom:100,canUndo:!1,canRedo:!1,exportImageDialogVisible:!1,exportImageUrl:"",exportOnlySelected:!1,exportRenderBackground:!0,exportFileName:"未命名",exportImagePaddingX:10,exportImagePaddingY:10,exportJsonDialogVisible:!1,exportJsonData:"",tree:null,backgroundColor:"",scroll:{x:0,y:0},showGrid:!1,readonly:!1,helpDialogVisible:!1,shortcutKeyList:[{name:"全部选中",value:"Control + a"},{name:"删除",value:"Del 或 Backspace"},{name:"复制",value:"Control + c"},{name:"粘贴",value:"Control + v"},{name:"放大",value:"Control + +"},{name:"缩小",value:"Control + -"},{name:"重置缩放",value:"Control + 0"},{name:"缩放以适应所有元素",value:"Shift + 1"},{name:"撤销",value:"Control + z"},{name:"重做",value:"Control + y"},{name:"显示隐藏网格",value:"Control + '"}],hasSelectedElements:!1,activeElementStyle:null,activeElementType:null,activeElementFillStyle:null,jsonNull:'{"state":{"scale":1,"scrollX":0,"scrollY":0,"scrollStep":50,"backgroundColor":"","strokeStyle":"#000000","fillStyle":"transparent","fontFamily":"微软雅黑, Microsoft YaHei","fontSize":18,"dragStrokeStyle":"#666","showGrid":false,"readonly":false,"gridConfig":{"size":20,"strokeStyle":"#dfe0e1","lineWidth":1}},"elements":[]}'}},watch:{currentType:function(e,t){this.Whiteboard.updateCurrentType(e)},whiteboardData:function(e){this.Whiteboard.setData(JSON.parse(e))}},mounted:function(){this.init()},methods:{test:function(){console.log("test"),console.log(this.Whiteboard),console.log(this.Whiteboard.state),console.log(this.Whiteboard.elements)},init:function(){var e=this,t={container:this.$refs.box,drawType:this.currentType};this.Whiteboard=new Ue["a"](t);var n=localStorage.getItem("TINY_WHITEBOARD_DATA");n=this.value?this.value:this.jsonNull,n&&(n=JSON.parse(n),[["backgroundColor",""],["strokeStyle","#000000"],["fontFamily","微软雅黑, Microsoft YaHei"],["dragStrokeStyle","#666"],["fillStyle","transparent"],["fontSize",18]].forEach((function(e){void 0===n.state[e[0]]&&(n.state[e[0]]=e[1])})),this.currentZoom=parseInt(100*n.state.scale),this.scroll.x=parseInt(n.state.scrollX),this.scroll.y=parseInt(n.state.scrollY),this.showGrid=n.state.showGrid,this.readonly=n.state.readonly,this.Whiteboard.setData(n)),this.Whiteboard.on("currentTypeChange",(function(t){e.currentType=t})),this.Whiteboard.on("activeElementChange",(function(t){if(e.activeElement&&e.activeElement.off("elementRotateChange",e.onElementRotateChange),e.activeElement=t,t){var n=t.style,i=t.rotate;e.lineWidth=n.lineWidth,e.fontFamily=n.fontFamily,e.fontSize=n.fontSize,e.lineDash=n.lineDash,e.globalAlpha=n.globalAlpha,e.rotate=i,t.on("elementRotateChange",e.onElementRotateChange),e.activeElementType=t.type,e.activeElementStyle=t.style.strokeStyle,e.activeElementFillStyle=t.style.fillStyle}})),this.Whiteboard.on("multiSelectChange",(function(t){e.selectedElements=t,e.hasSelectedElements=e.selectedElements.length>0})),this.Whiteboard.on("zoomChange",(function(t){e.currentZoom=parseInt(100*t)})),this.Whiteboard.on("shuttle",(function(t,n){e.canUndo=t>0,e.canRedo=t<n-1})),this.Whiteboard.on("change",(function(t){e.showGrid=t.state.showGrid;var n=JSON.stringify(e.Whiteboard.exportJson());e.sendData(n),e.$emit("input",n)})),this.Whiteboard.on("scrollChange",(function(t,n){e.scroll.y=parseInt(n),e.scroll.x=parseInt(t)})),this.readOnly&&(this.readonly=!0,this.Whiteboard.setReadonlyMode());var i=null;window.addEventListener("resize",(function(){clearTimeout(i),i=setTimeout((function(){e.Whiteboard.resize()}),300)}))},onElementRotateChange:function(e){this.rotate=e},onRotateChange:function(e){this.Whiteboard.updateActiveElementRotate(e)},onInputNumberFocus:function(){this.Whiteboard.keyCommand.unBindEvent()},onInputNumberBlur:function(){this.Whiteboard.keyCommand.bindEvent()},onCurrentTypeChange:function(){this.Whiteboard.cancelActiveElement()},deleteElement:function(){this.Whiteboard.deleteCurrentElements()},copyElement:function(){this.Whiteboard.copyPasteCurrentElements()},updateStyle:function(e,t){this.Whiteboard.setCurrentElementsStyle(Object(Le["a"])({},e,t))},zoomIn:function(){this.Whiteboard.zoomIn()},zoomOut:function(){this.Whiteboard.zoomOut()},resetZoom:function(){this.Whiteboard.setZoom(1)},toggleEraser:function(){this.currentType="eraser"===this.currentType?"selection":"eraser"},undo:function(){this.Whiteboard.undo()},redo:function(){this.Whiteboard.redo()},empty:function(){this.Whiteboard.empty()},setBackgroundColor:function(e){this.Whiteboard.setBackgroundColor(e)},scrollToCenter:function(){this.Whiteboard.scrollToCenter()},toggleGrid:function(){this.showGrid?(this.showGrid=!1,this.Whiteboard.hideGrid()):(this.showGrid=!0,this.Whiteboard.showGrid())},toggleMode:function(){this.readonly?(this.readonly=!1,this.Whiteboard.setEditMode()):(this.readonly=!0,this.Whiteboard.setReadonlyMode())},importFromJson:function(){var e=this,t=document.createElement("input");t.type="file",t.accept="application/json",t.addEventListener("input",(function(){var n=new FileReader;n.onload=function(){t.value=null,n.result&&e.Whiteboard.setData(JSON.parse(n.result))},n.readAsText(t.files[0])})),t.click()},handleExportCommand:function(e){var t=this;"png"===e?(this.exportImageUrl=this.Whiteboard.exportImage({renderBg:this.exportRenderBackground,paddingX:this.exportImagePaddingX,paddingY:this.exportImagePaddingY,onlySelected:this.exportOnlySelected}),this.exportImageDialogVisible=!0):"json"===e&&(this.exportJsonData=this.Whiteboard.exportJson(),this.exportJsonDialogVisible=!0,this.$nextTick((function(){t.tree?t.tree.loadData(t.exportJsonData):t.tree=ze.jsonTree.create(t.exportJsonData,t.$refs.jsonPreviewBox)})))},reRenderExportImage:function(){this.exportImageUrl=this.Whiteboard.exportImage({renderBg:this.exportRenderBackground,paddingX:this.exportImagePaddingX,paddingY:this.exportImagePaddingY,onlySelected:this.exportOnlySelected})},downloadExportImage:function(){Ue["a"].utils.downloadFile(this.exportImageUrl,this.exportFileName+".png")},downloadExportJson:function(){var e=JSON.stringify(this.exportJsonData,null,4),t=new Blob([e]);Ue["a"].utils.downloadFile(URL.createObjectURL(t),this.exportFileName+".json")},cancelMeeting:function(){this.$emit("closeWhiteBoard")},sendData:function(e){console.log(this.session),this.session.signal({data:e,to:"",type:"whiteboard"}).then((function(){console.log("Message successfully sent")})).catch((function(e){console.error(e)}))}}},Ye=Ge,He=(n("5c34"),n("7ce6"),Object(v["a"])(Ye,Fe,Be,!1,null,"1843c615",null)),Ke=He.exports;p.a.defaults.headers.post["Content-Type"]="application/json";var Xe={name:"meeting",components:{Chat:y,MemberManagement:D,MeetingFile:Oe,TinyWhiteboard:Ke,VideoBoard:ce,Screen:E,AudioChat:Me},data:function(){return{OV:void 0,OVScreen:void 0,session:void 0,sessionScreen:void 0,screensharing:!1,mainStreamManager:void 0,publisher:void 0,subscribers:[],hasVedio:!1,mcfDeviceList:[],sxtDeviceList:[],speakingNameList:[],speakingConnection:void 0,allowAudio:!0,allowVideo:!0,screenSubcriber:void 0,showScreenStatus:void 0,whiteboardData:"",role:"",myUsername:"",myRealname:"Participant"+Math.floor(100*Math.random()),activeName:"first",msgContent:"",connectionList:[],chatItemList:[],chatSelectedUserConnection:"",roomId:this.$route.query.roomId,password:localStorage.getItem("insmess-meeting-password"),roomInfo:{},videoStatus:!1,audioStatus:!1,recordingStatus:!1,recordingSessionId:"",rightTabeTabsValue:"2",rightTabes:[],rightTabIndex:2,showChatStatus:!1,showMemberManagementStatus:!1,showMeetingFileStatus:!1,showWhiteBoardStatus:!1,showAudioChatStatus:!1,mcfGifIcon:n("f37d"),mcfIcon:n("4213"),mcfOffIcon:n("9c3c"),listenAudioMap:new Map,audioItemList:[]}},watch:{showChatStatus:function(e){if(e){var t={titel:"聊天",name:"chat"};this.addTab(t),this.rightTabeTabsValue=t.name}else this.removeTab("chat")},showMemberManagementStatus:function(e){if(e){var t={titel:"成员管理",name:"memberManagement"};this.addTab(t),this.rightTabeTabsValue=t.name}else this.removeTab("memberManagement")},showMeetingFileStatus:function(e){if(e){var t={titel:"资料",name:"meetingFile"};this.addTab(t),this.rightTabeTabsValue=t.name}else this.removeTab("meetingFile")},showAudioChatStatus:function(e){if(e){var t={titel:"语音转写",name:"audioChat"};this.addTab(t),this.rightTabeTabsValue=t.name}else this.removeTab("audioChat")}},filters:{getRealname:function(e){var t=JSON.parse(e);return t.clientData}},mounted:function(){this.initInfo()},methods:{joinSession:function(){var e=this;this.OV=new c["OpenVidu"],this.OVScreen=new c["OpenVidu"],this.OV.getDevices().then((function(t){var n,i=Object(r["a"])(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;"audioinput"===o.kind&&e.mcfDeviceList.push(o),"videoinput"===o.kind&&e.sxtDeviceList.push(o)}}catch(a){i.e(a)}finally{i.f()}})),this.session=this.OV.initSession(),this.sessionScreen=this.OVScreen.initSession(),this.session.on("sessionDisconnected",(function(t){e.$message.error("您已被踢出会议室或已断开连接"),e.$router.push({path:"/room/public-room"})})),this.session.on("connectionCreated",(function(t){var n=t.connection;e.isMemberConnection(n)&&(e.connectionList.push(n),e.$forceUpdate())})),this.session.on("signal:meeting-manager",(function(t){"mute"===t.data&&(e.offMcf(),e.$message.error("您被静音了")),"stopVideo"===t.data&&(e.offSxt(),e.$message.error("您被关闭视频了"))})),this.session.on("signal:whiteboard",(function(t){t.from.connectionId!=e.session.connection.connectionId&&(e.whiteboardData=t.data)})),this.session.on("connectionDestroyed",(function(t){var n=t.connection,i=e.connectionList.indexOf(n,0);i>=0&&e.connectionList.splice(i,1)})),this.session.on("streamCreated",(function(t){var n=t.stream;if("CAMERA"==n.typeOfVideo){var i=e.session.subscribe(n);e.subscribers.push(i)}})),this.sessionScreen.on("streamCreated",(function(t){var n=t.stream;if("SCREEN"==n.typeOfVideo){var i=e.session.subscribe(n);e.screenSubcriber=i,e.showScreenStatus=!0}})),this.session.on("streamPropertyChanged",(function(t){console.log(t),e.subscribers.splice(0,0),"videoActive"==B["f"].changedProperty&&console.log("切换摄像头了"),t.changedProperty})),this.session.on("publisherStartSpeaking",(function(t){var n=t.connection;console.log(n+"说话了");var i=JSON.parse(n.data).clientData;e.speakingNameList.push(i);var o=document.querySelector("#mcf-icon-"+n.connectionId);o.src=e.mcfGifIcon})),this.session.on("publisherStopSpeaking",(function(t){var n=t.connection,i=JSON.parse(n.data).clientData,o=e.speakingNameList.indexOf(i);-1!=o&&e.speakingNameList.splice(o,1);var a=document.querySelector("#mcf-icon-"+n.connectionId);n.stream&&n.stream.audioActive?a.src=e.mcfIcon:a.src=e.mcfOffIcon})),this.session.on("streamDestroyed",(function(t){var n=t.stream,i=e.subscribers.indexOf(n.streamManager,0);i>=0&&e.subscribers.splice(i,1)})),this.sessionScreen.on("streamDestroyed",(function(t){t.stream;e.screenSubcriber=void 0,e.showScreenStatus=!1})),this.session.on("exception",(function(e){var t=e.exception;console.warn(t)})),this.session.on("signal",(function(t){var n=t.type;if(n.startsWith("signal:chat-")){var i={content:"",name:"",contentType:""};i.content=t.data;var o=JSON.parse(t.from.data);i.name=o.clientData,n.startsWith("signal:chat-private")?i.type="chat-private":n.startsWith("signal:chat-mass")&&(i.type="chat-public"),n.endsWith("text")?i.contentType="text":n.endsWith("image")?i.contentType="image":n.endsWith("file")&&(i.contentType="file"),t.from.connectionId===e.session.connection.connectionId?i.mine=!0:i.mine=!1,console.log("發送了"),console.log(i.contentType),e.chatItemList.push(i)}})),this.getToken(this.roomId).then((function(t){e.session.connect(t,{clientData:e.myRealname,streamType:"normal"}).then((function(){var t=e.OV.initPublisher("video-container",{audioSource:!0,videoSource:void 0,publishAudio:e.audioStatus,publishVideo:e.videoStatus,resolution:void 0,frameRate:30,insertMode:"APPEND",mirror:!1});e.mainStreamManager=t,e.publisher=t,e.session.publish(e.publisher);var n=e.session.remoteConnections.values();e.connectionList=[];var i,o=Object(r["a"])(n);try{for(o.s();!(i=o.n()).done;){var a=i.value;e.isMemberConnection(a)&&e.connectionList.push(a)}}catch(s){o.e(s)}finally{o.f()}})).catch((function(e){console.log("There was an error connecting to the session:",e.code,e.message)}))})),this.getToken(this.roomId).then((function(t){e.sessionScreen.connect(t,{clientData:e.myRealname,streamType:"screen"}).then((function(){console.log("Session screen connected")})).catch((function(e){console.warn("There was an error connecting to the session for screen share:",e.code,e.message)}))})),window.addEventListener("beforeunload",this.leaveSession)},leaveSession:function(){this.session&&this.session.disconnect(),this.sessionScreen&&this.sessionScreen.disconnect(),this.session=void 0,this.mainStreamManager=void 0,this.publisher=void 0,this.subscribers=[],this.screenSubcriber=void 0,this.OV=void 0,this.showScreenStatus=!1,this.sessionScreen=void 0,this.OVScreen=void 0,window.removeEventListener("beforeunload",this.leaveSession),this.$router.push({path:"/room/public-room"})},updateMainVideoStreamManager:function(e){this.mainStreamManager!==e&&(this.mainStreamManager=e)},getToken:function(e){var t=this;return Object(s["a"])(Object(a["a"])().mark((function n(){var i;return Object(a["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.createSession(e);case 2:return i=n.sent,n.next=5,t.createToken(i);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n)})))()},createSession:function(e){var t=this;return Object(s["a"])(Object(a["a"])().mark((function n(){var i;return Object(a["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,p.a.post(window.baseUrl.server+"/room/sessions",{customSessionId:e,password:t.password});case 2:return i=n.sent,n.abrupt("return",i.data);case 4:case"end":return n.stop()}}),n)})))()},createToken:function(e){var t=this;return Object(s["a"])(Object(a["a"])().mark((function n(){var i;return Object(a["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,p.a.post(window.baseUrl.server+"/room/sessions/"+e+"/connections",{password:t.password},{headers:{"Content-Type":"application/json"}});case 2:return i=n.sent,n.abrupt("return",i.data);case 4:case"end":return n.stop()}}),n)})))()},checkPermission:function(){var e=this;Object(B["d"])(this.roomId).then((function(t){if(200!=t.code)throw e.$message.error("您无权限进入该会议"),"no access"}))},getRoomInfoById:function(){var e=this;Object(B["i"])(this.roomId).then((function(t){if(200!=t.code)throw e.$message.error("您无权限进入该会议"),"no access";e.roomInfo=t.data}))},initInfo:function(){var e=this;return Object(s["a"])(Object(a["a"])().mark((function t(){var n;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p.a.post(window.baseUrl.userInfo,{},{headers:{"insmess-meeting-token":localStorage.getItem("insmess-meeting-token")}});case 2:n=t.sent,200==n.data.code&&null!=n.data.data?(e.myRealname=n.data.data.realname,e.myUsername=n.data.data.username,e.getRoomInfoById(),e.joinSession(),e.getRole()):(alert("未获取到您的用户信息，即将退出"),e.$router.push({path:"/room/join"}));case 4:case"end":return t.stop()}}),t)})))()},switchMcf:function(){console.log(this.mcfDeviceList),null!=this.mcfDeviceList&&0!=this.mcfDeviceList.length?(this.audioStatus=!this.audioStatus,this.publisher.publishAudio(this.audioStatus),console.log(this.publisher),this.OV.getDevices().then((function(e){console.log(e)}))):this.$message("获取麦克风失败，请检查硬件设备")},offMcf:function(){this.audioStatus=!1,this.publisher.publishAudio(!1)},switchSxt:function(){console.log(this.sxtDeviceList),null!=this.sxtDeviceList&&0!=this.sxtDeviceList.length?(this.videoStatus=!this.videoStatus,this.videoStatus?this.publisher.publishVideo(!0):this.publisher.publishVideo(!1)):this.$message("获取麦克风失败，请检查硬件设备")},offSxt:function(){this.videoStatus=!1,this.publisher.publishVideo(!1)},isMemberConnection:function(e){var t=JSON.parse(e.data);return"normal"==t.streamType},addTab:function(e){var t=++this.rightTabIndex+"";this.rightTabes.push({title:e.titel,name:e.name}),this.rightTabeTabsValue=t},closeRightTab:function(e){"chat"===e?this.showChatStatus=!1:"memberManagement"==e?this.showMemberManagementStatus=!1:"meetingFile"==e?this.showMeetingFileStatus=!1:"audioChat"==e&&(this.showAudioChatStatus=!1)},removeTab:function(e){var t=this.rightTabes,n=this.rightTabeTabsValue;n===e&&t.forEach((function(i,o){if(i.name===e){var a=t[o+1]||t[o-1];a&&(n=a.name)}})),this.rightTabeTabsValue=n,this.rightTabes=t.filter((function(t){return t.name!==e}))},closeWhiteBoard:function(){this.showWhiteBoardStatus=!1},closeShowScreen:function(){console.log("关闭屏幕共享界面"),this.showScreenStatus=!1},publishScreenShare:function(){var e=this;if(this.screenSubcriber)this.$message.error("每个会议室只能开启一个屏幕共享");else{var t=this.OVScreen.initPublisher("container-screens",{videoSource:"screen"});t.once("accessAllowed",(function(n){e.screensharing=!0,t.stream.getMediaStream().getVideoTracks()[0].addEventListener("ended",(function(){e.sessionScreen.unpublish(t),e.screensharing=!1})),e.sessionScreen.publish(t)})),t.once("accessDenied",(function(e){console.warn("ScreenShare: Access Denied")}))}},testConsole:function(){console.log(this.subscribers),console.log(this.publisher)},filterVedioStream:function(){},startRecording:function(){var e=this;return Object(s["a"])(Object(a["a"])().mark((function t(){return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(B["b"])({session:e.roomId,outputMode:"COMPOSED",hasAudio:!0,hasVideo:!0}).then((function(t){200==t.code&&(e.recordingStatus=!0,e.recordingSessionId=t.data.id)}));case 2:case"end":return t.stop()}}),t)})))()},stopRecording:function(){var e=this;return Object(s["a"])(Object(a["a"])().mark((function t(){return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(B["f"])({recording:e.recordingSessionId}).then((function(t){200==t.code&&(e.recordingStatus=!1)}));case 2:case"end":return t.stop()}}),t)})))()},getRole:function(){var e=this;return Object(s["a"])(Object(a["a"])().mark((function t(){return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:Object(B["h"])({username:e.myUsername,sessionId:e.roomId}).then((function(t){e.role=t.data,console.log("role:"+e.role)}));case 1:case"end":return t.stop()}}),t)})))()},sendPrivateMessage:function(e){sessionStorage.setItem("chat-select-conId",e),this.showChatStatus=!0,this.rightTabeTabsValue="chat"},processPCMData:function(){var e=this.encodeWAV(this.chunks),t=new Blob([e]),n=URL.createObjectURL(t),i=document.createElement("audio");i.style="display: block",i.controls=!0,i.src=n,document.body.appendChild(i)},encodeWAV:function(e){var t=new ArrayBuffer(44+2*e.length),n=new DataView(t);return this.writeString(n,0,"RIFF"),n.setUint32(4,36+2*e.length,!0),this.writeString(n,8,"WAVE"),this.writeString(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,1,!0),n.setUint32(24,this.sampleRate,!0),n.setUint32(28,4*this.sampleRate,!0),n.setUint16(32,2,!0),n.setUint16(34,16,!0),this.writeString(n,36,"data"),n.setUint32(40,2*e.length,!0),this.floatTo16BitPCM(n,44,e),n},writeString:function(e,t,n){for(var i=0;i<n.length;i++)e.setUint8(t+i,n.charCodeAt(i))},floatTo16BitPCM:function(e,t,n){for(var i=0;i<n.length;i++,t+=2){var o=Math.max(-1,Math.min(1,n[i]));e.setInt16(t,o<0?32768*o:32767*o,!0)}}}},Ze=Xe,qe=(n("a21bd"),n("84d5"),Object(v["a"])(Ze,i,o,!1,null,"6026d6c2",null));t["default"]=qe.exports},ef63:function(e,t,n){"use strict";n("715e")},f37d:function(e,t,n){e.exports=n.p+"static/img/mcf.a9799438.gif"},f931:function(e,t,n){}}]);