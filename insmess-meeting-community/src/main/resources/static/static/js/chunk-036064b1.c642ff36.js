(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-036064b1"],{"01e1":function(e,t,n){var i=!1;if(Object.defineProperty)try{Object.defineProperty({},"x",{})}catch(m){i=!0}Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,i=function(){},r=function(){return n.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,r.prototype=new i,r});var r=n("faa1").EventEmitter,o=n("3fb5"),s=n("d30c"),a=n("8140"),c=5e3;function l(e){if(!e)return{};for(var t in e){var n=e[t];"string"==typeof n&&(e[t]={response:n})}return e}function u(e){if(e){if(e instanceof Function)return{send:e};if(e.send instanceof Function)return e;if(e.postMessage instanceof Function)return e.send=e.postMessage,e;if(e.write instanceof Function)return e.send=e.write,e;if(void 0===e.onmessage&&!(e.pause instanceof Function))throw new SyntaxError("Transport is not a function nor a valid object")}}function d(e,t){i?(this.method=e,this.params=t):(Object.defineProperty(this,"method",{value:e,enumerable:!0}),Object.defineProperty(this,"params",{value:t,enumerable:!0}))}function h(e,t,n,s){var h=this;if(!e)throw new SyntaxError("Packer is not defined");if(!e.pack||!e.unpack)throw new SyntaxError("Packer is invalid");var p=l(e.responseMethods);if(t instanceof Function){if(void 0!=n)throw new SyntaxError("There can't be parameters after onRequest");s=t,n=void 0,t=void 0}if(t&&t.send instanceof Function){if(n&&!(n instanceof Function))throw new SyntaxError("Only a function can be after transport");s=n,n=t,t=void 0}if(n instanceof Function){if(void 0!=s)throw new SyntaxError("There can't be parameters after onRequest");s=n,n=void 0}if(n&&n.send instanceof Function&&s&&!(s instanceof Function))throw new SyntaxError("Only a function can be after transport");t=t||{},r.call(this),s&&this.on("request",s),i?this.peerID=t.peerID:Object.defineProperty(this,"peerID",{value:t.peerID});var f=t.max_retries||0;function v(e){h.decode(e.data||e)}this.getTransport=function(){return n},this.setTransport=function(e){n&&(n.removeEventListener?n.removeEventListener("message",v):n.removeListener&&n.removeListener("data",v)),e&&(e.addEventListener?e.addEventListener("message",v):e.addListener&&e.addListener("data",v)),n=u(e)},i||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)}),this.setTransport(n);var g=t.request_timeout||c,E=t.ping_request_timeout||g,b=t.response_timeout||c,y=t.duplicates_timeout||c,S=0,w=new a,C=new a,O=new a,x={};function R(e,t,n){var i={message:e,timeout:setTimeout((function(){C.remove(t,n)}),b)};C.set(i,t,n)}function I(e,t){var n=setTimeout((function(){O.remove(e,t)}),y);O.set(n,e,t)}function T(t,n,r,o,s){d.call(this,t,n),this.getTransport=function(){return s},this.setTransport=function(e){s=u(e)},i||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)});var a=C.get(r,o);s||h.getTransport()||(i?this.duplicated=Boolean(a):Object.defineProperty(this,"duplicated",{value:Boolean(a)}));var c=p[t];this.pack=e.pack.bind(e,this,r),this.reply=function(t,n,i){if(t instanceof Function||t&&t.send instanceof Function){if(void 0!=n)throw new SyntaxError("There can't be parameters after callback");i=t,n=null,t=void 0}else if(n instanceof Function||n&&n.send instanceof Function){if(void 0!=i)throw new SyntaxError("There can't be parameters after callback");i=n,n=null}var s;if(i=u(i),a&&clearTimeout(a.timeout),void 0!=o&&(t&&(t.dest=o),n&&(n.dest=o)),t||void 0!=n){if(void 0!=h.peerID&&(t?t.from=h.peerID:n.from=h.peerID),c)if(void 0==c.error&&t)s={error:t};else{var l=t?c.error:c.response;s={method:l,params:t||n}}else s={error:t,result:n};s=e.pack(s,r)}else s=a?a.message:e.pack({result:null},r);return R(s,r,o),i=i||this.getTransport()||h.getTransport(),i?i.send(s):s}}function P(e){var t=x[e];if(t){delete x[e];var n=w.pop(t.id,t.dest);n&&(clearTimeout(n.timeout),I(t.id,t.dest))}}o(T,d),this.cancel=function(e){if(e)return P(e);for(var e in x)P(e)},this.close=function(){var e=this.getTransport();e&&e.close&&e.close(4003,"Cancel request"),this.cancel(),O.forEach(clearTimeout),C.forEach((function(e){clearTimeout(e.timeout)}))},this.encode=function(t,n,i,r,o){if(n instanceof Function){if(void 0!=i)throw new SyntaxError("There can't be parameters after callback");o=n,r=void 0,i=void 0,n=void 0}else if(i instanceof Function){if(void 0!=r)throw new SyntaxError("There can't be parameters after callback");o=i,r=void 0,i=void 0}else if(r instanceof Function){if(void 0!=o)throw new SyntaxError("There can't be parameters after callback");o=r,r=void 0}void 0!=h.peerID&&(n=n||{},n.from=h.peerID),void 0!=i&&(n=n||{},n.dest=i);var s={method:t,params:n};if(o){var a=S++,c=0;function l(e,t){h.cancel(s),o(e,t)}s=e.pack(s,a);var d={message:s,callback:l,responseMethods:p[t]||{}},m=u(r);function v(e){var n="ping"===t?E:g;return d.timeout=setTimeout(y,n*Math.pow(2,c++)),x[s]={id:a,dest:i},w.set(d,a,i),e=e||m||h.getTransport(),e?e.send(s):s}function b(e){e=u(e),console.warn(c+" retry for request message:",s);var t=O.pop(a,i);return clearTimeout(t),v(e)}function y(){if(c<f)return b(r);var e=new Error("Request has timed out");e.request=s,e.retry=b,l(e)}return v(r)}return s=e.pack(s),r=r||this.getTransport(),r?r.send(s):s},this.decode=function(t,n){if(!t)throw new TypeError("Message is not defined");try{t=e.unpack(t)}catch(m){return console.debug(m,t)}var i=t.id,r=t.ack,o=t.method,s=t.params||{},a=s.from,c=s.dest;if(void 0==h.peerID||a!=h.peerID){if(void 0==i&&void 0==r){var l=new d(o,s);if(h.emit("request",l))return;return l}if(o){if(void 0==c||c==h.peerID){var p=w.get(r,a);if(p){var f=p.responseMethods;return o==f.error?y(p,s):o==f.response?y(p,null,s):b()}var v=O.get(r,a);if(v)return S(v)}return b()}var g=t.error,E=t.result;if((!g||!g.dest||g.dest==h.peerID)&&(!E||!E.dest||E.dest==h.peerID)){p=w.get(r,a);if(!p){v=O.get(r,a);return v?S(v):console.warn("No callback was defined for this message",t)}y(p,g,E)}}function b(){if(n=u(n)||h.getTransport(),n){var e=C.get(i,a);if(e)return n.send(e.message)}var t=void 0!=i?i:r,c=new T(o,s,t,a,n);if(!h.emit("request",c))return c}function y(e,t,n){e.callback(t,n)}function S(e){console.warn("Response already processed",t),clearTimeout(e),I(r,a)}}}o(h,r),h.RpcNotification=d,e.exports=h;var p=n("498b"),f=n("79ef");h.clients=p,h.clients.transports=f,h.packers=s},"043b":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkQualityLevelChangedEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r){var o=e.call(this,!1,t,"networkQualityLevelChanged")||this;return o.newValue=n,o.oldValue=i,o.connection=r,o}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.NetworkQualityLevelChangedEvent=o},"0703":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.StreamPropertyChangedEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r,o,s){var a=e.call(this,!1,t,"streamPropertyChanged")||this;return a.stream=n,a.changedProperty=i,a.newValue=r,a.oldValue=o,a.reason=s,a}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.StreamPropertyChangedEvent=o},"0b25":function(e,t,n){var i=n("a691"),r=n("50c4");e.exports=function(e){if(void 0===e)return 0;var t=i(e),n=r(t);if(t!==n)throw RangeError("Wrong length or index");return n}},"0cf2":function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,a[0]&&(s=0)),s)try{if(n=1,i&&(r=2&a[0]?i["return"]:a[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(c){a=[6,c],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=void 0;var o,s=n("ef86"),a=n("6e4e"),c=n("e649"),l=n("f852"),u=n("e9cb"),d=n("7bca"),h=n("1f15"),p=n("0703"),f=n("4edf"),m=n("b793"),v=n("f66e"),g=n("e237"),E=n("d2ca"),b=n("68cb"),y=n("e0ef"),S=v.OpenViduLogger.getInstance(),w=function(){function e(e,t){var n=this;this.isSubscribeToRemote=!1,this.isLocalStreamReadyToPublish=!1,this.isLocalStreamPublished=!1,this.publishedOnce=!1,this.harkSpeakingEnabled=!1,this.harkSpeakingEnabledOnce=!1,this.harkStoppedSpeakingEnabled=!1,this.harkStoppedSpeakingEnabledOnce=!1,this.harkVolumeChangeEnabled=!1,this.harkVolumeChangeEnabledOnce=!1,this.ee=new y,o=g.PlatformUtils.getInstance(),this.session=e,t.hasOwnProperty("id")?(this.inboundStreamOpts=t,this.streamId=this.inboundStreamOpts.id,this.creationTime=this.inboundStreamOpts.createdAt,this.hasAudio=this.inboundStreamOpts.hasAudio,this.hasVideo=this.inboundStreamOpts.hasVideo,this.hasAudio&&(this.audioActive=this.inboundStreamOpts.audioActive),this.hasVideo&&(this.videoActive=this.inboundStreamOpts.videoActive,this.typeOfVideo=this.inboundStreamOpts.typeOfVideo?this.inboundStreamOpts.typeOfVideo:void 0,this.frameRate=-1===this.inboundStreamOpts.frameRate?void 0:this.inboundStreamOpts.frameRate,this.videoDimensions=this.inboundStreamOpts.videoDimensions),this.inboundStreamOpts.filter&&Object.keys(this.inboundStreamOpts.filter).length>0&&(this.inboundStreamOpts.filter.lastExecMethod&&0===Object.keys(this.inboundStreamOpts.filter.lastExecMethod).length&&delete this.inboundStreamOpts.filter.lastExecMethod,this.filter=this.inboundStreamOpts.filter)):(this.outboundStreamOpts=t,this.hasAudio=this.isSendAudio(),this.hasVideo=this.isSendVideo(),this.hasAudio&&(this.audioActive=!!this.outboundStreamOpts.publisherProperties.publishAudio),this.hasVideo&&(this.videoActive=!!this.outboundStreamOpts.publisherProperties.publishVideo,this.frameRate=this.outboundStreamOpts.publisherProperties.frameRate,"undefined"!==typeof MediaStreamTrack&&this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?this.typeOfVideo=m.TypeOfVideo.CUSTOM:this.typeOfVideo=this.isSendScreen()?m.TypeOfVideo.SCREEN:m.TypeOfVideo.CAMERA),this.outboundStreamOpts.publisherProperties.filter&&(this.filter=this.outboundStreamOpts.publisherProperties.filter)),this.ee.on("mediastream-updated",(function(){var e;n.streamManager.updateMediaStream(n.mediaStream),S.debug("Video srcObject ["+(null===(e=n.mediaStream)||void 0===e?void 0:e.id)+"] updated in stream ["+n.streamId+"]")}))}return e.prototype.reconnect=function(){return this.reconnectStream("API")},e.prototype.applyFilter=function(e,t){var n=this;return new Promise((function(o,a){return i(n,void 0,void 0,(function(){var n,c,l,u,d,h,m=this;return r(this,(function(v){if(this.filter)return[2,a(new f.OpenViduError(f.OpenViduErrorName.GENERIC_ERROR,"There is already a filter applied to Stream "+this.streamId))];if(n=function(n,i){if(n)return S.error("Error applying filter for Stream "+m.streamId,n),401===n.code?a(new f.OpenViduError(f.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to apply a filter")):a(n);S.info("Filter successfully applied on Stream "+m.streamId);var r=m.filter;return m.filter=new s.Filter(e,t),m.filter.stream=m,i&&(m.session.emitEvent("streamPropertyChanged",[new p.StreamPropertyChangedEvent(m.session,m,"filter",m.filter,r,"applyFilter")]),m.streamManager.emitEvent("streamPropertyChanged",[new p.StreamPropertyChangedEvent(m.streamManager,m,"filter",m.filter,r,"applyFilter")])),o(m.filter)},e.startsWith("VB:")){if(!this.hasVideo)return[2,a(new f.OpenViduError(f.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"The Virtual Background filter requires a video track to be applied"))];if(!this.mediaStream||0===this.streamManager.videos.length)return[2,a(new f.OpenViduError(f.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"The StreamManager requires some video element to be attached to it in order to apply a Virtual Background filter"))];if(c=this.session.token?this.session.token:t["token"],!c)return[2,a(new f.OpenViduError(f.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,'Virtual Background requires the client to be connected to a Session or to have a "token" property available in "options" parameter with a valid OpenVidu token'))];if(l=this.session.getTokenParams(c),"pro"!==l.edition&&"enterprise"!==l.edition)return[2,a(new f.OpenViduError(f.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"OpenVidu Virtual Background API is available from OpenVidu Pro edition onwards"))];c=encodeURIComponent(btoa(c)),S.info("Applying Virtual Background to stream "+this.streamId),u=function(){return i(m,void 0,void 0,(function(){var i,o,s,a,u,d,h;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,8,,9]),i=this.streamId+"_"+(0,E.v4)(),o=this.mediaStream.clone(),s=this.streamManager.videos[0].video.cloneNode(!1),s.id=VirtualBackground.VirtualBackground.SOURCE_VIDEO_PREFIX+i,s.srcObject=o,s.muted=!0,this.virtualBackgroundSourceElements={videoClone:s,mediaStreamClone:o},VirtualBackground.VirtualBackground.hideHtmlElement(s,!1),VirtualBackground.VirtualBackground.appendHtmlElementToHiddenContainer(s,i),[4,s.play()];case 1:switch(r.sent(),a=new VirtualBackground.VirtualBackground({id:i,openviduServerUrl:new URL(l.httpUri),openviduToken:c,inputVideo:s,inputResolution:"160x96",outputFramerate:24}),u=void 0,d=e,d){case"VB:blur":return[3,2];case"VB:image":return[3,4]}return[3,6];case 2:return[4,a.backgroundBlur(t)];case 3:return u=r.sent(),[3,7];case 4:return[4,a.backgroundImage(t)];case 5:return u=r.sent(),[3,7];case 6:throw new Error("Unknown Virtual Background filter: "+e);case 7:return this.virtualBackgroundSinkElements={VB:a,video:u},s.style.display="none",this.streamManager.remote?this.streamManager.replaceTrackInMediaStream(this.virtualBackgroundSinkElements.video.srcObject.getVideoTracks()[0],!1):this.streamManager.replaceTrackAux(this.virtualBackgroundSinkElements.video.srcObject.getVideoTracks()[0],!1),n(void 0,!1),[3,9];case 8:return h=r.sent(),h.name===f.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR?n(new f.OpenViduError(f.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,h.message),!1):n(h,!1),[3,9];case 9:return[2]}}))}))},"undefined"===typeof VirtualBackground?(d=document.createElement("script"),d.type="text/javascript",d.src=l.httpUri+"/openvidu/virtual-background/openvidu-virtual-background.js?token="+c,d.onload=function(){return i(m,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,u()];case 1:return i.sent(),o(new s.Filter(e,t)),[3,3];case 2:return n=i.sent(),a(n),[3,3];case 3:return[2]}}))}))},document.body.appendChild(d)):u().then((function(){return o(new s.Filter(e,t))})).catch((function(e){return a(e)}))}else{if(!this.session.sessionConnected())return[2,a(this.session.notConnectedError())];S.info("Applying server filter to stream "+this.streamId),t=null!=t?t:{},h=t,"string"!==typeof h&&(h=JSON.stringify(h)),this.session.openvidu.sendRequest("applyFilter",{streamId:this.streamId,type:e,options:h},(function(e,t){n(e,!0)}))}return[2]}))}))}))},e.prototype.removeFilter=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.removeFilterAux(!1)];case 1:return[2,e.sent()]}}))}))},e.prototype.getRTCPeerConnection=function(){return this.webRtcPeer.pc},e.prototype.getMediaStream=function(){return this.mediaStream},e.prototype.removeFilterAux=function(e){var t=this;return new Promise((function(n,o){return i(t,void 0,void 0,(function(){var t,i,s,a,c=this;return r(this,(function(r){switch(r.label){case 0:if(t=function(e,t){if(e)return delete c.filter,S.error("Error removing filter for Stream "+c.streamId,e),401===e.code?o(new f.OpenViduError(f.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to remove a filter")):o(e);S.info("Filter successfully removed from Stream "+c.streamId);var i=c.filter;return delete c.filter,t&&(c.session.emitEvent("streamPropertyChanged",[new p.StreamPropertyChangedEvent(c.session,c,"filter",c.filter,i,"applyFilter")]),c.streamManager.emitEvent("streamPropertyChanged",[new p.StreamPropertyChangedEvent(c.streamManager,c,"filter",c.filter,i,"applyFilter")])),n()},!this.filter)return[3,11];if(!(null===(a=this.filter)||void 0===a?void 0:a.type.startsWith("VB:")))return[3,9];r.label=1;case 1:return r.trys.push([1,7,,8]),i=this.virtualBackgroundSourceElements.mediaStreamClone,e?[3,5]:this.streamManager.remote?(this.streamManager.replaceTrackInMediaStream(i.getVideoTracks()[0],!1),[3,4]):[3,2];case 2:return[4,this.streamManager.replaceTrackAux(i.getVideoTracks()[0],!1)];case 3:r.sent(),r.label=4;case 4:return[3,6];case 5:i.getTracks().forEach((function(e){return e.stop()})),r.label=6;case 6:return this.virtualBackgroundSinkElements.VB.cleanUp(),delete this.virtualBackgroundSinkElements,delete this.virtualBackgroundSourceElements,[2,t(void 0,!1)];case 7:return s=r.sent(),[2,t(s,!1)];case 8:return[3,10];case 9:if(!this.session.sessionConnected())return[2,o(this.session.notConnectedError())];S.info("Removing filter of stream "+this.streamId),this.session.openvidu.sendRequest("removeFilter",{streamId:this.streamId},(function(e,n){return t(e,!0)})),r.label=10;case 10:return[3,12];case 11:return[2,o(new f.OpenViduError(f.OpenViduErrorName.GENERIC_ERROR,"Stream "+this.streamId+" has no filter applied"))];case 12:return[2]}}))}))}))},e.prototype.setMediaStream=function(e){this.mediaStream=e},e.prototype.updateMediaStreamInVideos=function(){this.ee.emitEvent("mediastream-updated",[])},e.prototype.getWebRtcPeer=function(){return this.webRtcPeer},e.prototype.subscribeToMyRemote=function(e){this.isSubscribeToRemote=e},e.prototype.setOutboundStreamOptions=function(e){this.outboundStreamOpts=e},e.prototype.subscribe=function(){var e=this;return new Promise((function(t,n){e.initWebRtcPeerReceive(!1).then((function(){return t()})).catch((function(e){return n(e)}))}))},e.prototype.publish=function(){var e=this;return new Promise((function(t,n){e.isLocalStreamReadyToPublish?e.initWebRtcPeerSend(!1).then((function(){return t()})).catch((function(e){return n(e)})):e.ee.once("stream-ready-to-publish",(function(){e.publish().then((function(){return t()})).catch((function(e){return n(e)}))}))}))},e.prototype.disposeWebRtcPeer=function(){var e;this.webRtcPeer&&(this.webRtcPeer.dispose(),e=this.webRtcPeer.getId()),this.stopWebRtcStats(),S.info((this.outboundStreamOpts?"Outbound ":"Inbound ")+"RTCPeerConnection with id ["+e+"] from 'Stream' with id ["+this.streamId+"] is now closed")},e.prototype.disposeMediaStream=function(){return i(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:if(!this.filter||!this.filter.type.startsWith("VB:"))return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.removeFilterAux(!0)];case 2:return t.sent(),console.debug("Success removing Virtual Background filter for stream ".concat(this.streamId)),[3,4];case 3:return e=t.sent(),console.error("Error removing Virtual Background filter for stream ".concat(this.streamId),e),[3,4];case 4:return this.mediaStream&&(this.mediaStream.getAudioTracks().forEach((function(e){e.stop()})),this.mediaStream.getVideoTracks().forEach((function(e){e.stop()})),delete this.mediaStream),this.localMediaStreamWhenSubscribedToRemote&&(this.localMediaStreamWhenSubscribedToRemote.getAudioTracks().forEach((function(e){e.stop()})),this.localMediaStreamWhenSubscribedToRemote.getVideoTracks().forEach((function(e){e.stop()})),delete this.localMediaStreamWhenSubscribedToRemote),this.speechEvent&&(this.speechEvent.stop&&this.speechEvent.stop(),delete this.speechEvent),S.info((this.outboundStreamOpts?"Local ":"Remote ")+"MediaStream from 'Stream' with id ["+this.streamId+"] is now disposed"),[2]}}))}))},e.prototype.displayMyRemote=function(){return this.isSubscribeToRemote},e.prototype.isSendAudio=function(){return!!this.outboundStreamOpts&&null!==this.outboundStreamOpts.publisherProperties.audioSource&&!1!==this.outboundStreamOpts.publisherProperties.audioSource},e.prototype.isSendVideo=function(){return!!this.outboundStreamOpts&&null!==this.outboundStreamOpts.publisherProperties.videoSource&&!1!==this.outboundStreamOpts.publisherProperties.videoSource},e.prototype.isSendScreen=function(){var e="screen"===this.outboundStreamOpts.publisherProperties.videoSource;return o.isElectron()&&(e="string"===typeof this.outboundStreamOpts.publisherProperties.videoSource&&this.outboundStreamOpts.publisherProperties.videoSource.startsWith("screen:")),!!this.outboundStreamOpts&&e},e.prototype.enableHarkSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),!this.harkSpeakingEnabled&&this.speechEvent&&(this.harkSpeakingEnabled=!0,this.speechEvent.on("speaking",(function(){e.session.emitEvent("publisherStartSpeaking",[new d.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStartSpeaking",[new d.PublisherSpeakingEvent(e.streamManager,"publisherStartSpeaking",e.connection,e.streamId)]),e.harkSpeakingEnabledOnce=!1})))},e.prototype.enableOnceHarkSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),!this.harkSpeakingEnabledOnce&&this.speechEvent&&(this.harkSpeakingEnabledOnce=!0,this.speechEvent.once("speaking",(function(){e.harkSpeakingEnabledOnce&&(e.session.emitEvent("publisherStartSpeaking",[new d.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStartSpeaking",[new d.PublisherSpeakingEvent(e.streamManager,"publisherStartSpeaking",e.connection,e.streamId)])),e.disableHarkSpeakingEvent(!0)})))},e.prototype.disableHarkSpeakingEvent=function(e){if(this.speechEvent){if(this.harkSpeakingEnabledOnce=!1,e){if(this.harkSpeakingEnabled)return}else this.harkSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},e.prototype.enableHarkStoppedSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),!this.harkStoppedSpeakingEnabled&&this.speechEvent&&(this.harkStoppedSpeakingEnabled=!0,this.speechEvent.on("stopped_speaking",(function(){e.session.emitEvent("publisherStopSpeaking",[new d.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStopSpeaking",[new d.PublisherSpeakingEvent(e.streamManager,"publisherStopSpeaking",e.connection,e.streamId)]),e.harkStoppedSpeakingEnabledOnce=!1})))},e.prototype.enableOnceHarkStoppedSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),!this.harkStoppedSpeakingEnabledOnce&&this.speechEvent&&(this.harkStoppedSpeakingEnabledOnce=!0,this.speechEvent.once("stopped_speaking",(function(){e.harkStoppedSpeakingEnabledOnce&&(e.session.emitEvent("publisherStopSpeaking",[new d.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStopSpeaking",[new d.PublisherSpeakingEvent(e.streamManager,"publisherStopSpeaking",e.connection,e.streamId)])),e.disableHarkStoppedSpeakingEvent(!0)})))},e.prototype.disableHarkStoppedSpeakingEvent=function(e){if(this.speechEvent){if(this.harkStoppedSpeakingEnabledOnce=!1,e){if(this.harkStoppedSpeakingEnabled)return}else this.harkStoppedSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce?this.speechEvent.off("stopped_speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},e.prototype.enableHarkVolumeChangeEvent=function(e){var t=this;this.setHarkListenerIfNotExists()?this.harkVolumeChangeEnabled&&!e||(this.harkVolumeChangeEnabled=!0,this.speechEvent.on("volume_change",(function(e){var n=t.speechEvent.oldVolumeValue,i={newValue:e,oldValue:n};t.speechEvent.oldVolumeValue=e,t.streamManager.emitEvent("streamAudioVolumeChange",[new h.StreamManagerEvent(t.streamManager,"streamAudioVolumeChange",i)])}))):this.harkVolumeChangeEnabled=!0},e.prototype.enableOnceHarkVolumeChangeEvent=function(e){var t=this;this.setHarkListenerIfNotExists()?this.harkVolumeChangeEnabledOnce&&!e||(this.harkVolumeChangeEnabledOnce=!0,this.speechEvent.once("volume_change",(function(e){var n=t.speechEvent.oldVolumeValue,i={newValue:e,oldValue:n};t.speechEvent.oldVolumeValue=e,t.disableHarkVolumeChangeEvent(!0),t.streamManager.emitEvent("streamAudioVolumeChange",[new h.StreamManagerEvent(t.streamManager,"streamAudioVolumeChange",i)])}))):this.harkVolumeChangeEnabledOnce=!0},e.prototype.disableHarkVolumeChangeEvent=function(e){if(this.speechEvent){if(this.harkVolumeChangeEnabledOnce=!1,e){if(this.harkVolumeChangeEnabled)return}else this.harkVolumeChangeEnabled=!1;this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("volume_change"):(this.speechEvent.stop(),delete this.speechEvent)}},e.prototype.isLocal=function(){return!this.inboundStreamOpts&&!!this.outboundStreamOpts},e.prototype.getSelectedIceCandidate=function(){var e=this;return new Promise((function(t,n){e.webRtcStats.getSelectedIceCandidateInfo().then((function(e){return t(e)})).catch((function(e){return n(e)}))}))},e.prototype.getRemoteIceCandidateList=function(){return this.webRtcPeer.remoteCandidatesQueue},e.prototype.getLocalIceCandidateList=function(){return this.webRtcPeer.localCandidatesQueue},e.prototype.streamIceConnectionStateBroken=function(){if(!this.getWebRtcPeer()||!this.getRTCPeerConnection())return!1;if(this.isLocal()&&this.session.openvidu.advancedConfiguration.forceMediaReconnectionAfterNetworkDrop)return S.warn('OpenVidu Browser advanced configuration option "forceMediaReconnectionAfterNetworkDrop" is enabled. Stream '.concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") will force a reconnection")),!0;var e=this.getRTCPeerConnection().iceConnectionState;return"connected"!==e&&"completed"!==e},e.prototype.setHarkListenerIfNotExists=function(){if(this.mediaStream){if(!this.speechEvent){var e=this.harkOptions?this.harkOptions:this.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{};e.interval="number"===typeof e.interval?e.interval:100,e.threshold="number"===typeof e.threshold?e.threshold:-50,this.speechEvent=b(this.mediaStream,e)}return!0}return!1},e.prototype.setupReconnectionEventEmitter=function(e,t){return void 0==this.reconnectionEventEmitter?(this.reconnectionEventEmitter=new y,!1):(console.warn("Trying to reconnect stream ".concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") but an ongoing reconnection process is active. Waiting for response...")),this.reconnectionEventEmitter.once("success",(function(){return e()})),this.reconnectionEventEmitter.once("error",(function(e){return t(e)})),!0)},e.prototype.initWebRtcPeerSend=function(e){var t=this;return new Promise((function(n,i){var r;if(e){if(t.setupReconnectionEventEmitter(n,i))return}else t.initHarkEvents();var o=function(){var i;return e&&(null===(i=t.reconnectionEventEmitter)||void 0===i||i.emitEvent("success"),delete t.reconnectionEventEmitter),n()},s=function(n){var r;return e&&(null===(r=t.reconnectionEventEmitter)||void 0===r||r.emitEvent("error",[n]),delete t.reconnectionEventEmitter),i(n)},a=function(n){S.debug("Sending SDP offer to publish as "+t.streamId,n);var i,r=e?"reconnectStream":"publishVideo";if(e)i={stream:t.streamId,sdpString:n};else{var a=void 0;t.isSendVideo()&&(a="undefined"!==typeof MediaStreamTrack&&t.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?m.TypeOfVideo.CUSTOM:t.isSendScreen()?m.TypeOfVideo.SCREEN:m.TypeOfVideo.CAMERA),i={doLoopback:t.displayMyRemote()||!1,hasAudio:t.isSendAudio(),hasVideo:t.isSendVideo(),audioActive:t.audioActive,videoActive:t.videoActive,typeOfVideo:a,frameRate:t.frameRate?t.frameRate:-1,videoDimensions:JSON.stringify(t.videoDimensions),filter:t.outboundStreamOpts.publisherProperties.filter,sdpOffer:n}}t.session.openvidu.sendRequest(r,i,(function(n,i){n?401===n.code?s(new f.OpenViduError(f.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to publish")):s("Error on publishVideo: "+JSON.stringify(n)):t.webRtcPeer.processRemoteAnswer(i.sdpAnswer).then((function(){t.streamId=i.id,t.creationTime=i.createdAt,t.isLocalStreamPublished=!0,t.publishedOnce=!0,t.displayMyRemote()&&(t.localMediaStreamWhenSubscribedToRemote=t.mediaStream,t.remotePeerSuccessfullyEstablished(e)),e?t.ee.emitEvent("stream-reconnected-by-publisher",[]):t.ee.emitEvent("stream-created-by-publisher",[]),t.initWebRtcStats(),S.info("'Publisher' ("+t.streamId+") successfully "+(e?"reconnected":"published")+" to session"),o()})).catch((function(e){s(e)}))}))},l={mediaConstraints:{audio:t.hasAudio,video:t.hasVideo},simulcast:null!==(r=t.outboundStreamOpts.publisherProperties.videoSimulcast)&&void 0!==r?r:t.session.openvidu.videoSimulcast,onIceCandidate:t.connection.sendIceCandidate.bind(t.connection),onIceConnectionStateException:t.onIceConnectionStateExceptionHandler.bind(t),iceServers:t.getIceServersConf(),mediaStream:t.mediaStream,mediaServer:t.session.openvidu.mediaServer,typeOfVideo:t.typeOfVideo?m.TypeOfVideo[t.typeOfVideo]:void 0};"mediasoup"!==t.session.openvidu.mediaServer&&(l.simulcast=!1),e&&t.disposeWebRtcPeer(),t.displayMyRemote()?t.webRtcPeer=new c.WebRtcPeerSendrecv(l):t.webRtcPeer=new c.WebRtcPeerSendonly(l),t.webRtcPeer.addIceConnectionStateChangeListener("publisher of "+t.connection.connectionId),t.webRtcPeer.createOffer().then((function(e){t.webRtcPeer.processLocalOffer(e).then((function(){a(e.sdp)})).catch((function(e){s(new Error("(publish) SDP process local offer error: "+JSON.stringify(e)))}))})).catch((function(e){s(new Error("(publish) SDP create offer error: "+JSON.stringify(e)))}))}))},e.prototype.finalResolveForSubscription=function(e,t){var n;return S.info("'Subscriber' ("+this.streamId+") successfully "+(e?"reconnected":"subscribed")),this.remotePeerSuccessfullyEstablished(e),this.initWebRtcStats(),e&&(null===(n=this.reconnectionEventEmitter)||void 0===n||n.emitEvent("success"),delete this.reconnectionEventEmitter),t()},e.prototype.finalRejectForSubscription=function(e,t,n){var i;return S.error("Error for 'Subscriber' ("+this.streamId+") while trying to "+(e?"reconnect":"subscribe")+": "+t.toString()),e&&(null===(i=this.reconnectionEventEmitter)||void 0===i||i.emitEvent("error",[t]),delete this.reconnectionEventEmitter),n(t)},e.prototype.initWebRtcPeerReceive=function(e){var t=this;return new Promise((function(n,i){e&&t.setupReconnectionEventEmitter(n,i)||("mediasoup"===t.session.openvidu.mediaServer?t.initWebRtcPeerReceiveFromServer(e).then((function(){return t.finalResolveForSubscription(e,n)})).catch((function(n){return t.finalRejectForSubscription(e,n,i)})):t.initWebRtcPeerReceiveFromClient(e).then((function(){return t.finalResolveForSubscription(e,n)})).catch((function(n){return t.finalRejectForSubscription(e,n,i)})))}))},e.prototype.initWebRtcPeerReceiveFromClient=function(e){var t=this;return new Promise((function(n,i){t.completeWebRtcPeerReceive(e,!1).then((function(e){t.webRtcPeer.processRemoteAnswer(e.sdpAnswer).then((function(){return n()})).catch((function(e){return i(e)}))})).catch((function(e){return i(e)}))}))},e.prototype.initWebRtcPeerReceiveFromServer=function(e){var t=this;return new Promise((function(n,i){t.session.openvidu.sendRequest("prepareReceiveVideoFrom",{sender:t.streamId,reconnect:e},(function(r,o){if(r)return i(new Error("Error on prepareReceiveVideoFrom: "+JSON.stringify(r)));t.completeWebRtcPeerReceive(e,!1,o.sdpOffer).then((function(){return n()})).catch((function(e){return i(e)}))}))}))},e.prototype.completeWebRtcPeerReceive=function(e,t,n){var i=this;return new Promise((function(r,o){S.debug("'Session.subscribe(Stream)' called");var s=function(s){S.debug("Sending local SDP ".concat(n?"answer":"offer"," to subscribe to ").concat(i.streamId),s);var a=e?"reconnectStream":"receiveVideoFrom",c={};c[e?"stream":"sender"]=i.streamId,n?c[e?"sdpString":"sdpAnswer"]=s:c["sdpOffer"]=s,e&&(c["forciblyReconnect"]=t),i.session.openvidu.sendRequest(a,c,(function(e,t){return e?o(new Error("Error on "+a+" : "+JSON.stringify(e))):r(t)}))},a={mediaConstraints:{audio:i.hasAudio,video:i.hasVideo},simulcast:!1,onIceCandidate:i.connection.sendIceCandidate.bind(i.connection),onIceConnectionStateException:i.onIceConnectionStateExceptionHandler.bind(i),iceServers:i.getIceServersConf(),mediaServer:i.session.openvidu.mediaServer,typeOfVideo:i.typeOfVideo?m.TypeOfVideo[i.typeOfVideo]:void 0};e&&i.disposeWebRtcPeer(),i.webRtcPeer=new c.WebRtcPeerRecvonly(a),i.webRtcPeer.addIceConnectionStateChangeListener(i.streamId),n?i.webRtcPeer.processRemoteOffer(n).then((function(){i.webRtcPeer.createAnswer().then((function(e){i.webRtcPeer.processLocalAnswer(e).then((function(){s(e.sdp)})).catch((function(e){return o(new Error("(subscribe) SDP process local answer error: "+JSON.stringify(e)))}))})).catch((function(e){return o(new Error("(subscribe) SDP create answer error: "+JSON.stringify(e)))}))})).catch((function(e){return o(new Error("(subscribe) SDP process remote offer error: "+JSON.stringify(e)))})):i.webRtcPeer.createOffer().then((function(e){i.webRtcPeer.processLocalOffer(e).then((function(){s(e.sdp)})).catch((function(e){return o(new Error("(subscribe) SDP process local offer error: "+JSON.stringify(e)))}))})).catch((function(e){return o(new Error("(subscribe) SDP create offer error: "+JSON.stringify(e)))}))}))},e.prototype.remotePeerSuccessfullyEstablished=function(e){var t;e&&null!=this.mediaStream&&this.disposeMediaStream(),this.mediaStream=new MediaStream;for(var n=0,i=this.webRtcPeer.pc.getReceivers();n<i.length;n++)t=i[n],t.track&&this.mediaStream.addTrack(t.track);if(S.debug("Peer remote stream",this.mediaStream),this.mediaStream){if(this.streamManager instanceof a.Subscriber){if(this.mediaStream.getAudioTracks()[0]){var r=e?this.audioActive:!!this.streamManager.properties.subscribeToAudio;this.mediaStream.getAudioTracks()[0].enabled=r}if(this.mediaStream.getVideoTracks()[0]){r=e?this.videoActive:!!this.streamManager.properties.subscribeToVideo;this.mediaStream.getVideoTracks()[0].enabled=r}}this.updateMediaStreamInVideos(),this.initHarkEvents()}},e.prototype.initHarkEvents=function(){this.mediaStream.getAudioTracks()[0]&&(this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!0,this.streamManager)&&this.enableOnceHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.streamManager)&&this.enableHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!0,this.streamManager)&&this.enableOnceHarkStoppedSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.streamManager)&&this.enableHarkStoppedSpeakingEvent(),this.harkVolumeChangeEnabledOnce&&this.enableOnceHarkVolumeChangeEvent(!0),this.harkVolumeChangeEnabled&&this.enableHarkVolumeChangeEvent(!0))},e.prototype.onIceConnectionStateExceptionHandler=function(e,t,n){switch(e){case u.ExceptionEventName.ICE_CONNECTION_FAILED:this.onIceConnectionFailed();break;case u.ExceptionEventName.ICE_CONNECTION_DISCONNECTED:this.onIceConnectionDisconnected();break}this.session.emitEvent("exception",[new u.ExceptionEvent(this.session,e,this,t,n)])},e.prototype.onIceConnectionFailed=function(){S.log("[ICE_CONNECTION_FAILED] Handling ICE_CONNECTION_FAILED event. Reconnecting stream ".concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",")")),this.reconnectStreamAndLogResultingIceConnectionState(u.ExceptionEventName.ICE_CONNECTION_FAILED)},e.prototype.onIceConnectionDisconnected=function(){var e=this;S.log("[ICE_CONNECTION_DISCONNECTED] Handling ICE_CONNECTION_DISCONNECTED event. Waiting for ICE to be restored and reconnect stream ".concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") if not possible"));var t=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3;this.awaitWebRtcPeerConnectionState(t).then((function(n){switch(n){case"failed":S.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream ".concat(e.streamId," (").concat(e.isLocal()?"Publisher":"Subscriber",") is now failed after ICE_CONNECTION_DISCONNECTED"));break;case"connected":case"completed":S.log("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream ".concat(e.streamId," (").concat(e.isLocal()?"Publisher":"Subscriber",") automatically restored after ICE_CONNECTION_DISCONNECTED. Current ICE connection state: ").concat(n));break;case"closed":case"checking":case"new":case"disconnected":S.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream ".concat(e.streamId," (").concat(e.isLocal()?"Publisher":"Subscriber",") couldn't be restored after ICE_CONNECTION_DISCONNECTED event. Current ICE connection state after ").concat(t," ms: ").concat(n)),e.reconnectStreamAndLogResultingIceConnectionState(u.ExceptionEventName.ICE_CONNECTION_DISCONNECTED);break}}))},e.prototype.reconnectStreamAndLogResultingIceConnectionState=function(e){return i(this,void 0,void 0,(function(){var t,n;return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.reconnectStreamAndReturnIceConnectionState(e)];case 1:switch(t=i.sent(),t){case"connected":case"completed":S.log("[".concat(e,"] Stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") successfully reconnected after ").concat(e,". Current ICE connection state: ").concat(t));break;default:S.error("[".concat(e,"] Stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") failed to reconnect after ").concat(e,". Current ICE connection state: ").concat(t));break}return[3,3];case 2:return n=i.sent(),S.error("[".concat(e,"] Error reconnecting stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") after ").concat(e,": ").concat(n)),[3,3];case 3:return[2]}}))}))},e.prototype.reconnectStreamAndReturnIceConnectionState=function(e){return i(this,void 0,void 0,(function(){var t,n;return r(this,(function(i){switch(i.label){case 0:S.log("[".concat(e,"] Reconnecting stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") after event ").concat(e)),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.reconnectStream(e)];case 2:return i.sent(),t=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3,[2,this.awaitWebRtcPeerConnectionState(t)];case 3:return n=i.sent(),S.warn("[".concat(e,"] Error reconnecting stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber","). Reason: ").concat(n)),[2,this.awaitWebRtcPeerConnectionState(1)];case 4:return[2]}}))}))},e.prototype.awaitWebRtcPeerConnectionState=function(e){return i(this,void 0,void 0,(function(){var t,n,i,o;return r(this,(function(r){switch(r.label){case 0:t=this.getRTCPeerConnection().iceConnectionState,n=150,i=Math.ceil(e/n),o=0,r.label=1;case 1:return o<i?(t=this.getRTCPeerConnection().iceConnectionState,"connected"===t||"completed"===t?[3,4]:[4,new Promise((function(e){return setTimeout(e,n)}))]):[3,4];case 2:r.sent(),r.label=3;case 3:return o++,[3,1];case 4:return[2,t]}}))}))},e.prototype.reconnectStream=function(e){return i(this,void 0,void 0,(function(){var t,n;return r(this,(function(i){switch(i.label){case 0:return[4,this.isWebsocketConnected(e,3e3)];case 1:if(t=i.sent(),t)return S.log("[".concat(e,"] Trying to reconnect stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") and the websocket is opened")),this.isLocal()?[2,this.initWebRtcPeerSend(!0)]:[2,this.initWebRtcPeerReceive(!0)];throw n="[".concat(e,"] Trying to reconnect stream ").concat(this.streamId," (").concat(this.isLocal()?"Publisher":"Subscriber",") but the websocket wasn't opened"),S.error(n),Error(n)}}))}))},e.prototype.isWebsocketConnected=function(e,t){var n=this;return new Promise((function(i,r){var o=n.session.openvidu.getWsReadyState();if(1!==o)return console.warn("[".concat(e,"] Websocket readyState is ").concat(o)),i(!1);var s=setTimeout((function(){return console.warn("[".concat(e,"] Websocket timeout of ").concat(t,"ms")),i(!1)}),t);n.session.openvidu.sendRequest("echo",{},(function(t,n){return clearTimeout(s),t?(console.warn("[".concat(e,"] Websocket 'echo' returned error: ").concat(t)),i(!1)):i(!0)}))}))},e.prototype.initWebRtcStats=function(){this.webRtcStats=new l.WebRtcStats(this),this.webRtcStats.initWebRtcStats()},e.prototype.stopWebRtcStats=function(){this.webRtcStats&&this.webRtcStats.isEnabled()&&this.webRtcStats.stopWebRtcStats()},e.prototype.getIceServersConf=function(){var e;return e=this.session.openvidu.advancedConfiguration.iceServers?"freeice"===this.session.openvidu.advancedConfiguration.iceServers?void 0:this.session.openvidu.advancedConfiguration.iceServers:this.session.openvidu.iceServers?this.session.openvidu.iceServers:void 0,e},e.prototype.gatherStatsForPeer=function(){var e=this;return new Promise((function(t,n){e.isLocal()?e.getRTCPeerConnection().getSenders().forEach((function(t){return t.getStats().then((function(t){t.forEach((function(t){if(e.isReportWanted(t)){var n={};n["type"]=t.type,n["timestamp"]=t.timestamp,n["id"]=t.id,"outbound-rtp"===t.type&&(n["ssrc"]=t.ssrc,n["firCount"]=t.firCount,n["pliCount"]=t.pliCount,n["nackCount"]=t.nackCount,n["qpSum"]=t.qpSum,t.kind?n["mediaType"]=t.kind:t.mediaType?n["mediaType"]=t.mediaType:n["mediaType"]=-1!==t.id.indexOf("VideoStream")?"video":"audio","video"===n["mediaType"]&&(n["framesEncoded"]=t.framesEncoded),n["packetsSent"]=t.packetsSent,n["bytesSent"]=t.bytesSent),"candidate-pair"===t.type&&void 0!==t.totalRoundTripTime&&(n["availableOutgoingBitrate"]=t.availableOutgoingBitrate,n["rtt"]=t.currentRoundTripTime,n["averageRtt"]=t.totalRoundTripTime/t.responsesReceived),"remote-inbound-rtp"===t.type||t.type,S.log(n)}}))}))})):e.getRTCPeerConnection().getReceivers().forEach((function(t){return t.getStats().then((function(t){t.forEach((function(t){if(e.isReportWanted(t)){var n={};n["type"]=t.type,n["timestamp"]=t.timestamp,n["id"]=t.id,"inbound-rtp"===t.type&&(n["ssrc"]=t.ssrc,n["firCount"]=t.firCount,n["pliCount"]=t.pliCount,n["nackCount"]=t.nackCount,n["qpSum"]=t.qpSum,t.kind?n["mediaType"]=t.kind:t.mediaType?n["mediaType"]=t.mediaType:n["mediaType"]=-1!==t.id.indexOf("VideoStream")?"video":"audio","video"===n["mediaType"]&&(n["framesDecoded"]=t.framesDecoded),n["packetsReceived"]=t.packetsReceived,n["packetsLost"]=t.packetsLost,n["jitter"]=t.jitter,n["bytesReceived"]=t.bytesReceived),"candidate-pair"===t.type&&void 0!==t.totalRoundTripTime&&(n["availableIncomingBitrate"]=t.availableIncomingBitrate,n["rtt"]=t.currentRoundTripTime,n["averageRtt"]=t.totalRoundTripTime/t.responsesReceived),"remote-inbound-rtp"===t.type||t.type,S.log(n)}}))}))}))}))},e.prototype.isReportWanted=function(e){return"inbound-rtp"===e.type&&!this.isLocal()||"outbound-rtp"===e.type&&this.isLocal()||"candidate-pair"===e.type&&e.nominated&&e.bytesSent>0},e}();t.Stream=w},"0d3b":function(e,t,n){var i=n("d039"),r=n("b622"),o=n("c430"),s=r("iterator");e.exports=!i((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,i){t["delete"]("b"),n+=i+e})),o&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[s]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host}))},"0f3b":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=void 0;var i=n("f66e"),r=n("e0ef"),o=i.OpenViduLogger.getInstance(),s=function(){function e(){this.userHandlerArrowHandler=new WeakMap,this.ee=new r}return e.prototype.onAux=function(e,t,n){var i=function(e){e?o.debug(t,e):o.debug(t),n(e)};return this.userHandlerArrowHandler.set(n,i),this.ee.on(e,i),this},e.prototype.onceAux=function(e,t,n){var i=this,r=function(e){e?o.debug(t,e):o.debug(t),n(e),i.userHandlerArrowHandler.delete(n)};return this.userHandlerArrowHandler.set(n,r),this.ee.once(e,r),this},e.prototype.offAux=function(e,t){if(t){var n=this.userHandlerArrowHandler.get(t);n&&this.ee.off(e,n),this.userHandlerArrowHandler.delete(t)}else this.ee.removeAllListeners(e);return this},e}();t.EventDispatcher=s},"103a":function(e,t,n){var i=n("01e1"),r=n("714c"),o=n("f66e").OpenViduLogger;Date.now=Date.now||function(){return+new Date};var s=5e3,a="RECONNECTING",c="CONNECTED",l="DISCONNECTED",u=o.getInstance();function d(e){var t,n=this,o=e.ws,d=-1,h=0,p=!0,f=!1,m=l,v=o.onreconnecting,g=o.onreconnected,E=o.onconnected,b=o.onerror;e.rpc.pull=function(e,t){t.reply(null,"push")},o.onreconnecting=function(){u.debug("--------- ONRECONNECTING -----------"),m!==a?(R(),m=a,v&&v()):u.error("Websocket already in RECONNECTING state when receiving a new ONRECONNECTING message. Ignoring it")},o.onreconnected=function(){u.debug("--------- ONRECONNECTED -----------"),m!==c?(m=c,C(),g&&g()):u.error("Websocket already in CONNECTED state when receiving a new ONRECONNECTED message. Ignoring it")},o.onconnected=function(){u.debug("--------- ONCONNECTED -----------"),m!==c?(m=c,p=!0,x(),E&&E()):u.error("Websocket already in CONNECTED state when receiving a new ONCONNECTED message. Ignoring it")},o.onerror=function(e){u.debug("--------- ONERROR -----------"),m=l,R(),b&&b(e)};var y=new r(o);u.debug("Connecting websocket to URI: "+o.uri);var S={request_timeout:e.rpc.requestTimeout,ping_request_timeout:e.rpc.heartbeatRequestTimeout},w=new i(i.packers.JsonRPC,S,y,(function(t){u.debug("Received request: "+JSON.stringify(t));try{var n=e.rpc[t.method];void 0===n?u.error("Method "+t.method+" not registered in client"):n(t.params,t)}catch(i){u.error("Exception processing request: "+JSON.stringify(t)),u.error(i)}}));function C(){u.debug("notReconnectIfNumLessThan = "+h+" (old="+d+")"),d=h}function O(){if(p){var t=null;0!=h&&h!=d||(t={interval:e.heartbeat||s}),h++,n.send("ping",t,function(e){return function(t,n){t&&(u.debug("Error in ping request #"+e+" ("+t.message+")"),e>d&&(p=!1,C(),u.debug("Server did not respond to ping message #"+e+". Reconnecting... "),y.reconnectWs()))}}(h))}else u.debug("Trying to send ping, but ping is not enabled")}function x(){f||(u.debug("Starting ping (if configured)"),f=!0,void 0!=e.heartbeat&&(t=setInterval(O,e.heartbeat),O()))}function R(){clearInterval(t),f=!1,p=!1,h=-1,w.cancel()}this.send=function(e,t,n){var i=Date.now();w.encode(e,t,(function(r,o){if(r){try{u.error("ERROR:"+r.message+" in Request: method:"+e+" params:"+JSON.stringify(t)+" request:"+r.request),r.data&&u.error("ERROR DATA:"+JSON.stringify(r.data))}catch(s){}r.requestTime=i}n&&(void 0!=o&&"pong"!==o.value&&u.debug("Response: "+JSON.stringify(o)),n(r,o))}))},this.close=function(e,n){u.debug("Closing  with code: "+e+" because: "+n),void 0!=t&&(u.debug("Clearing ping interval"),clearInterval(t)),f=!1,p=!1,y.close(e,n)},this.reconnect=function(){y.reconnectWs()},this.resetPing=function(){p=!0,h=0,x()},this.getReadyState=function(){return y.getReadyState()}}e.exports=d},"11c5":function(e,t){var n,i,r="screen";if("undefined"!==typeof window&&"undefined"!==typeof navigator&&"undefined"!==typeof navigator.userAgent){var o="undefined"!==typeof window.InstallTrigger,s=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;window.chrome;window.addEventListener("message",(function(e){e.origin==window.location.origin&&a(e.data)}))}function a(e){if("PermissionDeniedError"==e){if(i)return i("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(r="desktop"),e.sourceId&&i&&i(n=e.sourceId,!0===e.canRequestAudioTrack)}function c(e){if(e){if("desktop"==r)return e(!0);window.postMessage("are-you-there","*"),setTimeout((function(){e("screen"!=r)}),2e3)}}function l(e){if(!e)throw'"callback" parameter is mandatory.';if(n)return e(n);i=e,window.postMessage("get-sourceId","*")}function u(e){if(!e)throw'"callback" parameter is mandatory.';if(n)return e(n);i=e,window.postMessage("audio-plus-tab","*")}function d(e,t){if(o)return t("not-chrome");2!=arguments.length&&(t=e,e="lfcgfepafnobdloecchnfaclibenjold");var n=document.createElement("img");n.src="chrome-extension://"+e+"/icon.png",n.onload=function(){r="screen",window.postMessage("are-you-there","*"),setTimeout((function(){t("screen"==r?"installed-disabled":"installed-enabled")}),2e3)},n.onerror=function(){t("not-installed")}}function h(e){p(e,!0)}function p(e,t){n="";var i={mozMediaSource:"window",mediaSource:"window"};if(o)return e(null,i);var s={mandatory:{chromeMediaSource:r,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]};"desktop"!=r||n?("desktop"==r&&(s.mandatory.chromeMediaSourceId=n),e(null,s)):t?u((function(t,n){s.mandatory.chromeMediaSourceId=t,n&&(s.canRequestAudioTrack=!0),e("PermissionDeniedError"==t?t:null,s)})):l((function(t){s.mandatory.chromeMediaSourceId=t,e("PermissionDeniedError"==t?t:null,s)}))}t.getScreenConstraints=p,t.getScreenConstraintsWithAudio=h,t.isChromeExtensionAvailable=c,t.getChromeExtensionStatus=d,t.getSourceId=l},1276:function(e,t,n){"use strict";var i=n("d784"),r=n("44e7"),o=n("825a"),s=n("1d80"),a=n("4840"),c=n("8aa5"),l=n("50c4"),u=n("14c3"),d=n("9263"),h=n("d039"),p=[].push,f=Math.min,m=4294967295,v=!h((function(){return!RegExp(m,"y")}));i("split",2,(function(e,t,n){var i;return i="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var i=String(s(this)),o=void 0===n?m:n>>>0;if(0===o)return[];if(void 0===e)return[i];if(!r(e))return t.call(i,e,o);var a,c,l,u=[],h=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,v=new RegExp(e.source,h+"g");while(a=d.call(v,i)){if(c=v.lastIndex,c>f&&(u.push(i.slice(f,a.index)),a.length>1&&a.index<i.length&&p.apply(u,a.slice(1)),l=a[0].length,f=c,u.length>=o))break;v.lastIndex===a.index&&v.lastIndex++}return f===i.length?!l&&v.test("")||u.push(""):u.push(i.slice(f)),u.length>o?u.slice(0,o):u}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var r=s(this),o=void 0==t?void 0:t[e];return void 0!==o?o.call(t,r,n):i.call(String(r),t,n)},function(e,r){var s=n(i,e,this,r,i!==t);if(s.done)return s.value;var d=o(e),h=String(this),p=a(d,RegExp),g=d.unicode,E=(d.ignoreCase?"i":"")+(d.multiline?"m":"")+(d.unicode?"u":"")+(v?"y":"g"),b=new p(v?d:"^(?:"+d.source+")",E),y=void 0===r?m:r>>>0;if(0===y)return[];if(0===h.length)return null===u(b,h)?[h]:[];var S=0,w=0,C=[];while(w<h.length){b.lastIndex=v?w:0;var O,x=u(b,v?h:h.slice(w));if(null===x||(O=f(l(b.lastIndex+(v?0:w)),h.length))===S)w=c(h,w,g);else{if(C.push(h.slice(S,w)),C.length===y)return C;for(var R=1;R<=x.length-1;R++)if(C.push(x[R]),C.length===y)return C;w=S=O}}return C.push(h.slice(S)),C}]}),!v)},1946:function(e,t,n){"use strict";let i=n("4755");e.exports=new i(n("c1a9"))},"1f15":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.StreamManagerEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i){var r=e.call(this,!1,t,n)||this;return r.value=i,r}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.StreamManagerEvent=o},2533:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,a[0]&&(s=0)),s)try{if(n=1,i&&(r=2&a[0]?i["return"]:a[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(c){a=[6,c],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;var s,a=n("af24"),c=n("ef86"),l=n("6e4e"),u=n("0f3b"),d=n("f0a5"),h=n("fa28"),p=n("ad42"),f=n("92c2"),m=n("b2e1"),v=n("fefe"),g=n("4def"),E=n("0703"),b=n("f1bf"),y=n("043b"),S=n("4edf"),w=n("fdd2"),C=n("f66e"),O=n("e237"),x=n("bf54"),R=n("3c13"),I=n("e9cb"),T=C.OpenViduLogger.getInstance(),P=function(e){function t(t){var n=e.call(this)||this;return n.streamManagers=[],n.remoteStreamsCreated=new Map,n.remoteConnections=new Map,s=O.PlatformUtils.getInstance(),n.openvidu=t,n}return i(t,e),t.prototype.connect=function(e,t){var n=this;return new Promise((function(i,r){if(n.processToken(e),!n.openvidu.checkSystemRequirements())return r(new S.OpenViduError(S.OpenViduErrorName.BROWSER_NOT_SUPPORTED,"Browser "+s.getName()+" (version "+s.getVersion()+") for "+s.getFamily()+" is not supported in OpenVidu"));n.options={sessionId:n.sessionId,participantId:e,metadata:t?n.stringClientMetadata(t):""},n.connectAux(e).then((function(){return i()})).catch((function(e){return r(e)}))}))},t.prototype.disconnect=function(){this.leave(!1,"disconnect")},t.prototype.subscribe=function(e,t,n,i){var r={};r=n&&"function"!==typeof n?{insertMode:"undefined"!==typeof n.insertMode?"string"===typeof n.insertMode?w.VideoInsertMode[n.insertMode]:r.insertMode:w.VideoInsertMode.APPEND,subscribeToAudio:"undefined"===typeof n.subscribeToAudio||n.subscribeToAudio,subscribeToVideo:"undefined"===typeof n.subscribeToVideo||n.subscribeToVideo}:{insertMode:w.VideoInsertMode.APPEND,subscribeToAudio:!0,subscribeToVideo:!0};var o=void 0;if(n&&"function"===typeof n?o=n:i&&(o=i),!this.sessionConnected())throw void 0!==o&&o(this.notConnectedError()),this.notConnectedError();T.info("Subscribing to "+e.connection.connectionId),e.subscribe().then((function(){T.info("Subscribed correctly to "+e.connection.connectionId),void 0!==o&&o(void 0)})).catch((function(e){void 0!==o&&o(e)}));var s=new l.Subscriber(e,t,r);return s.targetElement&&e.streamManager.createVideoElement(s.targetElement,r.insertMode),s},t.prototype.subscribeAsync=function(e,t,n){var i=this;return new Promise((function(r,o){if(!i.sessionConnected())return o(i.notConnectedError());var s,a=function(e){return e?o(e):r(s)};s=n?i.subscribe(e,t,n,a):i.subscribe(e,t,a)}))},t.prototype.unsubscribe=function(e){var t=this;return new Promise((function(n,i){if(!t.sessionConnected())return i(t.notConnectedError());var r=e.stream.connection.connectionId;T.info("Unsubscribing from "+r),t.openvidu.sendRequest("unsubscribeFromVideo",{sender:e.stream.connection.connectionId},(function(t,o){return t?(T.error("Error unsubscribing from "+r),i(t)):(T.info("Unsubscribed correctly from "+r),e.stream.streamManager.removeAllVideos(),e.stream.disposeWebRtcPeer(),e.stream.disposeMediaStream(),n())}))}))},t.prototype.publish=function(e){var t=this;return new Promise((function(n,i){if(!t.sessionConnected())return i(t.notConnectedError());e.session=t,e.stream.session=t,e.stream.publishedOnce?e.initialize().then((function(){t.connection.addStream(e.stream),e.reestablishStreamPlayingEvent(),e.stream.publish().then((function(){return t.sendVideoData(e,8,!0,5),n()})).catch((function(e){return i(e)}))})).catch((function(e){return i(e)})):(t.connection.addStream(e.stream),e.stream.publish().then((function(){return t.sendVideoData(e,8,!0,5),n()})).catch((function(e){return i(e)})))}))},t.prototype.unpublish=function(e){var t=this;return new Promise((function(n,i){if(!t.sessionConnected())throw t.notConnectedError();var r=e.stream;return r.connection?r.connection!==t.connection?i(new Error("The associated Connection object of this Publisher is not your local Connection.  Only moderators can force unpublish on remote Streams via 'forceUnpublish' method")):(T.info("Unpublishing local media ("+r.connection.connectionId+")"),void t.openvidu.sendRequest("unpublishVideo",(function(t,o){if(t)return i(t);T.info("Media unpublished correctly"),r.disposeWebRtcPeer(),r.connection.stream==r&&delete r.connection.stream;var s=new g.StreamEvent(!0,e,"streamDestroyed",e.stream,"unpublish");return e.emitEvent("streamDestroyed",[s]),s.callDefaultBehavior(),n()}))):i(new Error("The associated Connection object of this Publisher is null"))}))},t.prototype.forceDisconnect=function(e){var t=this;return new Promise((function(n,i){if(!t.sessionConnected())return i(t.notConnectedError());T.info("Forcing disconnect for connection "+e.connectionId),t.openvidu.sendRequest("forceDisconnect",{connectionId:e.connectionId},(function(t,r){return t?(T.error("Error forcing disconnect for Connection "+e.connectionId,t),401===t.code?i(new S.OpenViduError(S.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force a disconnection")):i(t)):(T.info("Forcing disconnect correctly for Connection "+e.connectionId),n())}))}))},t.prototype.forceUnpublish=function(e){var t=this;return new Promise((function(n,i){if(!t.sessionConnected())return i(t.notConnectedError());T.info("Forcing unpublish for stream "+e.streamId),t.openvidu.sendRequest("forceUnpublish",{streamId:e.streamId},(function(t,r){return t?(T.error("Error forcing unpublish for Stream "+e.streamId,t),401===t.code?i(new S.OpenViduError(S.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force an unpublishing")):i(t)):(T.info("Forcing unpublish correctly for Stream "+e.streamId),n())}))}))},t.prototype.signal=function(e){var t=this;return new Promise((function(n,i){if(!t.sessionConnected())return i(t.notConnectedError());var r={};if(e.to&&e.to.length>0){var o=[];e.to.forEach((function(e){e.connectionId&&o.push(e.connectionId)})),r["to"]=o}else r["to"]=[];r["data"]=e.data?e.data:"";var s=e.type?e.type:"signal";s&&"signal:"!==s.substring(0,7)&&(s="signal:"+s),r["type"]=s,t.openvidu.sendRequest("sendMessage",{message:JSON.stringify(r)},(function(e,t){return e?i(e):n()}))}))},t.prototype.subscribeToSpeechToText=function(e,t){var n=this;return new Promise((function(i,r){n.openvidu.sendRequest("subscribeToSpeechToText",{connectionId:e.connection.connectionId,lang:t},(function(e,t){return e?r(e):i()}))}))},t.prototype.unsubscribeFromSpeechToText=function(e){var t=this;return new Promise((function(n,i){t.openvidu.sendRequest("unsubscribeFromSpeechToText",{connectionId:e.connection.connectionId},(function(e,t){return e?i(e):n()}))}))},t.prototype.on=function(t,n){var i,r,o,s;return e.prototype.onAux.call(this,t,"Event '"+t+"' triggered by 'Session'",n),"publisherStartSpeaking"===t&&(this.remoteConnections.forEach((function(e){var t;(null===(t=e.stream)||void 0===t?void 0:t.hasAudio)&&e.stream.enableHarkSpeakingEvent()})),(null===(r=null===(i=this.connection)||void 0===i?void 0:i.stream)||void 0===r?void 0:r.hasAudio)&&this.connection.stream.enableHarkSpeakingEvent()),"publisherStopSpeaking"===t&&(this.remoteConnections.forEach((function(e){var t;(null===(t=e.stream)||void 0===t?void 0:t.hasAudio)&&e.stream.enableHarkStoppedSpeakingEvent()})),(null===(s=null===(o=this.connection)||void 0===o?void 0:o.stream)||void 0===s?void 0:s.hasAudio)&&this.connection.stream.enableHarkStoppedSpeakingEvent()),this},t.prototype.once=function(t,n){var i,r,o,s;return e.prototype.onceAux.call(this,t,"Event '"+t+"' triggered once by 'Session'",n),"publisherStartSpeaking"===t&&(this.remoteConnections.forEach((function(e){var t;(null===(t=e.stream)||void 0===t?void 0:t.hasAudio)&&e.stream.enableOnceHarkSpeakingEvent()})),(null===(r=null===(i=this.connection)||void 0===i?void 0:i.stream)||void 0===r?void 0:r.hasAudio)&&this.connection.stream.enableOnceHarkSpeakingEvent()),"publisherStopSpeaking"===t&&(this.remoteConnections.forEach((function(e){var t;(null===(t=e.stream)||void 0===t?void 0:t.hasAudio)&&e.stream.enableOnceHarkStoppedSpeakingEvent()})),(null===(s=null===(o=this.connection)||void 0===o?void 0:o.stream)||void 0===s?void 0:s.hasAudio)&&this.connection.stream.enableOnceHarkStoppedSpeakingEvent()),this},t.prototype.off=function(t,n){var i,r,o,s,a=this;return e.prototype.offAux.call(this,t,n),"publisherStartSpeaking"===t&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1)||(this.remoteConnections.forEach((function(e){var t;(null===(t=e.stream)||void 0===t?void 0:t.streamManager)&&(a.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,e.stream.streamManager)||e.stream.disableHarkSpeakingEvent(!1))})),(null===(r=null===(i=this.connection)||void 0===i?void 0:i.stream)||void 0===r?void 0:r.streamManager)&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkSpeakingEvent(!1)))),"publisherStopSpeaking"===t&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1)||(this.remoteConnections.forEach((function(e){var t;(null===(t=e.stream)||void 0===t?void 0:t.streamManager)&&(a.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,e.stream.streamManager)||e.stream.disableHarkStoppedSpeakingEvent(!1))})),(null===(s=null===(o=this.connection)||void 0===o?void 0:o.stream)||void 0===s?void 0:s.streamManager)&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkStoppedSpeakingEvent(!1)))),this},t.prototype.onParticipantJoined=function(e){var t=this;this.getConnection(e.id,"").then((function(e){T.warn("Connection "+e.connectionId+" already exists in connections list")})).catch((function(n){var i=new a.Connection(t,e);t.remoteConnections.set(e.id,i),t.ee.emitEvent("connectionCreated",[new d.ConnectionEvent(!1,t,"connectionCreated",i,"")])}))},t.prototype.onParticipantLeft=function(e){var t=this;this.getRemoteConnection(e.connectionId,"onParticipantLeft").then((function(n){if(n.stream){var i=n.stream,r=new g.StreamEvent(!0,t,"streamDestroyed",i,e.reason);t.ee.emitEvent("streamDestroyed",[r]),r.callDefaultBehavior(),t.remoteStreamsCreated.delete(i.streamId)}n.dispose(),t.remoteConnections.delete(n.connectionId),t.ee.emitEvent("connectionDestroyed",[new d.ConnectionEvent(!1,t,"connectionDestroyed",n,e.reason)])})).catch((function(e){T.error(e)}))},t.prototype.onParticipantPublished=function(e){var t,n=this,i=function(e){n.remoteConnections.set(e.connectionId,e),n.remoteStreamsCreated.get(e.stream.streamId)||n.ee.emitEvent("streamCreated",[new g.StreamEvent(!1,n,"streamCreated",e.stream,"")]),n.remoteStreamsCreated.set(e.stream.streamId,!0)};this.getRemoteConnection(e.id,"onParticipantPublished").then((function(n){t=n,e.metadata=n.data,t.remoteOptions=e,t.initRemoteStreams(e.streams),i(t)})).catch((function(r){t=new a.Connection(n,e),i(t)}))},t.prototype.onParticipantUnpublished=function(e){var t=this;e.connectionId===this.connection.connectionId?this.stopPublisherStream(e.reason):this.getRemoteConnection(e.connectionId,"onParticipantUnpublished").then((function(n){var i=new g.StreamEvent(!0,t,"streamDestroyed",n.stream,e.reason);if(t.ee.emitEvent("streamDestroyed",[i]),i.callDefaultBehavior(),null!=n.stream){var r=n.stream.streamId;t.remoteStreamsCreated.delete(r),n.removeStream()}})).catch((function(e){T.error(e)}))},t.prototype.onParticipantEvicted=function(e){e.connectionId===this.connection.connectionId&&this.sessionId&&!this.connection.disposed&&this.leave(!0,e.reason)},t.prototype.onNewMessage=function(e){var t=this;T.info("New signal: "+JSON.stringify(e));var n=e.type?e.type.replace(/^(signal:)/,""):void 0;e.from?this.getConnection(e.from,"Connection '"+e.from+"' unknown when 'onNewMessage'. Existing remote connections: "+JSON.stringify(this.remoteConnections.keys())+". Existing local connection: "+this.connection.connectionId).then((function(i){t.ee.emitEvent("signal",[new m.SignalEvent(t,n,e.data,i)]),e.type&&"signal"!==e.type&&t.ee.emitEvent(e.type,[new m.SignalEvent(t,n,e.data,i)])})).catch((function(e){T.error(e)})):(this.ee.emitEvent("signal",[new m.SignalEvent(this,n,e.data,void 0)]),e.type&&"signal"!==e.type&&this.ee.emitEvent(e.type,[new m.SignalEvent(this,n,e.data,void 0)]))},t.prototype.onStreamPropertyChanged=function(e){var t=this,n=function(n){if(n.stream&&n.stream.streamId===e.streamId){var i=n.stream,r=void 0;switch(e.property){case"audioActive":r=i.audioActive,e.newValue="true"===e.newValue,i.audioActive=e.newValue;break;case"videoActive":r=i.videoActive,e.newValue="true"===e.newValue,i.videoActive=e.newValue;break;case"videoTrack":e.newValue=JSON.parse(e.newValue);break;case"audioTrack":e.newValue=JSON.parse(e.newValue);break;case"videoDimensions":r=i.videoDimensions,e.newValue=JSON.parse(JSON.parse(e.newValue)),i.videoDimensions=e.newValue;break;case"filter":r=i.filter,e.newValue=Object.keys(e.newValue).length>0?e.newValue:void 0,void 0!==e.newValue?(i.filter=new c.Filter(e.newValue.type,e.newValue.options),i.filter.stream=i,e.newValue.lastExecMethod&&(i.filter.lastExecMethod=e.newValue.lastExecMethod)):delete i.filter,e.newValue=i.filter;break}t.ee.emitEvent("streamPropertyChanged",[new E.StreamPropertyChangedEvent(t,i,e.property,e.newValue,r,e.reason)]),i.streamManager&&i.streamManager.emitEvent("streamPropertyChanged",[new E.StreamPropertyChangedEvent(i.streamManager,i,e.property,e.newValue,r,e.reason)])}else T.error("No stream with streamId '"+e.streamId+"' found for connection '"+e.connectionId+"' on 'streamPropertyChanged' event")};e.connectionId===this.connection.connectionId?n(this.connection):this.getRemoteConnection(e.connectionId,"onStreamPropertyChanged").then((function(e){n(e)})).catch((function(e){T.error(e)}))},t.prototype.onConnectionPropertyChanged=function(e){var t;switch(e.property){case"role":t=this.connection.role.slice(),this.connection.role=e.newValue,this.connection.localOptions.role=e.newValue;break;case"record":t=this.connection.record,e.newValue="true"===e.newValue,this.connection.record=e.newValue,this.connection.localOptions.record=e.newValue;break}this.ee.emitEvent("connectionPropertyChanged",[new b.ConnectionPropertyChangedEvent(this,this.connection,e.property,e.newValue,t)])},t.prototype.onNetworkQualityLevelChangedChanged=function(e){var t=this;e.connectionId===this.connection.connectionId?this.ee.emitEvent("networkQualityLevelChanged",[new y.NetworkQualityLevelChangedEvent(this,e.newValue,e.oldValue,this.connection)]):this.getConnection(e.connectionId,"Connection not found for connectionId "+e.connectionId).then((function(n){t.ee.emitEvent("networkQualityLevelChanged",[new y.NetworkQualityLevelChangedEvent(t,e.newValue,e.oldValue,n)])})).catch((function(e){T.error(e)}))},t.prototype.recvIceCandidate=function(e){var t={candidate:e.candidate,sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid},n=new RTCIceCandidate(t);this.getConnection(e.senderConnectionId,"Connection not found for connectionId "+e.senderConnectionId+" owning endpoint "+e.endpointName+". Ice candidate will be ignored: "+n).then((function(t){var i=t.stream;i.getWebRtcPeer().addIceCandidate(n).catch((function(t){T.error("Error adding candidate for "+i.streamId+" stream of endpoint "+e.endpointName+": "+t)}))})).catch((function(e){T.error(e)}))},t.prototype.onSessionClosed=function(e){T.info("Session closed: "+JSON.stringify(e));var t=e.sessionId;void 0!==t?this.ee.emitEvent("session-closed",[{session:t}]):T.warn("Session undefined on session closed",e)},t.prototype.onLostConnection=function(e){T.warn("Lost connection in Session "+this.sessionId),this.sessionId&&this.connection&&!this.connection.disposed&&this.leave(!0,e)},t.prototype.onRecoveredConnection=function(){T.info("Recovered connection in Session "+this.sessionId),this.reconnectBrokenStreams(),this.ee.emitEvent("reconnected",[])},t.prototype.onMediaError=function(e){T.error("Media error: "+JSON.stringify(e));var t=e.error;t?this.ee.emitEvent("error-media",[{error:t}]):T.warn("Received undefined media error:",e)},t.prototype.onRecordingStarted=function(e){this.ee.emitEvent("recordingStarted",[new p.RecordingEvent(this,"recordingStarted",e.id,e.name)])},t.prototype.onRecordingStopped=function(e){this.ee.emitEvent("recordingStopped",[new p.RecordingEvent(this,"recordingStopped",e.id,e.name,e.reason)])},t.prototype.onFilterEventDispatched=function(e){var t=this,n=e.connectionId;this.getConnection(n,"No connection found for connectionId "+n).then((function(n){T.info('Filter event of type "'.concat(e.eventType,'" dispatched'));var i=n.stream;if(!i||!i.filter)return T.error('Filter event of type "'.concat(e.eventType,'" dispatched for stream ').concat(i.streamId," but there is no ").concat(i?"filter":"stream"," defined"));var r=i.filter.handlers.get(e.eventType);if(!r||"function"!==typeof r){var o=Array.from(i.filter.handlers.keys());return T.error('Filter event of type "'.concat(e.eventType,'" not handled or not a function! Active filter events: ').concat(o.join(",")))}r.call(t,new h.FilterEvent(i.filter,e.eventType,e.data))}))},t.prototype.onForciblyReconnectSubscriber=function(e){var t=this;return new Promise((function(n,i){t.getRemoteConnection(e.connectionId,"onForciblyReconnectSubscriber").then((function(r){if(!r.stream||r.stream.streamId!==e.streamId){var o="No stream with streamId '"+e.streamId+"' found for connection '"+e.connectionId+"' on 'streamPropertyChanged' event";return T.error(o),i(o)}var s=r.stream;if(s.setupReconnectionEventEmitter(n,i)){if(null!=s.reconnectionEventEmitter["onForciblyReconnectSubscriberLastEvent"])return s.reconnectionEventEmitter["onForciblyReconnectSubscriberLastEvent"]=e,i("Ongoing forced subscriber reconnection");s.reconnectionEventEmitter["onForciblyReconnectSubscriberLastEvent"]=e;var a=function(){var e=s.reconnectionEventEmitter["onForciblyReconnectSubscriberLastEvent"];delete s.reconnectionEventEmitter["onForciblyReconnectSubscriberLastEvent"],t.onForciblyReconnectSubscriber(e)};return s.reconnectionEventEmitter.once("success",(function(){a()})),void s.reconnectionEventEmitter.once("error",(function(){a()}))}s.completeWebRtcPeerReceive(!0,!0,e.sdpOffer).then((function(){return s.finalResolveForSubscription(!0,n)})).catch((function(t){return s.finalRejectForSubscription(!0,"Error while forcibly reconnecting remote stream ".concat(e.streamId,": ").concat(t.toString()),i)}))})).catch((function(e){return T.error(e),i(e)}))}))},t.prototype.reconnectBrokenStreams=function(){T.info("Re-establishing media connections...");var e=!1;this.connection.stream&&this.connection.stream.streamIceConnectionStateBroken()&&(T.warn("Re-establishing Publisher "+this.connection.stream.streamId),this.connection.stream.initWebRtcPeerSend(!0),e=!0),this.remoteConnections.forEach((function(t){t.stream&&t.stream.streamIceConnectionStateBroken()&&(T.warn("Re-establishing Subscriber "+t.stream.streamId),t.stream.initWebRtcPeerReceive(!0),e=!0)})),e||T.info("There were no media streams in need of a reconnection")},t.prototype.onSpeechToTextMessage=function(e){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(i){switch(i.label){case 0:return[4,this.getConnection(e.connectionId,"No connection found for connectionId "+e.connectionId)];case 1:return t=i.sent(),n=new v.SpeechToTextEvent(this,t,e.text,e.reason.toLowerCase(),e.raw,e.lang),this.ee.emitEvent("speechToTextMessage",[n]),[2]}}))}))},t.prototype.onSpeechToTextDisconnected=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){return this.emitEvent("exception",[new I.ExceptionEvent(this,I.ExceptionEventName.SPEECH_TO_TEXT_DISCONNECTED,this,e.message)]),[2]}))}))},t.prototype.emitEvent=function(e,t){this.ee.emitEvent(e,t)},t.prototype.leave=function(e,t){var n=this;if(e=!!e,T.info("Leaving Session (forced="+e+")"),this.stopVideoDataIntervals(),this.connection){if(this.connection.disposed||e?this.openvidu.closeWs():this.openvidu.sendRequest("leaveRoom",(function(e,t){e&&T.error("leaveRoom error: ".concat(JSON.stringify(e))),n.openvidu.closeWs()})),this.stopPublisherStream(t),!this.connection.disposed){var i=new f.SessionDisconnectedEvent(this,t);this.ee.emitEvent("sessionDisconnected",[i]),i.callDefaultBehavior()}}else T.warn("You were not connected to the session "+this.sessionId);T.flush()},t.prototype.initializeParams=function(e){var t={token:e||"",session:this.sessionId,platform:s.getDescription()?s.getDescription():"unknown",sdkVersion:this.openvidu.libraryVersion,metadata:this.options.metadata?this.options.metadata:"",secret:this.openvidu.getSecret(),recorder:this.openvidu.getRecorder(),stt:this.openvidu.getStt()};return t},t.prototype.sendVideoData=function(e,t,n,i){var a,c,l=this;if(void 0===t&&(t=1),void 0===n&&(n=!1),void 0===i&&(i=1),s.isChromeBrowser()||s.isChromeMobileBrowser()||s.isOperaBrowser()||s.isOperaMobileBrowser()||s.isEdgeBrowser()||s.isEdgeMobileBrowser()||s.isElectron()||s.isSafariBrowser()&&!s.isIonicIos()||s.isAndroidBrowser()||s.isSamsungBrowser()||s.isIonicAndroid()||s.isIOSWithSafari()){var u=function(){return r(l,void 0,void 0,(function(){var t,n,i;return o(this,(function(r){switch(r.label){case 0:return t=e.stream.getRTCPeerConnection(),"connected"!==t.connectionState?[3,2]:[4,t.getStats()];case 1:n=r.sent(),i=[],n.forEach((function(e){"frameWidth"in e&&"frameHeight"in e&&0===i.length&&i.push(e)})),i.length>0&&this.openvidu.sendRequest("videoData",{height:i[0].frameHeight,width:i[0].frameWidth,videoActive:null!=e.stream.videoActive&&e.stream.videoActive,audioActive:null!=e.stream.audioActive&&e.stream.audioActive},(function(e,t){e&&T.error("Error sending 'videoData' event",e)})),r.label=2;case 2:return[2]}}))}))};if(n){var d=1;this.videoDataInterval=setInterval((function(){d<i?(d++,u()):clearInterval(l.videoDataInterval)}),1e3*t)}else this.videoDataTimeout=setTimeout(u,1e3*t)}else s.isFirefoxBrowser()||s.isFirefoxMobileBrowser()||s.isIonicIos()||s.isReactNative()?this.openvidu.sendRequest("videoData",{height:(null===(a=e.stream.videoDimensions)||void 0===a?void 0:a.height)||0,width:(null===(c=e.stream.videoDimensions)||void 0===c?void 0:c.width)||0,videoActive:null!=e.stream.videoActive&&e.stream.videoActive,audioActive:null!=e.stream.audioActive&&e.stream.audioActive},(function(e,t){e&&T.error("Error sending 'videoData' event",e)})):T.error("Browser "+s.getName()+" (version "+s.getVersion()+") for "+s.getFamily()+" is not supported in OpenVidu for Network Quality")},t.prototype.sessionConnected=function(){return null!=this.connection},t.prototype.notConnectedError=function(){return new S.OpenViduError(S.OpenViduErrorName.OPENVIDU_NOT_CONNECTED,"There is no connection to the session. Method 'Session.connect' must be successfully completed first")},t.prototype.anySpeechEventListenerEnabled=function(e,t,n){var i=this.ee.getListeners(e);t&&(i=i.filter((function(e){return e.once})));var r=i.length;if(r>0)return!0;var o=0;if(n){var s=n.ee.getListeners(e);t&&(s=s.filter((function(e){return e.once}))),o=s.length}return o>0},t.prototype.getTokenParams=function(e){var t=e.match(/^(wss?)\:\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7]},i=e.split("?"),r=decodeURI(i[1]).split("&").map((function(e){return e.split("=")})).reduce((function(e,t){var n=t[0],i=t[1];return e[n]=i,e}),{});return{sessionId:r["sessionId"],secret:r["secret"],recorder:r["recorder"],stt:r["stt"],webrtcStatsInterval:r["webrtcStatsInterval"],sendBrowserLogs:r["sendBrowserLogs"],edition:r["edition"],wsUri:n.protocol+"://"+n.host+"/openvidu",httpUri:"https://"+n.host}}throw new Error('Token not valid: "'.concat(e,'"'))},t.prototype.connectAux=function(e){var t=this;return new Promise((function(n,i){t.openvidu.startWs((function(r){if(r)return i(r);var o=t.initializeParams(e);t.openvidu.sendRequest("joinRoom",o,(function(r,o){if(r)return i(r);t.processJoinRoomResponse(o,e),t.connection=new a.Connection(t,o);var s={connections:new Array,streams:new Array},c=o.value;return c.forEach((function(e){var n=new a.Connection(t,e);t.remoteConnections.set(n.connectionId,n),s.connections.push(n),n.stream&&(t.remoteStreamsCreated.set(n.stream.streamId,!0),s.streams.push(n.stream))})),t.ee.emitEvent("connectionCreated",[new d.ConnectionEvent(!1,t,"connectionCreated",t.connection,"")]),s.connections.forEach((function(e){t.ee.emitEvent("connectionCreated",[new d.ConnectionEvent(!1,t,"connectionCreated",e,"")])})),s.streams.forEach((function(e){t.ee.emitEvent("streamCreated",[new g.StreamEvent(!1,t,"streamCreated",e,"")])})),o.recordingId&&o.recordingName&&t.ee.emitEvent("recordingStarted",[new p.RecordingEvent(t,"recordingStarted",o.recordingId,o.recordingName)]),n()}))}))}))},t.prototype.stopPublisherStream=function(e){this.connection.stream&&(this.connection.stream.disposeWebRtcPeer(),this.connection.stream.isLocalStreamPublished&&this.connection.stream.ee.emitEvent("local-stream-destroyed",[e]))},t.prototype.stopVideoDataIntervals=function(){clearInterval(this.videoDataInterval),clearTimeout(this.videoDataTimeout)},t.prototype.stringClientMetadata=function(e){return"string"!==typeof e?JSON.stringify(e):e},t.prototype.getConnection=function(e,t){var n=this;return new Promise((function(i,r){var o=n.remoteConnections.get(e);return o?i(o):n.connection.connectionId===e?i(n.connection):r(new S.OpenViduError(S.OpenViduErrorName.GENERIC_ERROR,t))}))},t.prototype.getRemoteConnection=function(e,t){var n=this;return new Promise((function(i,r){var o=n.remoteConnections.get(e);if(o)return i(o);var s="Remote connection "+e+" unknown when '"+t+"'. Existing remote connections: "+JSON.stringify(n.remoteConnections.keys());return r(new S.OpenViduError(S.OpenViduErrorName.GENERIC_ERROR,s))}))},t.prototype.processToken=function(e){var t=this.getTokenParams(e);this.sessionId=t.sessionId,t.secret&&(this.openvidu.secret=t.secret),t.recorder&&(this.openvidu.recorder=!0),t.stt&&(this.openvidu.stt=!0),t.webrtcStatsInterval&&(this.openvidu.webrtcStatsInterval=t.webrtcStatsInterval),t.sendBrowserLogs&&(this.openvidu.sendBrowserLogs=t.sendBrowserLogs),this.openvidu.isAtLeastPro="pro"===t.edition||"enterprise"===t.edition,this.openvidu.isEnterprise="enterprise"===t.edition,this.openvidu.wsUri=t.wsUri,this.openvidu.httpUri=t.httpUri},t.prototype.processJoinRoomResponse=function(e,t){if(this.sessionId=e.session,null!=e.customIceServers&&e.customIceServers.length>0){this.openvidu.iceServers=[];for(var n=0,i=e.customIceServers;n<i.length;n++){var r=i[n],o={urls:[r.url]};T.log("STUN/TURN server IP: "+r.url),null!=r.username&&null!=r.credential&&(o.username=r.username,o.credential=r.credential,T.log("TURN credentials ["+r.username+":"+r.credential+"]")),this.openvidu.iceServers.push(o)}}this.openvidu.role=e.role,this.openvidu.finalUserId=e.finalUserId,this.openvidu.mediaServer=e.mediaServer,this.openvidu.videoSimulcast=e.videoSimulcast,this.capabilities={subscribe:!0,publish:"SUBSCRIBER"!==this.openvidu.role,forceUnpublish:"MODERATOR"===this.openvidu.role,forceDisconnect:"MODERATOR"===this.openvidu.role},T.info("openvidu-server version: "+e.version),null!=e.life&&(this.openvidu.life=e.life);var s=R(e.version)-R(this.openvidu.libraryVersion);x(e.version)!==x(this.openvidu.libraryVersion)||0!=s&&1!=s?T.error("openvidu-browser (".concat(this.openvidu.libraryVersion,") and openvidu-server (").concat(e.version,") versions are incompatible. ")+"Errors are likely to occur. openvidu-browser SDK is only compatible with the same version or the immediately following minor version of an OpenVidu deployment"):1==s&&T.warn("openvidu-browser version ".concat(this.openvidu.libraryVersion," does not match openvidu-server version ").concat(e.version,". ")+"These versions are still compatible with each other, but openvidu-browser version must be updated as soon as possible to ".concat(x(e.version),".").concat(R(e.version),".x. ")+"This client using openvidu-browser ".concat(this.openvidu.libraryVersion," will become incompatible with the next release of openvidu-server")),C.OpenViduLogger.configureJSNLog(this.openvidu,t),this.token=t},t}(u.EventDispatcher);t.Session=P},"2b3d":function(e,t,n){"use strict";n("3ca3");var i,r=n("23e7"),o=n("83ab"),s=n("0d3b"),a=n("da84"),c=n("37e8"),l=n("6eeb"),u=n("19aa"),d=n("5135"),h=n("60da"),p=n("4df4"),f=n("6547").codeAt,m=n("5fb2"),v=n("d44e"),g=n("9861"),E=n("69f3"),b=a.URL,y=g.URLSearchParams,S=g.getState,w=E.set,C=E.getterFor("URL"),O=Math.floor,x=Math.pow,R="Invalid authority",I="Invalid scheme",T="Invalid host",P="Invalid port",k=/[A-Za-z]/,_=/[\d+-.A-Za-z]/,L=/\d/,A=/^(0x|0X)/,N=/^[0-7]+$/,M=/^\d+$/,D=/^[\dA-Fa-f]+$/,V=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,B=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,j=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,F=/[\u0009\u000A\u000D]/g,U=function(e,t){var n,i,r;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return T;if(n=H(t.slice(1,-1)),!n)return T;e.host=n}else if(Q(e)){if(t=m(t),V.test(t))return T;if(n=z(t),null===n)return T;e.host=n}else{if(B.test(t))return T;for(n="",i=p(t),r=0;r<i.length;r++)n+=Y(i[r],X);e.host=n}},z=function(e){var t,n,i,r,o,s,a,c=e.split(".");if(c.length&&""==c[c.length-1]&&c.pop(),t=c.length,t>4)return e;for(n=[],i=0;i<t;i++){if(r=c[i],""==r)return e;if(o=10,r.length>1&&"0"==r.charAt(0)&&(o=A.test(r)?16:8,r=r.slice(8==o?1:2)),""===r)s=0;else{if(!(10==o?M:8==o?N:D).test(r))return e;s=parseInt(r,o)}n.push(s)}for(i=0;i<t;i++)if(s=n[i],i==t-1){if(s>=x(256,5-t))return null}else if(s>255)return null;for(a=n.pop(),i=0;i<n.length;i++)a+=n[i]*x(256,3-i);return a},H=function(e){var t,n,i,r,o,s,a,c=[0,0,0,0,0,0,0,0],l=0,u=null,d=0,h=function(){return e.charAt(d)};if(":"==h()){if(":"!=e.charAt(1))return;d+=2,l++,u=l}while(h()){if(8==l)return;if(":"!=h()){t=n=0;while(n<4&&D.test(h()))t=16*t+parseInt(h(),16),d++,n++;if("."==h()){if(0==n)return;if(d-=n,l>6)return;i=0;while(h()){if(r=null,i>0){if(!("."==h()&&i<4))return;d++}if(!L.test(h()))return;while(L.test(h())){if(o=parseInt(h(),10),null===r)r=o;else{if(0==r)return;r=10*r+o}if(r>255)return;d++}c[l]=256*c[l]+r,i++,2!=i&&4!=i||l++}if(4!=i)return;break}if(":"==h()){if(d++,!h())return}else if(h())return;c[l++]=t}else{if(null!==u)return;d++,l++,u=l}}if(null!==u){s=l-u,l=7;while(0!=l&&s>0)a=c[l],c[l--]=c[u+s-1],c[u+--s]=a}else if(8!=l)return;return c},W=function(e){for(var t=null,n=1,i=null,r=0,o=0;o<8;o++)0!==e[o]?(r>n&&(t=i,n=r),i=null,r=0):(null===i&&(i=o),++r);return r>n&&(t=i,n=r),t},G=function(e){var t,n,i,r;if("number"==typeof e){for(t=[],n=0;n<4;n++)t.unshift(e%256),e=O(e/256);return t.join(".")}if("object"==typeof e){for(t="",i=W(e),n=0;n<8;n++)r&&0===e[n]||(r&&(r=!1),i===n?(t+=n?":":"::",r=!0):(t+=e[n].toString(16),n<7&&(t+=":")));return"["+t+"]"}return e},X={},q=h({},X,{" ":1,'"':1,"<":1,">":1,"`":1}),J=h({},q,{"#":1,"?":1,"{":1,"}":1}),$=h({},J,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Y=function(e,t){var n=f(e,0);return n>32&&n<127&&!d(t,e)?e:encodeURIComponent(e)},K={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Q=function(e){return d(K,e.scheme)},Z=function(e){return""!=e.username||""!=e.password},ee=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},te=function(e,t){var n;return 2==e.length&&k.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)},ne=function(e){var t;return e.length>1&&te(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},ie=function(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&te(t[0],!0)||t.pop()},re=function(e){return"."===e||"%2e"===e.toLowerCase()},oe=function(e){return e=e.toLowerCase(),".."===e||"%2e."===e||".%2e"===e||"%2e%2e"===e},se={},ae={},ce={},le={},ue={},de={},he={},pe={},fe={},me={},ve={},ge={},Ee={},be={},ye={},Se={},we={},Ce={},Oe={},xe={},Re={},Ie=function(e,t,n,r){var o,s,a,c,l=n||se,u=0,h="",f=!1,m=!1,v=!1;n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(j,"")),t=t.replace(F,""),o=p(t);while(u<=o.length){switch(s=o[u],l){case se:if(!s||!k.test(s)){if(n)return I;l=ce;continue}h+=s.toLowerCase(),l=ae;break;case ae:if(s&&(_.test(s)||"+"==s||"-"==s||"."==s))h+=s.toLowerCase();else{if(":"!=s){if(n)return I;h="",l=ce,u=0;continue}if(n&&(Q(e)!=d(K,h)||"file"==h&&(Z(e)||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=h,n)return void(Q(e)&&K[e.scheme]==e.port&&(e.port=null));h="","file"==e.scheme?l=be:Q(e)&&r&&r.scheme==e.scheme?l=le:Q(e)?l=pe:"/"==o[u+1]?(l=ue,u++):(e.cannotBeABaseURL=!0,e.path.push(""),l=Oe)}break;case ce:if(!r||r.cannotBeABaseURL&&"#"!=s)return I;if(r.cannotBeABaseURL&&"#"==s){e.scheme=r.scheme,e.path=r.path.slice(),e.query=r.query,e.fragment="",e.cannotBeABaseURL=!0,l=Re;break}l="file"==r.scheme?be:de;continue;case le:if("/"!=s||"/"!=o[u+1]){l=de;continue}l=fe,u++;break;case ue:if("/"==s){l=me;break}l=Ce;continue;case de:if(e.scheme=r.scheme,s==i)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query;else if("/"==s||"\\"==s&&Q(e))l=he;else if("?"==s)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query="",l=xe;else{if("#"!=s){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.path.pop(),l=Ce;continue}e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query,e.fragment="",l=Re}break;case he:if(!Q(e)||"/"!=s&&"\\"!=s){if("/"!=s){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,l=Ce;continue}l=me}else l=fe;break;case pe:if(l=fe,"/"!=s||"/"!=h.charAt(u+1))continue;u++;break;case fe:if("/"!=s&&"\\"!=s){l=me;continue}break;case me:if("@"==s){f&&(h="%40"+h),f=!0,a=p(h);for(var g=0;g<a.length;g++){var E=a[g];if(":"!=E||v){var b=Y(E,$);v?e.password+=b:e.username+=b}else v=!0}h=""}else if(s==i||"/"==s||"?"==s||"#"==s||"\\"==s&&Q(e)){if(f&&""==h)return R;u-=p(h).length+1,h="",l=ve}else h+=s;break;case ve:case ge:if(n&&"file"==e.scheme){l=Se;continue}if(":"!=s||m){if(s==i||"/"==s||"?"==s||"#"==s||"\\"==s&&Q(e)){if(Q(e)&&""==h)return T;if(n&&""==h&&(Z(e)||null!==e.port))return;if(c=U(e,h),c)return c;if(h="",l=we,n)return;continue}"["==s?m=!0:"]"==s&&(m=!1),h+=s}else{if(""==h)return T;if(c=U(e,h),c)return c;if(h="",l=Ee,n==ge)return}break;case Ee:if(!L.test(s)){if(s==i||"/"==s||"?"==s||"#"==s||"\\"==s&&Q(e)||n){if(""!=h){var y=parseInt(h,10);if(y>65535)return P;e.port=Q(e)&&y===K[e.scheme]?null:y,h=""}if(n)return;l=we;continue}return P}h+=s;break;case be:if(e.scheme="file","/"==s||"\\"==s)l=ye;else{if(!r||"file"!=r.scheme){l=Ce;continue}if(s==i)e.host=r.host,e.path=r.path.slice(),e.query=r.query;else if("?"==s)e.host=r.host,e.path=r.path.slice(),e.query="",l=xe;else{if("#"!=s){ne(o.slice(u).join(""))||(e.host=r.host,e.path=r.path.slice(),ie(e)),l=Ce;continue}e.host=r.host,e.path=r.path.slice(),e.query=r.query,e.fragment="",l=Re}}break;case ye:if("/"==s||"\\"==s){l=Se;break}r&&"file"==r.scheme&&!ne(o.slice(u).join(""))&&(te(r.path[0],!0)?e.path.push(r.path[0]):e.host=r.host),l=Ce;continue;case Se:if(s==i||"/"==s||"\\"==s||"?"==s||"#"==s){if(!n&&te(h))l=Ce;else if(""==h){if(e.host="",n)return;l=we}else{if(c=U(e,h),c)return c;if("localhost"==e.host&&(e.host=""),n)return;h="",l=we}continue}h+=s;break;case we:if(Q(e)){if(l=Ce,"/"!=s&&"\\"!=s)continue}else if(n||"?"!=s)if(n||"#"!=s){if(s!=i&&(l=Ce,"/"!=s))continue}else e.fragment="",l=Re;else e.query="",l=xe;break;case Ce:if(s==i||"/"==s||"\\"==s&&Q(e)||!n&&("?"==s||"#"==s)){if(oe(h)?(ie(e),"/"==s||"\\"==s&&Q(e)||e.path.push("")):re(h)?"/"==s||"\\"==s&&Q(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&te(h)&&(e.host&&(e.host=""),h=h.charAt(0)+":"),e.path.push(h)),h="","file"==e.scheme&&(s==i||"?"==s||"#"==s))while(e.path.length>1&&""===e.path[0])e.path.shift();"?"==s?(e.query="",l=xe):"#"==s&&(e.fragment="",l=Re)}else h+=Y(s,J);break;case Oe:"?"==s?(e.query="",l=xe):"#"==s?(e.fragment="",l=Re):s!=i&&(e.path[0]+=Y(s,X));break;case xe:n||"#"!=s?s!=i&&("'"==s&&Q(e)?e.query+="%27":e.query+="#"==s?"%23":Y(s,X)):(e.fragment="",l=Re);break;case Re:s!=i&&(e.fragment+=Y(s,q));break}u++}},Te=function(e){var t,n,i=u(this,Te,"URL"),r=arguments.length>1?arguments[1]:void 0,s=String(e),a=w(i,{type:"URL"});if(void 0!==r)if(r instanceof Te)t=C(r);else if(n=Ie(t={},String(r)),n)throw TypeError(n);if(n=Ie(a,s,null,t),n)throw TypeError(n);var c=a.searchParams=new y,l=S(c);l.updateSearchParams(a.query),l.updateURL=function(){a.query=String(c)||null},o||(i.href=ke.call(i),i.origin=_e.call(i),i.protocol=Le.call(i),i.username=Ae.call(i),i.password=Ne.call(i),i.host=Me.call(i),i.hostname=De.call(i),i.port=Ve.call(i),i.pathname=Be.call(i),i.search=je.call(i),i.searchParams=Fe.call(i),i.hash=Ue.call(i))},Pe=Te.prototype,ke=function(){var e=C(this),t=e.scheme,n=e.username,i=e.password,r=e.host,o=e.port,s=e.path,a=e.query,c=e.fragment,l=t+":";return null!==r?(l+="//",Z(e)&&(l+=n+(i?":"+i:"")+"@"),l+=G(r),null!==o&&(l+=":"+o)):"file"==t&&(l+="//"),l+=e.cannotBeABaseURL?s[0]:s.length?"/"+s.join("/"):"",null!==a&&(l+="?"+a),null!==c&&(l+="#"+c),l},_e=function(){var e=C(this),t=e.scheme,n=e.port;if("blob"==t)try{return new URL(t.path[0]).origin}catch(i){return"null"}return"file"!=t&&Q(e)?t+"://"+G(e.host)+(null!==n?":"+n:""):"null"},Le=function(){return C(this).scheme+":"},Ae=function(){return C(this).username},Ne=function(){return C(this).password},Me=function(){var e=C(this),t=e.host,n=e.port;return null===t?"":null===n?G(t):G(t)+":"+n},De=function(){var e=C(this).host;return null===e?"":G(e)},Ve=function(){var e=C(this).port;return null===e?"":String(e)},Be=function(){var e=C(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},je=function(){var e=C(this).query;return e?"?"+e:""},Fe=function(){return C(this).searchParams},Ue=function(){var e=C(this).fragment;return e?"#"+e:""},ze=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(o&&c(Pe,{href:ze(ke,(function(e){var t=C(this),n=String(e),i=Ie(t,n);if(i)throw TypeError(i);S(t.searchParams).updateSearchParams(t.query)})),origin:ze(_e),protocol:ze(Le,(function(e){var t=C(this);Ie(t,String(e)+":",se)})),username:ze(Ae,(function(e){var t=C(this),n=p(String(e));if(!ee(t)){t.username="";for(var i=0;i<n.length;i++)t.username+=Y(n[i],$)}})),password:ze(Ne,(function(e){var t=C(this),n=p(String(e));if(!ee(t)){t.password="";for(var i=0;i<n.length;i++)t.password+=Y(n[i],$)}})),host:ze(Me,(function(e){var t=C(this);t.cannotBeABaseURL||Ie(t,String(e),ve)})),hostname:ze(De,(function(e){var t=C(this);t.cannotBeABaseURL||Ie(t,String(e),ge)})),port:ze(Ve,(function(e){var t=C(this);ee(t)||(e=String(e),""==e?t.port=null:Ie(t,e,Ee))})),pathname:ze(Be,(function(e){var t=C(this);t.cannotBeABaseURL||(t.path=[],Ie(t,e+"",we))})),search:ze(je,(function(e){var t=C(this);e=String(e),""==e?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",Ie(t,e,xe)),S(t.searchParams).updateSearchParams(t.query)})),searchParams:ze(Fe),hash:ze(Ue,(function(e){var t=C(this);e=String(e),""!=e?("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",Ie(t,e,Re)):t.fragment=null}))}),l(Pe,"toJSON",(function(){return ke.call(this)}),{enumerable:!0}),l(Pe,"toString",(function(){return ke.call(this)}),{enumerable:!0}),b){var He=b.createObjectURL,We=b.revokeObjectURL;He&&l(Te,"createObjectURL",(function(e){return He.apply(b,arguments)})),We&&l(Te,"revokeObjectURL",(function(e){return We.apply(b,arguments)}))}v(Te,"URL"),r({global:!0,forced:!s,sham:!o},{URL:Te})},3029:function(e,t,n){var i,r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();function o(e){if(!e)return o.__;Array.prototype.reduce||(Array.prototype.reduce=function(e,t){for(var n=t,i=0;i<this.length;i++)n=e(n,this[i],i,this);return n});var t="",n=("."+e).split(".").reduce((function(e,n,i,r){t?t+="."+n:t=n;var s=e["__"+t];return void 0===s&&(o.Logger.prototype=e,s=new o.Logger(t),e["__"+t]=s),s}),o.__);return n}(function(e){function t(e,t,n){void 0!==t[e]&&(null!==t[e]?n[e]=t[e]:delete n[e])}function n(t){if(null!=e.enabled&&!e.enabled)return!1;try{if(t.userAgentRegex&&!new RegExp(t.userAgentRegex).test(navigator.userAgent))return!1}catch(n){}try{if(t.ipRegex&&e.clientIP&&!new RegExp(t.ipRegex).test(e.clientIP))return!1}catch(n){}return!0}function i(e,t){try{if(e.disallow&&new RegExp(e.disallow).test(t))return!1}catch(n){}return!0}function o(e){return"function"==typeof e?e instanceof RegExp?e.toString():e():e}e.requestId="",e.entryId=0,e._createXMLHttpRequest=function(){return new XMLHttpRequest},e._getTime=function(){return(new Date).getTime()},e._console=console,e._appenderNames=[];var s=function(){function e(e,t,n){this.msg=e,this.meta=t,this.finalString=n}return e}();function a(t){var n,i=o(t);switch(typeof i){case"string":return new s(i,null,i);case"number":return n=i.toString(),new s(n,null,n);case"boolean":return n=i.toString(),new s(n,null,n);case"undefined":return new s("undefined",null,"undefined");case"object":return i instanceof RegExp||i instanceof String||i instanceof Number||i instanceof Boolean?(n=i.toString(),new s(n,null,n)):(n="function"===typeof e.serialize?e.serialize.call(this,i):JSON.stringify(i),new s("",i,n));default:return new s("unknown",null,"unknown")}}function c(e){return t("enabled",e,this),t("maxMessages",e,this),t("defaultAjaxUrl",e,this),t("clientIP",e,this),t("requestId",e,this),t("defaultBeforeSend",e,this),t("serialize",e,this),this}function l(){return-2147483648}function u(){return 1e3}function d(){return 2e3}function h(){return 3e3}function p(){return 4e3}function f(){return 5e3}function m(){return 6e3}function v(){return 2147483647}function g(e){return e<=1e3?"trace":e<=2e3?"debug":e<=3e3?"info":e<=4e3?"warn":e<=5e3?"error":"fatal"}e.setOptions=c,e.getAllLevel=l,e.getTraceLevel=u,e.getDebugLevel=d,e.getInfoLevel=h,e.getWarnLevel=p,e.getErrorLevel=f,e.getFatalLevel=m,e.getOffLevel=v;var E=function(){function e(e,t){this.inner=t,this.name="JL.Exception",this.message=a(e).finalString}return e}();e.Exception=E,E.prototype=new Error;var b=function(){function e(e,t,n,i,r){this.l=e,this.m=t,this.n=n,this.t=i,this.u=r}return e}();function y(t,n,i){return e.entryId++,new b(t,n,i,e._getTime(),e.entryId)}function S(e){e.id&&(clearTimeout(e.id),e.id=null)}function w(e,t,n){var i=this;e.id||(e.id=setTimeout((function(){n.call(i)}),t))}e.LogItem=b;var C=function(){function r(t,n){this.appenderName=t,this.sendLogItems=n,this.level=e.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.maxBatchSize=20,this.batchTimeout=2147483647,this.sendTimeout=5e3,this.buffer=[],this.batchBuffer=[],this.batchTimeoutTimer={id:null},this.sendTimeoutTimer={id:null},this.nbrLogItemsSkipped=0,this.nbrLogItemsBeingSent=0;var i="Trying to create an appender without a name or with an empty name";if(void 0==t)throw i;if(-1!=e._appenderNames.indexOf(t)){if(!t)throw i;throw"Multiple appenders use the same name "+t}e._appenderNames.push(t)}return r.prototype.addLogItemsToBuffer=function(t){if(this.batchBuffer.length>=this.maxBatchSize)this.nbrLogItemsSkipped+=t.length;else{if(null!=e.maxMessages){if(e.maxMessages<1)return;e.maxMessages-=t.length}this.batchBuffer=this.batchBuffer.concat(t);var n=this;w(this.batchTimeoutTimer,this.batchTimeout,(function(){n.sendBatch.call(n)}))}},r.prototype.batchBufferHasOverdueMessages=function(){for(var t=0;t<this.batchBuffer.length;t++){var n=e._getTime()-this.batchBuffer[t].t;if(n>this.batchTimeout)return!0}return!1},r.prototype.batchBufferHasStrandedMessage=function(){return!(null==e.maxMessages)&&e.maxMessages<1&&this.batchBuffer.length>0},r.prototype.sendBatchIfComplete=function(){(this.batchBuffer.length>=this.batchSize||this.batchBufferHasOverdueMessages()||this.batchBufferHasStrandedMessage())&&this.sendBatch()},r.prototype.onSendingEnded=function(){S(this.sendTimeoutTimer),this.nbrLogItemsBeingSent=0,this.sendBatchIfComplete()},r.prototype.setOptions=function(n){if(t("level",n,this),t("ipRegex",n,this),t("userAgentRegex",n,this),t("disallow",n,this),t("sendWithBufferLevel",n,this),t("storeInBufferLevel",n,this),t("bufferSize",n,this),t("batchSize",n,this),t("maxBatchSize",n,this),t("batchTimeout",n,this),t("sendTimeout",n,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this.maxBatchSize<this.batchSize)throw new e.Exception({message:"maxBatchSize cannot be smaller than batchSize",maxBatchSize:this.maxBatchSize,batchSize:this.batchSize});return this},r.prototype.log=function(e,t,r,o,s,a,c){var l;n(this)&&i(this,a)&&(s<this.storeInBufferLevel||(l=y(s,a,c),s<this.level?this.bufferSize>0&&(this.buffer.push(l),this.buffer.length>this.bufferSize&&this.buffer.shift()):(this.addLogItemsToBuffer([l]),s>=this.sendWithBufferLevel&&this.buffer.length&&(this.addLogItemsToBuffer(this.buffer),this.buffer.length=0),this.sendBatchIfComplete())))},r.prototype.sendBatch=function(){if(!(this.nbrLogItemsBeingSent>0)&&(S(this.batchTimeoutTimer),0!=this.batchBuffer.length)){this.nbrLogItemsBeingSent=this.batchBuffer.length;var e=this;w(this.sendTimeoutTimer,this.sendTimeout,(function(){e.onSendingEnded.call(e)})),this.sendLogItems(this.batchBuffer,(function(){e.batchBuffer.splice(0,e.nbrLogItemsBeingSent),e.nbrLogItemsSkipped>0&&(e.batchBuffer.push(y(p(),"Lost "+e.nbrLogItemsSkipped+" messages. Either connection with the server was down or logging was disabled via the enabled option. Reduce lost messages by increasing the ajaxAppender option maxBatchSize.",e.appenderName)),e.nbrLogItemsSkipped=0),e.onSendingEnded.call(e)}))}},r}();e.Appender=C;var O=function(i){function o(e){return i.call(this,e,o.prototype.sendLogItemsAjax)||this}return r(o,i),o.prototype.setOptions=function(e){return t("url",e,this),t("beforeSend",e,this),i.prototype.setOptions.call(this,e),this},o.prototype.sendLogItemsAjax=function(t,i){try{if(!n(this))return;this.xhr&&0!=this.xhr.readyState&&4!=this.xhr.readyState&&this.xhr.abort(),this.xhr=e._createXMLHttpRequest();var r="/jsnlog.logger";null!=e.defaultAjaxUrl&&(r=e.defaultAjaxUrl),this.url&&(r=this.url),this.xhr.open("POST",r),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("JSNLog-RequestId",e.requestId);var o=this;this.xhr.onreadystatechange=function(){4==o.xhr.readyState&&o.xhr.status>=200&&o.xhr.status<300&&i()};var s={r:e.requestId,lg:t};"function"===typeof this.beforeSend?this.beforeSend.call(this,this.xhr,s):"function"===typeof e.defaultBeforeSend&&e.defaultBeforeSend.call(this,this.xhr,s);var a=JSON.stringify(s);this.xhr.send(a)}catch(c){}},o}(C);e.AjaxAppender=O;var x=function(t){function i(e){return t.call(this,e,i.prototype.sendLogItemsConsole)||this}return r(i,t),i.prototype.clog=function(t){e._console.log(t)},i.prototype.cerror=function(t){e._console.error?e._console.error(t):this.clog(t)},i.prototype.cwarn=function(t){e._console.warn?e._console.warn(t):this.clog(t)},i.prototype.cinfo=function(t){e._console.info?e._console.info(t):this.clog(t)},i.prototype.cdebug=function(t){e._console.debug?e._console.debug(t):this.cinfo(t)},i.prototype.sendLogItemsConsole=function(t,i){try{if(!n(this))return;if(!e._console)return;var r;for(r=0;r<t.length;++r){var o=t[r],s=o.n+": "+o.m;"undefined"===typeof window&&(s=new Date(o.t)+" | "+s),o.l<=e.getDebugLevel()?this.cdebug(s):o.l<=e.getInfoLevel()?this.cinfo(s):o.l<=e.getWarnLevel()?this.cwarn(s):this.cerror(s)}}catch(a){}i()},i}(C);e.ConsoleAppender=x;var R,I=function(){function e(e){this.loggerName=e,this.seenRegexes=[]}return e.prototype.setOptions=function(e){return t("level",e,this),t("userAgentRegex",e,this),t("disallow",e,this),t("ipRegex",e,this),t("appenders",e,this),t("onceOnly",e,this),this.seenRegexes=[],this},e.prototype.buildExceptionObject=function(e){var t={};return e.stack?t.stack=e.stack:t.e=e,e.message&&(t.message=e.message),e.name&&(t.name=e.name),e.data&&(t.data=e.data),e.inner&&(t.inner=this.buildExceptionObject(e.inner)),t},e.prototype.log=function(e,t,r){var s,c,l=0;if(!this.appenders)return this;if(e>=this.level&&n(this)&&(r?(c=this.buildExceptionObject(r),c.logData=o(t)):c=t,s=a(c),i(this,s.finalString))){if(this.onceOnly){l=this.onceOnly.length-1;while(l>=0){if(new RegExp(this.onceOnly[l]).test(s.finalString)){if(this.seenRegexes[l])return this;this.seenRegexes[l]=!0}l--}}s.meta=s.meta||{},l=this.appenders.length-1;while(l>=0)this.appenders[l].log(g(e),s.msg,s.meta,(function(){}),e,s.finalString,this.loggerName),l--}return this},e.prototype.trace=function(e){return this.log(u(),e)},e.prototype.debug=function(e){return this.log(d(),e)},e.prototype.info=function(e){return this.log(h(),e)},e.prototype.warn=function(e){return this.log(p(),e)},e.prototype.error=function(e){return this.log(f(),e)},e.prototype.fatal=function(e){return this.log(m(),e)},e.prototype.fatalException=function(e,t){return this.log(m(),e,t)},e}();function T(e){return new O(e)}function P(e){return new x(e)}e.Logger=I,e.createAjaxAppender=T,e.createConsoleAppender=P,R="undefined"!==typeof window?new O(""):new x(""),e.__=new e.Logger(""),e.__.setOptions({level:e.getDebugLevel(),appenders:[R]})})(o||(o={})),t.__esModule=!0,t.JL=o,"function"==typeof i&&i.amd&&i("jsnlog",[],(function(){return o})),"function"==typeof __jsnlog_configure&&__jsnlog_configure(o),"undefined"===typeof window||window.onerror||(window.onerror=function(e,t,n,i,r){return o("onerrorLogger").fatalException({msg:"Uncaught Exception",errorMsg:e?e.message||e:"",url:t,"line number":n,column:i},r),!1}),"undefined"===typeof window||window.onunhandledrejection||(window.onunhandledrejection=function(e){o("onerrorLogger").fatalException({msg:"unhandledrejection",errorMsg:e.reason?e.reason.message:e.message||null},e.reason)})},"3c13":function(e,t,n){const i=n("9923"),r=(e,t)=>new i(e,t).minor;e.exports=r},"3c4c":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,a[0]&&(s=0)),s)try{if(n=1,i&&(r=2&a[0]?i["return"]:a[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(c){a=[6,c],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Publisher=void 0;var s,a=n("2533"),c=n("0cf2"),l=n("3f7b"),u=n("4def"),d=n("0703"),h=n("4edf"),p=n("f66e"),f=n("e237"),m=n("b793"),v=p.OpenViduLogger.getInstance(),g=function(e){function t(t,n,i){var r=e.call(this,new c.Stream(i.session?i.session:new a.Session(i),{publisherProperties:n,mediaConstraints:{}}),t)||this;return r.accessAllowed=!1,r.isSubscribedToRemote=!1,r.accessDenied=!1,s=f.PlatformUtils.getInstance(),r.properties=n,r.openvidu=i,r.stream.ee.on("local-stream-destroyed",(function(e){r.stream.isLocalStreamPublished=!1;var t=new u.StreamEvent(!0,r,"streamDestroyed",r.stream,e);r.emitEvent("streamDestroyed",[t]),t.callDefaultBehavior()})),r}return i(t,e),t.prototype.publishAudio=function(e){var t=this;if(this.stream.audioActive!==e){var n=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream();n.getAudioTracks().forEach((function(t){t.enabled=e})),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"audioActive",newValue:e,reason:"publishAudio"},(function(n,i){n?v.error("Error sending 'streamPropertyChanged' event",n):(t.session.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(t.session,t.stream,"audioActive",e,!e,"publishAudio")]),t.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(t,t.stream,"audioActive",e,!e,"publishAudio")]),t.session.sendVideoData(t.stream.streamManager))})),this.stream.audioActive=e,v.info("'Publisher' has "+(e?"published":"unpublished")+" its audio stream")}},t.prototype.publishVideo=function(e,t){var n=this;return new Promise((function(i,s){return r(n,void 0,void 0,(function(){var n,a,c,l,u,h,p=this;return o(this,(function(f){switch(f.label){case 0:return this.stream.videoActive===e?[3,9]:(n=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream(),a=!1,n.getVideoTracks().forEach((function(n){n.enabled=e,e||!0!==t?e&&"ended"===n.readyState&&(a=!0):n.stop()})),!e&&!0===t&&this.stream.filter&&this.stream.filter.type.startsWith("VB:")?(this.stream.lastVBFilter=this.stream.filter,[4,this.stream.removeFilterAux(!0)]):[3,2]);case 1:f.sent(),f.label=2;case 2:return a?(c=n.getVideoTracks()[0],n.removeTrack(c),l=function(e){return r(p,void 0,void 0,(function(){var t=this;return o(this,(function(i){switch(i.label){case 0:return n.addTrack(e),this.stream.isLocalStreamPublished?[4,this.replaceTrackInRtcRtpSender(e)]:[3,2];case 1:i.sent(),i.label=2;case 2:return this.stream.lastVBFilter&&setTimeout((function(){return r(t,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return e=this.stream.lastVBFilter.options,t=this.stream.lastVBFilter.lastExecMethod,t&&"update"===t.method&&(e=Object.assign({},e,t.params)),[4,this.stream.applyFilter(this.stream.lastVBFilter.type,e)];case 1:return n.sent(),delete this.stream.lastVBFilter,[2]}}))}))}),1),[2]}}))}))},t&&t instanceof MediaStreamTrack?[4,l(t)]:[3,4]):[3,8];case 3:return f.sent(),[3,8];case 4:return f.trys.push([4,7,,8]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:this.stream.lastVideoTrackConstraints})];case 5:return u=f.sent(),[4,l(u.getVideoTracks()[0])];case 6:return f.sent(),[3,8];case 7:return h=f.sent(),[2,s(h)];case 8:return this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"videoActive",newValue:e,reason:"publishVideo"},(function(t,n){t?v.error("Error sending 'streamPropertyChanged' event",t):(p.session.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(p.session,p.stream,"videoActive",e,!e,"publishVideo")]),p.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(p,p.stream,"videoActive",e,!e,"publishVideo")]),p.session.sendVideoData(p.stream.streamManager))})),this.stream.videoActive=e,v.info("'Publisher' has "+(e?"published":"unpublished")+" its video stream"),[2,i()];case 9:return[2]}}))}))}))},t.prototype.subscribeToRemote=function(e){e=void 0===e||e,this.isSubscribedToRemote=e,this.stream.subscribeToMyRemote(e)},t.prototype.on=function(t,n){var i=this;return e.prototype.on.call(this,t,n),"streamCreated"===t&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new u.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.on("stream-created-by-publisher",(function(){i.emitEvent("streamCreated",[new u.StreamEvent(!1,i,"streamCreated",i.stream,"")])}))),"accessAllowed"===t&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),"accessDenied"===t&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},t.prototype.once=function(t,n){var i=this;return e.prototype.once.call(this,t,n),"streamCreated"===t&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new u.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.once("stream-created-by-publisher",(function(){i.emitEvent("streamCreated",[new u.StreamEvent(!1,i,"streamCreated",i.stream,"")])}))),"accessAllowed"===t&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),"accessDenied"===t&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},t.prototype.off=function(t,n){return e.prototype.off.call(this,t,n),this},t.prototype.replaceTrack=function(e){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.replaceTrackAux(e,!0)]}))}))},t.prototype.initialize=function(){var e=this;return new Promise((function(t,n){return r(e,void 0,void 0,(function(){var e,i,a,c,l,u,d,p,f,g,E,b,y,S,w,C,O=this;return o(this,(function(x){switch(x.label){case 0:e={},i={},a=2e3,l=function(e){return O.accessDenied=!0,O.accessAllowed=!1,v.error("Publisher initialization failed. ".concat(e.name,": ").concat(e.message)),n(e)},u=function(e){var n,i;if(O.accessAllowed=!0,O.accessDenied=!1,"undefined"!==typeof MediaStreamTrack&&O.properties.audioSource instanceof MediaStreamTrack&&(e.removeTrack(e.getAudioTracks()[0]),e.addTrack(O.properties.audioSource)),"undefined"!==typeof MediaStreamTrack&&O.properties.videoSource instanceof MediaStreamTrack&&(e.removeTrack(e.getVideoTracks()[0]),e.addTrack(O.properties.videoSource)),e.getAudioTracks()[0]){var r=void 0!==O.stream.audioActive&&null!==O.stream.audioActive?O.stream.audioActive:!!O.stream.outboundStreamOpts.publisherProperties.publishAudio;e.getAudioTracks()[0].enabled=r}if(e.getVideoTracks()[0]){r=void 0!==O.stream.videoActive&&null!==O.stream.videoActive?O.stream.videoActive:!!O.stream.outboundStreamOpts.publisherProperties.publishVideo;e.getVideoTracks()[0].enabled=r}for(var o=0,s=e.getAudioTracks();o<s.length;o++){var a=s[o];(null===(n=a.contentHint)||void 0===n?void 0:n.length)||(a.contentHint="",v.info("Audio track Content Hint set: '".concat(a.contentHint,"'")))}for(var c=0,l=e.getVideoTracks();c<l.length;c++){a=l[c];if(!(null===(i=a.contentHint)||void 0===i?void 0:i.length)){switch(O.stream.typeOfVideo){case m.TypeOfVideo.SCREEN:a.contentHint="detail";break;case m.TypeOfVideo.CUSTOM:v.warn("CUSTOM type video track was provided without Content Hint!"),a.contentHint="motion";break;case m.TypeOfVideo.CAMERA:case m.TypeOfVideo.IPCAM:default:a.contentHint="motion";break}v.info("Video track Content Hint set: '".concat(a.contentHint,"'"))}}return O.initializeVideoReference(e),O.stream.displayMyRemote()||O.stream.updateMediaStreamInVideos(),delete O.firstVideoElement,O.stream.isSendVideo()?O.getVideoDimensions().then((function(t){O.stream.videoDimensions={width:t.width,height:t.height},O.stream.isSendScreen()&&(O.screenShareResizeInterval=setInterval((function(){var t=e.getVideoTracks()[0].getSettings(),n=t.width,i=t.height,r=null!=n&&n!==O.stream.videoDimensions.width,o=null!=i&&i!==O.stream.videoDimensions.height;O.stream.isLocalStreamPublished&&(r||o)&&O.openvidu.sendVideoDimensionsChangedEvent(O,"screenResized",O.stream.videoDimensions.width,O.stream.videoDimensions.height,n||0,i||0)}),650)),O.stream.isLocalStreamReadyToPublish=!0,O.stream.ee.emitEvent("stream-ready-to-publish",[])})):(O.stream.isLocalStreamReadyToPublish=!0,O.stream.ee.emitEvent("stream-ready-to-publish",[])),t()},d=function(t,n){return r(O,void 0,void 0,(function(){var r,s;return o(this,(function(o){switch(o.label){case 0:if(this.clearPermissionDialogTimer(c,a),!this.stream.isSendScreen()||!this.stream.isSendAudio())return[3,5];i.audio=n,i.video=!1,c=Date.now(),this.setPermissionDialogTimer(a),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia(i)];case 2:return r=o.sent(),this.clearPermissionDialogTimer(c,a),t.addTrack(r.getAudioTracks()[0]),u(t),[3,4];case 3:return s=o.sent(),this.clearPermissionDialogTimer(c,a),t.getAudioTracks().forEach((function(e){e.stop()})),t.getVideoTracks().forEach((function(e){e.stop()})),l(this.openvidu.generateAudioDeviceError(s,e)),[2];case 4:return[3,6];case 5:u(t),o.label=6;case 6:return[2]}}))}))},p=function(t){return r(O,void 0,void 0,(function(){var n,i,r,s,u,d;return o(this,(function(o){switch(o.label){case 0:switch(v.error("getMediaError: ".concat(t.toString())),this.clearPermissionDialogTimer(c,a),"Error"===t.name&&(t.name=t.constructor.name),r=t.name.toLowerCase(),r){case"notfounderror":return[3,1];case"notallowederror":return[3,5];case"overconstrainederror":return[3,6];case"aborterror":return[3,10];case"notreadableerror":return[3,10]}return[3,11];case 1:return o.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:e.video})];case 2:return u=o.sent(),u.getVideoTracks().forEach((function(e){e.stop()})),n=h.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,i=t.toString(),l(new h.OpenViduError(n,i)),[3,4];case 3:return s=o.sent(),n=h.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,i=s.toString(),l(new h.OpenViduError(n,i)),[3,4];case 4:return[3,12];case 5:return n=this.stream.isSendScreen()?h.OpenViduErrorName.SCREEN_CAPTURE_DENIED:h.OpenViduErrorName.DEVICE_ACCESS_DENIED,i=t.toString(),l(new h.OpenViduError(n,i)),[3,12];case 6:return o.trys.push([6,8,,9]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:e.video})];case 7:return u=o.sent(),u.getVideoTracks().forEach((function(e){e.stop()})),"deviceid"===t.constraint.toLowerCase()?(n=h.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,i="Audio input device with deviceId '"+e.audio.deviceId.exact+"' not found"):(n=h.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,i="Audio input device doesn't support the value passed for constraint '"+t.constraint+"'"),l(new h.OpenViduError(n,i)),[3,9];case 8:return d=o.sent(),"deviceid"===d.constraint.toLowerCase()?(n=h.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,i="Video input device with deviceId '"+e.video.deviceId.exact+"' not found"):(n=h.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,i="Video input device doesn't support the value passed for constraint '"+d.constraint+"'"),l(new h.OpenViduError(n,i)),[3,9];case 9:return[3,12];case 10:return n=h.OpenViduErrorName.DEVICE_ALREADY_IN_USE,i=t.toString(),l(new h.OpenViduError(n,i)),[3,12];case 11:return n=h.OpenViduErrorName.GENERIC_ERROR,i=t.toString(),l(new h.OpenViduError(n,i)),[3,12];case 12:return[2]}}))}))},x.label=1;case 1:return x.trys.push([1,14,,15]),[4,this.openvidu.generateMediaConstraints(this.properties)];case 2:return f=x.sent(),f.videoTrack&&f.audioTrack||f.audioTrack&&!1===(null===(w=f.constraints)||void 0===w?void 0:w.video)||f.videoTrack&&!1===(null===(C=f.constraints)||void 0===C?void 0:C.audio)?(u(this.openvidu.addAlreadyProvidedTracks(f,new MediaStream,this.stream)),[3,13]):[3,3];case 3:e=f.constraints,g={mediaConstraints:e,publisherProperties:this.properties},this.stream.setOutboundStreamOptions(g),E=void 0===e.audio||e.audio,i.audio=!this.stream.isSendScreen()&&E,i.video=e.video,c=Date.now(),this.setPermissionDialogTimer(a),x.label=4;case 4:return x.trys.push([4,11,,13]),this.stream.isSendScreen()&&navigator.mediaDevices["getDisplayMedia"]&&!s.isElectron()?[4,navigator.mediaDevices["getDisplayMedia"]({video:!0})]:[3,7];case 5:return b=x.sent(),this.openvidu.addAlreadyProvidedTracks(f,b),[4,d(b,E)];case 6:return x.sent(),[3,10];case 7:return this.stream.lastVideoTrackConstraints=i.video,[4,navigator.mediaDevices.getUserMedia(i)];case 8:return b=x.sent(),this.openvidu.addAlreadyProvidedTracks(f,b,this.stream),[4,d(b,E)];case 9:x.sent(),x.label=10;case 10:return[3,13];case 11:return y=x.sent(),[4,p(y)];case 12:return x.sent(),[3,13];case 13:return[3,15];case 14:return S=x.sent(),l(S),[3,15];case 15:return[2]}}))}))}))},t.prototype.replaceTrackAux=function(e,t){return r(this,void 0,void 0,(function(){var n,i;return o(this,(function(r){switch(r.label){case 0:n=e.enabled,"video"===e.kind?e.enabled=this.stream.videoActive:"audio"===e.kind&&(e.enabled=this.stream.audioActive),r.label=1;case 1:return r.trys.push([1,5,,6]),this.stream.isLocalStreamPublished?(this.replaceTrackInMediaStream(e,t),[4,this.replaceTrackInRtcRtpSender(e)]):[3,3];case 2:return[2,r.sent()];case 3:return[2,this.replaceTrackInMediaStream(e,t)];case 4:return[3,6];case 5:throw i=r.sent(),e.enabled=n,i;case 6:return[2]}}))}))},t.prototype.getVideoDimensions=function(){var e=this;return new Promise((function(t,n){var i,r=s.isIonicIos()||s.isIOSWithSafari(),o=function(){var n,o;if("function"===typeof e.stream.getMediaStream().getVideoTracks()[0].getSettings){var a=e.stream.getMediaStream().getVideoTracks()[0].getSettings();n=a.width||e.videoReference.videoWidth,o=a.height||e.videoReference.videoHeight}else v.warn("MediaStreamTrack does not have getSettings method on "+s.getDescription()),n=e.videoReference.videoWidth,o=e.videoReference.videoHeight;return null!=i&&e.videoReference.removeEventListener("loadedmetadata",i),r&&document.body.removeChild(e.videoReference),t({width:n,height:o})};e.videoReference.readyState>=1?o():(i=function(){if(e.videoReference.videoWidth)o();else var t=setInterval((function(){e.videoReference.videoWidth&&(clearInterval(t),o())}),40)},e.videoReference.addEventListener("loadedmetadata",i),r&&document.body.appendChild(e.videoReference))}))},t.prototype.reestablishStreamPlayingEvent=function(){this.ee.getListeners("streamPlaying").length>0&&this.addPlayEventToFirstVideo()},t.prototype.initializeVideoReference=function(e){this.videoReference=document.createElement("video"),this.videoReference.style.display="none",this.videoReference.muted=!0,this.videoReference.autoplay=!0,this.videoReference.controls=!1,(s.isSafariBrowser()||s.isIPhoneOrIPad()&&(s.isChromeMobileBrowser()||s.isEdgeMobileBrowser()||s.isOperaMobileBrowser()||s.isFirefoxMobileBrowser()))&&(this.videoReference.playsInline=!0),this.stream.setMediaStream(e),this.firstVideoElement&&this.createVideoElement(this.firstVideoElement.targetElement,this.properties.insertMode),this.videoReference.srcObject=this.stream.getMediaStream()},t.prototype.replaceTrackInMediaStream=function(e,t){var n,i=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream();"video"===e.kind?(n=i.getVideoTracks()[0],t&&(this.stream.lastVideoTrackConstraints=e.getConstraints())):n=i.getAudioTracks()[0],n.enabled=!1,n.stop(),i.removeTrack(n),i.addTrack(e);var r={oldLabel:(null===n||void 0===n?void 0:n.label)||"",newLabel:(null===e||void 0===e?void 0:e.label)||""};"video"===e.kind&&t?(this.openvidu.sendNewVideoDimensionsIfRequired(this,"trackReplaced",50,30),this.openvidu.sendTrackChangedEvent(this,r.oldLabel,r.newLabel,"videoTrack"),this.stream.isLocalStreamPublished&&this.session.sendVideoData(this.stream.streamManager,5,!0,5)):"audio"===e.kind&&t&&this.openvidu.sendTrackChangedEvent(this,r.oldLabel,r.newLabel,"audioTrack"),"audio"===e.kind&&(this.stream.disableHarkSpeakingEvent(!1),this.stream.disableHarkStoppedSpeakingEvent(!1),this.stream.disableHarkVolumeChangeEvent(!1),this.stream.initHarkEvents())},t.prototype.setPermissionDialogTimer=function(e){var t=this;this.permissionDialogTimeout=setTimeout((function(){t.emitEvent("accessDialogOpened",[])}),e)},t.prototype.clearPermissionDialogTimer=function(e,t){clearTimeout(this.permissionDialogTimeout),Date.now()-e>t&&this.emitEvent("accessDialogClosed",[])},t.prototype.replaceTrackInRtcRtpSender=function(e){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(i){switch(i.label){case 0:if(t=this.stream.getRTCPeerConnection().getSenders(),"video"===e.kind){if(n=t.find((function(e){return!!e.track&&"video"===e.track.kind})),!n)throw new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object")}else{if("audio"!==e.kind)throw new Error("Unknown track kind "+e.kind);if(n=t.find((function(e){return!!e.track&&"audio"===e.track.kind})),!n)throw new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object")}return[4,n.replaceTrack(e)];case 1:return i.sent(),[2]}}))}))},t}(l.StreamManager);t.Publisher=g},"3cf7":function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,a[0]&&(s=0)),s)try{if(n=1,i&&(r=2&a[0]?i["return"]:a[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(c){a=[6,c],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenVidu=void 0;var o,s=n("b489"),a=n("3c4c"),c=n("2533"),l=n("92c2"),u=n("0703"),d=n("4edf"),h=n("fdd2"),p=n("f66e"),f=n("e237"),m=n("fb6e"),v=n("11c5"),g=n("49d9"),E=n("e0ef"),b=n("01e1"),y=n("bea1"),S=p.OpenViduLogger.getInstance(),w=function(){function e(){var e=this;this.masterNodeHasCrashed=!1,this.publishers=[],this.secret="",this.recorder=!1,this.stt=!1,this.life=-1,this.advancedConfiguration={},this.webrtcStatsInterval=-1,this.sendBrowserLogs=g.OpenViduLoggerConfiguration.disabled,this.isAtLeastPro=!1,this.isEnterprise=!1,this.ee=new E,o=f.PlatformUtils.getInstance(),this.libraryVersion=y.version,S.info("OpenVidu initialized"),S.info("Platform detected: "+o.getDescription()),S.info("openvidu-browser version: "+this.libraryVersion),(o.isMobileDevice()||o.isReactNative())&&this.onOrientationChanged((function(){e.publishers.forEach((function(t){t.stream.isLocalStreamPublished&&t.stream&&t.stream.hasVideo&&e.sendNewVideoDimensionsIfRequired(t,"deviceRotated",75,10)}))}))}return e.prototype.initSession=function(){return this.session=new c.Session(this),this.session},e.prototype.initPublisher=function(e,t,n){var i;t&&"function"!==typeof t?(i=t,i={audioSource:"undefined"!==typeof i.audioSource?i.audioSource:void 0,frameRate:"undefined"!==typeof MediaStreamTrack&&i.videoSource instanceof MediaStreamTrack?void 0:"undefined"!==typeof i.frameRate?i.frameRate:void 0,insertMode:"undefined"!==typeof i.insertMode?"string"===typeof i.insertMode?h.VideoInsertMode[i.insertMode]:i.insertMode:h.VideoInsertMode.APPEND,mirror:"undefined"===typeof i.mirror||i.mirror,publishAudio:"undefined"===typeof i.publishAudio||i.publishAudio,publishVideo:"undefined"===typeof i.publishVideo||i.publishVideo,resolution:"undefined"!==typeof MediaStreamTrack&&i.videoSource instanceof MediaStreamTrack?void 0:"undefined"!==typeof i.resolution?i.resolution:"640x480",videoSource:"undefined"!==typeof i.videoSource?i.videoSource:void 0,videoSimulcast:i.videoSimulcast,filter:i.filter}):i={insertMode:h.VideoInsertMode.APPEND,mirror:!0,publishAudio:!0,publishVideo:!0,resolution:"640x480"};var r,o=new a.Publisher(e,i,this);return t&&"function"===typeof t?r=t:n&&(r=n),o.initialize().then((function(){void 0!==r&&r(void 0),o.emitEvent("accessAllowed",[])})).catch((function(e){void 0!==r&&r(e),o.emitEvent("accessDenied",[e])})),this.publishers.push(o),o},e.prototype.initPublisherAsync=function(e,t){var n=this;return new Promise((function(i,r){var o,s=function(e){return e?r(e):i(o)};o=t?n.initPublisher(e,t,s):n.initPublisher(e,s)}))},e.prototype.initLocalRecorder=function(e){return new s.LocalRecorder(e)},e.prototype.checkSystemRequirements=function(){return o.isIPhoneOrIPad()?o.isIOSWithSafari()||o.isChromeMobileBrowser()||o.isFirefoxMobileBrowser()||o.isOperaMobileBrowser()||o.isEdgeMobileBrowser()||o.isIonicIos():o.isChromeBrowser()||o.isChromeMobileBrowser()||o.isFirefoxBrowser()||o.isFirefoxMobileBrowser()||o.isOperaBrowser()||o.isOperaMobileBrowser()||o.isEdgeBrowser()||o.isEdgeMobileBrowser()||o.isSamsungBrowser()||o.isSafariBrowser()||o.isAndroidBrowser()||o.isElectron()||o.isNodeJs()},e.prototype.checkScreenSharingCapabilities=function(){return o.canScreenShare()},e.prototype.getDevices=function(){return new Promise((function(e,t){navigator.mediaDevices.enumerateDevices().then((function(t){var n,i=[];if(!o.isIonicAndroid()||"undefined"==typeof cordova||!(null===(n=null===cordova||void 0===cordova?void 0:cordova.plugins)||void 0===n?void 0:n.EnumerateDevicesPlugin))return t.forEach((function(e){"audioinput"!==e.kind&&"videoinput"!==e.kind||i.push({kind:e.kind,deviceId:e.deviceId,label:e.label})})),e(i);cordova.plugins.EnumerateDevicesPlugin.getEnumerateDevices().then((function(n){var r=[],o=[],s=[];return r=n.filter((function(e){return"audioinput"===e.kind})),o=t.filter((function(e){return"videoinput"===e.kind})),s=t.filter((function(e){return"audioinput"===e.kind})),o.forEach((function(e,t){if(e.label)i.push({kind:e.kind,deviceId:e.deviceId,label:e.label});else{var n="";n=0===t?"Front Camera":1===t?"Back Camera":"Unknown Camera",i.push({kind:e.kind,deviceId:e.deviceId,label:n})}})),s.forEach((function(e,t){if(e.label)i.push({kind:e.kind,deviceId:e.deviceId,label:e.label});else{var n="";switch(t){case 0:n="Default";break;case 1:var o=r.filter((function(e){return e.label.includes("Built")}))[0];n=o?o.label:"Built-in Microphone";break;case 2:var s=r.filter((function(e){return e.label.includes("Wired")}))[0];n=s?s.label:"Headset earpiece";break;case 3:var a=r.filter((function(e){return e.label.includes("Bluetooth")}))[0];n=a?a.label:"Wireless";break;default:n="Unknown Microphone";break}i.push({kind:e.kind,deviceId:e.deviceId,label:n})}})),e(i)}))})).catch((function(e){return S.error("Error getting devices",e),t(e)}))}))},e.prototype.getUserMedia=function(e){var t=this;return new Promise((function(n,s){return i(t,void 0,void 0,(function(){var t,a,c,l,u,h,p,f,m,v,g,E,b=this;return r(this,(function(y){switch(y.label){case 0:t=function(e,t){return i(b,void 0,void 0,(function(){var i,o,a,c;return r(this,(function(r){switch(r.label){case 0:i=void 0===t.audio||t.audio,o={audio:i,video:!1},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia(o)];case 2:return a=r.sent(),e.addTrack(a.getAudioTracks()[0]),[2,n(e)];case 3:return c=r.sent(),e.getAudioTracks().forEach((function(e){e.stop()})),e.getVideoTracks().forEach((function(e){e.stop()})),[2,s(this.generateAudioDeviceError(c,o))];case 4:return[2]}}))}))},y.label=1;case 1:return y.trys.push([1,20,,21]),[4,this.generateMediaConstraints(e)];case 2:return a=y.sent(),a.videoTrack&&a.audioTrack||a.audioTrack&&!1===(null===(g=a.constraints)||void 0===g?void 0:g.video)||a.videoTrack&&!1===(null===(E=a.constraints)||void 0===E?void 0:E.audio)?[2,n(this.addAlreadyProvidedTracks(a,new MediaStream))]:[3,3];case 3:if(a.videoTrack&&delete a.constraints.video,a.audioTrack&&delete a.constraints.audio,c=!1,"string"!==typeof e.videoSource)return[3,12];if(!("screen"===e.videoSource||"window"===e.videoSource||o.isElectron()&&e.videoSource.startsWith("screen:")))return[3,12];if(c=!a.audioTrack&&null!==e.audioSource&&!1!==e.audioSource,!navigator.mediaDevices["getDisplayMedia"]||o.isElectron())return[3,11];y.label=4;case 4:return y.trys.push([4,9,,10]),[4,navigator.mediaDevices["getDisplayMedia"]({video:!0})];case 5:return h=y.sent(),this.addAlreadyProvidedTracks(a,h),c?[4,t(h,a.constraints)]:[3,7];case 6:return y.sent(),[2];case 7:return[2,n(h)];case 8:return[3,10];case 9:return l=y.sent(),f=d.OpenViduErrorName.SCREEN_CAPTURE_DENIED,m=l.toString(),[2,s(new d.OpenViduError(f,m))];case 10:return[3,11];case 11:return[3,12];case 12:u=c?{video:a.constraints.video}:a.constraints,y.label=13;case 13:return y.trys.push([13,18,,19]),[4,navigator.mediaDevices.getUserMedia(u)];case 14:return h=y.sent(),this.addAlreadyProvidedTracks(a,h),c?[4,t(h,a.constraints)]:[3,16];case 15:return y.sent(),[3,17];case 16:return[2,n(h)];case 17:return[3,19];case 18:return p=y.sent(),f=void 0,m=p.toString(),f="screen"!==e.videoSource?d.OpenViduErrorName.DEVICE_ACCESS_DENIED:d.OpenViduErrorName.SCREEN_CAPTURE_DENIED,[2,s(new d.OpenViduError(f,m))];case 19:return[3,21];case 20:return v=y.sent(),s(v),[3,21];case 21:return[2]}}))}))}))},e.prototype.enableProdMode=function(){S.enableProdMode()},e.prototype.setAdvancedConfiguration=function(e){this.advancedConfiguration=e},e.prototype.onOrientationChanged=function(e){globalThis.addEventListener("orientationchange",e)},e.prototype.sendNewVideoDimensionsIfRequired=function(e,t,n,i){var r,o,s,a,c=this,l=0,u=(null===(o=null===(r=null===e||void 0===e?void 0:e.stream)||void 0===r?void 0:r.videoDimensions)||void 0===o?void 0:o.width)||0,d=(null===(a=null===(s=null===e||void 0===e?void 0:e.stream)||void 0===s?void 0:s.videoDimensions)||void 0===a?void 0:a.height)||0,h=setInterval((function(){l++,l>i&&clearTimeout(h),e.getVideoDimensions().then((function(n){n.width===u&&n.height===d||(clearTimeout(h),c.sendVideoDimensionsChangedEvent(e,t,u,d,n.width,n.height))}))}),n)},e.prototype.sendVideoDimensionsChangedEvent=function(e,t,n,i,r,o){var s=this;e.stream.videoDimensions={width:r||0,height:o||0},this.sendRequest("streamPropertyChanged",{streamId:e.stream.streamId,property:"videoDimensions",newValue:JSON.stringify(e.stream.videoDimensions),reason:t},(function(r,o){r?S.error("Error sending 'streamPropertyChanged' event",r):(s.session.emitEvent("streamPropertyChanged",[new u.StreamPropertyChangedEvent(s.session,e.stream,"videoDimensions",e.stream.videoDimensions,{width:n,height:i},t)]),e.emitEvent("streamPropertyChanged",[new u.StreamPropertyChangedEvent(e,e.stream,"videoDimensions",e.stream.videoDimensions,{width:n,height:i},t)]),s.session.sendVideoData(e))}))},e.prototype.sendTrackChangedEvent=function(e,t,n,i){var r=this,o={label:t},s={label:n},a="trackReplaced";e.stream.isLocalStreamPublished?this.sendRequest("streamPropertyChanged",{streamId:e.stream.streamId,property:i,newValue:s,reason:a},(function(t,n){t?S.error("Error sending 'streamPropertyChanged' event",t):(r.session.emitEvent("streamPropertyChanged",[new u.StreamPropertyChangedEvent(r.session,e.stream,i,s,o,a)]),e.emitEvent("streamPropertyChanged",[new u.StreamPropertyChangedEvent(e,e.stream,i,s,o,a)]))})):(this.session.emitEvent("streamPropertyChanged",[new u.StreamPropertyChangedEvent(this.session,e.stream,i,s,o,a)]),e.emitEvent("streamPropertyChanged",[new u.StreamPropertyChangedEvent(e,e.stream,i,s,o,a)]))},e.prototype.generateMediaConstraints=function(e){var t=this;return new Promise((function(n,i){var r={audioTrack:void 0,videoTrack:void 0,constraints:{audio:void 0,video:void 0}},o=e.audioSource,s=e.videoSource;if(null!==o&&!1!==o||(r.constraints.audio=!1),null!==s&&!1!==s||(r.constraints.video=!1),!1===r.constraints.audio&&!1===r.constraints.video)return i(new d.OpenViduError(d.OpenViduErrorName.NO_INPUT_SOURCE_SET,"Properties 'audioSource' and 'videoSource' cannot be set to false or null at the same time"));if("undefined"!==typeof MediaStreamTrack&&o instanceof MediaStreamTrack&&(r.audioTrack=o),"undefined"!==typeof MediaStreamTrack&&s instanceof MediaStreamTrack&&(r.videoTrack=s),void 0===o&&(r.constraints.audio=!0),void 0===s&&(r.constraints.video={width:{ideal:640},height:{ideal:480}}),null!==s&&!1!==s){if(e.resolution){var a=e.resolution.toLowerCase().split("x"),c=Number(a[0]),l=Number(a[1]);r.constraints.video={width:{ideal:c},height:{ideal:l}}}e.frameRate&&(r.constraints.video.frameRate={ideal:e.frameRate})}return t.configureDeviceIdOrScreensharing(r,e,n,i),n(r)}))},e.prototype.startWs=function(e){var t={heartbeat:5e3,ws:{uri:this.wsUri+"?sessionId="+this.session.sessionId,onconnected:e,ondisconnect:this.disconnectCallback.bind(this),onreconnecting:this.reconnectingCallback.bind(this),onreconnected:this.reconnectedCallback.bind(this),ismasternodecrashed:this.isMasterNodeCrashed.bind(this)},rpc:{requestTimeout:1e4,heartbeatRequestTimeout:5e3,participantJoined:this.session.onParticipantJoined.bind(this.session),participantPublished:this.session.onParticipantPublished.bind(this.session),participantUnpublished:this.session.onParticipantUnpublished.bind(this.session),participantLeft:this.session.onParticipantLeft.bind(this.session),participantEvicted:this.session.onParticipantEvicted.bind(this.session),recordingStarted:this.session.onRecordingStarted.bind(this.session),recordingStopped:this.session.onRecordingStopped.bind(this.session),sendMessage:this.session.onNewMessage.bind(this.session),streamPropertyChanged:this.session.onStreamPropertyChanged.bind(this.session),connectionPropertyChanged:this.session.onConnectionPropertyChanged.bind(this.session),networkQualityLevelChanged:this.session.onNetworkQualityLevelChangedChanged.bind(this.session),filterEventDispatched:this.session.onFilterEventDispatched.bind(this.session),iceCandidate:this.session.recvIceCandidate.bind(this.session),mediaError:this.session.onMediaError.bind(this.session),masterNodeCrashedNotification:this.onMasterNodeCrashedNotification.bind(this),forciblyReconnectSubscriber:this.session.onForciblyReconnectSubscriber.bind(this.session),speechToTextMessage:this.session.onSpeechToTextMessage.bind(this.session),speechToTextDisconnected:this.session.onSpeechToTextDisconnected.bind(this.session)}};this.jsonRpcClient=new b.clients.JsonRpcClient(t)},e.prototype.onMasterNodeCrashedNotification=function(e){console.error("Master Node has crashed"),this.masterNodeHasCrashed=!0,this.session.onLostConnection("nodeCrashed"),this.jsonRpcClient.close(4103,"Master Node has crashed")},e.prototype.getWsReadyState=function(){return this.jsonRpcClient.getReadyState()},e.prototype.closeWs=function(){this.jsonRpcClient.close(4102,"Connection closed by client")},e.prototype.sendRequest=function(e,t,n){var i;t&&t instanceof Function&&(n=t,t={}),S.debug('Sending request: {method:"'+e+'", params: '+JSON.stringify(t)+"}"),null===(i=this.jsonRpcClient)||void 0===i||i.send(e,t,n)},e.prototype.getWsUri=function(){return this.wsUri},e.prototype.getSecret=function(){return this.secret},e.prototype.getRecorder=function(){return this.recorder},e.prototype.getStt=function(){return this.stt},e.prototype.generateAudioDeviceError=function(e,t){var n,i;switch("Error"===e.name&&(e.name=e.constructor.name),e.name.toLowerCase()){case"notfounderror":return n=d.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,i=e.toString(),new d.OpenViduError(n,i);case"notallowederror":return n=d.OpenViduErrorName.DEVICE_ACCESS_DENIED,i=e.toString(),new d.OpenViduError(n,i);case"overconstrainederror":return"deviceid"===e.constraint.toLowerCase()?(n=d.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,i="Audio input device with deviceId '"+t.audio.deviceId.exact+"' not found"):(n=d.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,i="Audio input device doesn't support the value passed for constraint '"+e.constraint+"'"),new d.OpenViduError(n,i);case"notreadableerror":return n=d.OpenViduErrorName.DEVICE_ALREADY_IN_USE,i=e.toString(),new d.OpenViduError(n,i);default:return new d.OpenViduError(d.OpenViduErrorName.INPUT_AUDIO_DEVICE_GENERIC_ERROR,e.toString())}},e.prototype.addAlreadyProvidedTracks=function(e,t,n){return e.videoTrack&&(t.addTrack(e.videoTrack),n&&(e.constraints.video?n.lastVideoTrackConstraints=e.constraints.video:n.lastVideoTrackConstraints=e.videoTrack.getConstraints())),e.audioTrack&&t.addTrack(e.audioTrack),t},e.prototype.configureDeviceIdOrScreensharing=function(e,t,n,i){var r=this,s=t.audioSource,a=t.videoSource;if("string"===typeof s&&(e.constraints.audio={deviceId:{exact:s}}),"string"===typeof a){if(this.isScreenShare(a)){if(this.checkScreenSharingCapabilities()){if(o.isElectron()){var c="screen:",l=a,u=l.substr(l.indexOf(c)+c.length);return e.constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:u}},n(e)}if(!this.advancedConfiguration.screenShareChromeExtension||o.isFirefoxBrowser()||o.isFirefoxMobileBrowser()||navigator.mediaDevices["getDisplayMedia"]){if(navigator.mediaDevices["getDisplayMedia"])return n(e);var h=o.isFirefoxBrowser()||o.isFirefoxMobileBrowser()?t.videoSource:void 0;return void m.getScreenId(h,(function(t,o,s){if(t){if("not-installed"===t){var a=r.advancedConfiguration.screenShareChromeExtension?r.advancedConfiguration.screenShareChromeExtension:"https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",c=new d.OpenViduError(d.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,a);return S.error(c),i(c)}if("installed-disabled"===t){c=new d.OpenViduError(d.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");return S.error(c),i(c)}if("permission-denied"===t){c=new d.OpenViduError(d.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");return S.error(c),i(c)}c=new d.OpenViduError(d.OpenViduErrorName.GENERIC_ERROR,"Unknown error when accessing screen share");return S.error(c),S.error(t),i(c)}return e.constraints.video=s.video,n(e)}))}return void v.getScreenConstraints((function(t,o){if(!(t||o.mandatory&&"screen"===o.mandatory.chromeMediaSource))return e.constraints.video=o,n(e);if("permission-denied"===t||"PermissionDeniedError"===t){var s=new d.OpenViduError(d.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");return S.error(s),i(s)}var a=r.advancedConfiguration.screenShareChromeExtension.split("/").pop().trim();v.getChromeExtensionStatus(a,(function(e){if("installed-disabled"===e){var t=new d.OpenViduError(d.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");return S.error(t),i(t)}if("not-installed"===e){var n=new d.OpenViduError(d.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,r.advancedConfiguration.screenShareChromeExtension);return S.error(n),i(n)}}))}))}var p=new d.OpenViduError(d.OpenViduErrorName.SCREEN_SHARING_NOT_SUPPORTED,"You can only screen share in desktop Chrome, Firefox, Opera, Safari (>=13.0), Edge (>= 80) or Electron. Detected client: "+o.getName()+" "+o.getVersion());return S.error(p),i(p)}this.setVideoSource(e,a)}},e.prototype.setVideoSource=function(e,t){e.constraints.video||(e.constraints.video={}),e.constraints.video["deviceId"]={exact:t}},e.prototype.disconnectCallback=function(){S.warn("Websocket connection lost"),this.isRoomAvailable()?this.session.onLostConnection("networkDisconnect"):alert("Connection error. Please reload page.")},e.prototype.reconnectingCallback=function(){S.warn("Websocket connection lost (reconnecting)"),this.isRoomAvailable()?this.session.emitEvent("reconnecting",[]):alert("Connection error. Please reload page.")},e.prototype.reconnectWebsocketThroughRpcConnectMethod=function(e){var t=this;this.sendRequest("connect",{sessionId:e,reconnect:!0},(function(e,n){if(e)if(t.isMasterNodeCrashed())S.warn("Master Node has crashed!");else{S.error(e);var i=function(e,n){S.warn(n),t.session.onLostConnection(e),t.jsonRpcClient.close(4101,"Reconnection fault: "+n)},r=function(){-1===t.life?i("networkDisconnect","WS successfully reconnected but the user was already evicted due to timeout"):t.sendRequest("sessionStatus",{sessionId:t.session.sessionId},(function(e,n){null!=e?console.error("Error checking session status",e):t.life===n.life?i("networkDisconnect","WS successfully reconnected but the user was already evicted due to timeout"):i("nodeCrashed","WS successfully reconnected to OpenVidu Server but your Master Node crashed")}))};40007===e.code&&"reconnection error"===e.message?(console.error("Invalid RPC sessionId. Client network disconnection or Master Node crash"),r()):r()}else t.jsonRpcClient.resetPing(),t.session.onRecoveredConnection()}))},e.prototype.reconnectedCallback=function(){if(S.warn("Websocket reconnected"),this.isRoomAvailable())if(this.session.connection)this.reconnectWebsocketThroughRpcConnectMethod(this.session.connection.rpcSessionId);else{S.warn("There was no previous connection when running reconnection callback");var e=new l.SessionDisconnectedEvent(this.session,"networkDisconnect");this.session.ee.emitEvent("sessionDisconnected",[e]),e.callDefaultBehavior()}else alert("Connection error. Please reload page.")},e.prototype.isMasterNodeCrashed=function(){return this.masterNodeHasCrashed},e.prototype.isRoomAvailable=function(){return void 0!==this.session&&this.session instanceof c.Session||(S.warn("Session instance not found"),!1)},e.prototype.isScreenShare=function(e){return"screen"===e||"window"===e||o.isElectron()&&e.startsWith("screen:")},e}();t.OpenVidu=w},"3d9c":function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=t.ExceptionEventName=t.ExceptionEvent=t.SpeechToTextEvent=t.NetworkQualityLevelChangedEvent=t.FilterEvent=t.ConnectionPropertyChangedEvent=t.StreamPropertyChangedEvent=t.VideoElementEvent=t.StreamManagerEvent=t.StreamEvent=t.SignalEvent=t.SessionDisconnectedEvent=t.RecordingEvent=t.PublisherSpeakingEvent=t.ConnectionEvent=t.Event=t.VideoInsertMode=t.TypeOfVideo=t.OpenViduErrorName=t.OpenViduError=t.LocalRecorderState=t.Filter=t.LocalRecorder=t.Connection=t.Stream=t.StreamManager=t.Subscriber=t.Publisher=t.Session=t.OpenVidu=void 0;var o=n("3029"),s=n("3cf7");Object.defineProperty(t,"OpenVidu",{enumerable:!0,get:function(){return s.OpenVidu}});var a=n("2533");Object.defineProperty(t,"Session",{enumerable:!0,get:function(){return a.Session}});var c=n("3c4c");Object.defineProperty(t,"Publisher",{enumerable:!0,get:function(){return c.Publisher}});var l=n("6e4e");Object.defineProperty(t,"Subscriber",{enumerable:!0,get:function(){return l.Subscriber}});var u=n("3f7b");Object.defineProperty(t,"StreamManager",{enumerable:!0,get:function(){return u.StreamManager}});var d=n("0cf2");Object.defineProperty(t,"Stream",{enumerable:!0,get:function(){return d.Stream}});var h=n("af24");Object.defineProperty(t,"Connection",{enumerable:!0,get:function(){return h.Connection}});var p=n("b489");Object.defineProperty(t,"LocalRecorder",{enumerable:!0,get:function(){return p.LocalRecorder}});var f=n("ef86");Object.defineProperty(t,"Filter",{enumerable:!0,get:function(){return f.Filter}});var m=n("627d");Object.defineProperty(t,"LocalRecorderState",{enumerable:!0,get:function(){return m.LocalRecorderState}});var v=n("4edf");Object.defineProperty(t,"OpenViduError",{enumerable:!0,get:function(){return v.OpenViduError}}),Object.defineProperty(t,"OpenViduErrorName",{enumerable:!0,get:function(){return v.OpenViduErrorName}});var g=n("b793");Object.defineProperty(t,"TypeOfVideo",{enumerable:!0,get:function(){return g.TypeOfVideo}});var E=n("fdd2");Object.defineProperty(t,"VideoInsertMode",{enumerable:!0,get:function(){return E.VideoInsertMode}});var b=n("8733");Object.defineProperty(t,"Event",{enumerable:!0,get:function(){return b.Event}});var y=n("f0a5");Object.defineProperty(t,"ConnectionEvent",{enumerable:!0,get:function(){return y.ConnectionEvent}});var S=n("7bca");Object.defineProperty(t,"PublisherSpeakingEvent",{enumerable:!0,get:function(){return S.PublisherSpeakingEvent}});var w=n("ad42");Object.defineProperty(t,"RecordingEvent",{enumerable:!0,get:function(){return w.RecordingEvent}});var C=n("92c2");Object.defineProperty(t,"SessionDisconnectedEvent",{enumerable:!0,get:function(){return C.SessionDisconnectedEvent}});var O=n("b2e1");Object.defineProperty(t,"SignalEvent",{enumerable:!0,get:function(){return O.SignalEvent}});var x=n("4def");Object.defineProperty(t,"StreamEvent",{enumerable:!0,get:function(){return x.StreamEvent}});var R=n("1f15");Object.defineProperty(t,"StreamManagerEvent",{enumerable:!0,get:function(){return R.StreamManagerEvent}});var I=n("a081");Object.defineProperty(t,"VideoElementEvent",{enumerable:!0,get:function(){return I.VideoElementEvent}});var T=n("0703");Object.defineProperty(t,"StreamPropertyChangedEvent",{enumerable:!0,get:function(){return T.StreamPropertyChangedEvent}});var P=n("f1bf");Object.defineProperty(t,"ConnectionPropertyChangedEvent",{enumerable:!0,get:function(){return P.ConnectionPropertyChangedEvent}});var k=n("fa28");Object.defineProperty(t,"FilterEvent",{enumerable:!0,get:function(){return k.FilterEvent}});var _=n("043b");Object.defineProperty(t,"NetworkQualityLevelChangedEvent",{enumerable:!0,get:function(){return _.NetworkQualityLevelChangedEvent}});var L=n("fefe");Object.defineProperty(t,"SpeechToTextEvent",{enumerable:!0,get:function(){return L.SpeechToTextEvent}});var A=n("e9cb");Object.defineProperty(t,"ExceptionEvent",{enumerable:!0,get:function(){return A.ExceptionEvent}}),Object.defineProperty(t,"ExceptionEventName",{enumerable:!0,get:function(){return A.ExceptionEventName}});var N=n("0f3b");Object.defineProperty(t,"EventDispatcher",{enumerable:!0,get:function(){return N.EventDispatcher}}),r(n("6c8b"),t),o.JL.setOptions({enabled:!1})},"3f7b":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.StreamManager=void 0;var r,o=n("0f3b"),s=n("1f15"),a=n("a081"),c=n("e9cb"),l=n("fdd2"),u=n("f66e"),d=n("e237"),h=u.OpenViduLogger.getInstance(),p=function(e){function t(t,n){var i=e.call(this)||this;if(i.videos=[],i.lazyLaunchVideoElementCreatedEvent=!1,r=d.PlatformUtils.getInstance(),i.stream=t,i.stream.streamManager=i,i.remote=!i.stream.isLocal(),n){var o=void 0;"string"===typeof n?o=document.getElementById(n):n instanceof HTMLElement&&(o=n),o&&(i.firstVideoElement={targetElement:o,video:document.createElement("video"),id:"",canplayListenerAdded:!1},(r.isSafariBrowser()||r.isIPhoneOrIPad()&&(r.isChromeMobileBrowser()||r.isEdgeMobileBrowser()||r.isOperaMobileBrowser()||r.isFirefoxMobileBrowser()))&&(i.firstVideoElement.video.playsInline=!0),i.targetElement=o,i.element=o)}return i.canPlayListener=function(){i.deactivateStreamPlayingEventExceptionTimeout(),i.ee.emitEvent("streamPlaying",[new s.StreamManagerEvent(i,"streamPlaying",void 0)])},i}return i(t,e),t.prototype.on=function(t,n){return e.prototype.onAux.call(this,t,"Event '"+t+"' triggered by '"+(this.remote?"Subscriber":"Publisher")+"'",n),"videoElementCreated"===t&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&(this.ee.emitEvent("videoElementCreated",[new a.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!1),"streamPlaying"===t&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&this.ee.emitEvent("streamPlaying",[new s.StreamManagerEvent(this,"streamPlaying",void 0)]),this.stream.hasAudio&&("publisherStartSpeaking"===t&&this.stream.enableHarkSpeakingEvent(),"publisherStopSpeaking"===t&&this.stream.enableHarkStoppedSpeakingEvent(),"streamAudioVolumeChange"===t&&this.stream.enableHarkVolumeChangeEvent(!1)),this},t.prototype.once=function(t,n){return e.prototype.onceAux.call(this,t,"Event '"+t+"' triggered once by '"+(this.remote?"Subscriber":"Publisher")+"'",n),"videoElementCreated"===t&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&this.ee.emitEvent("videoElementCreated",[new a.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),"streamPlaying"===t&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&this.ee.emitEvent("streamPlaying",[new s.StreamManagerEvent(this,"streamPlaying",void 0)]),this.stream.hasAudio&&("publisherStartSpeaking"===t&&this.stream.enableOnceHarkSpeakingEvent(),"publisherStopSpeaking"===t&&this.stream.enableOnceHarkStoppedSpeakingEvent(),"streamAudioVolumeChange"===t&&this.stream.enableOnceHarkVolumeChangeEvent(!1)),this},t.prototype.off=function(t,n){if(e.prototype.offAux.call(this,t,n),"publisherStartSpeaking"===t){var i=this.ee.getListeners(t).length+this.stream.session.ee.getListeners(t).length;0===i&&this.stream.disableHarkSpeakingEvent(!1)}if("publisherStopSpeaking"===t){var r=this.ee.getListeners(t).length+this.stream.session.ee.getListeners(t).length;0===r&&this.stream.disableHarkStoppedSpeakingEvent(!1)}if("streamAudioVolumeChange"===t){var o=this.ee.getListeners(t).length;0===o&&this.stream.disableHarkVolumeChangeEvent(!1)}return this},t.prototype.addVideoElement=function(e){this.initializeVideoProperties(e),!this.remote&&this.stream.displayMyRemote()&&e.srcObject!==this.stream.getMediaStream()&&(e.srcObject=this.stream.getMediaStream());for(var t=0,n=this.videos;t<n.length;t++){var i=n[t];if(i.video===e)return 0}for(var r=1,o=0,s=this.stream.session.streamManagers;o<s.length;o++){var a=s[o];if(a.disassociateVideo(e)){r=-1;break}}return this.stream.session.streamManagers.forEach((function(t){t.disassociateVideo(e)})),this.pushNewStreamManagerVideo({video:e,id:e.id,canplayListenerAdded:!1}),h.info("New video element associated to ",this),r},t.prototype.createVideoElement=function(e,t){var n;if("string"===typeof e){if(n=document.getElementById(e),!n)throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e)}else{if(!(e instanceof HTMLElement))throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e);n=e}var i=this.createVideo();this.initializeVideoProperties(i);var r=t||l.VideoInsertMode.APPEND;switch(r){case l.VideoInsertMode.AFTER:n.parentNode.insertBefore(i,n.nextSibling);break;case l.VideoInsertMode.APPEND:n.appendChild(i);break;case l.VideoInsertMode.BEFORE:n.parentNode.insertBefore(i,n);break;case l.VideoInsertMode.PREPEND:n.insertBefore(i,n.childNodes[0]);break;case l.VideoInsertMode.REPLACE:n.parentNode.replaceChild(i,n);break;default:r=l.VideoInsertMode.APPEND,n.appendChild(i);break}var o={targetElement:n,video:i,insertMode:r,id:i.id,canplayListenerAdded:!1};return this.pushNewStreamManagerVideo(o),this.ee.emitEvent("videoElementCreated",[new a.VideoElementEvent(o.video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!!this.firstVideoElement,i},t.prototype.updatePublisherSpeakingEventsOptions=function(e){var t=this.stream.harkOptions?this.stream.harkOptions:this.stream.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{},n="number"===typeof e.interval?e.interval:"number"===typeof t.interval?t.interval:100,i="number"===typeof e.threshold?e.threshold:"number"===typeof t.threshold?t.threshold:-50;this.stream.harkOptions={interval:n,threshold:i},this.stream.speechEvent&&(this.stream.speechEvent.setInterval(n),this.stream.speechEvent.setThreshold(i))},t.prototype.initializeVideoProperties=function(e){!this.remote&&this.stream.displayMyRemote()||e.srcObject!==this.stream.getMediaStream()&&(e.srcObject=this.stream.getMediaStream()),e.autoplay=!0,e.controls=!1,(r.isSafariBrowser()||r.isIPhoneOrIPad()&&(r.isChromeMobileBrowser()||r.isEdgeMobileBrowser()||r.isOperaMobileBrowser()||r.isFirefoxMobileBrowser()))&&(e.playsInline=!0),e.id||(e.id=(this.remote?"remote-":"local-")+"video-"+this.stream.streamId,!this.id&&this.targetElement&&(this.id=e.id)),this.remote&&this.isMirroredVideo(e)?this.removeMirrorVideo(e):this.remote||this.stream.displayMyRemote()||(e.muted=!0,this.isMirroredVideo(e)&&!this.stream.outboundStreamOpts.publisherProperties.mirror?this.removeMirrorVideo(e):this.stream.outboundStreamOpts.publisherProperties.mirror&&!this.stream.isSendScreen()&&this.mirrorVideo(e))},t.prototype.removeAllVideos=function(){for(var e=this,t=this.stream.session.streamManagers.length-1;t>=0;--t)this.stream.session.streamManagers[t]===this&&this.stream.session.streamManagers.splice(t,1);this.videos.forEach((function(t){t.video&&t.video.removeEventListener&&t.video.removeEventListener("canplay",e.canPlayListener),t.canplayListenerAdded=!1,t.targetElement&&(t.video.parentNode.removeChild(t.video),e.ee.emitEvent("videoElementDestroyed",[new a.VideoElementEvent(t.video,e,"videoElementDestroyed")])),e.removeSrcObject(t),e.videos.filter((function(e){return!e.targetElement}))}))},t.prototype.disassociateVideo=function(e){for(var t=!1,n=0;n<this.videos.length;n++)if(this.videos[n].video===e){this.videos[n].video.removeEventListener("canplay",this.canPlayListener),this.videos.splice(n,1),t=!0,h.info("Video element disassociated from ",this);break}return t},t.prototype.addPlayEventToFirstVideo=function(){this.videos[0]&&this.videos[0].video&&!this.videos[0].canplayListenerAdded&&(this.activateStreamPlayingEventExceptionTimeout(),this.videos[0].video.addEventListener("canplay",this.canPlayListener),this.videos[0].canplayListenerAdded=!0)},t.prototype.updateMediaStream=function(e){this.videos.forEach((function(t){if(t.video.srcObject=e,r.isIonicIos()){var n=t.video.parentElement,i=t.video;n.replaceChild(i,t.video),t.video=i}}))},t.prototype.emitEvent=function(e,t){this.ee.emitEvent(e,t)},t.prototype.createVideo=function(){return document.createElement("video")},t.prototype.removeSrcObject=function(e){e.video.srcObject=null,this.deactivateStreamPlayingEventExceptionTimeout()},t.prototype.pushNewStreamManagerVideo=function(e){this.videos.push(e),this.addPlayEventToFirstVideo(),-1===this.stream.session.streamManagers.indexOf(this)&&this.stream.session.streamManagers.push(this)},t.prototype.mirrorVideo=function(e){r.isIonicIos()||(e.style.transform="rotateY(180deg)",e.style.webkitTransform="rotateY(180deg)")},t.prototype.removeMirrorVideo=function(e){e.style.transform="unset",e.style.webkitTransform="unset"},t.prototype.isMirroredVideo=function(e){return"rotateY(180deg)"===e.style.transform||"rotateY(180deg)"===e.style.webkitTransform},t.prototype.activateStreamPlayingEventExceptionTimeout=function(){var e=this;if(this.remote&&null==this.streamPlayingEventExceptionTimeout){var t=this.stream.session.openvidu.advancedConfiguration.noStreamPlayingEventExceptionTimeout||4e3;this.streamPlayingEventExceptionTimeout=setTimeout((function(){var n="StreamManager of Stream "+e.stream.streamId+" ("+(e.remote?"Subscriber":"Publisher")+') did not trigger "streamPlaying" event in '+t+" ms";h.warn(n),e.stream.session.emitEvent("exception",[new c.ExceptionEvent(e.stream.session,c.ExceptionEventName.NO_STREAM_PLAYING_EVENT,e,n)]),delete e.streamPlayingEventExceptionTimeout}),t)}},t.prototype.deactivateStreamPlayingEventExceptionTimeout=function(){clearTimeout(this.streamPlayingEventExceptionTimeout),delete this.streamPlayingEventExceptionTimeout},t}(o.EventDispatcher);t.StreamManager=p},"3fb5":function(e,t){"function"===typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},4755:function(e,t,n){"use strict";function i(){this._types=Object.create(null),this._extensions=Object.create(null);for(let e=0;e<arguments.length;e++)this.define(arguments[e]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}i.prototype.define=function(e,t){for(let n in e){let i=e[n].map((function(e){return e.toLowerCase()}));n=n.toLowerCase();for(let e=0;e<i.length;e++){const r=i[e];if("*"!==r[0]){if(!t&&r in this._types)throw new Error('Attempt to change mapping for "'+r+'" extension from "'+this._types[r]+'" to "'+n+'". Pass `force=true` to allow this, otherwise remove "'+r+'" from the list of extensions for "'+n+'".');this._types[r]=n}}if(t||!this._extensions[n]){const e=i[0];this._extensions[n]="*"!==e[0]?e:e.substr(1)}}},i.prototype.getType=function(e){e=String(e);let t=e.replace(/^.*[/\\]/,"").toLowerCase(),n=t.replace(/^.*\./,"").toLowerCase(),i=t.length<e.length,r=n.length<t.length-1;return(r||!i)&&this._types[n]||null},i.prototype.getExtension=function(e){return e=/^\s*([^;\s]*)/.test(e)&&RegExp.$1,e&&this._extensions[e.toLowerCase()]||null},e.exports=i},"498b":function(e,t,n){var i=n("103a");t.JsonRpcClient=i},"49d9":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenViduLoggerConfiguration=void 0,function(e){e["disabled"]="disabled",e["debug"]="debug",e["debug_app"]="debug_app"}(t.OpenViduLoggerConfiguration||(t.OpenViduLoggerConfiguration={}))},"4a89":function(e,t,n){!function(t,n){e.exports=n()}(0,(function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=9)}([function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){e.exports=!n(3)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var n=e.exports={version:"2.5.1"};"number"==typeof __e&&(__e=n)},function(e,t,n){var i=n(6),r=n(7);e.exports=function(e){return i(r(e))}},function(e,t,n){var i=n(30);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Avatar=void 0;var i=n(10),r=function(e){return e&&e.__esModule?e:{default:e}}(i);t.Avatar=r.default,t.default=r.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(12),r=n.n(i),o=n(41),s=n(11),a=s(r.a,o.a,!1,null,null,null);t.default=a.exports},function(e,t){e.exports=function(e,t,n,i,r,o){var s,a=e=e||{},c=typeof e.default;"object"!==c&&"function"!==c||(s=e,a=e.default);var l,u="function"==typeof a?a.options:a;if(t&&(u.render=t.render,u.staticRenderFns=t.staticRenderFns,u._compiled=!0),n&&(u.functional=!0),r&&(u._scopeId=r),o?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},u._ssrRegister=l):i&&(l=i),l){var d=u.functional,h=d?u.render:u.beforeCreate;d?(u._injectStyles=l,u.render=function(e,t){return l.call(t),h(e,t)}):u.beforeCreate=h?[].concat(h,l):[l]}return{esModule:s,exports:a,options:u}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(13),r=function(e){return e&&e.__esModule?e:{default:e}}(i),o=function(e){for(var t=e.split(/[ -]/),n="",i=0;i<t.length;i++)n+=t[i].charAt(0);return n.length>3&&-1!==n.search(/[A-Z]/)&&(n=n.replace(/[a-z]+/g,"")),n.substr(0,3).toUpperCase()};t.default={name:"avatar",props:{username:{type:String},initials:{type:String},backgroundColor:{type:String},color:{type:String},customStyle:{type:Object},inline:{type:Boolean},size:{type:Number,default:50},src:{type:String},rounded:{type:Boolean,default:!0},lighten:{type:Number,default:80},parser:{type:Function,default:o,validator:function(e){return"string"==typeof e("John",o)}}},data:function(){return{backgroundColors:["#F44336","#FF4081","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFC107","#FF9800","#FF5722","#795548","#9E9E9E","#607D8B"],imgError:!1}},mounted:function(){this.isImage||this.$emit("avatar-initials",this.username,this.userInitial)},computed:{background:function(){if(!this.isImage)return this.backgroundColor||this.randomBackgroundColor(this.username.length,this.backgroundColors)},fontColor:function(){if(!this.isImage)return this.color||this.lightenColor(this.background,this.lighten)},isImage:function(){return!this.imgError&&Boolean(this.src)},style:function(){var e={display:this.inline?"inline-flex":"flex",width:this.size+"px",height:this.size+"px",borderRadius:this.rounded?"50%":0,lineHeight:this.size+Math.floor(this.size/20)+"px",fontWeight:"bold",alignItems:"center",justifyContent:"center",textAlign:"center",userSelect:"none"},t={background:"transparent url('"+this.src+"') no-repeat scroll 0% 0% / "+this.size+"px "+this.size+"px content-box border-box"},n={backgroundColor:this.background,font:Math.floor(this.size/2.5)+"px/"+this.size+"px Helvetica, Arial, sans-serif",color:this.fontColor},i=this.isImage?t:n;return(0,r.default)(e,i),e},userInitial:function(){return this.isImage?"":this.initials||this.parser(this.username,o)}},methods:{initial:o,onImgError:function(e){this.imgError=!0},randomBackgroundColor:function(e,t){return t[e%t.length]},lightenColor:function(e,t){var n=!1;"#"===e[0]&&(e=e.slice(1),n=!0);var i=parseInt(e,16),r=(i>>16)+t;r>255?r=255:r<0&&(r=0);var o=(i>>8&255)+t;o>255?o=255:o<0&&(o=0);var s=(255&i)+t;return s>255?s=255:s<0&&(s=0),(n?"#":"")+(s|o<<8|r<<16).toString(16)}}}},function(e,t,n){e.exports={default:n(14),__esModule:!0}},function(e,t,n){n(15),e.exports=n(4).Object.assign},function(e,t,n){var i=n(16);i(i.S+i.F,"Object",{assign:n(26)})},function(e,t,n){var i=n(0),r=n(4),o=n(17),s=n(19),a=function(e,t,n){var c,l,u,d=e&a.F,h=e&a.G,p=e&a.S,f=e&a.P,m=e&a.B,v=e&a.W,g=h?r:r[t]||(r[t]={}),E=g.prototype,b=h?i:p?i[t]:(i[t]||{}).prototype;for(c in h&&(n=t),n)(l=!d&&b&&void 0!==b[c])&&c in g||(u=l?b[c]:n[c],g[c]=h&&"function"!=typeof b[c]?n[c]:m&&l?o(u,i):v&&b[c]==u?function(e){var t=function(t,n,i){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,i)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(u):f&&"function"==typeof u?o(Function.call,u):u,f&&((g.virtual||(g.virtual={}))[c]=u,e&a.R&&E&&!E[c]&&s(E,c,u)))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,e.exports=a},function(e,t,n){var i=n(18);e.exports=function(e,t,n){if(i(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var i=n(20),r=n(25);e.exports=n(2)?function(e,t,n){return i.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var i=n(21),r=n(22),o=n(24),s=Object.defineProperty;t.f=n(2)?Object.defineProperty:function(e,t,n){if(i(e),t=o(t,!0),i(n),r)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var i=n(1);e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){e.exports=!n(2)&&!n(3)((function(){return 7!=Object.defineProperty(n(23)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var i=n(1),r=n(0).document,o=i(r)&&i(r.createElement);e.exports=function(e){return o?r.createElement(e):{}}},function(e,t,n){var i=n(1);e.exports=function(e,t){if(!i(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!i(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){"use strict";var i=n(27),r=n(38),o=n(39),s=n(40),a=n(6),c=Object.assign;e.exports=!c||n(3)((function(){var e={},t={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach((function(e){t[e]=e})),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=i}))?function(e,t){for(var n=s(e),c=arguments.length,l=1,u=r.f,d=o.f;c>l;)for(var h,p=a(arguments[l++]),f=u?i(p).concat(u(p)):i(p),m=f.length,v=0;m>v;)d.call(p,h=f[v++])&&(n[h]=p[h]);return n}:c},function(e,t,n){var i=n(28),r=n(37);e.exports=Object.keys||function(e){return i(e,r)}},function(e,t,n){var i=n(29),r=n(5),o=n(31)(!1),s=n(34)("IE_PROTO");e.exports=function(e,t){var n,a=r(e),c=0,l=[];for(n in a)n!=s&&i(a,n)&&l.push(n);for(;t.length>c;)i(a,n=t[c++])&&(~o(l,n)||l.push(n));return l}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var i=n(5),r=n(32),o=n(33);e.exports=function(e){return function(t,n,s){var a,c=i(t),l=r(c.length),u=o(s,l);if(e&&n!=n){for(;l>u;)if((a=c[u++])!=a)return!0}else for(;l>u;u++)if((e||u in c)&&c[u]===n)return e||u||0;return!e&&-1}}},function(e,t,n){var i=n(8),r=Math.min;e.exports=function(e){return e>0?r(i(e),9007199254740991):0}},function(e,t,n){var i=n(8),r=Math.max,o=Math.min;e.exports=function(e,t){return e=i(e),e<0?r(e+t,0):o(e,t)}},function(e,t,n){var i=n(35)("keys"),r=n(36);e.exports=function(e){return i[e]||(i[e]=r(e))}},function(e,t,n){var i=n(0),r=i["__core-js_shared__"]||(i["__core-js_shared__"]={});e.exports=function(e){return r[e]||(r[e]={})}},function(e,t){var n=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var i=n(7);e.exports=function(e){return Object(i(e))}},function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"vue-avatar--wrapper",style:[e.style,e.customStyle],attrs:{"aria-hidden":"true"}},[this.isImage?n("img",{staticStyle:{display:"none"},attrs:{src:this.src},on:{error:e.onImgError}}):e._e(),e._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:!this.isImage,expression:"!this.isImage"}]},[e._v(e._s(e.userInitial))])])},r=[],o={render:i,staticRenderFns:r};t.a=o}])}))},"4def":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.StreamEvent=void 0;var r=n("8733"),o=n("3c4c"),s=n("2533"),a=n("f66e"),c=a.OpenViduLogger.getInstance(),l=function(e){function t(t,n,i,r,o){var s=e.call(this,t,n,i)||this;return s.stream=r,s.reason=o,s}return i(t,e),t.prototype.callDefaultBehavior=function(){if("streamDestroyed"===this.type){if(this.target instanceof s.Session)c.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'"),this.stream.disposeWebRtcPeer();else if(this.target instanceof o.Publisher){c.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Publisher'"),clearInterval(this.target.screenShareResizeInterval),this.stream.isLocalStreamReadyToPublish=!1;for(var e=this.target.openvidu.publishers,t=0;t<e.length;t++)if(e[t]===this.target){e.splice(t,1);break}}this.stream.disposeMediaStream(),this.stream.streamManager&&this.stream.streamManager.removeAllVideos(),this.stream.session.remoteStreamsCreated.delete(this.stream.streamId);var n=this.stream.session.remoteConnections.get(this.stream.connection.connectionId);if(n&&n.remoteOptions){var i=n.remoteOptions.streams;for(t=i.length-1;t>=0;--t)i[t].id===this.stream.streamId&&i.splice(t,1)}}},t}(r.Event);t.StreamEvent=l},"4e82":function(e,t,n){"use strict";var i=n("23e7"),r=n("1c0b"),o=n("7b0b"),s=n("d039"),a=n("a640"),c=[],l=c.sort,u=s((function(){c.sort(void 0)})),d=s((function(){c.sort(null)})),h=a("sort"),p=u||!d||!h;i({target:"Array",proto:!0,forced:p},{sort:function(e){return void 0===e?l.call(o(this)):l.call(o(this),r(e))}})},"4ec5":function(e,t,n){const{MAX_SAFE_COMPONENT_LENGTH:i}=n("85cd"),r=n("aaf5");t=e.exports={};const o=t.re=[],s=t.src=[],a=t.t={};let c=0;const l=(e,t,n)=>{const i=c++;r(e,i,t),a[e]=i,s[i]=t,o[i]=new RegExp(t,n?"g":void 0)};l("NUMERICIDENTIFIER","0|[1-9]\\d*"),l("NUMERICIDENTIFIERLOOSE","[0-9]+"),l("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),l("MAINVERSION",`(${s[a.NUMERICIDENTIFIER]})\\.(${s[a.NUMERICIDENTIFIER]})\\.(${s[a.NUMERICIDENTIFIER]})`),l("MAINVERSIONLOOSE",`(${s[a.NUMERICIDENTIFIERLOOSE]})\\.(${s[a.NUMERICIDENTIFIERLOOSE]})\\.(${s[a.NUMERICIDENTIFIERLOOSE]})`),l("PRERELEASEIDENTIFIER",`(?:${s[a.NUMERICIDENTIFIER]}|${s[a.NONNUMERICIDENTIFIER]})`),l("PRERELEASEIDENTIFIERLOOSE",`(?:${s[a.NUMERICIDENTIFIERLOOSE]}|${s[a.NONNUMERICIDENTIFIER]})`),l("PRERELEASE",`(?:-(${s[a.PRERELEASEIDENTIFIER]}(?:\\.${s[a.PRERELEASEIDENTIFIER]})*))`),l("PRERELEASELOOSE",`(?:-?(${s[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${s[a.PRERELEASEIDENTIFIERLOOSE]})*))`),l("BUILDIDENTIFIER","[0-9A-Za-z-]+"),l("BUILD",`(?:\\+(${s[a.BUILDIDENTIFIER]}(?:\\.${s[a.BUILDIDENTIFIER]})*))`),l("FULLPLAIN",`v?${s[a.MAINVERSION]}${s[a.PRERELEASE]}?${s[a.BUILD]}?`),l("FULL",`^${s[a.FULLPLAIN]}$`),l("LOOSEPLAIN",`[v=\\s]*${s[a.MAINVERSIONLOOSE]}${s[a.PRERELEASELOOSE]}?${s[a.BUILD]}?`),l("LOOSE",`^${s[a.LOOSEPLAIN]}$`),l("GTLT","((?:<|>)?=?)"),l("XRANGEIDENTIFIERLOOSE",s[a.NUMERICIDENTIFIERLOOSE]+"|x|X|\\*"),l("XRANGEIDENTIFIER",s[a.NUMERICIDENTIFIER]+"|x|X|\\*"),l("XRANGEPLAIN",`[v=\\s]*(${s[a.XRANGEIDENTIFIER]})(?:\\.(${s[a.XRANGEIDENTIFIER]})(?:\\.(${s[a.XRANGEIDENTIFIER]})(?:${s[a.PRERELEASE]})?${s[a.BUILD]}?)?)?`),l("XRANGEPLAINLOOSE",`[v=\\s]*(${s[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[a.XRANGEIDENTIFIERLOOSE]})(?:${s[a.PRERELEASELOOSE]})?${s[a.BUILD]}?)?)?`),l("XRANGE",`^${s[a.GTLT]}\\s*${s[a.XRANGEPLAIN]}$`),l("XRANGELOOSE",`^${s[a.GTLT]}\\s*${s[a.XRANGEPLAINLOOSE]}$`),l("COERCE",`(^|[^\\d])(\\d{1,${i}})(?:\\.(\\d{1,${i}}))?(?:\\.(\\d{1,${i}}))?(?:$|[^\\d])`),l("COERCERTL",s[a.COERCE],!0),l("LONETILDE","(?:~>?)"),l("TILDETRIM",`(\\s*)${s[a.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",l("TILDE",`^${s[a.LONETILDE]}${s[a.XRANGEPLAIN]}$`),l("TILDELOOSE",`^${s[a.LONETILDE]}${s[a.XRANGEPLAINLOOSE]}$`),l("LONECARET","(?:\\^)"),l("CARETTRIM",`(\\s*)${s[a.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",l("CARET",`^${s[a.LONECARET]}${s[a.XRANGEPLAIN]}$`),l("CARETLOOSE",`^${s[a.LONECARET]}${s[a.XRANGEPLAINLOOSE]}$`),l("COMPARATORLOOSE",`^${s[a.GTLT]}\\s*(${s[a.LOOSEPLAIN]})$|^$`),l("COMPARATOR",`^${s[a.GTLT]}\\s*(${s[a.FULLPLAIN]})$|^$`),l("COMPARATORTRIM",`(\\s*)${s[a.GTLT]}\\s*(${s[a.LOOSEPLAIN]}|${s[a.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",l("HYPHENRANGE",`^\\s*(${s[a.XRANGEPLAIN]})\\s+-\\s+(${s[a.XRANGEPLAIN]})\\s*$`),l("HYPHENRANGELOOSE",`^\\s*(${s[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${s[a.XRANGEPLAINLOOSE]})\\s*$`),l("STAR","(<|>)?=?\\s*\\*"),l("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),l("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},"4ec9":function(e,t,n){"use strict";var i=n("6d61"),r=n("6566");e.exports=i("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r)},"4edf":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenViduError=t.OpenViduErrorName=void 0,function(e){e["BROWSER_NOT_SUPPORTED"]="BROWSER_NOT_SUPPORTED",e["DEVICE_ACCESS_DENIED"]="DEVICE_ACCESS_DENIED",e["DEVICE_ALREADY_IN_USE"]="DEVICE_ALREADY_IN_USE",e["SCREEN_CAPTURE_DENIED"]="SCREEN_CAPTURE_DENIED",e["SCREEN_SHARING_NOT_SUPPORTED"]="SCREEN_SHARING_NOT_SUPPORTED",e["SCREEN_EXTENSION_NOT_INSTALLED"]="SCREEN_EXTENSION_NOT_INSTALLED",e["SCREEN_EXTENSION_DISABLED"]="SCREEN_EXTENSION_DISABLED",e["INPUT_VIDEO_DEVICE_NOT_FOUND"]="INPUT_VIDEO_DEVICE_NOT_FOUND",e["INPUT_AUDIO_DEVICE_NOT_FOUND"]="INPUT_AUDIO_DEVICE_NOT_FOUND",e["INPUT_AUDIO_DEVICE_GENERIC_ERROR"]="INPUT_AUDIO_DEVICE_GENERIC_ERROR",e["NO_INPUT_SOURCE_SET"]="NO_INPUT_SOURCE_SET",e["PUBLISHER_PROPERTIES_ERROR"]="PUBLISHER_PROPERTIES_ERROR",e["OPENVIDU_PERMISSION_DENIED"]="OPENVIDU_PERMISSION_DENIED",e["OPENVIDU_NOT_CONNECTED"]="OPENVIDU_NOT_CONNECTED",e["VIRTUAL_BACKGROUND_ERROR"]="VIRTUAL_BACKGROUND_ERROR",e["GENERIC_ERROR"]="GENERIC_ERROR"}(t.OpenViduErrorName||(t.OpenViduErrorName={}));var i=function(){function e(e,t){this.name=e,this.message=t}return e}();t.OpenViduError=i},"5fb2":function(e,t,n){"use strict";var i=2147483647,r=36,o=1,s=26,a=38,c=700,l=72,u=128,d="-",h=/[^\0-\u007E]/,p=/[.\u3002\uFF0E\uFF61]/g,f="Overflow: input needs wider integers to process",m=r-o,v=Math.floor,g=String.fromCharCode,E=function(e){var t=[],n=0,i=e.length;while(n<i){var r=e.charCodeAt(n++);if(r>=55296&&r<=56319&&n<i){var o=e.charCodeAt(n++);56320==(64512&o)?t.push(((1023&r)<<10)+(1023&o)+65536):(t.push(r),n--)}else t.push(r)}return t},b=function(e){return e+22+75*(e<26)},y=function(e,t,n){var i=0;for(e=n?v(e/c):e>>1,e+=v(e/t);e>m*s>>1;i+=r)e=v(e/m);return v(i+(m+1)*e/(e+a))},S=function(e){var t=[];e=E(e);var n,a,c=e.length,h=u,p=0,m=l;for(n=0;n<e.length;n++)a=e[n],a<128&&t.push(g(a));var S=t.length,w=S;S&&t.push(d);while(w<c){var C=i;for(n=0;n<e.length;n++)a=e[n],a>=h&&a<C&&(C=a);var O=w+1;if(C-h>v((i-p)/O))throw RangeError(f);for(p+=(C-h)*O,h=C,n=0;n<e.length;n++){if(a=e[n],a<h&&++p>i)throw RangeError(f);if(a==h){for(var x=p,R=r;;R+=r){var I=R<=m?o:R>=m+s?s:R-m;if(x<I)break;var T=x-I,P=r-I;t.push(g(b(I+T%P))),x=v(T/P)}t.push(g(b(x))),m=y(p,O,w==S),p=0,++w}}++p,++h}return t.join("")};e.exports=function(e){var t,n,i=[],r=e.toLowerCase().replace(p,".").split(".");for(t=0;t<r.length;t++)n=r[t],i.push(h.test(n)?"xn--"+S(n):n);return i.join(".")}},"621a":function(e,t,n){"use strict";var i=n("da84"),r=n("83ab"),o=n("a981"),s=n("9112"),a=n("e2cc"),c=n("d039"),l=n("19aa"),u=n("a691"),d=n("50c4"),h=n("0b25"),p=n("77a7"),f=n("e163"),m=n("d2bb"),v=n("241c").f,g=n("9bf2").f,E=n("81d5"),b=n("d44e"),y=n("69f3"),S=y.get,w=y.set,C="ArrayBuffer",O="DataView",x="prototype",R="Wrong length",I="Wrong index",T=i[C],P=T,k=i[O],_=k&&k[x],L=Object.prototype,A=i.RangeError,N=p.pack,M=p.unpack,D=function(e){return[255&e]},V=function(e){return[255&e,e>>8&255]},B=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},j=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},F=function(e){return N(e,23,4)},U=function(e){return N(e,52,8)},z=function(e,t){g(e[x],t,{get:function(){return S(this)[t]}})},H=function(e,t,n,i){var r=h(n),o=S(e);if(r+t>o.byteLength)throw A(I);var s=S(o.buffer).bytes,a=r+o.byteOffset,c=s.slice(a,a+t);return i?c:c.reverse()},W=function(e,t,n,i,r,o){var s=h(n),a=S(e);if(s+t>a.byteLength)throw A(I);for(var c=S(a.buffer).bytes,l=s+a.byteOffset,u=i(+r),d=0;d<t;d++)c[l+d]=u[o?d:t-d-1]};if(o){if(!c((function(){T(1)}))||!c((function(){new T(-1)}))||c((function(){return new T,new T(1.5),new T(NaN),T.name!=C}))){P=function(e){return l(this,P),new T(h(e))};for(var G,X=P[x]=T[x],q=v(T),J=0;q.length>J;)(G=q[J++])in P||s(P,G,T[G]);X.constructor=P}m&&f(_)!==L&&m(_,L);var $=new k(new P(2)),Y=_.setInt8;$.setInt8(0,2147483648),$.setInt8(1,2147483649),!$.getInt8(0)&&$.getInt8(1)||a(_,{setInt8:function(e,t){Y.call(this,e,t<<24>>24)},setUint8:function(e,t){Y.call(this,e,t<<24>>24)}},{unsafe:!0})}else P=function(e){l(this,P,C);var t=h(e);w(this,{bytes:E.call(new Array(t),0),byteLength:t}),r||(this.byteLength=t)},k=function(e,t,n){l(this,k,O),l(e,P,O);var i=S(e).byteLength,o=u(t);if(o<0||o>i)throw A("Wrong offset");if(n=void 0===n?i-o:d(n),o+n>i)throw A(R);w(this,{buffer:e,byteLength:n,byteOffset:o}),r||(this.buffer=e,this.byteLength=n,this.byteOffset=o)},r&&(z(P,"byteLength"),z(k,"buffer"),z(k,"byteLength"),z(k,"byteOffset")),a(k[x],{getInt8:function(e){return H(this,1,e)[0]<<24>>24},getUint8:function(e){return H(this,1,e)[0]},getInt16:function(e){var t=H(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=H(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return j(H(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return j(H(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return M(H(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return M(H(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){W(this,1,e,D,t)},setUint8:function(e,t){W(this,1,e,D,t)},setInt16:function(e,t){W(this,2,e,V,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){W(this,2,e,V,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){W(this,4,e,B,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){W(this,4,e,B,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){W(this,4,e,F,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){W(this,8,e,U,t,arguments.length>2?arguments[2]:void 0)}});b(P,C),b(k,O),e.exports={ArrayBuffer:P,DataView:k}},"627d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalRecorderState=void 0,function(e){e["READY"]="READY",e["RECORDING"]="RECORDING",e["PAUSED"]="PAUSED",e["FINISHED"]="FINISHED"}(t.LocalRecorderState||(t.LocalRecorderState={}))},"62e4":function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},"68cb":function(e,t,n){var i,r=n("a7b3");function o(e,t){var n=-1/0;e.getFloatFrequencyData(t);for(var i=4,r=t.length;i<r;i++)t[i]>n&&t[i]<0&&(n=t[i]);return n}"undefined"!==typeof window&&(i=window.AudioContext||window.webkitAudioContext);var s=null;e.exports=function(e,t){var n=new r;if(!i)return n;t=t||{};var a,c,l,u=t.smoothing||.1,d=t.interval||50,h=t.threshold,p=t.play,f=t.history||10,m=!0;s=t.audioContext||s||new i,l=s.createAnalyser(),l.fftSize=512,l.smoothingTimeConstant=u,c=new Float32Array(l.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(a=s.createMediaElementSource(e),"undefined"===typeof p&&(p=!0),h=h||-50):(a=s.createMediaStreamSource(e),h=h||-50),a.connect(l),p&&l.connect(s.destination),n.speaking=!1,n.suspend=function(){return s.suspend()},n.resume=function(){return s.resume()},Object.defineProperty(n,"state",{get:function(){return s.state}}),s.onstatechange=function(){n.emit("state_change",s.state)},n.setThreshold=function(e){h=e},n.setInterval=function(e){d=e},n.stop=function(){m=!1,n.emit("volume_change",-100,h),n.speaking&&(n.speaking=!1,n.emit("stopped_speaking")),l.disconnect(),a.disconnect()},n.speakingHistory=[];for(var v=0;v<f;v++)n.speakingHistory.push(0);var g=function(){setTimeout((function(){if(m){var e=o(l,c);n.emit("volume_change",e,h);var t=0;if(e>h&&!n.speaking){for(var i=n.speakingHistory.length-3;i<n.speakingHistory.length;i++)t+=n.speakingHistory[i];t>=2&&(n.speaking=!0,n.emit("speaking"))}else if(e<h&&n.speaking){for(i=0;i<n.speakingHistory.length;i++)t+=n.speakingHistory[i];0==t&&(n.speaking=!1,n.emit("stopped_speaking"))}n.speakingHistory.shift(),n.speakingHistory.push(0+(e>h)),g()}}),d)};return g(),n}},"6c8b":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"6e4e":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Subscriber=void 0;var r=n("3f7b"),o=n("f66e"),s=o.OpenViduLogger.getInstance(),a=function(e){function t(t,n,i){var r=e.call(this,t,n)||this;return r.element=r.targetElement,r.stream=t,r.properties=i,r}return i(t,e),t.prototype.subscribeToAudio=function(e){return this.stream.getMediaStream().getAudioTracks().forEach((function(t){t.enabled=e})),this.stream.audioActive=e,s.info("'Subscriber' has "+(e?"subscribed to":"unsubscribed from")+" its audio stream"),this},t.prototype.subscribeToVideo=function(e){return this.stream.getMediaStream().getVideoTracks().forEach((function(t){t.enabled=e})),this.stream.videoActive=e,s.info("'Subscriber' has "+(e?"subscribed to":"unsubscribed from")+" its video stream"),this},t.prototype.replaceTrackInMediaStream=function(e,t){var n,i=this.stream.getMediaStream();"video"===e.kind?(n=i.getVideoTracks()[0],t&&(this.stream.lastVideoTrackConstraints=e.getConstraints())):n=i.getAudioTracks()[0],i.removeTrack(n),n.stop(),i.addTrack(e)},t}(r.StreamManager);t.Subscriber=a},"714c":function(e,t,n){"use strict";var i=n("f66e").OpenViduLogger,r=i.getInstance(),o=2e3,s=3e3,a=3;function c(e){var t,n=!1,i=e.uri,c=!1,l=new WebSocket(i);l.onopen=function(){r.debug("WebSocket connected to "+i),e.onconnected&&e.onconnected()},l.onerror=function(t){r.error("Could not connect to "+i+" (invoking onerror if defined)",t),e.onerror&&e.onerror(t)};var u=function(){l.readyState===a?n?r.debug("Connection closed by user"):e.ismasternodecrashed()?r.error("Master Node has crashed. Stopping reconnection process"):(r.debug("Connection closed unexpectedly. Reconnecting..."),d(o,1)):r.debug("Close callback from previous websocket. Ignoring it")};function d(t,n){if(r.debug("reconnect (attempt #"+n+", max="+t+")"),1===n){if(c)return void r.warn("Trying to reconnect when already reconnecting... Ignoring this reconnection.");c=!0,e.onreconnecting&&e.onreconnecting()}p(t,n)}function h(e){var t=new URLSearchParams(new URL(e).search);return t.has("reconnect")||(e=Array.from(t).length>0?e+"&reconnect=true":e+"?reconnect=true"),e}function p(n,o){r.debug("Reconnection attempt #"+o),l.close(4104,"Connection closed for reconnection"),i=h(i),l=new WebSocket(i),l.onopen=function(){r.debug("Reconnected to "+i+" after "+o+" attempts..."),c=!1,t(),e.onreconnected()&&e.onreconnected(),l.onclose=u},l.onerror=function(t){r.warn("Reconnection error: ",t),o===n?e.ondisconnect&&e.ondisconnect():setTimeout((function(){d(n,o+1)}),s)}}l.onclose=u,this.close=function(e,t){n=!0,l.close(e,t)},this.reconnectWs=function(){r.debug("reconnectWs"),d(o,1)},this.send=function(e){l.send(e)},this.addEventListener=function(e,n){t=function(){l.addEventListener(e,n)},t()},this.getReadyState=function(){return l.readyState}}e.exports=c},"75ee":function(e,t){function n(e,t){var n={jsonrpc:"2.0"};if(e.method)n.method=e.method,e.params&&(n.params=e.params),void 0!=t&&(n.id=t);else if(void 0!=t){if(e.error){if(void 0!==e.result)throw new TypeError("Both result and error are defined");n.error=e.error}else{if(void 0===e.result)throw new TypeError("No result or error is defined");n.result=e.result}n.id=t}return JSON.stringify(n)}function i(e){var t=e;("string"===typeof e||e instanceof String)&&(t=JSON.parse(e));var n=t.jsonrpc;if("2.0"!==n)throw new TypeError("Invalid JsonRPC version '"+n+"': "+e);if(void 0==t.method){if(void 0==t.id)throw new TypeError("Invalid message: "+e);var i=void 0!==t.result,r=void 0!==t.error;if(i&&r)throw new TypeError("Both result and error are defined: "+e);if(!i&&!r)throw new TypeError("No result or error is defined: "+e);t.ack=t.id,delete t.id}return t}t.pack=n,t.unpack=i},"77a7":function(e,t){var n=1/0,i=Math.abs,r=Math.pow,o=Math.floor,s=Math.log,a=Math.LN2,c=function(e,t,c){var l,u,d,h=new Array(c),p=8*c-t-1,f=(1<<p)-1,m=f>>1,v=23===t?r(2,-24)-r(2,-77):0,g=e<0||0===e&&1/e<0?1:0,E=0;for(e=i(e),e!=e||e===n?(u=e!=e?1:0,l=f):(l=o(s(e)/a),e*(d=r(2,-l))<1&&(l--,d*=2),e+=l+m>=1?v/d:v*r(2,1-m),e*d>=2&&(l++,d/=2),l+m>=f?(u=0,l=f):l+m>=1?(u=(e*d-1)*r(2,t),l+=m):(u=e*r(2,m-1)*r(2,t),l=0));t>=8;h[E++]=255&u,u/=256,t-=8);for(l=l<<t|u,p+=t;p>0;h[E++]=255&l,l/=256,p-=8);return h[--E]|=128*g,h},l=function(e,t){var i,o=e.length,s=8*o-t-1,a=(1<<s)-1,c=a>>1,l=s-7,u=o-1,d=e[u--],h=127&d;for(d>>=7;l>0;h=256*h+e[u],u--,l-=8);for(i=h&(1<<-l)-1,h>>=-l,l+=t;l>0;i=256*i+e[u],u--,l-=8);if(0===h)h=1-c;else{if(h===a)return i?NaN:d?-n:n;i+=r(2,t),h-=c}return(d?-1:1)*i*r(2,h-t)};e.exports={pack:c,unpack:l}},"79ef":function(e,t,n){var i=n("714c");t.WebSocketWithReconnection=i},"7bca":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.PublisherSpeakingEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r){var o=e.call(this,!1,t,n)||this;return o.type=n,o.connection=i,o.streamId=r,o}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.PublisherSpeakingEvent=o},"7e99":function(e,t){const n=["includePrerelease","loose","rtl"],i=e=>e?"object"!==typeof e?{loose:!0}:n.filter(t=>e[t]).reduce((e,t)=>(e[t]=!0,e),{}):{};e.exports=i},8140:function(e,t){function n(){var e={};this.forEach=function(t){for(var n in e){var i=e[n];for(var r in i)t(i[r])}},this.get=function(t,n){var i=e[n];if(void 0!=i)return i[t]},this.remove=function(t,n){var i=e[n];if(void 0!=i){for(var r in delete i[t],i)return!1;delete e[n]}},this.set=function(t,n,i){if(void 0==t)return this.remove(n,i);var r=e[i];void 0==r&&(e[i]=r={}),r[n]=t}}n.prototype.pop=function(e,t){var n=this.get(e,t);if(void 0!=n)return this.remove(e,t),n},e.exports=n},"81d5":function(e,t,n){"use strict";var i=n("7b0b"),r=n("23cb"),o=n("50c4");e.exports=function(e){var t=i(this),n=o(t.length),s=arguments.length,a=r(s>1?arguments[1]:void 0,n),c=s>2?arguments[2]:void 0,l=void 0===c?n:r(c,n);while(l>a)t[a++]=e;return t}},"85cd":function(e,t){const n="2.0.0",i=256,r=Number.MAX_SAFE_INTEGER||9007199254740991,o=16;e.exports={SEMVER_SPEC_VERSION:n,MAX_LENGTH:i,MAX_SAFE_INTEGER:r,MAX_SAFE_COMPONENT_LENGTH:o}},8733:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Event=void 0;var i=function(){function e(e,t,n){this.hasBeenPrevented=!1,this.cancelable=e,this.target=t,this.type=n}return e.prototype.isDefaultPrevented=function(){return this.hasBeenPrevented},e.prototype.preventDefault=function(){this.callDefaultBehavior=function(){},this.hasBeenPrevented=!0},e}();t.Event=i},"8a79":function(e,t,n){"use strict";var i=n("23e7"),r=n("06cf").f,o=n("50c4"),s=n("5a34"),a=n("1d80"),c=n("ab13"),l=n("c430"),u="".endsWith,d=Math.min,h=c("endsWith"),p=!l&&!h&&!!function(){var e=r(String.prototype,"endsWith");return e&&!e.writable}();i({target:"String",proto:!0,forced:!p&&!h},{endsWith:function(e){var t=String(a(this));s(e);var n=arguments.length>1?arguments[1]:void 0,i=o(t.length),r=void 0===n?i:d(o(n),i),c=String(e);return u?u.call(t,c,r):t.slice(r-c.length,r)===c}})},"92c2":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.SessionDisconnectedEvent=void 0;var r=n("8733"),o=n("f66e"),s=o.OpenViduLogger.getInstance(),a=function(e){function t(t,n){var i=e.call(this,!0,t,"sessionDisconnected")||this;return i.reason=n,i}return i(t,e),t.prototype.callDefaultBehavior=function(){s.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'");var e=this.target;e.remoteConnections.forEach((function(t){var n,i,r,o,s,a,c,l,u=t.connectionId;if(null===(n=e.remoteConnections.get(u))||void 0===n?void 0:n.stream){null===(i=e.remoteConnections.get(u))||void 0===i||i.stream.disposeWebRtcPeer(),null===(r=e.remoteConnections.get(u))||void 0===r||r.stream.disposeMediaStream(),(null===(o=e.remoteConnections.get(u))||void 0===o?void 0:o.stream.streamManager)&&(null===(s=e.remoteConnections.get(u))||void 0===s||s.stream.streamManager.removeAllVideos());var d=null===(c=null===(a=e.remoteConnections.get(u))||void 0===a?void 0:a.stream)||void 0===c?void 0:c.streamId;d&&e.remoteStreamsCreated.delete(d),null===(l=e.remoteConnections.get(u))||void 0===l||l.dispose()}e.remoteConnections.delete(u)}))},t}(r.Event);t.SessionDisconnectedEvent=a},"93ed":function(e,t){const n=/^[0-9]+$/,i=(e,t)=>{const i=n.test(e),r=n.test(t);return i&&r&&(e=+e,t=+t),e===t?0:i&&!r?-1:r&&!i?1:e<t?-1:1},r=(e,t)=>i(t,e);e.exports={compareIdentifiers:i,rcompareIdentifiers:r}},9861:function(e,t,n){"use strict";n("e260");var i=n("23e7"),r=n("d066"),o=n("0d3b"),s=n("6eeb"),a=n("e2cc"),c=n("d44e"),l=n("9ed3"),u=n("69f3"),d=n("19aa"),h=n("5135"),p=n("0366"),f=n("f5df"),m=n("825a"),v=n("861d"),g=n("7c73"),E=n("5c6c"),b=n("9a1f"),y=n("35a1"),S=n("b622"),w=r("fetch"),C=r("Headers"),O=S("iterator"),x="URLSearchParams",R=x+"Iterator",I=u.set,T=u.getterFor(x),P=u.getterFor(R),k=/\+/g,_=Array(4),L=function(e){return _[e-1]||(_[e-1]=RegExp("((?:%[\\da-f]{2}){"+e+"})","gi"))},A=function(e){try{return decodeURIComponent(e)}catch(t){return e}},N=function(e){var t=e.replace(k," "),n=4;try{return decodeURIComponent(t)}catch(i){while(n)t=t.replace(L(n--),A);return t}},M=/[!'()~]|%20/g,D={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},V=function(e){return D[e]},B=function(e){return encodeURIComponent(e).replace(M,V)},j=function(e,t){if(t){var n,i,r=t.split("&"),o=0;while(o<r.length)n=r[o++],n.length&&(i=n.split("="),e.push({key:N(i.shift()),value:N(i.join("="))}))}},F=function(e){this.entries.length=0,j(this.entries,e)},U=function(e,t){if(e<t)throw TypeError("Not enough arguments")},z=l((function(e,t){I(this,{type:R,iterator:b(T(e).entries),kind:t})}),"Iterator",(function(){var e=P(this),t=e.kind,n=e.iterator.next(),i=n.value;return n.done||(n.value="keys"===t?i.key:"values"===t?i.value:[i.key,i.value]),n})),H=function(){d(this,H,x);var e,t,n,i,r,o,s,a,c,l=arguments.length>0?arguments[0]:void 0,u=this,p=[];if(I(u,{type:x,entries:p,updateURL:function(){},updateSearchParams:F}),void 0!==l)if(v(l))if(e=y(l),"function"===typeof e){t=e.call(l),n=t.next;while(!(i=n.call(t)).done){if(r=b(m(i.value)),o=r.next,(s=o.call(r)).done||(a=o.call(r)).done||!o.call(r).done)throw TypeError("Expected sequence with length 2");p.push({key:s.value+"",value:a.value+""})}}else for(c in l)h(l,c)&&p.push({key:c,value:l[c]+""});else j(p,"string"===typeof l?"?"===l.charAt(0)?l.slice(1):l:l+"")},W=H.prototype;a(W,{append:function(e,t){U(arguments.length,2);var n=T(this);n.entries.push({key:e+"",value:t+""}),n.updateURL()},delete:function(e){U(arguments.length,1);var t=T(this),n=t.entries,i=e+"",r=0;while(r<n.length)n[r].key===i?n.splice(r,1):r++;t.updateURL()},get:function(e){U(arguments.length,1);for(var t=T(this).entries,n=e+"",i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){U(arguments.length,1);for(var t=T(this).entries,n=e+"",i=[],r=0;r<t.length;r++)t[r].key===n&&i.push(t[r].value);return i},has:function(e){U(arguments.length,1);var t=T(this).entries,n=e+"",i=0;while(i<t.length)if(t[i++].key===n)return!0;return!1},set:function(e,t){U(arguments.length,1);for(var n,i=T(this),r=i.entries,o=!1,s=e+"",a=t+"",c=0;c<r.length;c++)n=r[c],n.key===s&&(o?r.splice(c--,1):(o=!0,n.value=a));o||r.push({key:s,value:a}),i.updateURL()},sort:function(){var e,t,n,i=T(this),r=i.entries,o=r.slice();for(r.length=0,n=0;n<o.length;n++){for(e=o[n],t=0;t<n;t++)if(r[t].key>e.key){r.splice(t,0,e);break}t===n&&r.push(e)}i.updateURL()},forEach:function(e){var t,n=T(this).entries,i=p(e,arguments.length>1?arguments[1]:void 0,3),r=0;while(r<n.length)t=n[r++],i(t.value,t.key,this)},keys:function(){return new z(this,"keys")},values:function(){return new z(this,"values")},entries:function(){return new z(this,"entries")}},{enumerable:!0}),s(W,O,W.entries),s(W,"toString",(function(){var e,t=T(this).entries,n=[],i=0;while(i<t.length)e=t[i++],n.push(B(e.key)+"="+B(e.value));return n.join("&")}),{enumerable:!0}),c(H,x),i({global:!0,forced:!o},{URLSearchParams:H}),o||"function"!=typeof w||"function"!=typeof C||i({global:!0,enumerable:!0,forced:!0},{fetch:function(e){var t,n,i,r=[e];return arguments.length>1&&(t=arguments[1],v(t)&&(n=t.body,f(n)===x&&(i=t.headers?new C(t.headers):new C,i.has("content-type")||i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),t=g(t,{body:E(0,String(n)),headers:E(0,i)}))),r.push(t)),w.apply(this,r)}}),e.exports={URLSearchParams:H,getState:T}},9923:function(e,t,n){const i=n("aaf5"),{MAX_LENGTH:r,MAX_SAFE_INTEGER:o}=n("85cd"),{re:s,t:a}=n("4ec5"),c=n("7e99"),{compareIdentifiers:l}=n("93ed");class u{constructor(e,t){if(t=c(t),e instanceof u){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!==typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>r)throw new TypeError(`version is longer than ${r} characters`);i("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?s[a.LOOSE]:s[a.FULL]);if(!n)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<o)return t}return e}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version}toString(){return this.version}compare(e){if(i("SemVer.compare",this.version,this.options,e),!(e instanceof u)){if("string"===typeof e&&e===this.version)return 0;e=new u(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof u||(e=new u(e,this.options)),l(this.major,e.major)||l(this.minor,e.minor)||l(this.patch,e.patch)}comparePre(e){if(e instanceof u||(e=new u(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],r=e.prerelease[t];if(i("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return l(n,r)}while(++t)}compareBuild(e){e instanceof u||(e=new u(e,this.options));let t=0;do{const n=this.build[t],r=e.build[t];if(i("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return l(n,r)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;while(--e>=0)"number"===typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(0===l(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this}}e.exports=u},"9a1f":function(e,t,n){var i=n("825a"),r=n("35a1");e.exports=function(e){var t=r(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return i(t.call(e))}},a081:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.VideoElementEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i){var r=e.call(this,!1,n,i)||this;return r.element=t,r}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.VideoElementEvent=o},a21b:function(e,t){var n=["stun:","turn:"];e.exports=function(e){var t,i,r=(e||{}).url||e,o={};return"string"==typeof r||r instanceof String?(r=r.trim(),t=n[n.indexOf(r.slice(0,5))],t?(r=r.slice(5),i=r.split("@"),o.username=e.username,o.credential=e.credential,i.length>1&&(r=i[1],i=i[0].split(":"),o.username=i[0],o.credential=(e||{}).credential||i[1]||""),o.url=t+r,o.urls=[o.url],o):e):e}},a4b2:function(e,t){function n(e){throw new TypeError("Not yet implemented")}function i(e){throw new TypeError("Not yet implemented")}t.pack=n,t.unpack=i},a7b3:function(e,t){function n(){}e.exports=n,n.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,n){this.callbacks=this.callbacks||{};var i=3===arguments.length,r=i?arguments[1]:void 0,o=i?arguments[2]:arguments[1];return o._groupName=r,(this.callbacks[e]=this.callbacks[e]||[]).push(o),this},t.once=function(e,t,n){var i=this,r=3===arguments.length,o=r?arguments[1]:void 0,s=r?arguments[2]:arguments[1];function a(){i.off(e,a),s.apply(this,arguments)}return this.on(e,o,a),this},t.releaseGroup=function(e){var t,n,i,r;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(r=this.callbacks[t],n=0,i=r.length;n<i;n++)r[n]._groupName===e&&(r.splice(n,1),n--,i--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var n,i=this.callbacks[e];return i?1===arguments.length?(delete this.callbacks[e],this):(n=i.indexOf(t),-1!==n&&(i.splice(n,1),0===i.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,n,i,r=[].slice.call(arguments,1),o=this.callbacks[e],s=this.getWildcardCallbacks(e);if(o)for(i=o.slice(),t=0,n=i.length;t<n;++t){if(!i[t])break;i[t].apply(this,r)}if(s)for(n=s.length,i=s.slice(),t=0,n=i.length;t<n;++t){if(!i[t])break;i[t].apply(this,[e].concat(r))}return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,n,i=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[0].length)===n[0])&&(i=i.concat(this.callbacks[t]));return i}},n.mixin(n)},a981:function(e,t){e.exports="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof DataView},aaf5:function(e,t,n){(function(t){const n="object"===typeof t&&Object({NODE_ENV:"production",VUE_APP_BASE_API:"http://localhost:8380",BASE_URL:"/"})&&Object({NODE_ENV:"production",VUE_APP_BASE_API:"http://localhost:8380",BASE_URL:"/"}).NODE_DEBUG&&/\bsemver\b/i.test(Object({NODE_ENV:"production",VUE_APP_BASE_API:"http://localhost:8380",BASE_URL:"/"}).NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=n}).call(this,n("4362"))},ab23:function(e,t,n){"use strict";n.d(t,"a",(function(){return at}));var i=Object.defineProperty,r=Object.defineProperties,o=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,l=(e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,u=(e,t)=>{for(var n in t||(t={}))a.call(t,n)&&l(e,n,t[n]);if(s)for(var n of s(t))c.call(t,n)&&l(e,n,t[n]);return e},d=(e,t)=>r(e,o(t)),h=(e,t,n)=>new Promise((i,r)=>{var o=e=>{try{a(n.next(e))}catch(t){r(t)}},s=e=>{try{a(n.throw(e))}catch(t){r(t)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,s);a((n=n.apply(e,t)).next())}),p={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,i,o,s){if("function"!==typeof i)throw new TypeError("The listener must be a function");var a=new r(i,o||e,s),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function s(e,t){0===--e._eventsCount?e._events=new i:delete e._events[t]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,s=new Array(o);r<o;r++)s[r]=i[r].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},a.prototype.emit=function(e,t,i,r,o,s){var a=n?n+e:e;if(!this._events[a])return!1;var c,l,u=this._events[a],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,i),!0;case 4:return u.fn.call(u.context,t,i,r),!0;case 5:return u.fn.call(u.context,t,i,r,o),!0;case 6:return u.fn.call(u.context,t,i,r,o,s),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var h,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,i);break;case 4:u[l].fn.call(u[l].context,t,i,r);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];u[l].fn.apply(u[l].context,c)}}return!0},a.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,i,r){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||r&&!a.once||i&&a.context!==i||s(this,o);else{for(var c=0,l=[],u=a.length;c<u;c++)(a[c].fn!==t||r&&!a[c].once||i&&a[c].context!==i)&&l.push(a[c]);l.length?this._events[o]=1===l.length?l[0]:l:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a})(p);var f=p.exports;const m=(e,t,n={noStyle:!1,noTranslate:!1,className:""})=>{let i=document.createElement("canvas");n.noStyle||(i.style.cssText="\n      position: absolute;\n      left: 0;\n      top: 0;\n    "),n.className&&(i.className=n.className);let r=i.getContext("2d");return i.width=e,i.height=t,n.noTranslate||r.translate(i.width/2,i.height/2),{canvas:i,ctx:r}},v=(e,t,n,i)=>Math.sqrt(Math.pow(e-n,2)+Math.pow(t-i,2)),g=(e,t,n,i,r,o)=>{if(n===r)return Math.abs(e-n);{let s,a,c=1;return s=(i-o)/(r-n),a=0-c*i-s*n,Math.abs((s*e+c*t+a)/Math.sqrt(s*s+c*c))}},E=(e,t,n,i,r,o,s=10)=>{if(g(e,t,n,i,r,o)>s)return!1;let a=v(e,t,n,i),c=v(e,t,r,o),l=v(n,i,r,o),u=Math.sqrt(s*s+l*l);return a<=u&&c<=u},b=e=>e*(180/Math.PI),y=e=>e*(Math.PI/180),S=(e,t,n,i,r,o)=>b(Math.atan2(i-t,n-e)-Math.atan2(o-t,r-e)),w=(e,t,n,i,r)=>{let o=b(Math.atan2(t-i,e-n)),s=o+r,a=v(e,t,n,i);return{x:Math.cos(y(s))*a+n,y:Math.sin(y(s))*a+i}},C=e=>{let{x:t,y:n,width:i,height:r}=e;return{x:t+i/2,y:n+r/2}},O=(e,t,n,i,r)=>{if(0!==r){let o=w(e,t,n,i,-r);e=o.x,t=o.y}return{x:e,y:t}},x=(e,t,n)=>{let i=C(n);return O(e,t,i.x,i.y,n.rotate)},R=(e,t)=>{let{x:n,y:i,width:r,height:o}=e;switch(t){case"topLeft":return{x:n,y:i};case"topRight":return{x:n+r,y:i};case"bottomRight":return{x:n+r,y:i+o};case"bottomLeft":return{x:n,y:i+o}}},I=(e,t)=>{let n=C(e),i=R(e,t);return w(i.x,i.y,n.x,n.y,e.rotate)},T=(e,t,n,i,r,o)=>{if("object"===typeof n){let e=n;n=e.x,i=e.y,r=e.width,o=e.height}return e>=n&&e<=n+r&&t>=i&&t<=i+o},P=(e=[],t=!1)=>{let n=1/0,i=-1/0,r=1/0,o=-1/0;e.forEach(e=>{let[t,s]=e;t<n&&(n=t),t>i&&(i=t),s<r&&(r=s),s>o&&(o=s)});let s=n,a=r,c=i-n,l=o-r;return t?[{x:s,y:a},{x:s+c,y:a},{x:s+c,y:a+l},{x:s,y:a+l}]:{x:s,y:a,width:c,height:l}},k=e=>JSON.parse(JSON.stringify(e)),_=(e,t)=>`${e}px ${t}`,L=e=>e.replace(/\r\n?/g,"\n").split("\n");let A=null;const N=(e,t)=>{A||(A=document.createElement("div"),A.style.position="fixed",A.style.left="-99999px",document.body.appendChild(A));let{fontSize:n,fontFamily:i}=t;A.innerText=e,A.style.fontSize=n+"px",A.style.fontFamily=i;let{width:r}=A.getBoundingClientRect();return r},M=(e,t,n)=>{let i=12;while(N(e,d(u({},n),{fontSize:i+1}))<t)i++;return i},D=e=>{let{text:t}=e,n=L(t),i=-1/0;return n.forEach(t=>{let n=N(t,e.style);n>i&&(i=n)}),i},V=e=>{let t=L(e),n=-1/0;return t.forEach(e=>{e.length>n&&(n=e.length)}),n},B=e=>{let{text:t,style:n}=e,i=D(e);const r=Math.max(L(t).length,1);let o=n.fontSize*n.lineHeightRatio,s=r*o;return{width:i,height:s}},j=(e,t,n=100)=>{let i=null;return(...r)=>{i||(i=setTimeout(()=>{e.call(t,...r),i=null},n))}},F=(e,t,n=2)=>{let i=0,r=n,o=10,s=.5;return i=e>=o?n:e<=s?r+1:r-(e-s)/(o-s)*r,-1===t&&(t=r),.5*i+.5*t},U=(e,t)=>{let n=document.createElement("a");n.href=e,n.download=t,n.click()},z=e=>{let t=I(e,"topLeft"),n=I(e,"topRight"),i=I(e,"bottomLeft"),r=I(e,"bottomRight");return[t,n,i,r]},H=(e=[])=>{if(e.length<=0)return{minx:0,maxx:0,miny:0,maxy:0};let t=1/0,n=-1/0,i=1/0,r=-1/0;return e.forEach(e=>{let o=e.getEndpointList();o.forEach(({x:e,y:o})=>{e<t&&(t=e),e>n&&(n=e),o<i&&(i=o),o>r&&(r=o)})}),{minx:t,maxx:n,miny:i,maxy:r}},W=e=>new Promise(t=>{let n=new Image;n.setAttribute("crossOrigin","anonymous"),n.onload=()=>{t(n)},n.onerror=()=>{t(null)},n.src=e});let G=0;const X=()=>G++;var q=Object.freeze(Object.defineProperty({__proto__:null,createCanvas:m,getTowPointDistance:v,getPointToLineDistance:g,checkIsAtSegment:E,radToDeg:b,degToRad:y,getTowPointRotate:S,getRotatedPoint:w,getElementCenterPoint:C,transformPointReverseRotate:O,transformPointOnElement:x,getElementCornerPoint:R,getElementRotatedCornerPoint:I,checkPointIsInRectangle:T,getBoundingRect:P,deepCopy:k,getFontString:_,splitTextLines:L,getTextActWidth:N,getMaxFontSizeInWidth:M,getWrapTextActWidth:D,getWrapTextMaxRowTextNumber:V,getTextElementSize:B,throttle:j,computedLineWidthBySpeed:F,downloadFile:U,getElementCorners:z,getMultiElementRectInfo:H,createImageObj:W,createNodeKey:X},Symbol.toStringTag,{value:"Module"}));const J={TOP_LEFT:"topLeft",TOP_RIGHT:"topRight",BOTTOM_RIGHT:"bottomRight",BOTTOM_LEFT:"bottomLeft"},$={BODY:"body",ROTATE:"rotate",TOP_LEFT_BTN:"topLeftBtn",TOP_RIGHT_BTN:"topRightBtn",BOTTOM_RIGHT_BTN:"bottomRightBtn",BOTTOM_LEFT_BTN:"bottomLeftBtn"},Y=10,K=(e,t)=>{let n=!1;return e.forEach(e=>{n||E(t.x,t.y,...e,Y)&&(n=!0)}),n},Q=(e,t)=>{let{x:n,y:i,width:r,height:o}=e,s=[[n,i,n+r,i],[n+r,i,n+r,i+o],[n+r,i+o,n,i+o],[n,i+o,n,i]];return K(s,t)?e:null},Z=(e,t)=>T(t.x,t.y,e)?e:null,ee=(e,t)=>Math.min(Math.abs(e),Math.abs(t))/2,te=(e,t)=>{let{width:n,height:i,x:r,y:o}=e,s=ee(n,i),a=v(t.x,t.y,r+s,o+s),c=a>=s-Y&&a<=s+Y;return c?e:null},ne=(e,t)=>{let n=[],i=e.pointArr.length,r=e.pointArr;for(let o=0;o<i-1;o++)n.push([...r[o],...r[o+1]]);return K(n,t)?e:null},ie=(e,t)=>{let n=null;return e.pointArr.forEach(i=>{if(n)return;let r=v(t.x,t.y,i[0],i[1]);r<=Y&&(n=e)}),n},re=(e,t)=>{let{x:n,y:i,width:r,height:o}=e,s=[[n+r/2,i,n+r,i+o/2],[n+r,i+o/2,n+r/2,i+o],[n+r/2,i+o,n,i+o/2],[n,i+o/2,n+r/2,i]];return K(s,t)?e:null},oe=(e,t)=>{let{x:n,y:i,width:r,height:o}=e,s=[[n+r/2,i,n+r,i+o],[n+r,i+o,n,i+o],[n,i+o,n+r/2,i]];return K(s,t)?e:null},se=(e,t)=>{let n=e.pointArr,i=n[0][0],r=n[0][1],o=n[n.length-1][0],s=n[n.length-1][1],a=[[i,r,o,s]];return K(a,t)?e:null};var ae=Object.freeze(Object.defineProperty({__proto__:null,checkIsAtMultiSegment:K,checkIsAtRectangleEdge:Q,checkIsAtRectangleInner:Z,getCircleRadius:ee,checkIsAtCircleEdge:te,checkIsAtLineEdge:ne,checkIsAtFreedrawLineEdge:ie,checkIsAtDiamondEdge:re,checkIsAtTriangleEdge:oe,checkIsAtArrowEdge:se},Symbol.toStringTag,{value:"Module"}));const ce=(e,t,n=!1)=>{e.beginPath(),t(),e.stroke(),n&&e.fill()},le=(e,t,n,i,r,o=!1)=>{ce(e,()=>{e.rect(t,n,i,r),o&&e.fillRect(t,n,i,r)})},ue=(e,t,n,i,r,o=!1)=>{ce(e,()=>{e.moveTo(t+i/2,n),e.lineTo(t+i,n+r/2),e.lineTo(t+i/2,n+r),e.lineTo(t,n+r/2),e.closePath()},o)},de=(e,t,n,i,r,o=!1)=>{ce(e,()=>{e.moveTo(t+i/2,n),e.lineTo(t+i,n+r),e.lineTo(t,n+r),e.closePath()},o)},he=(e,t,n,i,r=!1)=>{ce(e,()=>{e.arc(t,n,i,0,2*Math.PI)},r)},pe=(e,t)=>{ce(e,()=>{let n=!0;t.forEach(t=>{n?(n=!1,e.moveTo(t[0],t[1])):e.lineTo(t[0],t[1])})})},fe=(e,t)=>{let n=t[0][0],i=t[0][1],r=t[t.length-1][0],o=t[t.length-1][1];ce(e,()=>{e.moveTo(n,i),e.lineTo(r,o)},!0);let s=30,a=30,c=b(Math.atan2(o-i,r-n));ce(e,()=>{let t=a-c,n=r-s*Math.cos(y(t)),i=o+s*Math.sin(y(t));e.moveTo(n,i),e.lineTo(r,o)},!0),ce(e,()=>{let t=90-c-a,n=r-s*Math.sin(y(t)),i=o-s*Math.cos(y(t));e.moveTo(n,i),e.lineTo(r,o)})},me=(e,t)=>{let{x:n,y:i}=t.app.coordinate.transform(e[0],e[1]);return[n-t.cx,i-t.cy,...e.slice(2)]},ve=(e,t,n)=>{for(let i=0;i<t.length-1;i++)ce(e,()=>{let r=me(t[i],n),o=me(t[i+1],n);ge(e,r[0],r[1],o[0],o[1],o[2])},!0)},ge=(e,t,n,i,r,o=0)=>{ce(e,()=>{o>0&&(e.lineWidth=o),e.moveTo(t,n),e.lineTo(i,r),e.lineCap="round",e.lineJoin="round"})},Ee=(e,t,n,i,r,o)=>{let{text:s,style:a}=t,c=a.fontSize*a.lineHeightRatio;ce(e,()=>{e.font=_(a.fontSize,a.fontFamily),e.textBaseline="middle";let t=L(s);t.forEach((t,r)=>{e.fillText(t,n,i+(r*c+c/2))})})},be=(e,t,n,i,r,o)=>{ce(e,()=>{let s=r/o,a=0,c=0;s>t.ratio?(c=o,a=t.ratio*o):(a=r,c=r/t.ratio),e.drawImage(t.imageObj,n,i,a,c)})};var ye=Object.freeze(Object.defineProperty({__proto__:null,drawWrap:ce,drawRect:le,drawDiamond:ue,drawTriangle:de,drawCircle:he,drawLine:pe,drawArrow:fe,drawFreeLine:ve,drawLineSegment:ge,drawText:Ee,drawImage:be},Symbol.toStringTag,{value:"Module"}));class Se{constructor(e){this.app=e}addScrollY(e){return e+this.app.state.scrollY}addScrollX(e){return e+this.app.state.scrollX}subScrollY(e){return e-this.app.state.scrollY}subScrollX(e){return e-this.app.state.scrollX}transformToCanvasCoordinate(e,t){return e-=this.app.width/2,t-=this.app.height/2,{x:e,y:t}}transformToScreenCoordinate(e,t){return e+=this.app.width/2,t+=this.app.height/2,{x:e,y:t}}transform(e,t){let n=this.transformToCanvasCoordinate(e,t);return{x:this.subScrollX(n.x),y:this.subScrollY(n.y)}}windowToContainer(e,t){return{x:e-this.app.left,y:t-this.app.top}}containerToWindow(e,t){return{x:e+this.app.left,y:t+this.app.top}}scale(e,t){let{state:n}=this.app,i=this.transformToCanvasCoordinate(e,t),r=this.transformToScreenCoordinate(i.x*n.scale,i.y*n.scale);return{x:r.x,y:r.y}}reverseScale(e,t){let{state:n}=this.app,i=this.transformToCanvasCoordinate(e,t),r=this.transformToScreenCoordinate(i.x/n.scale,i.y/n.scale);return{x:r.x,y:r.y}}gridAdsorbent(e,t){let{gridConfig:n,showGrid:i}=this.app.state;if(!i)return{x:e,y:t};let r=n.size;return{x:e-e%r,y:t-t%r}}}class we extends f{constructor(e){super(),this.app=e,this.coordinate=e.coordinate,this.isMousedown=!1,this.mousedownPos={x:0,y:0,unGridClientX:0,unGridClientY:0,originClientX:0,originClientY:0},this.mouseOffset={x:0,y:0,originX:0,originY:0},this.lastMousePos={x:0,y:0},this.mouseDistance=0,this.lastMouseTime=Date.now(),this.mouseDuration=0,this.mouseSpeed=0,this.onMousedown=this.onMousedown.bind(this),this.onMousemove=this.onMousemove.bind(this),this.onMouseup=this.onMouseup.bind(this),this.onDblclick=this.onDblclick.bind(this),this.onMousewheel=this.onMousewheel.bind(this),this.onKeydown=this.onKeydown.bind(this),this.onKeyup=this.onKeyup.bind(this),this.onContextmenu=this.onContextmenu.bind(this),this.bindEvent()}bindEvent(){this.app.container.addEventListener("mousedown",this.onMousedown),this.app.container.addEventListener("mousemove",this.onMousemove),this.app.container.addEventListener("mouseup",this.onMouseup),this.app.container.addEventListener("dblclick",this.onDblclick),this.app.container.addEventListener("mousewheel",this.onMousewheel),this.app.container.addEventListener("contextmenu",this.onContextmenu),window.addEventListener("keydown",this.onKeydown),window.addEventListener("keyup",this.onKeyup)}unbindEvent(){this.app.container.removeEventListener("mousedown",this.onMousedown),this.app.container.removeEventListener("mousemove",this.onMousemove),this.app.container.removeEventListener("mouseup",this.onMouseup),this.app.container.removeEventListener("dblclick",this.onDblclick),this.app.container.removeEventListener("mousewheel",this.onMousewheel),this.app.container.removeEventListener("contextmenu",this.onContextmenu),window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("keyup",this.onKeyup)}transformEvent(e){let{coordinate:t}=this.app,n=t.windowToContainer(e.clientX,e.clientY),{x:i,y:r}=t.reverseScale(n.x,n.y);i=t.addScrollX(i),r=t.addScrollY(r);let o=i,s=r,a=t.gridAdsorbent(i,r),c={originEvent:e,unGridClientX:o,unGridClientY:s,clientX:a.x,clientY:a.y};return c}onMousedown(e){e=this.transformEvent(e),this.isMousedown=!0,this.mousedownPos.x=e.clientX,this.mousedownPos.y=e.clientY,this.mousedownPos.unGridClientX=e.unGridClientX,this.mousedownPos.unGridClientY=e.unGridClientY,this.mousedownPos.originClientX=e.originEvent.clientX,this.mousedownPos.originClientY=e.originEvent.clientY,this.emit("mousedown",e,this)}onMousemove(e){e=this.transformEvent(e);let t=e.clientX,n=e.clientY;this.isMousedown&&(this.mouseOffset.x=t-this.mousedownPos.x,this.mouseOffset.y=n-this.mousedownPos.y,this.mouseOffset.originX=e.originEvent.clientX-this.mousedownPos.originClientX,this.mouseOffset.originY=e.originEvent.clientY-this.mousedownPos.originClientY);let i=Date.now();this.mouseDuration=i-this.lastMouseTime,this.mouseDistance=v(t,n,this.lastMousePos.x,this.lastMousePos.y),this.mouseSpeed=this.mouseDistance/this.mouseDuration,this.emit("mousemove",e,this),this.lastMouseTime=i,this.lastMousePos.x=t,this.lastMousePos.y=n}onMouseup(e){e=this.transformEvent(e),this.isMousedown=!1,this.mousedownPos.x=0,this.mousedownPos.y=0,this.emit("mouseup",e,this)}onDblclick(e){e=this.transformEvent(e),this.emit("dblclick",e,this)}onMousewheel(e){e=this.transformEvent(e),this.emit("mousewheel",e.originEvent.wheelDelta<0?"down":"up")}onContextmenu(e){e.stopPropagation(),e.preventDefault(),e=this.transformEvent(e),this.emit("contextmenu",e,this)}onKeydown(e){this.emit("keydown",e,this)}onKeyup(e){this.emit("keyup",e,this)}}class Ce extends f{constructor(e={},t){super(),this.app=t,this.groupId=e.groupId||"",this.type=e.type||"",this.key=X(),this.isCreating=!0,this.isActive=!0,this.isSelected=!1,this.startX=0,this.startY=0,this.x=e.x||0,this.y=e.y||0,this.width=e.width||0,this.height=e.height||0,this.startRotate=0,this.rotate=e.rotate||0,this.noRender=!1,this.style=u({strokeStyle:"",fillStyle:"",lineWidth:"small",lineDash:0,globalAlpha:1},e.style||{}),this.dragElement=null}serialize(){return{groupId:this.groupId,type:this.type,width:this.width,height:this.height,x:this.x,y:this.y,rotate:this.rotate,style:u({},this.style)}}render(){throw new Error("子类需要实现该方法！")}setGroupId(e){this.groupId=e}getGroupId(){return this.groupId}removeGroupId(){this.groupId=""}hasGroup(){return!!this.groupId}renderDragElement(){this.isActive&&!this.isCreating?(this.dragElement.showAll(),this.dragElement.render()):this.isSelected&&(this.dragElement.onlyShowBody(),this.dragElement.render())}handleStyle(e){return Object.keys(e).forEach(t=>{"lineWidth"===t&&("small"===e[t]?e[t]=2:"middle"===e[t]?e[t]=4:"large"===e[t]&&(e[t]=6)),""===e[t]&&void 0!==this.app.state[t]&&null!==this.app.state[t]&&""!==this.app.state[t]&&(e[t]=this.app.state[t])}),e}setStyle(e={}){let t=this.handleStyle(e);return Object.keys(t).forEach(e=>{"lineDash"===e?t.lineDash>0&&this.app.ctx.setLineDash([t.lineDash]):void 0!==t[e]&&""!==t[e]&&null!==t[e]&&(this.app.ctx[e]=t[e])}),this}warpRender(e){let{x:t,y:n,width:i,height:r,rotate:o,style:s}=this,{x:a,y:c}=this.app.coordinate.transform(t,n),l=i/2,u=r/2,d=a+l,h=c+u;return this.app.ctx.save(),this.app.ctx.translate(d,h),this.app.ctx.rotate(y(o)),this.setStyle(s),e({halfWidth:l,halfHeight:u,tx:a,ty:c,cx:d,cy:h}),this.app.ctx.restore(),this}saveState(){let{rotate:e,x:t,y:n}=this;return this.startRotate=e,this.startX=t,this.startY=n,this}move(e,t){let{startX:n,startY:i}=this;return this.x=n+e,this.y=i+t,this.emit("elementPositionChange",this.x,this.y),this}updateRect(e,t,n,i){return this.updatePos(e,t),this.updateSize(n,i),this}updateSize(e,t){return this.width=e,this.height=t,this.emit("elementSizeChange",this.width,this.height),this}updatePos(e,t){return this.x=e,this.y=t,this.emit("elementPositionChange",this.x,this.y),this}offsetRotate(e){return this.updateRotate(this.startRotate+e),this}updateRotate(e){e%=360,e<0&&(e=360+e),this.rotate=parseInt(e),this.emit("elementRotateChange",this.rotate)}rotateByCenter(e,t,n){this.offsetRotate(e);let i=w(this.startX,this.startY,t,n,e);this.updatePos(i.x,i.y)}isHit(e,t){throw new Error("子类需要实现该方法!")}startResize(e,t){return this.dragElement.startResize(e,t),this}endResize(){return this.dragElement.endResize(),this}resize(...e){return this.dragElement.handleResizeElement(...e),this}getEndpointList(){return z(this)}}class Oe extends Ce{constructor(e,t,n={}){super({type:"dragElement",notNeedDragElement:!0},t),this.opts=u({lockRatio:!1},n),this.style={strokeStyle:this.app.state.dragStrokeStyle,fillStyle:"transparent",lineWidth:"small",lineDash:0,globalAlpha:1},this.element=e,this.offset=5,this.size=10,this.resizeType="",this.diagonalPoint={x:0,y:0},this.mousedownPosAndElementPosOffset={x:0,y:0},this.elementRatio=0,this.hideParts=[]}setHideParts(e=[]){this.hideParts=e}showAll(){this.setHideParts([])}onlyShowBody(){this.setHideParts([$.ROTATE,$.TOP_LEFT_BTN,$.TOP_RIGHT_BTN,$.BOTTOM_RIGHT_BTN,$.BOTTOM_LEFT_BTN])}update(){this.x=this.element.x-this.offset,this.y=this.element.y-this.offset,this.width=this.element.width+2*this.offset,this.height=this.element.height+2*this.offset,this.rotate=this.element.rotate}render(){if(this.element.hasGroup())return;this.update();let{width:e,height:t}=this;this.warpRender(({halfWidth:n,halfHeight:i})=>{this.app.ctx.save(),this.hideParts.includes($.BODY)||(this.app.ctx.setLineDash([5]),le(this.app.ctx,-n,-i,e,t),this.app.ctx.restore()),this.hideParts.includes($.TOP_LEFT_BTN)||le(this.app.ctx,-n-this.size,-i-this.size,this.size,this.size),this.hideParts.includes($.TOP_RIGHT_BTN)||le(this.app.ctx,-n+this.element.width+this.size,-i-this.size,this.size,this.size),this.hideParts.includes($.BOTTOM_RIGHT_BTN)||le(this.app.ctx,-n+this.element.width+this.size,-i+this.element.height+this.size,this.size,this.size),this.hideParts.includes($.BOTTOM_LEFT_BTN)||le(this.app.ctx,-n-this.size,-i+this.element.height+this.size,this.size,this.size),this.hideParts.includes($.ROTATE)||he(this.app.ctx,-n+this.element.width/2+this.size/2,-i-2*this.size,this.size)})}checkPointInDragElementWhere(e,t){let n="",i=x(e,t,this.element);return T(i.x,i.y,this)?n=$.BODY:v(i.x,i.y,this.x+this.width/2,this.y-2*this.size)<=this.size?n=$.ROTATE:this._checkPointIsInBtn(i.x,i.y,J.TOP_LEFT)?n=$.TOP_LEFT_BTN:this._checkPointIsInBtn(i.x,i.y,J.TOP_RIGHT)?n=$.TOP_RIGHT_BTN:this._checkPointIsInBtn(i.x,i.y,J.BOTTOM_RIGHT)?n=$.BOTTOM_RIGHT_BTN:this._checkPointIsInBtn(i.x,i.y,J.BOTTOM_LEFT)&&(n=$.BOTTOM_LEFT_BTN),this.hideParts.includes(n)&&(n=""),n}_checkPointIsInBtn(e,t,n){let i=0,r=0;switch(n){case J.TOP_LEFT:i=this.x-this.size,r=this.y-this.size;break;case J.TOP_RIGHT:i=this.x+this.width,r=this.y-this.size;break;case J.BOTTOM_RIGHT:i=this.x+this.width,r=this.y+this.height;break;case J.BOTTOM_LEFT:i=this.x-this.size,r=this.y+this.height;break}return T(e,t,i,r,this.size,this.size)}startResize(e,t){this.resizeType=e,this.opts.lockRatio&&(this.elementRatio=this.element.width/this.element.height),e===$.BODY||e===$.ROTATE?this.element.saveState():e===$.TOP_LEFT_BTN?this.handleDragMousedown(t,J.TOP_LEFT):e===$.TOP_RIGHT_BTN?this.handleDragMousedown(t,J.TOP_RIGHT):e===$.BOTTOM_RIGHT_BTN?this.handleDragMousedown(t,J.BOTTOM_RIGHT):e===$.BOTTOM_LEFT_BTN&&this.handleDragMousedown(t,J.BOTTOM_LEFT)}endResize(){this.resizeType="",this.diagonalPoint={x:0,y:0},this.mousedownPosAndElementPosOffset={x:0,y:0},this.elementRatio=0}handleDragMousedown(e,t){let n=C(this.element),i=I(this.element,t);this.diagonalPoint.x=2*n.x-i.x,this.diagonalPoint.y=2*n.y-i.y,this.mousedownPosAndElementPosOffset.x=e.clientX-i.x,this.mousedownPosAndElementPosOffset.y=e.clientY-i.y,this.element.saveState()}handleResizeElement(e,t,n,i,r){let o=this.resizeType;o===$.BODY?this.handleMoveElement(i,r):o===$.ROTATE?this.handleRotateElement(e,t,n):o===$.TOP_LEFT_BTN?this.handleStretchElement(e,(e,t)=>({width:2*(e.x-t.x),height:2*(e.y-t.y)}),e=>({x:e.x,y:e.y}),(e,t)=>{let n=t.x,i=t.y;return e>this.elementRatio?n=t.x+t.width-this.elementRatio*t.height:e<this.elementRatio&&(i=t.y+(t.height-t.width/this.elementRatio)),{x:n,y:i}}):o===$.TOP_RIGHT_BTN?this.handleStretchElement(e,(e,t)=>({width:2*(t.x-e.x),height:2*(e.y-t.y)}),(e,t)=>({x:e.x-t.width,y:e.y}),(e,t)=>{let n=t.x,i=t.y;return e>this.elementRatio?n=t.x+this.elementRatio*t.height:e<this.elementRatio&&(n=t.x+t.width,i=t.y+(t.height-t.width/this.elementRatio)),{x:n,y:i}}):o===$.BOTTOM_RIGHT_BTN?this.handleStretchElement(e,(e,t)=>({width:2*(t.x-e.x),height:2*(t.y-e.y)}),(e,t)=>({x:e.x-t.width,y:e.y-t.height}),(e,t)=>{let n=t.x,i=t.y;return e>this.elementRatio?(n=t.x+this.elementRatio*t.height,i=t.y+t.height):e<this.elementRatio&&(n=t.x+t.width,i=t.y+t.width/this.elementRatio),{x:n,y:i}}):o===$.BOTTOM_LEFT_BTN&&this.handleStretchElement(e,(e,t)=>({width:2*(e.x-t.x),height:2*(t.y-e.y)}),(e,t)=>({x:e.x,y:e.y-t.height}),(e,t)=>{let n=t.x,i=t.y;return e>this.elementRatio?(n=t.x+t.width-this.elementRatio*t.height,i=t.y+t.height):e<this.elementRatio&&(i=t.y+t.width/this.elementRatio),{x:n,y:i}})}handleMoveElement(e,t){this.element.move(e,t)}handleRotateElement(e,t,n){let i=C(this.element),r=S(i.x,i.y,e.clientX,e.clientY,t,n);this.element.offsetRotate(r)}stretchCalc(e,t,n,i){let r={x:(e+this.diagonalPoint.x)/2,y:(t+this.diagonalPoint.y)/2},o=O(e,t,r.x,r.y,this.element.rotate),s=n(r,o),a=!1;s.width<0&&(s.width=0,a=!0);let c=!1;s.height<0&&(s.height=0,c=!0);let l=i(o,s),u={x:l.x,y:l.y,width:s.width,height:s.height};return(a||c)&&(u.x=this.element.x,u.y=this.element.y),{newRect:u,newCenter:r}}handleStretchElement(e,t,n,i){let r=e.clientX-this.mousedownPosAndElementPosOffset.x,o=e.clientY-this.mousedownPosAndElementPosOffset.y,{newRect:s,newCenter:a}=this.stretchCalc(r,o,t,n);this.opts.lockRatio?this.fixStretch(s,a,t,n,i):this.element.updateRect(s.x,s.y,s.width,s.height)}fixStretch(e,t,n,i,r){let o=e.width/e.height,s=r(o,e),a=w(s.x,s.y,t.x,t.y,this.element.rotate),c=this.stretchCalc(a.x,a.y,n,i).newRect;0===c.width&&0===c.height||this.element.updateRect(c.x,c.y,c.width,c.height)}}class xe extends Ce{constructor(...e){super(...e),this.dragElement=new Oe(this,this.app)}render(){let{width:e,height:t}=this;this.warpRender(({halfWidth:n,halfHeight:i})=>{le(this.app.ctx,-n,-i,e,t,!0)}),this.renderDragElement()}isHit(e,t){let n=x(e,t,this);return Q(this,n)}}class Re extends Ce{constructor(...e){super(...e),this.dragElement=new Oe(this,this.app,{lockRatio:!0})}render(){let{width:e,height:t}=this;this.warpRender(({halfWidth:n,halfHeight:i})=>{he(this.app.ctx,0,0,ee(e,t),!0)}),this.renderDragElement()}isHit(e,t){let n=x(e,t,this);return te(this,n)}}class Ie extends Ce{constructor(...e){super(...e),this.dragElement=new Oe(this,this.app)}render(){let{width:e,height:t}=this;this.warpRender(({halfWidth:n,halfHeight:i})=>{ue(this.app.ctx,-n,-i,e,t,!0)}),this.renderDragElement()}isHit(e,t){let n=x(e,t,this);return re(this,n)}getEndpointList(){let{x:e,y:t,width:n,height:i,rotate:r}=this,o=[[e+n/2,t],[e+n,t+i/2],[e+n/2,t+i],[e,t+i/2]],s=C(this);return o.map(e=>w(e[0],e[1],s.x,s.y,r))}}class Te extends Ce{constructor(...e){super(...e),this.dragElement=new Oe(this,this.app)}render(){let{width:e,height:t}=this;this.warpRender(({halfWidth:n,halfHeight:i})=>{de(this.app.ctx,-n,-i,e,t,!0)}),this.renderDragElement()}isHit(e,t){let n=x(e,t,this);return oe(this,n)}getEndpointList(){let{x:e,y:t,width:n,height:i,rotate:r}=this,o=[[e+n/2,t],[e+n,t+i],[e,t+i]],s=C(this);return o.map(e=>w(e[0],e[1],s.x,s.y,r))}}class Pe extends Ce{constructor(e={},t){super(e,t),this.startPointArr=[],this.pointArr=e.pointArr||[],this.startWidth=0,this.startHeight=0,this.fictitiousPoint={x:0,y:0}}serialize(){let e=super.serialize();return d(u({},e),{pointArr:[...this.pointArr]})}addPoint(e,t,...n){if(Array.isArray(this.pointArr))return this.pointArr.push([e,t,...n]),this}updateMultiPointBoundingRect(){let e=P(this.pointArr);return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}updateFictitiousPoint(e,t){this.fictitiousPoint.x=e,this.fictitiousPoint.y=t}saveState(){let{rotate:e,x:t,y:n,width:i,height:r,pointArr:o}=this;return this.startRotate=e,this.startX=t,this.startY=n,this.startPointArr=k(o),this.startWidth=i,this.startHeight=r,this}move(e,t){this.pointArr=this.startPointArr.map(n=>[n[0]+e,n[1]+t,...n.slice(2)]);let{startX:n,startY:i}=this;return this.x=n+e,this.y=i+t,this}updateRect(e,t,n,i){let{startWidth:r,startHeight:o,startPointArr:s}=this,a=n/r,c=i/o;this.pointArr=s.map(e=>{let t=e[0]*a,n=e[1]*c;return[t,n,...e.slice(2)]});let l=P(this.pointArr),u=l.x-e,d=l.y-t;return this.pointArr=this.pointArr.map(e=>[e[0]-u,e[1]-d,...e.slice(2)]),this.updatePos(e,t),this.updateSize(n,i),this}rotateByCenter(e,t,n){this.pointArr=this.startPointArr.map(i=>{let r=w(i[0],i[1],t,n,e);return[r.x,r.y,...i.slice(2)]}),this.updateMultiPointBoundingRect()}getEndpointList(){return this.pointArr.map(e=>{let t=C(this),n=w(e[0],e[1],t.x,t.y,this.rotate);return{x:n.x,y:n.y}})}}class ke extends Pe{constructor(...e){super(...e),this.dragElement=new Oe(this,this.app),this.lastLineWidth=-1}render(){let{pointArr:e}=this;this.warpRender(({cx:t,cy:n})=>{ve(this.app.ctx,e,{app:this.app,cx:t,cy:n})}),this.renderDragElement()}isHit(e,t){let n=x(e,t,this);return ie(this,n)}singleRender(e,t,n,i,r){this.app.ctx.save(),this.setStyle(this.style),ge(this.app.ctx,e,t,n,i,r),this.app.ctx.restore()}}class _e extends Pe{constructor(...e){super(...e),this.dragElement=new Oe(this,this.app)}render(){let{pointArr:e,fictitiousPoint:t}=this;this.warpRender(({cx:n,cy:i})=>{let r=[];if(e.length>0&&this.isCreating){let{x:e,y:o}=this.app.coordinate.transform(t.x-n,t.y-i);r=[[e,o]]}fe(this.app.ctx,e.map(e=>{let{x:t,y:r}=this.app.coordinate.transform(e[0],e[1]);return[t-n,r-i]}).concat(r))}),this.renderDragElement()}isHit(e,t){let n=x(e,t,this);return se(this,n)}}class Le extends Ce{constructor(e={},t){super(e,t),this.dragElement=new Oe(this,this.app,{lockRatio:!0}),this.url=e.url||"",this.imageObj=e.imageObj||null,this.ratio=e.ratio||1}serialize(){let e=super.serialize();return d(u({},e),{url:this.url,ratio:this.ratio})}render(){let{width:e,height:t}=this;this.warpRender(({halfWidth:n,halfHeight:i})=>{be(this.app.ctx,this,-n,-i,e,t)}),this.renderDragElement()}isHit(e,t){let n=x(e,t,this);return Z(this,n)}}class Ae extends Pe{constructor(e={},t){super(e,t),this.dragElement=new Oe(this,this.app),this.isSingle=e.isSingle}render(){let{pointArr:e,fictitiousPoint:t}=this;this.warpRender(({cx:n,cy:i})=>{let r=[];if(e.length>0&&this.isCreating){let{x:e,y:o}=this.app.coordinate.transform(t.x-n,t.y-i);r=[[e,o]]}pe(this.app.ctx,e.map(e=>{let{x:t,y:r}=this.app.coordinate.transform(e[0],e[1]);return[t-n,r-i]}).concat(r))}),this.renderDragElement()}isHit(e,t){let n=x(e,t,this);return ne(this,n)}}class Ne extends Ce{constructor(e={},t){var n,i,r,o;super(e,t),this.dragElement=new Oe(this,this.app,{lockRatio:!0}),this.text=e.text||"",this.style.fillStyle=(null==(n=e.style)?void 0:n.fillStyle)||this.app.state.strokeStyle||"#000",this.style.fontSize=(null==(i=e.style)?void 0:i.fontSize)||this.app.state.fontSize||18,this.style.lineHeightRatio=(null==(r=e.style)?void 0:r.lineHeightRatio)||1.5,this.style.fontFamily=(null==(o=e.style)?void 0:o.fontFamily)||this.app.state.fontFamily||"微软雅黑, Microsoft YaHei"}serialize(){let e=super.serialize();return d(u({},e),{text:this.text})}render(){this.warpRender(({halfWidth:e,halfHeight:t})=>{Ee(this.app.ctx,this,-e,-t)}),this.renderDragElement()}isHit(e,t){let n=x(e,t,this);return Z(this,n)}updateRect(e,t,n,i){let{text:r,style:o}=this,s=Math.floor(i/L(r).length/o.lineHeightRatio);this.style.fontSize=s,super.updateRect(e,t,n,i)}updateTextSize(){let{width:e,height:t}=B(this);this.width=e,this.height=t}}class Me{constructor(e){this.app=e,this.elementList=[],this.activeElement=null,this.isCreatingElement=!1,this.isResizing=!1,this.resizingElement=null,this.handleResize=j(this.handleResize,this,16)}serialize(e=!1){let t=this.elementList.map(e=>e.serialize());return e?JSON.stringify(t):t}getElementsNum(){return this.elementList.length}hasElements(){return this.elementList.length>0}addElement(e){return this.elementList.push(e),this}unshiftElement(e){return this.elementList.unshift(e),this}insertElement(e,t){this.elementList.splice(t,0,e)}deleteElement(e){let t=this.getElementIndex(e);return-1!==t&&(this.elementList.splice(t,1),e.isActive&&this.cancelActiveElement(e)),this}deleteAllElements(){return this.activeElement=null,this.elementList=[],this.isCreatingElement=!1,this.isResizing=!1,this.resizingElement=null,this}getElementIndex(e){return this.elementList.findIndex(t=>t===e)}createElementsFromData(e){return e.forEach(e=>{let t=this.pureCreateElement(e);t.isActive=!1,t.isCreating=!1,this.addElement(t)}),this.app.group.initIdToElementList(this.elementList),this}hasActiveElement(){return!!this.activeElement}setActiveElement(e){return this.cancelActiveElement(),this.activeElement=e,e&&(e.isActive=!0),this.app.emit("activeElementChange",this.activeElement),this}cancelActiveElement(){return this.hasActiveElement()?(this.activeElement.isActive=!1,this.activeElement=null,this.app.emit("activeElementChange",this.activeElement),this):this}checkIsHitElement(e){let t=e.unGridClientX,n=e.unGridClientY;for(let i=this.elementList.length-1;i>=0;i--){let e=this.elementList[i];if(e.isHit(t,n))return e}return null}pureCreateElement(e={}){switch(e.type){case"rectangle":return new xe(e,this.app);case"diamond":return new Ie(e,this.app);case"triangle":return new Te(e,this.app);case"circle":return new Re(e,this.app);case"freedraw":return new ke(e,this.app);case"image":return new Le(e,this.app);case"arrow":return new _e(e,this.app);case"line":return new Ae(e,this.app);case"text":return new Ne(e,this.app);default:return null}}createElement(e={},t=(()=>{}),n=null,i){if(this.hasActiveElement()||this.isCreatingElement)return this;let r=this.pureCreateElement(e);return r?(this.addElement(r),i||this.setActiveElement(r),this.isCreatingElement=!0,t.call(n,r),this):this}copyElement(e,t=!1,n){return new Promise(i=>h(this,null,(function*(){if(!e)return i();let r=this.app.group.handleCopyElementData(e.serialize());"image"===r.type&&(r.imageObj=yield W(r.url)),this.createElement(r,e=>{this.app.group.handleCopyElement(e),e.startResize($.BODY);let r=20,o=20;n&&(r=n.x-e.x-e.width/2,o=n.y-e.y-e.height/2);let s=this.app.coordinate.gridAdsorbent(r,o);e.resize(null,null,null,s.x,s.y),e.isCreating=!1,t&&(e.isActive=!1),this.isCreatingElement=!1,i(e)},this,t)})))}creatingRectangleLikeElement(e,t,n,i,r){this.createElement({type:e,x:t,y:n,width:i,height:r}),this.activeElement.updateSize(i,r)}creatingCircle(e,t,n){this.createElement({type:"circle",x:e,y:t});let i=v(n.clientX,n.clientY,e,t);this.activeElement.updateSize(i,i)}creatingFreedraw(e,t){this.createElement({type:"freedraw"});let n=this.activeElement,i=F(t.mouseSpeed,n.lastLineWidth);n.lastLineWidth=i,n.addPoint(e.clientX,e.clientY,i);let{coordinate:r,ctx:o,state:s}=this.app,a=r.transformToCanvasCoordinate(r.subScrollX(t.lastMousePos.x),r.subScrollY(t.lastMousePos.y)),c=r.transformToCanvasCoordinate(r.subScrollX(e.clientX),r.subScrollY(e.clientY));o.save(),o.scale(s.scale,s.scale),n.singleRender(a.x,a.y,c.x,c.y,i),o.restore()}creatingImage(e,{width:t,height:n,imageObj:i,url:r,ratio:o}){let s=this.app.coordinate.gridAdsorbent(e.unGridClientX-t/2,e.unGridClientY-n/2);this.createElement({type:"image",x:s.x,y:s.y,url:r,imageObj:i,width:t,height:n,ratio:o})}editingText(e){"text"===e.type&&(e.noRender=!0,this.setActiveElement(e))}completeEditingText(){let e=this.activeElement;if(e&&"text"===e.type)return e.text.trim()?void(e.noRender=!1):(this.deleteElement(e),void this.setActiveElement(null))}completeCreateArrow(e){this.activeElement.addPoint(e.clientX,e.clientY)}creatingArrow(e,t,n){this.createElement({type:"arrow",x:e,y:t},n=>{n.addPoint(e,t)}),this.activeElement.updateFictitiousPoint(n.clientX,n.clientY)}creatingLine(e,t,n,i=!1,r=!1){r||this.createElement({type:"line",x:e,y:t,isSingle:i},n=>{n.addPoint(e,t)});let o=this.activeElement;o&&o.updateFictitiousPoint(n.clientX,n.clientY)}completeCreateLine(e,t=(()=>{})){let n=this.activeElement,i=e.clientX,r=e.clientY;n&&n.isSingle?(n.addPoint(i,r),t()):(this.createElement({type:"line",isSingle:!1}),n=this.activeElement,n.addPoint(i,r),n.updateFictitiousPoint(i,r))}completeCreateElement(){this.isCreatingElement=!1;let e=this.activeElement;return e?(["freedraw","arrow","line"].includes(e.type)&&e.updateMultiPointBoundingRect(),e.isCreating=!1,this.app.emitChange(),this):this}setActiveElementStyle(e={}){return this.hasActiveElement()?(Object.keys(e).forEach(t=>{this.activeElement.style[t]=e[t],"fontSize"===t&&"text"===this.activeElement.type&&this.activeElement.updateTextSize()}),this):this}checkInResizeHand(e,t){let n=this.activeElement,i=n.dragElement.checkPointInDragElementWhere(e,t);return i?{element:n,hand:i}:null}checkIsResize(e,t,n){if(!this.hasActiveElement())return!1;let i=this.checkInResizeHand(e,t);return!!i&&(this.isResizing=!0,this.resizingElement=i.element,this.resizingElement.startResize(i.hand,n),this.app.cursor.setResize(i.hand),!0)}handleResize(...e){this.isResizing&&(this.resizingElement.resize(...e),this.app.render.render())}endResize(){this.isResizing=!1,this.resizingElement.endResize(),this.resizingElement=null}}class De extends f{constructor(e){super(),this.app=e,this.el=null,this.isReady=!1,this.previewEl=null,this.imageData=null,this.maxWidth=750,this.maxHeight=450,this.maxRatio=this.maxWidth/this.maxHeight,this.onImageSelectChange=this.onImageSelectChange.bind(this)}reset(){this.el.value="",this.isReady=!1,document.body.removeChild(this.previewEl),this.previewEl=null,this.imageData=null}selectImage(){this.el||(this.el=document.createElement("input"),this.el.type="file",this.el.accept="image/*",this.el.style.position="fixed",this.el.style.left="-999999px",this.el.addEventListener("change",this.onImageSelectChange),document.body.appendChild(this.el)),this.el.click()}updatePreviewElPos(e,t){let n=100,i=n/this.imageData.ratio;this.previewEl||(this.previewEl=document.createElement("div"),this.previewEl.style.position="fixed",this.previewEl.style.width=n+"px",this.previewEl.style.height=i+"px",this.previewEl.style.backgroundImage=`url('${this.imageData.url}')`,this.previewEl.style.backgroundSize="cover",this.previewEl.style.pointerEvents="none",document.body.appendChild(this.previewEl));let r=this.app.coordinate.containerToWindow(e,t);this.previewEl.style.left=r.x-n/2+"px",this.previewEl.style.top=r.y-i/2+"px"}getImageSize(e){return h(this,null,(function*(){return new Promise((t,n)=>{let i=new Image;i.setAttribute("crossOrigin","anonymous"),i.onload=()=>{let e=i.width,n=i.height,r=i.width/i.height;(i.width>this.maxWidth||i.height>this.maxHeight)&&(r>this.maxRatio?(e=this.maxWidth,n=this.maxWidth/r):(n=this.maxHeight,e=this.maxHeight*r)),t({imageObj:i,size:{width:e,height:n},ratio:r})},i.onerror=()=>{n()},i.src=e})}))}onImageSelectChange(e){return h(this,null,(function*(){let t=yield this.getImageUrl(e.target.files[0]),{imageObj:n,size:i,ratio:r}=yield this.getImageSize(t);this.isReady=!0,this.imageData=d(u({url:t},i),{ratio:r,imageObj:n}),this.emit("imageSelectChange",this.imageData)}))}getImageUrl(e){return h(this,null,(function*(){return new Promise((t,n)=>{let i=new FileReader;i.onloadend=()=>{t(i.result)},i.onerror=()=>{n()},i.readAsDataURL(e)})}))}}class Ve{constructor(e){this.app=e,this.currentType="default"}set(e="default"){this.currentType=e;let t=e;"eraser"===e&&(t="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAARRJREFUOE/dlDFLxEAQhd+BVouFZ3vlQuwSyI+5a7PBRkk6k9KzTOwStJFsWv0xgaQzkNLWszim0kL2OOFc9oKRYHFTz37Lm/dmJhi5JiPzcBjAOYDz7WheADz3jalP8oIxds85P3Zd90RBqqpad133SUSXAJ5M4H3AhWVZd1EUzYQQP96VZYkkSV7btr02QY1Axtgqz/NTz/OM6qSUCMNwRURneoMJOLdt+7Gu643MfeU4zrppmgt9pibgjRBiWRRFb0R934eUcgngdrfxX4CjSwZj7C3Lsqnu8Lc05XQQBO9ENP2NKapnE5s4jme608rhNE2HxWb7qwr2A+f8SAv2BxFdDQ32rpLRVu9Pl+0wztcg6V/VPW4Vw1FsawAAAABJRU5ErkJggg==) 10 10, auto"),this.app.container.style.cursor=t}hide(){this.set("none")}reset(){this.set()}setCrosshair(){this.set("crosshair")}setMove(){this.set("move")}setResize(e){let t="";switch(e){case $.BODY:t="move";break;case $.ROTATE:t="grab";break;case $.TOP_LEFT_BTN:t="nw-resize";break;case $.TOP_RIGHT_BTN:t="ne-resize";break;case $.BOTTOM_RIGHT_BTN:t="se-resize";break;case $.BOTTOM_LEFT_BTN:t="sw-resize";break}this.set(t)}setEraser(){this.set("eraser")}}class Be extends f{constructor(e){super(),this.app=e,this.editable=null,this.isEditing=!1,this.onTextInput=this.onTextInput.bind(this),this.onTextBlur=this.onTextBlur.bind(this)}crateTextInputEl(){this.editable=document.createElement("textarea"),this.editable.dir="auto",this.editable.tabIndex=0,this.editable.wrap="off",this.editable.className="textInput",Object.assign(this.editable.style,{position:"fixed",display:"block",minHeight:"1em",backfaceVisibility:"hidden",margin:0,padding:0,border:0,outline:0,resize:"none",background:"transparent",overflow:"hidden",whiteSpace:"pre"}),this.editable.addEventListener("input",this.onTextInput),this.editable.addEventListener("blur",this.onTextBlur),document.body.appendChild(this.editable)}updateTextInputStyle(){let e=this.app.elements.activeElement;if(!e)return;let{x:t,y:n,width:i,height:r,style:o,text:s,rotate:a}=e,{coordinate:c,state:l}=this.app;this.editable.value=s,t=c.subScrollX(t),n=c.subScrollY(n);let u=c.scale(t,n),d=c.containerToWindow(u.x,u.y),h=o.fontSize*l.scale,p={font:_(h,o.fontFamily),lineHeight:h*o.lineHeightRatio+"px",left:d.x+"px",top:d.y+"px",color:o.fillStyle,width:Math.max(i,100)*l.scale+"px",height:r*l.scale+"px",transform:`rotate(${a}deg)`,opacity:o.globalAlpha};Object.assign(this.editable.style,p)}onTextInput(){let e=this.app.elements.activeElement;if(!e)return;e.text=this.editable.value;let{width:t,height:n}=B(e);e.width=t,e.height=n,this.updateTextInputStyle()}onTextBlur(){this.editable.style.display="none",this.editable.value="",this.emit("blur"),this.isEditing=!1}showTextEdit(){this.editable?this.editable.style.display="block":this.crateTextInputEl(),this.updateTextInputStyle(),this.editable.focus(),this.editable.select(),this.isEditing=!0}}class je{constructor(e){this.app=e,this.historyStack=[],this.length=0,this.index=-1}add(e){let t=this.length>0?this.historyStack[this.length-1]:null,n=k(e);n!==t&&(this.historyStack.push(n),this.length++,this.index=this.length-1,this.emitChange())}undo(){this.index<=0||(this.index--,this.shuttle())}redo(){this.index>=this.length-1||(this.index++,this.shuttle())}shuttle(){return h(this,null,(function*(){let e=this.historyStack[this.index];yield this.app.setData(e,!0),this.emitChange(),this.app.emit("change",e)}))}clear(){this.index=-1,this.length=0,this.historyStack=[],this.emitChange()}emitChange(){this.app.emit("shuttle",this.index,this.length)}}class Fe{constructor(e){this.app=e,this.openTest=!1,this.saveState={scale:0,scrollX:0,scrollY:0,width:0,height:0}}show(e){this.openTest&&(e.style.cssText="\n        position: absolute;\n        left: 0;\n        top: 0;\n        background-color: #fff;\n      ",document.body.appendChild(e))}getElementList(e=!0){if(e){let e=[];this.app.elements.activeElement?e.push(this.app.elements.activeElement):this.app.selection.hasSelectionElements()&&(e=this.app.selection.getSelectionElements());let t=this.app.elements.elementList.filter(t=>e.includes(t));return t}return this.app.elements.elementList}exportImage({type:e="image/png",renderBg:t=!0,useBlob:n=!1,paddingX:i=10,paddingY:r=10,onlySelected:o}={}){let{minx:s,maxx:a,miny:c,maxy:l}=H(this.getElementList(o)),u=a-s+2*i,d=l-c+2*r,{canvas:h,ctx:p}=m(u,d,{noStyle:!0,noTranslate:!0});return this.show(h),this.saveAppState(),this.changeAppState(s-i,c-r,p),t&&this.app.state.backgroundColor&&this.app.background.canvasAddBackgroundColor(p,u,d,this.app.state.backgroundColor),this.render(p,o),this.recoveryAppState(),n?new Promise((t,n)=>{h.toBlob(e=>{e?t(e):n()},e)}):h.toDataURL(e)}saveAppState(){let{width:e,height:t,state:n,ctx:i}=this.app;this.saveState.width=e,this.saveState.height=t,this.saveState.scale=n.scale,this.saveState.scrollX=n.scrollX,this.saveState.scrollY=n.scrollY,this.saveState.ctx=i}changeAppState(e,t,n){this.app.ctx=n,this.app.state.scale=1,this.app.state.scrollX=0,this.app.state.scrollY=0,this.app.width=2*e,this.app.height=2*t}recoveryAppState(){let{width:e,height:t,scale:n,scrollX:i,scrollY:r,ctx:o}=this.saveState;this.app.state.scale=n,this.app.state.scrollX=i,this.app.state.scrollY=r,this.app.width=e,this.app.height=t,this.app.ctx=o}render(e,t){e.save(),this.getElementList(t).forEach(e=>{if(e.noRender)return;let t=e.isActive,n=e.isSelected;e.isActive=!1,e.isSelected=!1,e.render(),e.isActive=t,e.isSelected=n}),e.restore()}exportJson(){return this.app.getData()}}class Ue{constructor(e){this.app=e}set(){this.app.state.backgroundColor?this.addBackgroundColor():this.remove()}addBackgroundColor(){this.app.container.style.backgroundColor=this.app.state.backgroundColor}remove(){this.app.container.style.backgroundColor=""}canvasAddBackgroundColor(e,t,n,i){e.save(),e.rect(0,0,t,n),e.fillStyle=i,e.fill(),e.restore()}}class ze{constructor(e,t,n){this.width=e,this.height=t;let{canvas:i,ctx:r}=m(e,t,n);this.el=i,this.ctx=r}clearCanvas(){let{width:e,height:t}=this;this.ctx.clearRect(-e/2,-t/2,e,t)}}class He extends Ce{constructor(e={},t){super(e,t),this.dragElement=new Oe(this,this.app),this.selectedElementList=[],this.wholeCenterPos={x:0,y:0}}setSelectedElementList(e){this.selectedElementList.forEach(e=>{e.isSelected=!1}),this.selectedElementList=e,this.selectedElementList.forEach(e=>{e.isSelected=!0})}updateElements(e){let t=[];this.selectedElementList.forEach(n=>{e.includes(n)&&t.push(n)}),this.setSelectedElementList(t)}updateRect(){if(this.selectedElementList.length<=0)return void super.updateRect(0,0,0,0);let{minx:e,maxx:t,miny:n,maxy:i}=H(this.selectedElementList);super.updateRect(e,n,t-e,i-n)}startResize(...e){this.selectedElementList.forEach(t=>{"rotate"===e[0]&&(this.wholeCenterPos=C(this)),t.startResize(...e)})}resize(...e){this.selectedElementList.forEach(t=>{"rotate"===t.dragElement.resizeType?this.handleRotate(t,...e):t.resize(...e)})}handleRotate(e,t,n,i,r,o){let s=S(this.wholeCenterPos.x,this.wholeCenterPos.y,t.clientX,t.clientY,n,i);e.rotateByCenter(s,this.wholeCenterPos.x,this.wholeCenterPos.y)}endResize(){this.selectedElementList.forEach(e=>{e.endResize()})}render(){if(this.selectedElementList.length>0){if(this.width<=0||this.height<=0)return;this.dragElement.render()}}}class We{constructor(e){this.app=e,this.canvas=null,this.ctx=null,this.creatingSelection=!1,this.hasSelection=!1,this.isResizing=!1,this.state=this.app.state,this.width=this.app.width,this.height=this.app.height,this.coordinate=new Se(this),this.rectangle=new xe({type:"rectangle",style:{strokeStyle:"rgba(9,132,227,0.3)",fillStyle:"rgba(9,132,227,0.3)"}},this),this.multiSelectElement=new He({type:"multiSelectElement"},this),this.checkInNodes=j(this.checkInNodes,this,500),this.handleResize=j(this.handleResize,this,16),this.init(),this.bindEvent()}init(){this.canvas&&this.app.container.removeChild(this.canvas.el),this.width=this.app.width,this.height=this.app.height,this.canvas=new ze(this.width,this.height,{className:"selection"}),this.ctx=this.canvas.ctx,this.app.container.appendChild(this.canvas.el)}bindEvent(){this.app.on("change",()=>{this.state=this.app.state,this.multiSelectElement.updateElements(this.app.elements.elementList),this.renderSelection()}),this.app.on("scrollChange",()=>{this.renderSelection()}),this.app.on("zoomChange",()=>{this.renderSelection()})}onMousedown(e,t){1===e.originEvent.which&&(this.creatingSelection=!0,this.rectangle.updatePos(t.mousedownPos.x,t.mousedownPos.y))}onMousemove(e,t){Math.abs(t.mouseOffset.x)<=10&&Math.abs(t.mouseOffset.y)<=10||this.onMove(e,t)}onMouseup(){this.creatingSelection=!1,this.rectangle.updateRect(0,0,0,0),this.hasSelection=this.hasSelectionElements(),this.multiSelectElement.updateRect(),this.renderSelection(),this.emitChange()}reset(){this.setMultiSelectElements([]),this.hasSelection=!1,this.renderSelection(),this.emitChange()}renderSelection(){this.canvas.clearCanvas(),this.ctx.save(),this.ctx.scale(this.app.state.scale,this.app.state.scale),this.rectangle.render(),this.multiSelectElement.render(),this.ctx.restore()}onMove(e,t){this.rectangle.updateSize(t.mouseOffset.x,t.mouseOffset.y),this.renderSelection(),this.checkInElements(e,t)}checkInElements(e,t){let n=Math.min(t.mousedownPos.x,e.clientX),i=Math.min(t.mousedownPos.y,e.clientY),r=Math.max(t.mousedownPos.x,e.clientX),o=Math.max(t.mousedownPos.y,e.clientY),s=[];this.app.elements.elementList.forEach(e=>{let t=1/0,a=-1/0,c=1/0,l=-1/0,u=e.getEndpointList(),d=P(u.map(e=>[e.x,e.y]),!0);d.forEach(({x:e,y:n})=>{e<t&&(t=e),e>a&&(a=e),n<c&&(c=n),n>l&&(l=n)}),t>=n&&a<=r&&c>=i&&l<=o&&s.push(e)});let a=[...s];s.forEach(e=>{e.hasGroup()&&a.push(...this.app.group.getGroupElements(e))}),a=new Set(a),a=Array.from(a),this.setMultiSelectElements(a,!0),this.app.render.render()}checkInResizeHand(e,t){return this.multiSelectElement.dragElement.checkPointInDragElementWhere(e,t)}checkIsResize(e,t,n){if(!this.hasSelection)return!1;let i=this.multiSelectElement.dragElement.checkPointInDragElementWhere(e,t);return!!i&&(this.isResizing=!0,this.multiSelectElement.startResize(i,n),this.app.cursor.setResize(i),!0)}handleResize(...e){this.isResizing&&(this.multiSelectElement.resize(...e),this.app.render.render(),this.multiSelectElement.updateRect(),this.renderSelection())}endResize(){this.isResizing=!1,this.multiSelectElement.endResize()}setSelectedElementStyle(e={}){this.hasSelectionElements()&&(Object.keys(e).forEach(t=>{this.getSelectionElements().forEach(n=>{n.style[t]=e[t],"fontSize"===t&&"text"===n.type&&(n.updateTextSize(),this.multiSelectElement.updateRect())})}),this.app.render.render(),this.app.emitChange())}deleteSelectedElements(){this.getSelectionElements().forEach(e=>{this.app.elements.deleteElement(e)}),this.selectElements([]),this.app.emitChange()}hasSelectionElements(){return this.getSelectionElements().length>0}getSelectionElements(){return this.multiSelectElement.selectedElementList}copySelectionElements(e){return h(this,null,(function*(){let t=this.getSelectionElements().map(e=>this.app.elements.copyElement(e,!0));this.app.group.clearCopyMap();let n=yield Promise.all(t);if(this.setMultiSelectElements(n),e){this.multiSelectElement.startResize($.BODY);let t=e.x-this.multiSelectElement.x-this.multiSelectElement.width/2,n=e.y-this.multiSelectElement.y-this.multiSelectElement.height/2,i=this.app.coordinate.gridAdsorbent(t,n);this.multiSelectElement.resize(null,null,null,i.x,i.y),this.multiSelectElement.endResize(),this.multiSelectElement.updateRect()}this.app.render.render(),this.renderSelection(),this.app.emitChange()}))}selectElements(e=[]){this.hasSelection=e.length>0,this.setMultiSelectElements(e),this.app.render.render(),this.renderSelection(),this.emitChange()}setMultiSelectElements(e=[],t){this.multiSelectElement.setSelectedElementList(e),t||this.multiSelectElement.updateRect()}emitChange(){this.app.emit("multiSelectChange",this.getSelectionElements())}}class Ge{constructor(e){this.app=e,this.canvas=null,this.ctx=null,this.init(),this.app.on("zoomChange",this.renderGrid,this),this.app.on("scrollChange",this.renderGrid,this)}init(){this.canvas&&this.app.container.removeChild(this.canvas.el);let{width:e,height:t}=this.app;this.canvas=new ze(e,t,{className:"grid"}),this.ctx=this.canvas.ctx,this.app.container.insertBefore(this.canvas.el,this.app.container.children[0])}drawHorizontalLine(e){let{coordinate:t,width:n,state:i}=this.app,r=t.subScrollY(e);this.ctx.beginPath(),this.ctx.moveTo(-n/i.scale/2,r),this.ctx.lineTo(n/i.scale/2,r),this.ctx.stroke()}renderHorizontalLines(){let{coordinate:e,height:t,state:n}=this.app,{gridConfig:i,scale:r}=n,o=0;for(let s=-t/2;s<t/2;s+=i.size)this.drawHorizontalLine(s),o=s;for(let s=-t/2-i.size;s>-e.subScrollY(t/r/2);s-=i.size)this.drawHorizontalLine(s);for(let s=o+i.size;s<e.addScrollY(t/r/2);s+=i.size)this.drawHorizontalLine(s)}drawVerticalLine(e){let{coordinate:t,height:n,state:i}=this.app,r=t.subScrollX(e);this.ctx.beginPath(),this.ctx.moveTo(r,-n/i.scale/2),this.ctx.lineTo(r,n/i.scale/2),this.ctx.stroke()}renderVerticalLines(){let{coordinate:e,width:t,state:n}=this.app,{gridConfig:i,scale:r}=n,o=0;for(let s=-t/2;s<t/2;s+=i.size)this.drawVerticalLine(s),o=s;for(let s=-t/2-i.size;s>-e.subScrollX(t/r/2);s-=i.size)this.drawVerticalLine(s);for(let s=o+i.size;s<e.addScrollX(t/r/2);s+=i.size)this.drawVerticalLine(s)}renderGrid(){this.canvas.clearCanvas();let{gridConfig:e,scale:t,showGrid:n}=this.app.state;n&&(this.ctx.save(),this.ctx.scale(t,t),this.ctx.strokeStyle=e.strokeStyle,this.ctx.lineWidth=e.lineWidth,this.renderHorizontalLines(),this.renderVerticalLines(),this.ctx.restore())}showGrid(){this.app.updateState({showGrid:!0}),this.renderGrid()}hideGrid(){this.app.updateState({showGrid:!1}),this.canvas.clearCanvas()}updateGrid(e={}){this.app.updateState({gridConfig:u(u({},this.app.state.gridConfig),e)}),this.app.state.showGrid&&(this.hideGrid(),this.showGrid())}}const Xe={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,CapsLock:20,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"+":187,"-":189,"'":222,"/":191,".":190};for(let ct=0;ct<=9;ct++)Xe[ct]=ct+48;"abcdefghijklmnopqrstuvwxyz".split("").forEach((e,t)=>{Xe[e]=t+65});const qe=Xe;class Je{constructor(e){this.app=e,this.startScrollX=0,this.startScrollY=0,this.isDragMode=!1,this.onMove=j(this.onMove,this,16),this.bindEvent()}bindEvent(){this.app.event.on("keydown",e=>{e.keyCode===qe.Space&&(this.isDragMode=!0,this.app.cursor.set("grab"))}),this.app.event.on("keyup",e=>{this.isDragMode&&(this.isDragMode=!1,this.app.cursor.set("default"))})}setEditMode(){this.app.cursor.set("default"),this.app.updateState({readonly:!1})}setReadonlyMode(){this.app.cursor.set("grab"),this.app.updateState({readonly:!0})}onStart(){this.startScrollX=this.app.state.scrollX,this.startScrollY=this.app.state.scrollY}onMove(e,t){this.app.scrollTo(this.startScrollX-t.mouseOffset.originX/this.app.state.scale,this.startScrollY-t.mouseOffset.originY/this.app.state.scale)}onEnd(){this.startScrollX=0,this.startScrollY=0}}class $e{constructor(e){this.app=e,this.keyMap=qe,this.shortcutMap={},this.bindEvent()}bindEvent(){this.app.event.on("keydown",this.onKeydown,this)}unBindEvent(){this.app.event.off("keydown",this.onKeydown)}onKeydown(e){Object.keys(this.shortcutMap).forEach(t=>{this.checkKey(e,t)&&(e.stopPropagation(),e.preventDefault(),this.shortcutMap[t].forEach(e=>{e.fn.call(e.ctx)}))})}checkKey(e,t){let n=this.getOriginEventCodeArr(e),i=this.getKeyCodeArr(t);if(n.length!==i.length)return!1;for(let r=0;r<n.length;r++){let e=i.findIndex(e=>e===n[r]);if(-1===e)return!1;i.splice(e,1)}return!0}getOriginEventCodeArr(e){let t=[];return(e.ctrlKey||e.metaKey)&&t.push(qe["Control"]),e.altKey&&t.push(qe["Alt"]),e.shiftKey&&t.push(qe["Shift"]),t.includes(e.keyCode)||t.push(e.keyCode),t}getKeyCodeArr(e){e=e.replace(/\+\+/,"+add");let t=e.split(/\s*\+\s*/).map(e=>"add"===e?"+":e),n=[];return t.forEach(e=>{n.push(qe[e])}),n}addShortcut(e,t,n){e.split(/\s*\|\s*/).forEach(e=>{this.shortcutMap[e]?this.shortcutMap[e].push({fn:t,ctx:n}):this.shortcutMap[e]=[{fn:t,ctx:n}]})}removeShortcut(e,t){e.split(/\s*\|\s*/).forEach(e=>{if(this.shortcutMap[e])if(t){let n=this.shortcutMap[e].findIndex(e=>e.fn===t);-1!==n&&this.shortcutMap[e].splice(n,1)}else this.shortcutMap[e]=[],delete this.shortcutMap[e]})}}class Ye{constructor(e){this.app=e,this.beingCopyActiveElement=null,this.beingCopySelectedElements=[],this.registerShortcutKeys()}clearCanvas(){let{width:e,height:t}=this.app;return this.app.ctx.clearRect(-e/2,-t/2,e,t),this}render(){let{state:e}=this.app;return this.clearCanvas(),this.app.ctx.save(),this.app.ctx.scale(e.scale,e.scale),this.app.elements.elementList.forEach(e=>{e.noRender||e.render()}),this.app.group.render(),this.app.ctx.restore(),this}registerShortcutKeys(){this.app.keyCommand.addShortcut("Del|Backspace",()=>{this.deleteCurrentElements()}),this.app.keyCommand.addShortcut("Control+c",()=>{this.copyCurrentElement()}),this.app.keyCommand.addShortcut("Control+x",()=>{this.cutCurrentElement()}),this.app.keyCommand.addShortcut("Control+z",()=>{this.app.history.undo()}),this.app.keyCommand.addShortcut("Control+y",()=>{this.app.history.redo()}),this.app.keyCommand.addShortcut("Control+v",()=>{this.pasteCurrentElement(!0)}),this.app.keyCommand.addShortcut("Control++",()=>{this.zoomIn()}),this.app.keyCommand.addShortcut("Control+-",()=>{this.zoomOut()}),this.app.keyCommand.addShortcut("Shift+1",()=>{this.fit()}),this.app.keyCommand.addShortcut("Control+a",()=>{this.selectAll()}),this.app.keyCommand.addShortcut("Control+0",()=>{this.setZoom(1)}),this.app.keyCommand.addShortcut("Control+'",()=>{this.app.state.showGrid?this.app.grid.hideGrid():this.app.grid.showGrid()})}copyCurrentElement(){this.app.elements.activeElement?(this.beingCopySelectedElements=[],this.beingCopyElement=this.app.elements.activeElement):this.app.selection.hasSelectionElements()&&(this.beingCopyElement=null,this.beingCopySelectedElements=this.app.selection.getSelectionElements())}cutCurrentElement(){this.app.elements.activeElement?(this.copyCurrentElement(),this.deleteCurrentElements()):this.app.selection.hasSelectionElements()&&(this.copyCurrentElement(),this.deleteCurrentElements(),this.app.selection.setMultiSelectElements(this.beingCopySelectedElements),this.app.selection.emitChange())}pasteCurrentElement(e=!1){let t=null;if(e){let e=this.app.event.lastMousePos.x,n=this.app.event.lastMousePos.y;t={x:e,y:n}}this.beingCopyElement?this.copyElement(this.beingCopyElement,!1,t):this.beingCopySelectedElements.length>0&&(this.app.selection.selectElements(this.beingCopySelectedElements),this.app.selection.copySelectionElements(e?t:null))}deleteElement(e){this.app.elements.deleteElement(e),this.render(),this.app.emitChange()}copyElement(e,t=!1,n){return h(this,null,(function*(){this.app.elements.cancelActiveElement(),yield this.app.elements.copyElement(e,t,n),this.app.group.clearCopyMap(),this.render(),this.app.emitChange()}))}deleteActiveElement(){this.app.elements.hasActiveElement()&&this.deleteElement(this.app.elements.activeElement)}deleteCurrentElements(){this.deleteActiveElement(),this.app.selection.deleteSelectedElements()}moveUpCurrentElement(){this.moveLevelCurrentElement("up")}moveDownCurrentElement(){this.moveLevelCurrentElement("down")}moveTopCurrentElement(){this.moveLevelCurrentElement("top")}moveBottomCurrentElement(){this.moveLevelCurrentElement("bottom")}moveLevelCurrentElement(e){let t=null;if(this.app.elements.hasActiveElement()?t=this.app.elements.activeElement:1===this.app.selection.getSelectionElements().length&&(t=this.app.selection.getSelectionElements()[0]),!t)return;let n=this.app.elements.getElementIndex(t);this.app.elements.elementList.splice(n,1),"up"===e?this.app.elements.insertElement(t,n+1):"down"===e?this.app.elements.insertElement(t,n-1):"top"===e?this.app.elements.addElement(t):"bottom"===e&&this.app.elements.unshiftElement(t)}setActiveElementStyle(e={}){return this.app.elements.hasActiveElement()?(this.app.elements.setActiveElementStyle(e),this.render(),this.app.elements.isCreatingElement||this.app.emitChange(),this):this}setCurrentElementsStyle(e={}){this.setActiveElementStyle(e),this.app.selection.setSelectedElementStyle(e)}cancelActiveElement(){return this.app.elements.hasActiveElement()?(this.app.elements.cancelActiveElement(),this.render(),this):this}updateActiveElementPosition(e,t){return this.app.elements.hasActiveElement()?(this.app.elements.activeElement.updatePos(e,t),this.render(),this):this}updateActiveElementSize(e,t){return this.app.elements.hasActiveElement()?(this.app.elements.activeElement.updateSize(e,t),this.render(),this):this}updateActiveElementRotate(e){return this.app.elements.hasActiveElement()?(this.app.elements.activeElement.updateRotate(e),this.render(),this):this}empty(){this.app.elements.deleteAllElements(),this.render(),this.app.history.clear(),this.app.emitChange()}zoomIn(e=.1){this.app.updateState({scale:this.app.state.scale+e}),this.render(),this.app.emit("zoomChange",this.app.state.scale)}zoomOut(e=.1){this.app.updateState({scale:this.app.state.scale-e>0?this.app.state.scale-e:0}),this.render(),this.app.emit("zoomChange",this.app.state.scale)}setZoom(e){e<0||(this.app.updateState({scale:e}),this.render(),this.app.emit("zoomChange",this.app.state.scale))}fit(){if(!this.app.elements.hasElements())return;this.scrollToCenter();let{minx:e,maxx:t,miny:n,maxy:i}=H(this.app.elements.elementList),r=t-e,o=i-n,s=Math.min(this.app.width/r,this.app.height/o);console.log(s),this.setZoom(s)}scrollTo(e,t){this.app.updateState({scrollX:e,scrollY:t}),this.render(),this.app.emit("scrollChange",this.app.state.scrollX,this.app.state.scrollY)}scrollToCenter(){if(!this.app.elements.hasElements())return void this.scrollTo(0,0);let{minx:e,maxx:t,miny:n,maxy:i}=H(this.app.elements.elementList),r=t-e,o=i-n;this.scrollTo(e-(this.app.width-r)/2,n-(this.app.height-o)/2)}copyPasteCurrentElements(){this.copyCurrentElement(),this.pasteCurrentElement()}setBackgroundColor(e){this.app.updateState({backgroundColor:e}),this.app.background.set()}selectAll(){this.app.selection.selectElements(this.app.elements.elementList)}}class Ke{constructor(e){this.app=e,this.elementList=[],this.activeElement=null,this.isCreatingElement=!1,this.isResizing=!1,this.resizingElement=null,this.handleResize=j(this.handleResize,this,16)}serialize(e=!1){let t=this.elementList.map(e=>e.serialize());return e?JSON.stringify(t):t}getElementsNum(){return this.elementList.length}hasElements(){return this.elementList.length>0}addElement(e){return this.elementList.push(e),this}unshiftElement(e){return this.elementList.unshift(e),this}insertElement(e,t){this.elementList.splice(t,0,e)}deleteElement(e){let t=this.getElementIndex(e);return-1!==t&&(this.elementList.splice(t,1),e.isActive&&this.cancelActiveElement(e)),this}deleteAllElements(){return this.activeElement=null,this.elementList=[],this.isCreatingElement=!1,this.isResizing=!1,this.resizingElement=null,this}getElementIndex(e){return this.elementList.findIndex(t=>t===e)}createElementsFromData(e){return e.forEach(e=>{let t=this.pureCreateElement(e);t.isActive=!1,t.isCreating=!1,this.addElement(t)}),this.app.group.initIdToElementList(this.elementList),this}hasActiveElement(){return!!this.activeElement}setActiveElement(e){return this.cancelActiveElement(),this.activeElement=e,e&&(e.isActive=!0),this.app.emit("activeElementChange",this.activeElement),this}cancelActiveElement(){return this.hasActiveElement()?(this.activeElement.isActive=!1,this.activeElement=null,this.app.emit("activeElementChange",this.activeElement),this):this}checkIsHitElement(e){let t=e.unGridClientX,n=e.unGridClientY;for(let i=this.elementList.length-1;i>=0;i--){let e=this.elementList[i];if(e.isHit(t,n))return e}return null}pureCreateElement(e={}){switch(e.type){case"rectangle":return new xe(e,this.app);case"diamond":return new Ie(e,this.app);case"triangle":return new Te(e,this.app);case"circle":return new Re(e,this.app);case"freedraw":return new ke(e,this.app);case"image":return new Le(e,this.app);case"arrow":return new _e(e,this.app);case"line":return new Ae(e,this.app);case"text":return new Ne(e,this.app);default:return null}}createElement(e={},t=(()=>{}),n=null,i){if(this.hasActiveElement()||this.isCreatingElement)return this;let r=this.pureCreateElement(e);return r?(this.addElement(r),i||this.setActiveElement(r),this.isCreatingElement=!0,t.call(n,r),this):this}copyElement(e,t=!1,n){return new Promise(i=>h(this,null,(function*(){if(!e)return i();let r=this.app.group.handleCopyElementData(e.serialize());"image"===r.type&&(r.imageObj=yield W(r.url)),this.createElement(r,e=>{this.app.group.handleCopyElement(e),e.startResize($.BODY);let r=20,o=20;n&&(r=n.x-e.x-e.width/2,o=n.y-e.y-e.height/2);let s=this.app.coordinate.gridAdsorbent(r,o);e.resize(null,null,null,s.x,s.y),e.isCreating=!1,t&&(e.isActive=!1),this.isCreatingElement=!1,i(e)},this,t)})))}creatingRectangleLikeElement(e,t,n,i,r){this.createElement({type:e,x:t,y:n,width:i,height:r}),this.activeElement.updateSize(i,r)}creatingCircle(e,t,n){this.createElement({type:"circle",x:e,y:t});let i=v(n.clientX,n.clientY,e,t);this.activeElement.updateSize(i,i)}creatingFreedraw(e,t){this.createElement({type:"freedraw"});let n=this.activeElement,i=F(t.mouseSpeed,n.lastLineWidth);n.lastLineWidth=i,n.addPoint(e.clientX,e.clientY,i);let{coordinate:r,ctx:o,state:s}=this.app,a=r.transformToCanvasCoordinate(r.subScrollX(t.lastMousePos.x),r.subScrollY(t.lastMousePos.y)),c=r.transformToCanvasCoordinate(r.subScrollX(e.clientX),r.subScrollY(e.clientY));o.save(),o.scale(s.scale,s.scale),n.singleRender(a.x,a.y,c.x,c.y,i),o.restore()}creatingImage(e,{width:t,height:n,imageObj:i,url:r,ratio:o}){let s=this.app.coordinate.gridAdsorbent(e.unGridClientX-t/2,e.unGridClientY-n/2);this.createElement({type:"image",x:s.x,y:s.y,url:r,imageObj:i,width:t,height:n,ratio:o})}editingText(e){"text"===e.type&&(e.noRender=!0,this.setActiveElement(e))}completeEditingText(){let e=this.activeElement;if(e&&"text"===e.type)return e.text.trim()?void(e.noRender=!1):(this.deleteElement(e),void this.setActiveElement(null))}completeCreateArrow(e){this.activeElement.addPoint(e.clientX,e.clientY)}creatingArrow(e,t,n){this.createElement({type:"arrow",x:e,y:t},n=>{n.addPoint(e,t)}),this.activeElement.updateFictitiousPoint(n.clientX,n.clientY)}creatingLine(e,t,n,i=!1,r=!1){r||this.createElement({type:"line",x:e,y:t,isSingle:i},n=>{n.addPoint(e,t)});let o=this.activeElement;o&&o.updateFictitiousPoint(n.clientX,n.clientY)}completeCreateLine(e,t=(()=>{})){let n=this.activeElement,i=e.clientX,r=e.clientY;n&&n.isSingle?(n.addPoint(i,r),t()):(this.createElement({type:"line",isSingle:!1}),n=this.activeElement,n.addPoint(i,r),n.updateFictitiousPoint(i,r))}completeCreateElement(){this.isCreatingElement=!1;let e=this.activeElement;return e?(["freedraw","arrow","line"].includes(e.type)&&e.updateMultiPointBoundingRect(),e.isCreating=!1,this.app.emitChange(),this):this}setActiveElementStyle(e={}){return this.hasActiveElement()?(Object.keys(e).forEach(t=>{this.activeElement.style[t]=e[t],"fontSize"===t&&"text"===this.activeElement.type&&this.activeElement.updateTextSize()}),this):this}checkInResizeHand(e,t){let n=this.activeElement,i=n.dragElement.checkPointInDragElementWhere(e,t);return i?{element:n,hand:i}:null}checkIsResize(e,t,n){if(!this.hasActiveElement())return!1;let i=this.checkInResizeHand(e,t);return!!i&&(this.isResizing=!0,this.resizingElement=i.element,this.resizingElement.startResize(i.hand,n),this.app.cursor.setResize(i.hand),!0)}handleResize(...e){this.isResizing&&(this.resizingElement.resize(...e),this.app.render.render())}endResize(){this.isResizing=!1,this.resizingElement.endResize(),this.resizingElement=null}}let Qe;const Ze=new Uint8Array(16);function et(){if(!Qe&&(Qe="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Qe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Qe(Ze)}const tt=[];for(let ct=0;ct<256;++ct)tt.push((ct+256).toString(16).slice(1));function nt(e,t=0){return(tt[e[t+0]]+tt[e[t+1]]+tt[e[t+2]]+tt[e[t+3]]+"-"+tt[e[t+4]]+tt[e[t+5]]+"-"+tt[e[t+6]]+tt[e[t+7]]+"-"+tt[e[t+8]]+tt[e[t+9]]+"-"+tt[e[t+10]]+tt[e[t+11]]+tt[e[t+12]]+tt[e[t+13]]+tt[e[t+14]]+tt[e[t+15]]).toLowerCase()}const it="undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var rt={randomUUID:it};function ot(e,t,n){if(rt.randomUUID&&!t&&!e)return rt.randomUUID();e=e||{};const i=e.random||(e.rng||et)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=i[e];return t}return nt(i)}class st{constructor(e){this.app=e,this.groupIdToElementList={},this.newGroupIdMap={}}render(){Object.keys(this.groupIdToElementList).forEach(e=>{let t=this.groupIdToElementList[e],n=t[0].isSelected;if(n){let e=new He({type:"multiSelectElement"},this.app);e.setSelectedElementList(t),e.updateRect(),e.dragElement.onlyShowBody(),e.render()}})}setToMap(e){let t=e.getGroupId();t&&(this.groupIdToElementList[t]||(this.groupIdToElementList[t]=[]),this.groupIdToElementList[t].push(e))}initIdToElementList(e){this.groupIdToElementList={},e.forEach(e=>{this.setToMap(e)})}handleCopyElementData(e){return e.groupId&&(this.newGroupIdMap[e.groupId]?e.groupId=this.newGroupIdMap[e.groupId]:e.groupId=this.newGroupIdMap[e.groupId]=ot()),e}clearCopyMap(){this.newGroupIdMap={}}handleCopyElement(e){this.setToMap(e)}dogroup(){if(!this.app.selection.hasSelection||this.app.selection.multiSelectElement.selectedElementList.length<=1)return;let e=this.app.selection.multiSelectElement.selectedElementList,t=ot();this.groupIdToElementList[t]=e,e.forEach(e=>{e.setGroupId(t)}),this.app.render.render(),this.app.emitChange()}ungroup(){if(!this.app.selection.hasSelection||this.app.selection.multiSelectElement.selectedElementList.length<=1)return;let e=this.app.selection.multiSelectElement.selectedElementList,t=e[0].getGroupId();this.groupIdToElementList[t]=[],delete this.groupIdToElementList[t],e.forEach(e=>{e.removeGroupId(t)}),this.app.render.render(),this.app.emitChange()}setSelection(e){let t=e.getGroupId();this.groupIdToElementList[t]&&this.app.selection.selectElements(this.groupIdToElementList[t])}getGroupElements(e){let t=e.getGroupId();return this.groupIdToElementList[t]||[]}}class at extends f{constructor(e={}){if(super(),this.opts=e,this.container=e.container,this.drawType=e.drawType||"selection",!this.container)throw new Error("缺少 container 参数！");if(!["absolute","fixed","relative"].includes(window.getComputedStyle(this.container).position))throw new Error("container元素需要设置定位！");this.width=0,this.height=0,this.left=0,this.top=0,this.canvas=null,this.ctx=null,this.state=u({scale:1,scrollX:0,scrollY:0,scrollStep:50,backgroundColor:"",strokeStyle:"#000000",fillStyle:"transparent",fontFamily:"微软雅黑, Microsoft YaHei",fontSize:18,dragStrokeStyle:"#666",showGrid:!1,readonly:!1,gridConfig:{size:20,strokeStyle:"#dfe0e1",lineWidth:1}},e.state||{}),this.initCanvas(),this.coordinate=new Se(this),this.event=new we(this),this.event.on("mousedown",this.onMousedown,this),this.event.on("mousemove",this.onMousemove,this),this.event.on("mouseup",this.onMouseup,this),this.event.on("dblclick",this.onDblclick,this),this.event.on("mousewheel",this.onMousewheel,this),this.event.on("contextmenu",this.onContextmenu,this),this.keyCommand=new $e(this),this.imageEdit=new De(this),this.imageEdit.on("imageSelectChange",this.onImageSelectChange,this),this.textEdit=new Be(this),this.textEdit.on("blur",this.onTextInputBlur,this),this.cursor=new Ve(this),this.history=new je(this),this.export=new Fe(this),this.background=new Ue(this),this.selection=new We(this),this.group=new st(this),this.grid=new Ge(this),this.mode=new Je(this),this.elements=new Me(this),this.render=new Ye(this),this.proxy(),this.checkIsOnElement=j(this.checkIsOnElement,this),this.emitChange(),this.helpUpdate()}proxy(){["undo","redo"].forEach(e=>{this[e]=this.history[e].bind(this.history)}),[].forEach(e=>{this[e]=this.elements[e].bind(this.elements)}),["deleteElement","setActiveElementStyle","setCurrentElementsStyle","cancelActiveElement","deleteActiveElement","deleteCurrentElements","empty","zoomIn","zoomOut","setZoom","scrollTo","scrollToCenter","copyPasteCurrentElements","setBackgroundColor","copyElement","copyCurrentElement","cutCurrentElement","pasteCurrentElement","updateActiveElementRotate","updateActiveElementSize","updateActiveElementPosition","moveBottomCurrentElement","moveTopCurrentElement","moveUpCurrentElement","moveDownCurrentElement","selectAll","fit"].forEach(e=>{this[e]=this.render[e].bind(this.render)}),["exportImage","exportJson"].forEach(e=>{this[e]=this.export[e].bind(this.export)}),["setSelectedElementStyle"].forEach(e=>{this[e]=this.selection[e].bind(this.selection)}),["dogroup","ungroup"].forEach(e=>{this[e]=this.group[e].bind(this.group)}),["showGrid","hideGrid","updateGrid"].forEach(e=>{this[e]=this.grid[e].bind(this.grid)}),["setEditMode","setReadonlyMode"].forEach(e=>{this[e]=this.mode[e].bind(this.mode)})}getContainerRectInfo(){let{width:e,height:t,left:n,top:i}=this.container.getBoundingClientRect();this.width=e,this.height=t,this.left=n,this.top=i}helpUpdate(){this.background.set(),this.state.showGrid&&this.grid.showGrid(),this.state.readonly&&this.setReadonlyMode()}setData(e,t){return h(this,arguments,(function*({state:e={},elements:t=[]},n){this.state=e;for(let i=0;i<t.length;i++)"image"===t[i].type&&(t[i].imageObj=yield W(t[i].url));this.helpUpdate(),this.elements.deleteAllElements().createElementsFromData(t),this.render.render(),n||this.emitChange()}))}initCanvas(){this.getContainerRectInfo(),this.canvas&&this.container.removeChild(this.canvas);let{canvas:e,ctx:t}=m(this.width,this.height,{className:"main"});this.canvas=e,this.ctx=t,this.container.appendChild(this.canvas)}resize(){this.initCanvas(),this.render.render(),this.selection.init(),this.grid.init(),this.grid.renderGrid()}updateState(e={}){this.state=u(u({},this.state),e),this.emitChange()}updateCurrentType(e){this.drawType=e,"image"===this.drawType&&this.imageEdit.selectImage(),"eraser"===this.drawType?(this.cursor.setEraser(),this.cancelActiveElement()):"selection"!==this.drawType?this.cursor.setCrosshair():this.cursor.reset(),this.emit("currentTypeChange",this.drawType)}getData(){return{state:u({},this.state),elements:this.elements.serialize()}}onImageSelectChange(){this.cursor.hide()}onMousedown(e,t){if(this.state.readonly||this.mode.isDragMode)this.mode.onStart();else if(!this.elements.isCreatingElement&&!this.textEdit.isEditing){let n=this.elements.checkIsHitElement(e);if("selection"===this.drawType)if(this.elements.hasActiveElement()){let i=this.elements.checkIsResize(t.mousedownPos.unGridClientX,t.mousedownPos.unGridClientY,e);i||(this.elements.setActiveElement(n),this.render.render())}else if(this.selection.hasSelection){let i=this.selection.checkIsResize(t.mousedownPos.unGridClientX,t.mousedownPos.unGridClientY,e);i||(this.selection.reset(),this.elements.setActiveElement(n),this.render.render())}else n?n.hasGroup()?(this.group.setSelection(n),this.onMousedown(e,t)):(this.elements.setActiveElement(n),this.render.render(),this.onMousedown(e,t)):this.selection.onMousedown(e,t);else"eraser"===this.drawType&&this.deleteElement(n)}}onMousemove(e,t){if(this.state.readonly||this.mode.isDragMode)t.isMousedown&&this.mode.onMove(e,t);else if(t.isMousedown){let n=t.mousedownPos.x,i=t.mousedownPos.y,r=Math.max(t.mouseOffset.x,0),o=Math.max(t.mouseOffset.y,0);"selection"===this.drawType?this.selection.isResizing?this.selection.handleResize(e,n,i,t.mouseOffset.x,t.mouseOffset.y):this.selection.creatingSelection?this.selection.onMousemove(e,t):this.elements.handleResize(e,n,i,t.mouseOffset.x,t.mouseOffset.y):["rectangle","diamond","triangle"].includes(this.drawType)?(this.elements.creatingRectangleLikeElement(this.drawType,n,i,r,o),this.render.render()):"circle"===this.drawType?(this.elements.creatingCircle(n,i,e),this.render.render()):"freedraw"===this.drawType?this.elements.creatingFreedraw(e,t):"arrow"===this.drawType?(this.elements.creatingArrow(n,i,e),this.render.render()):"line"===this.drawType&&v(n,i,e.clientX,e.clientY)>3&&(this.elements.creatingLine(n,i,e,!0),this.render.render())}else if(this.imageEdit.isReady)this.cursor.hide(),this.imageEdit.updatePreviewElPos(e.originEvent.clientX,e.originEvent.clientY);else if("selection"===this.drawType)if(this.elements.hasActiveElement()){let t="";(t=this.elements.checkInResizeHand(e.unGridClientX,e.unGridClientY))?this.cursor.setResize(t.hand):this.checkIsOnElement(e)}else if(this.selection.hasSelection){let t=this.selection.checkInResizeHand(e.unGridClientX,e.unGridClientY);t?this.cursor.setResize(t):this.checkIsOnElement(e)}else this.checkIsOnElement(e);else"line"===this.drawType&&(this.elements.creatingLine(null,null,e,!1,!0),this.render.render())}checkIsOnElement(e){let t=this.elements.checkIsHitElement(e);t?this.cursor.setMove():this.cursor.reset()}resetCurrentType(){"selection"!==this.drawType&&(this.drawType="selection",this.emit("currentTypeChange","selection"))}completeCreateNewElement(){this.resetCurrentType(),this.elements.completeCreateElement(),this.render.render()}onMouseup(e){this.state.readonly||this.mode.isDragMode||("text"===this.drawType?this.textEdit.isEditing||(this.createTextElement(e),this.resetCurrentType()):this.imageEdit.isReady?(this.elements.creatingImage(e,this.imageEdit.imageData),this.completeCreateNewElement(),this.cursor.reset(),this.imageEdit.reset()):"arrow"===this.drawType?(this.elements.completeCreateArrow(e),this.completeCreateNewElement()):"line"===this.drawType?(this.elements.completeCreateLine(e,()=>{this.completeCreateNewElement()}),this.render.render()):this.elements.isCreatingElement?"freedraw"===this.drawType?(this.elements.completeCreateElement(),this.elements.setActiveElement()):this.completeCreateNewElement():this.elements.isResizing?(this.elements.endResize(),this.emitChange()):this.selection.creatingSelection?this.selection.onMouseup(e):this.selection.isResizing&&(this.selection.endResize(),this.emitChange()))}onDblclick(e){if("line"===this.drawType)this.completeCreateNewElement();else{let t=this.elements.checkIsHitElement(e);t?"text"===t.type&&(this.elements.editingText(t),this.render.render(),this.keyCommand.unBindEvent(),this.textEdit.showTextEdit()):this.textEdit.isEditing||this.createTextElement(e)}}onTextInputBlur(){this.keyCommand.bindEvent(),this.elements.completeEditingText(),this.render.render(),this.emitChange()}createTextElement(e){this.elements.createElement({type:"text",x:e.clientX,y:e.clientY}),this.keyCommand.unBindEvent(),this.textEdit.showTextEdit()}onMousewheel(e){let t=this.state.scrollStep/this.state.scale,n="down"===e?t:-t;this.scrollTo(this.state.scrollX,this.state.scrollY+n)}onContextmenu(e){let t=[];this.elements.hasActiveElement()?t=[this.elements.activeElement]:this.selection.hasSelectionElements()&&(t=this.selection.getSelectionElements()),this.emit("contextmenu",e.originEvent,t)}emitChange(){let e=this.getData();this.history.add(e),this.emit("change",e)}}at.utils=q,at.checkHit=ae,at.draw=ye,at.elements=Ke},ace4:function(e,t,n){"use strict";var i=n("23e7"),r=n("d039"),o=n("621a"),s=n("825a"),a=n("23cb"),c=n("50c4"),l=n("4840"),u=o.ArrayBuffer,d=o.DataView,h=u.prototype.slice,p=r((function(){return!new u(2).slice(1,void 0).byteLength}));i({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:p},{slice:function(e,t){if(void 0!==h&&void 0===t)return h.call(s(this),e);var n=s(this).byteLength,i=a(e,n),r=a(void 0===t?n:t,n),o=new(l(this,u))(c(r-i)),p=new d(this),f=new d(o),m=0;while(i<r)f.setUint8(m++,p.getUint8(i++));return o}})},ad42:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.RecordingEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r,o){var s=e.call(this,!1,t,n)||this;return s.id=i,r!==i&&(s.name=r),s.reason=o,s}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.RecordingEvent=o},af24:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0;var i=n("0cf2"),r=n("f66e"),o=n("e9cb"),s=r.OpenViduLogger.getInstance(),a=function(){function e(e,t){this.session=e,this.disposed=!1;var n="'Connection' created ";t.role?(this.localOptions=t,this.connectionId=this.localOptions.id,this.creationTime=this.localOptions.createdAt,this.data=this.localOptions.metadata,this.rpcSessionId=this.localOptions.sessionId,this.role=this.localOptions.role,this.record=this.localOptions.record,n+="(local)"):(this.remoteOptions=t,this.connectionId=this.remoteOptions.id,this.creationTime=this.remoteOptions.createdAt,this.remoteOptions.metadata&&(this.data=this.remoteOptions.metadata),this.remoteOptions.streams&&this.initRemoteStreams(this.remoteOptions.streams),n+="(remote) with 'connectionId' ["+this.remoteOptions.id+"]"),s.info(n)}return e.prototype.sendIceCandidate=function(e){var t=this;this.disposed?s.warn("Connection ".concat(this.connectionId," disposed when trying to send an ICE candidate. ICE candidate not sent")):(s.debug((this.stream.outboundStreamOpts?"Local":"Remote")+"candidate for"+this.connectionId,e),this.session.openvidu.sendRequest("onIceCandidate",{endpointName:this.connectionId,candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex},(function(e,n){e&&(s.error("Error sending ICE candidate: "+JSON.stringify(e)),t.session.emitEvent("exception",[new o.ExceptionEvent(t.session,o.ExceptionEventName.ICE_CANDIDATE_ERROR,t.session,"There was an unexpected error on the server-side processing an ICE candidate generated and sent by the client-side",e)]))})))},e.prototype.initRemoteStreams=function(e){var t=this;e.forEach((function(e){var n={id:e.id,createdAt:e.createdAt,connection:t,hasAudio:e.hasAudio,hasVideo:e.hasVideo,audioActive:e.audioActive,videoActive:e.videoActive,typeOfVideo:e.typeOfVideo,frameRate:e.frameRate,videoDimensions:e.videoDimensions?JSON.parse(e.videoDimensions):void 0,filter:e.filter?e.filter:void 0},r=new i.Stream(t.session,n);t.addStream(r)})),s.info("Remote 'Connection' with 'connectionId' ["+this.connectionId+"] is now configured for receiving Streams with options: ",this.stream.inboundStreamOpts)},e.prototype.addStream=function(e){e.connection=this,this.stream=e},e.prototype.removeStream=function(){delete this.stream},e.prototype.dispose=function(){this.disposed=!0,this.removeStream()},e}();t.Connection=a},b2e1:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.SignalEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r){var o=e.call(this,!1,t,"signal")||this;return n&&(o.type="signal:"+n),o.data=i,o.from=r,o}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.SignalEvent=o},b489:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalRecorder=void 0;var i,r=n("627d"),o=n("f66e"),s=n("e237"),a=n("1946"),c=o.OpenViduLogger.getInstance(),l=function(){function e(e){this.stream=e,this.chunks=[],i=s.PlatformUtils.getInstance(),this.connectionId=this.stream.connection?this.stream.connection.connectionId:"default-connection",this.id=this.stream.streamId+"_"+this.connectionId+"_localrecord",this.state=r.LocalRecorderState.READY}return e.prototype.record=function(e){var t=this;return new Promise((function(n,i){try{if("string"===typeof e||e instanceof String)return i("When calling LocalRecorder.record(options) parameter 'options' cannot be a string. Must be an object like { mimeType: \"".concat(e,'" }'));if("undefined"===typeof MediaRecorder)throw c.error("MediaRecorder not supported on your device. See compatibility in https://caniuse.com/#search=MediaRecorder"),Error("MediaRecorder not supported on your device. See compatibility in https://caniuse.com/#search=MediaRecorder");if(t.state!==r.LocalRecorderState.READY)throw Error("'LocalRecord.record()' needs 'LocalRecord.state' to be 'READY' (current value: '"+t.state+"'). Call 'LocalRecorder.clean()' or init a new LocalRecorder before");c.log("Starting local recording of stream '"+t.stream.streamId+"' of connection '"+t.connectionId+"'"),e?e.mimeType||(e.mimeType="video/webm"):e={mimeType:"video/webm"},t.mediaRecorder=new MediaRecorder(t.stream.getMediaStream(),e),t.mediaRecorder.start()}catch(o){return i(o)}return t.mediaRecorder.ondataavailable=function(e){e.data.size>0&&t.chunks.push(e.data)},t.mediaRecorder.onerror=function(e){c.error("MediaRecorder error: ",e)},t.mediaRecorder.onstart=function(){c.log("MediaRecorder started (state="+t.mediaRecorder.state+")")},t.mediaRecorder.onstop=function(){t.onStopDefault()},t.mediaRecorder.onpause=function(){c.log("MediaRecorder paused (state="+t.mediaRecorder.state+")")},t.mediaRecorder.onresume=function(){c.log("MediaRecorder resumed (state="+t.mediaRecorder.state+")")},t.state=r.LocalRecorderState.RECORDING,n()}))},e.prototype.stop=function(){var e=this;return new Promise((function(t,n){try{if(e.state===r.LocalRecorderState.READY||e.state===r.LocalRecorderState.FINISHED)throw Error("'LocalRecord.stop()' needs 'LocalRecord.state' to be 'RECORDING' or 'PAUSED' (current value: '"+e.state+"'). Call 'LocalRecorder.start()' before");e.mediaRecorder.onstop=function(){return e.onStopDefault(),t()},e.mediaRecorder.stop()}catch(i){return n(i)}}))},e.prototype.pause=function(){var e=this;return new Promise((function(t,n){try{return e.state!==r.LocalRecorderState.RECORDING?n(Error("'LocalRecord.pause()' needs 'LocalRecord.state' to be 'RECORDING' (current value: '"+e.state+"'). Call 'LocalRecorder.start()' or 'LocalRecorder.resume()' before")):(e.mediaRecorder.pause(),e.state=r.LocalRecorderState.PAUSED,t())}catch(i){return n(i)}}))},e.prototype.resume=function(){var e=this;return new Promise((function(t,n){try{if(e.state!==r.LocalRecorderState.PAUSED)throw Error("'LocalRecord.resume()' needs 'LocalRecord.state' to be 'PAUSED' (current value: '"+e.state+"'). Call 'LocalRecorder.pause()' before");return e.mediaRecorder.resume(),e.state=r.LocalRecorderState.RECORDING,t()}catch(i){return n(i)}}))},e.prototype.preview=function(e){if(this.state!==r.LocalRecorderState.FINISHED)throw Error("'LocalRecord.preview()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");if(this.videoPreview=document.createElement("video"),this.videoPreview.id=this.id,this.videoPreview.autoplay=!0,i.isSafariBrowser()&&(this.videoPreview.playsInline=!0),"string"===typeof e){var t=document.getElementById(e);t&&(this.videoPreview=t.appendChild(this.videoPreview))}else this.videoPreview=e.appendChild(this.videoPreview);return this.videoPreview.src=this.videoPreviewSrc,this.videoPreview},e.prototype.clean=function(){var e=this,t=function(){delete e.blob,e.chunks=[],e.state=r.LocalRecorderState.READY};this.state===r.LocalRecorderState.RECORDING||this.state===r.LocalRecorderState.PAUSED?this.stop().then((function(){return t()})).catch((function(){return t()})):t()},e.prototype.download=function(){if(this.state!==r.LocalRecorderState.FINISHED)throw Error("'LocalRecord.download()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");var e=document.createElement("a");e.style.display="none",document.body.appendChild(e);var t=globalThis.URL.createObjectURL(this.blob);e.href=t,e.download=this.id+"."+a.getExtension(this.blob.type),e.click(),globalThis.URL.revokeObjectURL(t),document.body.removeChild(e)},e.prototype.getBlob=function(){if(this.state!==r.LocalRecorderState.FINISHED)throw Error("Call 'LocalRecord.stop()' before getting Blob file");return this.blob},e.prototype.uploadAsBinary=function(e,t){var n=this;return new Promise((function(i,o){if(n.state!==r.LocalRecorderState.FINISHED)return o(Error("'LocalRecord.uploadAsBinary()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));var s=new XMLHttpRequest;if(s.open("POST",e,!0),"object"===typeof t)for(var a=0,c=Object.keys(t);a<c.length;a++){var l=c[a];s.setRequestHeader(l,t[l])}s.onreadystatechange=function(){if(4===s.readyState)return"2"===s.status.toString().charAt(0)?i(s.responseText):o(s.status)},s.send(n.blob)}))},e.prototype.uploadAsMultipartfile=function(e,t){var n=this;return new Promise((function(i,o){if(n.state!==r.LocalRecorderState.FINISHED)return o(Error("'LocalRecord.uploadAsMultipartfile()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));var s=new XMLHttpRequest;if(s.open("POST",e,!0),"object"===typeof t)for(var c=0,l=Object.keys(t);c<l.length;c++){var u=l[c];s.setRequestHeader(u,t[u])}var d=new FormData;d.append("file",n.blob,n.id+"."+a.getExtension(n.blob.type)),s.onreadystatechange=function(){if(4===s.readyState)return"2"===s.status.toString().charAt(0)?i(s.responseText):o(s.status)},s.send(d)}))},e.prototype.onStopDefault=function(){c.log("MediaRecorder stopped  (state="+this.mediaRecorder.state+")"),this.blob=new Blob(this.chunks,{type:this.mediaRecorder.mimeType}),this.chunks=[],this.videoPreviewSrc=globalThis.URL.createObjectURL(this.blob),this.state=r.LocalRecorderState.FINISHED},e}();t.LocalRecorder=l},b793:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeOfVideo=void 0,function(e){e["CAMERA"]="CAMERA",e["SCREEN"]="SCREEN",e["CUSTOM"]="CUSTOM",e["IPCAM"]="IPCAM"}(t.TypeOfVideo||(t.TypeOfVideo={}))},bea1:function(e){e.exports=JSON.parse('{"_from":"openvidu-browser@2.25.0","_id":"openvidu-browser@2.25.0","_inBundle":false,"_integrity":"sha512-arDKARUXCbt39AE3shLjgrsZR/1jwHlE81OGZGq8MLVHWALGEbvcZyjpYGFtymmwhYsAH6QcLh60Y3+fJoF7Ww==","_location":"/openvidu-browser","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"openvidu-browser@2.25.0","name":"openvidu-browser","escapedName":"openvidu-browser","rawSpec":"2.25.0","saveSpec":null,"fetchSpec":"2.25.0"},"_requiredBy":["/"],"_resolved":"https://registry.npmmirror.com/openvidu-browser/-/openvidu-browser-2.25.0.tgz","_shasum":"7d6ca7b6f2805d7d3fc12a8e4be1f50899da1214","_spec":"openvidu-browser@2.25.0","_where":"D:\\\\workspace\\\\insmess-meeting-web","author":{"name":"OpenVidu"},"bugs":{"url":"https://github.com/OpenVidu/openvidu/issues"},"bundleDependencies":false,"dependencies":{"events":"3.3.0","freeice":"2.2.2","hark":"1.2.3","inherits":"2.0.4","jsnlog":"2.30.0","mime":"3.0.0","platform":"1.3.6","semver":"7.3.8","uuid":"9.0.0","wolfy87-eventemitter":"5.2.9"},"deprecated":false,"description":"OpenVidu Browser","devDependencies":{"@types/node":"18.11.9","@types/platform":"1.3.4","browserify":"17.0.0","grunt":"1.5.3","grunt-cli":"1.4.3","grunt-contrib-copy":"1.0.0","grunt-contrib-sass":"2.0.0","grunt-contrib-uglify":"5.2.2","grunt-contrib-watch":"1.1.0","grunt-postcss":"0.9.0","grunt-string-replace":"1.3.3","grunt-ts":"6.0.0-beta.22","terser":"5.15.1","tsify":"5.0.4","tslint":"6.1.3","typedoc":"0.23.21","typescript":"4.9.3"},"homepage":"https://github.com/OpenVidu/openvidu#readme","license":"Apache-2.0","main":"lib/index.js","name":"openvidu-browser","repository":{"type":"git","url":"git://github.com/OpenVidu/openvidu.git"},"scripts":{"browserify":"VERSION=${VERSION:-dev}; mkdir -p static/js/ && cd src && ../node_modules/browserify/bin/cmd.js Main.ts -p [ tsify ] --exclude kurento-browser-extensions --debug -o ../static/js/openvidu-browser-$VERSION.js -v","browserify-prod":"VERSION=${VERSION:-dev}; mkdir -p static/js/ && cd src && ../node_modules/browserify/bin/cmd.js --debug Main.ts -p [ tsify ] --exclude kurento-browser-extensions | ../node_modules/terser/bin/terser --source-map content=inline --output ../static/js/openvidu-browser-$VERSION.min.js","build":"cd src/OpenVidu && ./../../node_modules/typescript/bin/tsc && cd ../.. && ./node_modules/typescript/bin/tsc --declaration src/index.ts --outDir ./lib --sourceMap --target es5 --lib dom,es5,es2015.promise,scripthost && rm -rf ./ts4.4 && mkdir -p ./ts4.4/lib && cp -r ./lib ./ts4.4 && find ./ts4.4/lib -type f ! -iname \'*.d.ts\' -delete && ./config/replace_for_ts44.sh","docs":"./generate-docs.sh"},"types":"lib/index.d.ts","typesVersions":{"<4.4":{"*":["ts4.4/*"]}},"version":"2.25.0"}')},bf19:function(e,t,n){"use strict";var i=n("23e7");i({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}})},bf54:function(e,t,n){const i=n("9923"),r=(e,t)=>new i(e,t).major;e.exports=r},c09e:function(e){e.exports=JSON.parse("[]")},c19f:function(e,t,n){"use strict";var i=n("23e7"),r=n("da84"),o=n("621a"),s=n("2626"),a="ArrayBuffer",c=o[a],l=r[a];i({global:!0,forced:l!==c},{ArrayBuffer:c}),s(a)},c1a9:function(e,t){e.exports={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]}},cf14:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleLogger=void 0;var i=function(){function e(e){this.logger=e,this.log=e.log,this.info=e.info,this.debug=e.debug,this.warn=e.warn,this.error=e.error}return e}();t.ConsoleLogger=i},d2ca:function(e,t,n){"use strict";let i;n.r(t),n.d(t,"v1",(function(){return E})),n.d(t,"v3",(function(){return j})),n.d(t,"v4",(function(){return H})),n.d(t,"v5",(function(){return $})),n.d(t,"NIL",(function(){return Y})),n.d(t,"version",(function(){return Q})),n.d(t,"validate",(function(){return c})),n.d(t,"stringify",(function(){return h})),n.d(t,"parse",(function(){return y}));const r=new Uint8Array(16);function o(){if(!i&&(i="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!i))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(r)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function a(e){return"string"===typeof e&&s.test(e)}var c=a;const l=[];for(let Z=0;Z<256;++Z)l.push((Z+256).toString(16).slice(1));function u(e,t=0){return(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase()}function d(e,t=0){const n=u(e,t);if(!c(n))throw TypeError("Stringified UUID is invalid");return n}var h=d;let p,f,m=0,v=0;function g(e,t,n){let i=t&&n||0;const r=t||new Array(16);e=e||{};let s=e.node||p,a=void 0!==e.clockseq?e.clockseq:f;if(null==s||null==a){const t=e.random||(e.rng||o)();null==s&&(s=p=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==a&&(a=f=16383&(t[6]<<8|t[7]))}let c=void 0!==e.msecs?e.msecs:Date.now(),l=void 0!==e.nsecs?e.nsecs:v+1;const d=c-m+(l-v)/1e4;if(d<0&&void 0===e.clockseq&&(a=a+1&16383),(d<0||c>m)&&void 0===e.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");m=c,v=l,f=a,c+=122192928e5;const h=(1e4*(268435455&c)+l)%4294967296;r[i++]=h>>>24&255,r[i++]=h>>>16&255,r[i++]=h>>>8&255,r[i++]=255&h;const g=c/4294967296*1e4&268435455;r[i++]=g>>>8&255,r[i++]=255&g,r[i++]=g>>>24&15|16,r[i++]=g>>>16&255,r[i++]=a>>>8|128,r[i++]=255&a;for(let o=0;o<6;++o)r[i+o]=s[o];return t||u(r)}var E=g;function b(e){if(!c(e))throw TypeError("Invalid UUID");let t;const n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n}var y=b;function S(e){e=unescape(encodeURIComponent(e));const t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}const w="6ba7b810-9dad-11d1-80b4-00c04fd430c8",C="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function O(e,t,n){function i(e,i,r,o){var s;if("string"===typeof e&&(e=S(e)),"string"===typeof i&&(i=y(i)),16!==(null===(s=i)||void 0===s?void 0:s.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+e.length);if(a.set(i),a.set(e,i.length),a=n(a),a[6]=15&a[6]|t,a[8]=63&a[8]|128,r){o=o||0;for(let e=0;e<16;++e)r[o+e]=a[e];return r}return u(a)}try{i.name=e}catch(r){}return i.DNS=w,i.URL=C,i}function x(e){if("string"===typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return R(T(P(e),8*e.length))}function R(e){const t=[],n=32*e.length,i="0123456789abcdef";for(let r=0;r<n;r+=8){const n=e[r>>5]>>>r%32&255,o=parseInt(i.charAt(n>>>4&15)+i.charAt(15&n),16);t.push(o)}return t}function I(e){return 14+(e+64>>>9<<4)+1}function T(e,t){e[t>>5]|=128<<t%32,e[I(t)-1]=t;let n=1732584193,i=-271733879,r=-1732584194,o=271733878;for(let s=0;s<e.length;s+=16){const t=n,a=i,c=r,l=o;n=A(n,i,r,o,e[s],7,-680876936),o=A(o,n,i,r,e[s+1],12,-389564586),r=A(r,o,n,i,e[s+2],17,606105819),i=A(i,r,o,n,e[s+3],22,-1044525330),n=A(n,i,r,o,e[s+4],7,-176418897),o=A(o,n,i,r,e[s+5],12,1200080426),r=A(r,o,n,i,e[s+6],17,-1473231341),i=A(i,r,o,n,e[s+7],22,-45705983),n=A(n,i,r,o,e[s+8],7,1770035416),o=A(o,n,i,r,e[s+9],12,-1958414417),r=A(r,o,n,i,e[s+10],17,-42063),i=A(i,r,o,n,e[s+11],22,-1990404162),n=A(n,i,r,o,e[s+12],7,1804603682),o=A(o,n,i,r,e[s+13],12,-40341101),r=A(r,o,n,i,e[s+14],17,-1502002290),i=A(i,r,o,n,e[s+15],22,1236535329),n=N(n,i,r,o,e[s+1],5,-165796510),o=N(o,n,i,r,e[s+6],9,-1069501632),r=N(r,o,n,i,e[s+11],14,643717713),i=N(i,r,o,n,e[s],20,-373897302),n=N(n,i,r,o,e[s+5],5,-701558691),o=N(o,n,i,r,e[s+10],9,38016083),r=N(r,o,n,i,e[s+15],14,-660478335),i=N(i,r,o,n,e[s+4],20,-405537848),n=N(n,i,r,o,e[s+9],5,568446438),o=N(o,n,i,r,e[s+14],9,-1019803690),r=N(r,o,n,i,e[s+3],14,-187363961),i=N(i,r,o,n,e[s+8],20,1163531501),n=N(n,i,r,o,e[s+13],5,-1444681467),o=N(o,n,i,r,e[s+2],9,-51403784),r=N(r,o,n,i,e[s+7],14,1735328473),i=N(i,r,o,n,e[s+12],20,-1926607734),n=M(n,i,r,o,e[s+5],4,-378558),o=M(o,n,i,r,e[s+8],11,-2022574463),r=M(r,o,n,i,e[s+11],16,1839030562),i=M(i,r,o,n,e[s+14],23,-35309556),n=M(n,i,r,o,e[s+1],4,-1530992060),o=M(o,n,i,r,e[s+4],11,1272893353),r=M(r,o,n,i,e[s+7],16,-155497632),i=M(i,r,o,n,e[s+10],23,-1094730640),n=M(n,i,r,o,e[s+13],4,681279174),o=M(o,n,i,r,e[s],11,-358537222),r=M(r,o,n,i,e[s+3],16,-722521979),i=M(i,r,o,n,e[s+6],23,76029189),n=M(n,i,r,o,e[s+9],4,-640364487),o=M(o,n,i,r,e[s+12],11,-421815835),r=M(r,o,n,i,e[s+15],16,530742520),i=M(i,r,o,n,e[s+2],23,-995338651),n=D(n,i,r,o,e[s],6,-198630844),o=D(o,n,i,r,e[s+7],10,1126891415),r=D(r,o,n,i,e[s+14],15,-1416354905),i=D(i,r,o,n,e[s+5],21,-57434055),n=D(n,i,r,o,e[s+12],6,1700485571),o=D(o,n,i,r,e[s+3],10,-1894986606),r=D(r,o,n,i,e[s+10],15,-1051523),i=D(i,r,o,n,e[s+1],21,-2054922799),n=D(n,i,r,o,e[s+8],6,1873313359),o=D(o,n,i,r,e[s+15],10,-30611744),r=D(r,o,n,i,e[s+6],15,-1560198380),i=D(i,r,o,n,e[s+13],21,1309151649),n=D(n,i,r,o,e[s+4],6,-145523070),o=D(o,n,i,r,e[s+11],10,-1120210379),r=D(r,o,n,i,e[s+2],15,718787259),i=D(i,r,o,n,e[s+9],21,-343485551),n=k(n,t),i=k(i,a),r=k(r,c),o=k(o,l)}return[n,i,r,o]}function P(e){if(0===e.length)return[];const t=8*e.length,n=new Uint32Array(I(t));for(let i=0;i<t;i+=8)n[i>>5]|=(255&e[i/8])<<i%32;return n}function k(e,t){const n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function _(e,t){return e<<t|e>>>32-t}function L(e,t,n,i,r,o){return k(_(k(k(t,e),k(i,o)),r),n)}function A(e,t,n,i,r,o,s){return L(t&n|~t&i,e,t,r,o,s)}function N(e,t,n,i,r,o,s){return L(t&i|n&~i,e,t,r,o,s)}function M(e,t,n,i,r,o,s){return L(t^n^i,e,t,r,o,s)}function D(e,t,n,i,r,o,s){return L(n^(t|~i),e,t,r,o,s)}var V=x;const B=O("v3",48,V);var j=B;const F="undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var U={randomUUID:F};function z(e,t,n){if(U.randomUUID&&!t&&!e)return U.randomUUID();e=e||{};const i=e.random||(e.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=i[e];return t}return u(i)}var H=z;function W(e,t,n,i){switch(e){case 0:return t&n^~t&i;case 1:return t^n^i;case 2:return t&n^t&i^n&i;case 3:return t^n^i}}function G(e,t){return e<<t|e>>>32-t}function X(e){const t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"===typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let n=0;n<t.length;++n)e.push(t.charCodeAt(n))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const i=e.length/4+2,r=Math.ceil(i/16),o=new Array(r);for(let s=0;s<r;++s){const t=new Uint32Array(16);for(let n=0;n<16;++n)t[n]=e[64*s+4*n]<<24|e[64*s+4*n+1]<<16|e[64*s+4*n+2]<<8|e[64*s+4*n+3];o[s]=t}o[r-1][14]=8*(e.length-1)/Math.pow(2,32),o[r-1][14]=Math.floor(o[r-1][14]),o[r-1][15]=8*(e.length-1)&4294967295;for(let s=0;s<r;++s){const e=new Uint32Array(80);for(let t=0;t<16;++t)e[t]=o[s][t];for(let t=16;t<80;++t)e[t]=G(e[t-3]^e[t-8]^e[t-14]^e[t-16],1);let i=n[0],r=n[1],a=n[2],c=n[3],l=n[4];for(let n=0;n<80;++n){const o=Math.floor(n/20),s=G(i,5)+W(o,r,a,c)+l+t[o]+e[n]>>>0;l=c,c=a,a=G(r,30)>>>0,r=i,i=s}n[0]=n[0]+i>>>0,n[1]=n[1]+r>>>0,n[2]=n[2]+a>>>0,n[3]=n[3]+c>>>0,n[4]=n[4]+l>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}var q=X;const J=O("v5",80,q);var $=J,Y="00000000-0000-0000-0000-000000000000";function K(e){if(!c(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}var Q=K},d30c:function(e,t,n){var i=n("75ee"),r=n("a4b2");t.JsonRPC=i,t.XmlRPC=r},e0ef:function(e,t,n){var i;
/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */(function(t){"use strict";function r(){}var o=r.prototype,s=t.EventEmitter;function a(e,t){var n=e.length;while(n--)if(e[n].listener===t)return n;return-1}function c(e){return function(){return this[e].apply(this,arguments)}}function l(e){return"function"===typeof e||e instanceof RegExp||!(!e||"object"!==typeof e)&&l(e.listener)}o.getListeners=function(e){var t,n,i=this._getEvents();if(e instanceof RegExp)for(n in t={},i)i.hasOwnProperty(n)&&e.test(n)&&(t[n]=i[n]);else t=i[e]||(i[e]=[]);return t},o.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},o.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},o.addListener=function(e,t){if(!l(t))throw new TypeError("listener must be a function");var n,i=this.getListenersAsObject(e),r="object"===typeof t;for(n in i)i.hasOwnProperty(n)&&-1===a(i[n],t)&&i[n].push(r?t:{listener:t,once:!1});return this},o.on=c("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=c("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,t){var n,i,r=this.getListenersAsObject(e);for(i in r)r.hasOwnProperty(i)&&(n=a(r[i],t),-1!==n&&r[i].splice(n,1));return this},o.off=c("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,n){var i,r,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!==typeof t||t instanceof RegExp){i=n.length;while(i--)o.call(this,t,n[i])}else for(i in t)t.hasOwnProperty(i)&&(r=t[i])&&("function"===typeof r?o.call(this,i,r):s.call(this,i,r));return this},o.removeEvent=function(e){var t,n=typeof e,i=this._getEvents();if("string"===n)delete i[e];else if(e instanceof RegExp)for(t in i)i.hasOwnProperty(t)&&e.test(t)&&delete i[t];else delete this._events;return this},o.removeAllListeners=c("removeEvent"),o.emitEvent=function(e,t){var n,i,r,o,s,a=this.getListenersAsObject(e);for(o in a)if(a.hasOwnProperty(o))for(n=a[o].slice(0),r=0;r<n.length;r++)i=n[r],!0===i.once&&this.removeListener(e,i.listener),s=i.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,i.listener);return this},o.trigger=c("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},o._getEvents=function(){return this._events||(this._events={})},r.noConflict=function(){return t.EventEmitter=s,r},i=function(){return r}.call(t,n,t,e),void 0===i||(e.exports=i)})("undefined"!==typeof window?window:this||{})},e237:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformUtils=void 0;var i=n("faac"),r=function(){function e(){}return e.getInstance=function(){return this.instance||(this.instance=new e),e.instance},e.prototype.isChromeBrowser=function(){return"Chrome"===i.name},e.prototype.isSafariBrowser=function(){return"Safari"===i.name},e.prototype.isChromeMobileBrowser=function(){return"Chrome Mobile"===i.name},e.prototype.isFirefoxBrowser=function(){return"Firefox"===i.name},e.prototype.isFirefoxMobileBrowser=function(){return"Firefox Mobile"===i.name||"Firefox for iOS"===i.name},e.prototype.isOperaBrowser=function(){return"Opera"===i.name},e.prototype.isOperaMobileBrowser=function(){return"Opera Mobile"===i.name},e.prototype.isEdgeBrowser=function(){var e=(null===i||void 0===i?void 0:i.version)?parseFloat(i.version):-1;return"Microsoft Edge"===i.name&&e>=80},e.prototype.isEdgeMobileBrowser=function(){var e,t,n=(null===i||void 0===i?void 0:i.version)?parseFloat(i.version):-1;return"Microsoft Edge"===i.name&&("Android"===(null===(e=i.os)||void 0===e?void 0:e.family)||"iOS"===(null===(t=i.os)||void 0===t?void 0:t.family))&&n>45},e.prototype.isAndroidBrowser=function(){return"Android Browser"===i.name},e.prototype.isElectron=function(){return"Electron"===i.name},e.prototype.isNodeJs=function(){return"Node.js"===i.name},e.prototype.isSamsungBrowser=function(){return"Samsung Internet Mobile"===i.name||"Samsung Internet"===i.name},e.prototype.isIPhoneOrIPad=function(){var e=i.ua?i.ua:navigator.userAgent,t="ontouchend"in document,n=/\b(\w*Macintosh\w*)\b/.test(e)&&t,r=/\b(\w*iPhone\w*)\b/.test(e)&&/\b(\w*Mobile\w*)\b/.test(e)&&t;return n||r},e.prototype.isIOSWithSafari=function(){var e=i.ua?i.ua:navigator.userAgent;return this.isIPhoneOrIPad()&&/\b(\w*Apple\w*)\b/.test(navigator.vendor)&&/\b(\w*Safari\w*)\b/.test(e)&&!/\b(\w*CriOS\w*)\b/.test(e)&&!/\b(\w*FxiOS\w*)\b/.test(e)},e.prototype.isIonicIos=function(){return this.isIPhoneOrIPad()&&-1===i.ua.indexOf("Safari")},e.prototype.isIonicAndroid=function(){return"Android"===i.os.family&&"Android Browser"==i.name},e.prototype.isMobileDevice=function(){return"iOS"===i.os.family||"Android"===i.os.family},e.prototype.isReactNative=function(){return!1},e.prototype.isChromium=function(){return this.isChromeBrowser()||this.isChromeMobileBrowser()||this.isOperaBrowser()||this.isOperaMobileBrowser()||this.isEdgeBrowser()||this.isEdgeMobileBrowser()||this.isSamsungBrowser()||this.isIonicAndroid()||this.isIonicIos()||this.isElectron()},e.prototype.canScreenShare=function(){var e=(null===i||void 0===i?void 0:i.version)?parseFloat(i.version):-1;return!this.isMobileDevice()&&(this.isChromeBrowser()||this.isFirefoxBrowser()||this.isOperaBrowser()||this.isElectron()||this.isEdgeBrowser()||this.isSafariBrowser()&&e>=13)},e.prototype.getName=function(){return i.name||""},e.prototype.getVersion=function(){return i.version||""},e.prototype.getFamily=function(){return i.os.family||""},e.prototype.getDescription=function(){return i.description||""},e}();t.PlatformUtils=r},e5b5:function(e){e.exports=JSON.parse('["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"]')},e649:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,a[0]&&(s=0)),s)try{if(n=1,i&&(r=2&a[0]?i["return"]:a[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(c){a=[6,c],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebRtcPeerSendrecv=t.WebRtcPeerSendonly=t.WebRtcPeerRecvonly=t.WebRtcPeer=void 0;var a=n("f1f1"),c=n("d2ca"),l=n("e9cb"),u=n("f66e"),d=n("e237"),h=u.OpenViduLogger.getInstance(),p=function(){function e(e){var t=this;this.remoteCandidatesQueue=[],this.localCandidatesQueue=[],this.iceCandidateList=[],d.PlatformUtils.getInstance(),this.configuration=r(r({},e),{iceServers:e.iceServers&&e.iceServers.length>0?e.iceServers:a(),mediaStream:void 0!==e.mediaStream?e.mediaStream:null,mode:e.mode?e.mode:"sendrecv",id:e.id?e.id:this.generateUniqueId()}),h.debug("[WebRtcPeer] configuration:\n".concat(JSON.stringify(this.configuration,null,2))),this.pc=new RTCPeerConnection({iceServers:this.configuration.iceServers}),this.pc.addEventListener("icecandidate",(function(e){if(null!==e.candidate){var n=e.candidate,i=new RTCIceCandidate(n);t.configuration.onIceCandidate(i),""!==i.candidate&&t.localCandidatesQueue.push(i)}})),this.pc.addEventListener("signalingstatechange",(function(){return o(t,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:if("stable"!==this.pc.signalingState)return[3,6];n.label=1;case 1:if(!(this.iceCandidateList.length>0))return[3,6];e=this.iceCandidateList.shift(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,this.pc.addIceCandidate(e)];case 3:return n.sent(),[3,5];case 4:return t=n.sent(),h.error("Error when calling RTCPeerConnection#addIceCandidate for RTCPeerConnection "+this.getId(),t),[3,5];case 5:return[3,1];case 6:return[2]}}))}))}))}return e.prototype.getId=function(){return this.configuration.id},e.prototype.dispose=function(){if(h.debug("Disposing WebRtcPeer"),this.pc){if("closed"===this.pc.signalingState)return;this.pc.close(),this.remoteCandidatesQueue=[],this.localCandidatesQueue=[]}},e.prototype.createOfferLegacy=function(){this.configuration.mediaStream&&this.deprecatedPeerConnectionTrackApi();var e=this.configuration.mediaConstraints.audio,t=this.configuration.mediaConstraints.video,n={offerToReceiveAudio:"sendonly"!==this.configuration.mode&&e,offerToReceiveVideo:"sendonly"!==this.configuration.mode&&t};return h.debug("[createOfferLegacy] RTCPeerConnection.createOffer() options:",JSON.stringify(n)),this.pc.createOffer(n)},e.prototype.createOffer=function(){var e,t,n,i,r,a,c,l;return o(this,void 0,void 0,(function(){var o,u,d,p,f,m,v,g,E,b,y,S,w,C,O,x,R,I,T,P,k,_,L;return s(this,(function(s){switch(s.label){case 0:if(!("addTransceiver"in this.pc))return h.warn("[createOffer] Method RTCPeerConnection.addTransceiver() is NOT available; using LEGACY offerToReceive{Audio,Video}"),[2,this.createOfferLegacy()];if(h.debug("[createOffer] Method RTCPeerConnection.addTransceiver() is available; using it"),"recvonly"===this.configuration.mode)return[3,7];if(!this.configuration.mediaStream)throw new Error("[WebRtcPeer.createOffer] Direction is '".concat(this.configuration.mode,"', but no stream was configured to be sent"));o=0,u=this.configuration.mediaStream.getTracks(),s.label=1;case 1:if(!(o<u.length))return[3,6];if(d=u[o],p={direction:this.configuration.mode,streams:[this.configuration.mediaStream]},"video"===d.kind&&this.configuration.simulcast)for(f=d.getSettings(),m=d.getConstraints(),v=null!==(n=null!==(t=null!==(e=f.width)&&void 0!==e?e:m.width.ideal)&&void 0!==t?t:m.width)&&void 0!==n?n:0,g=null!==(a=null!==(r=null!==(i=f.height)&&void 0!==i?i:m.height.ideal)&&void 0!==r?r:m.height)&&void 0!==a?a:0,h.info("[createOffer] Video track dimensions: ".concat(v,"x").concat(g)),E=v*g,b=0,b=E>=518400?3:E>=129600?2:1,p.sendEncodings=[],y=0;y<b;y++)S=Math.pow(2,b-y-1),w={rid:"rdiv"+S.toString(),scalabilityMode:"L1T1"},["detail","text"].includes(d.contentHint)?(w.scaleResolutionDownBy=1,w.maxFramerate=Math.floor(30/S)):w.scaleResolutionDownBy=S,p.sendEncodings.push(w);if(C=this.pc.addTransceiver(d,p),"video"!==d.kind)return[3,5];if(O=C.sender.getParameters(),x=!1,(null===(c=O.degradationPreference)||void 0===c?void 0:c.length)||(["detail","text"].includes(d.contentHint)?O.degradationPreference="maintain-resolution":O.degradationPreference="balanced",h.info("[createOffer] Video sender Degradation Preference set: ".concat(O.degradationPreference)),x=!0),this.configuration.simulcast&&(null===(l=O.encodings)||void 0===l?void 0:l.length)!==p.sendEncodings.length&&(O.encodings=p.sendEncodings,x=!0),!x)return[3,5];h.debug("[createOffer] Setting new RTCRtpSendParameters to video sender"),s.label=2;case 2:return s.trys.push([2,4,,5]),[4,C.sender.setParameters(O)];case 3:return s.sent(),[3,5];case 4:throw R=s.sent(),L="[WebRtcPeer.createOffer] Cannot set RTCRtpSendParameters to video sender",R instanceof Error&&(L+=": ".concat(R.message)),new Error(L);case 5:return o++,[3,1];case 6:return[3,8];case 7:for(I=0,T=["audio","video"];I<T.length;I++)P=T[I],this.configuration.mediaConstraints[P]&&(this.configuration.mediaStream=new MediaStream,this.pc.addTransceiver(P,{direction:this.configuration.mode,streams:[this.configuration.mediaStream]}));s.label=8;case 8:return s.trys.push([8,10,,11]),[4,this.pc.createOffer()];case 9:return k=s.sent(),[3,11];case 10:throw _=s.sent(),L="[WebRtcPeer.createOffer] Browser failed creating an SDP Offer",_ instanceof Error&&(L+=": ".concat(_.message)),new Error(L);case 11:return[2,k]}}))}))},e.prototype.deprecatedPeerConnectionTrackApi=function(){for(var e=0,t=this.configuration.mediaStream.getTracks();e<t.length;e++){var n=t[e];this.pc.addTrack(n,this.configuration.mediaStream)}},e.prototype.createAnswer=function(){var e=this;return new Promise((function(t,n){if("getTransceivers"in e.pc){h.debug("[createAnswer] Method RTCPeerConnection.getTransceivers() is available; using it");for(var i=function(t){if(!e.configuration.mediaConstraints[t])return"continue";var i=e.pc.getTransceivers().find((function(e){return e.receiver.track.kind===t}));if(!i)return{value:n(new Error("".concat(t," requested, but no transceiver was created from remote description")))};i.direction=e.configuration.mode},r=0,o=["audio","video"];r<o.length;r++){var s=o[r],a=i(s);if("object"===typeof a)return a.value}e.pc.createAnswer().then((function(e){return t(e)})).catch((function(e){return n(e)}))}else{var c=void 0,l=!0;if(e.configuration.mediaConstraints){c="boolean"!==typeof e.configuration.mediaConstraints.audio||e.configuration.mediaConstraints.audio,l="boolean"!==typeof e.configuration.mediaConstraints.video||e.configuration.mediaConstraints.video;var u={offerToReceiveAudio:c,offerToReceiveVideo:l};e.pc.createAnswer(u).then((function(e){return t(e)})).catch((function(e){return n(e)}))}}}))},e.prototype.processLocalOffer=function(e){var t=this;return new Promise((function(n,i){t.pc.setLocalDescription(e).then((function(){var e=t.pc.localDescription;return e?(h.debug("Local description set",e.sdp),n()):i("Local description is not defined")})).catch((function(e){return i(e)}))}))},e.prototype.processRemoteOffer=function(e){var t=this;return new Promise((function(n,i){var r={type:"offer",sdp:e};if(h.debug("SDP offer received, setting remote description",r),"closed"===t.pc.signalingState)return i("RTCPeerConnection is closed when trying to set remote description");t.setRemoteDescription(r).then((function(){return n()})).catch((function(e){return i(e)}))}))},e.prototype.processLocalAnswer=function(e){var t=this;return new Promise((function(n,i){if(h.debug("SDP answer created, setting local description"),"closed"===t.pc.signalingState)return i("RTCPeerConnection is closed when trying to set local description");t.pc.setLocalDescription(e).then((function(){return n()})).catch((function(e){return i(e)}))}))},e.prototype.processRemoteAnswer=function(e){var t=this;return new Promise((function(n,i){var r={type:"answer",sdp:e};if(h.debug("SDP answer received, setting remote description"),"closed"===t.pc.signalingState)return i("RTCPeerConnection is closed when trying to set remote description");t.setRemoteDescription(r).then((function(){n()})).catch((function(e){return i(e)}))}))},e.prototype.setRemoteDescription=function(e){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.pc.setRemoteDescription(e)]}))}))},e.prototype.addIceCandidate=function(e){var t=this;return new Promise((function(n,i){switch(h.debug("Remote ICE candidate received",e),t.remoteCandidatesQueue.push(e),t.pc.signalingState){case"closed":i(new Error("PeerConnection object is closed"));break;case"stable":t.pc.remoteDescription?t.pc.addIceCandidate(e).then((function(){return n()})).catch((function(e){return i(e)})):(t.iceCandidateList.push(e),n());break;default:t.iceCandidateList.push(e),n()}}))},e.prototype.addIceConnectionStateChangeListener=function(e){var t=this;this.pc.addEventListener("iceconnectionstatechange",(function(){var n=t.pc.iceConnectionState;switch(n){case"disconnected":var i="IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') change to "disconnected". Possible network disconnection';h.warn(i),t.configuration.onIceConnectionStateException(l.ExceptionEventName.ICE_CONNECTION_DISCONNECTED,i);break;case"failed":var r="IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') to "failed"';h.error(r),t.configuration.onIceConnectionStateException(l.ExceptionEventName.ICE_CONNECTION_FAILED,r);break;case"closed":h.log("IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') change to "closed"');break;case"new":h.log("IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') change to "new"');break;case"checking":h.log("IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') change to "checking"');break;case"connected":h.log("IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') change to "connected"');break;case"completed":h.log("IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') change to "completed"');break}}))},e.prototype.generateUniqueId=function(){return(0,c.v4)()},e}();t.WebRtcPeer=p;var f=function(e){function t(t){return t.mode="recvonly",e.call(this,t)||this}return i(t,e),t}(p);t.WebRtcPeerRecvonly=f;var m=function(e){function t(t){return t.mode="sendonly",e.call(this,t)||this}return i(t,e),t}(p);t.WebRtcPeerSendonly=m;var v=function(e){function t(t){return t.mode="sendrecv",e.call(this,t)||this}return i(t,e),t}(p);t.WebRtcPeerSendrecv=v},e9c4:function(e,t,n){var i=n("23e7"),r=n("d066"),o=n("d039"),s=r("JSON","stringify"),a=/[\uD800-\uDFFF]/g,c=/^[\uD800-\uDBFF]$/,l=/^[\uDC00-\uDFFF]$/,u=function(e,t,n){var i=n.charAt(t-1),r=n.charAt(t+1);return c.test(e)&&!l.test(r)||l.test(e)&&!c.test(i)?"\\u"+e.charCodeAt(0).toString(16):e},d=o((function(){return'"\\udf06\\ud834"'!==s("\udf06\ud834")||'"\\udead"'!==s("\udead")}));s&&i({target:"JSON",stat:!0,forced:d},{stringify:function(e,t,n){var i=s.apply(null,arguments);return"string"==typeof i?i.replace(a,u):i}})},e9cb:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.ExceptionEvent=t.ExceptionEventName=void 0;var r=n("8733");(function(e){e["ICE_CANDIDATE_ERROR"]="ICE_CANDIDATE_ERROR",e["ICE_CONNECTION_FAILED"]="ICE_CONNECTION_FAILED",e["ICE_CONNECTION_DISCONNECTED"]="ICE_CONNECTION_DISCONNECTED",e["NO_STREAM_PLAYING_EVENT"]="NO_STREAM_PLAYING_EVENT",e["SPEECH_TO_TEXT_DISCONNECTED"]="SPEECH_TO_TEXT_DISCONNECTED"})(t.ExceptionEventName||(t.ExceptionEventName={}));var o=function(e){function t(t,n,i,r,o){var s=e.call(this,!1,t,"exception")||this;return s.name=n,s.origin=i,s.message=r,s.data=o,s}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.ExceptionEvent=o},ef86:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=void 0;var i=n("0703"),r=n("4edf"),o=n("f66e"),s=o.OpenViduLogger.getInstance(),a=function(){function e(e,t){this.handlers=new Map,this.type=e,this.options=t}return e.prototype.execMethod=function(e,t){var n=this;return new Promise((function(o,a){var c,l;s.info("Executing filter method to stream "+n.stream.streamId);var u=function(t){s.info("Filter method successfully executed on Stream "+n.stream.streamId);var r=Object.assign({},n.stream.filter);return n.stream.filter.lastExecMethod={method:e,params:l},t&&(n.stream.session.emitEvent("streamPropertyChanged",[new i.StreamPropertyChangedEvent(n.stream.session,n.stream,"filter",n.stream.filter,r,"execFilterMethod")]),n.stream.streamManager.emitEvent("streamPropertyChanged",[new i.StreamPropertyChangedEvent(n.stream.streamManager,n.stream,"filter",n.stream.filter,r,"execFilterMethod")])),o()};if(n.type.startsWith("VB:")){if("string"===typeof t)try{t=JSON.parse(t)}catch(p){return a(new r.OpenViduError(r.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"Wrong params syntax: "+p))}if(l=t,"update"!==e)return a(new r.OpenViduError(r.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,'Unknown Virtual Background method "'.concat(e,'"')));if(!(null===(c=n.stream.virtualBackgroundSinkElements)||void 0===c?void 0:c.VB))return a(new r.OpenViduError(r.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"There is no Virtual Background filter applied"));n.stream.virtualBackgroundSinkElements.VB.updateValues(t).then((function(){return u(!1)})).catch((function(e){return e.name===r.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR?a(new r.OpenViduError(e.name,e.message)):a(new r.OpenViduError(r.OpenViduErrorName.VIRTUAL_BACKGROUND_ERROR,"Error updating values on Virtual Background filter: "+e))}))}else{var d=void 0;if("string"!==typeof t)try{d=JSON.stringify(t)}catch(p){var h="'params' property must be a JSON formatted object";return s.error(h),a(h)}else d=t;l=d,n.stream.session.openvidu.sendRequest("execFilterMethod",{streamId:n.stream.streamId,method:e,params:d},(function(e,t){return e?(s.error("Error executing filter method for Stream "+n.stream.streamId,e),401===e.code?a(new r.OpenViduError(r.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to execute a filter method")):a(e)):u(!0)}))}}))},e.prototype.addEventListener=function(e,t){var n=this;return new Promise((function(i,o){s.info("Adding filter event listener to event "+e+" to stream "+n.stream.streamId),n.stream.session.openvidu.sendRequest("addFilterEventListener",{streamId:n.stream.streamId,eventType:e},(function(a,c){return a?(s.error("Error adding filter event listener to event "+e+"for Stream "+n.stream.streamId,a),401===a.code?o(new r.OpenViduError(r.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):o(a)):(n.handlers.set(e,t),s.info("Filter event listener to event "+e+" successfully applied on Stream "+n.stream.streamId),i())}))}))},e.prototype.removeEventListener=function(e){var t=this;return new Promise((function(n,i){s.info("Removing filter event listener to event "+e+" to stream "+t.stream.streamId),t.stream.session.openvidu.sendRequest("removeFilterEventListener",{streamId:t.stream.streamId,eventType:e},(function(o,a){return o?(s.error("Error removing filter event listener to event "+e+"for Stream "+t.stream.streamId,o),401===o.code?i(new r.OpenViduError(r.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):i(o)):(t.handlers.delete(e),s.info("Filter event listener to event "+e+" successfully removed on Stream "+t.stream.streamId),n())}))}))},e}();t.Filter=a},f0a5:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r,o){var s=e.call(this,t,n,i)||this;return s.connection=r,s.reason=o,s}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.ConnectionEvent=o},f1bf:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionPropertyChangedEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r,o){var s=e.call(this,!1,t,"connectionPropertyChanged")||this;return s.connection=n,s.changedProperty=i,s.newValue=r,s.oldValue=o,s}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.ConnectionPropertyChangedEvent=o},f1f1:function(e,t,n){"use strict";var i=n("a21b"),r=function(e){var t,r={stun:(e||{}).stun||n("e5b5"),turn:(e||{}).turn||n("c09e")},o=(e||{}).stunCount||2,s=(e||{}).turnCount||0;function a(e,t){var n,o=[],s=[].concat(r[e]);while(s.length&&o.length<t)n=Math.random()*s.length|0,o=o.concat(s.splice(n,1));return o.map((function(t){return"string"===typeof t||t instanceof String?i(e+":"+t):t}))}return t=[].concat(a("stun",o)),s&&(t=t.concat(a("turn",s))),t};e.exports=r},f66e:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenViduLogger=void 0;var i=n("3029"),r=n("cf14"),o=n("49d9"),s=function(){function e(){this.JSNLOG_URL="/openvidu/elk/openvidu-browser-logs",this.MAX_JSNLOG_BATCH_LOG_MESSAGES=100,this.MAX_MSECONDS_BATCH_MESSAGES=5e3,this.MAX_LENGTH_STRING_JSON=1e3,this.defaultConsoleLogger=new r.ConsoleLogger(globalThis.console),this.isProdMode=!1,this.isJSNLogSetup=!1}return e.configureJSNLog=function(e,t){var n=this;try{if(globalThis["LOG_JSNLOG_RESULTS"]||this.instance&&e.isAtLeastPro&&this.instance.isOpenViduBrowserLogsDebugActive(e)&&this.instance.canConfigureJSNLog(e,this.instance)){e.sendBrowserLogs===o.OpenViduLoggerConfiguration.debug_app&&this.instance.replaceWindowConsole(),this.instance.isJSNLogSetup=!1,this.instance.info("Configuring JSNLogs.");var r=e.finalUserId,s=e.session.sessionId,a=function(e){var i=e.onreadystatechange;e.onreadystatechange=function(){n.isInvalidResponse(e)&&(Object.defineProperty(e,"readyState",{value:4}),Object.defineProperty(e,"status",{value:200}),n.instance.disableLogger()),i()},e.setRequestHeader("Authorization","Basic "+btoa("".concat(r,"%/%").concat(s)+":"+t)),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("OV-Final-User-Id",r),e.setRequestHeader("OV-Session-Id",s),e.setRequestHeader("OV-Token",t)};this.instance.currentAppender=i.JL.createAjaxAppender("appender-".concat(r,"-").concat(s)),this.instance.currentAppender.setOptions({beforeSend:a,maxBatchSize:1e3,batchSize:this.instance.MAX_JSNLOG_BATCH_LOG_MESSAGES,batchTimeout:this.instance.MAX_MSECONDS_BATCH_MESSAGES});var c=function(e){var t=function(){var e=new WeakSet;return function(t,n){if("object"===typeof n&&null!=n){if(e.has(n)||globalThis.HTMLElement&&n instanceof HTMLElement)return;e.add(n)}return n}},i=JSON.stringify(e,t());return i.length>n.instance.MAX_LENGTH_STRING_JSON&&(i="".concat(i.substring(0,n.instance.MAX_LENGTH_STRING_JSON),"...")),globalThis["LOG_JSNLOG_RESULTS"]&&console.log(i),i};i.JL.setOptions({defaultAjaxUrl:e.httpUri+this.instance.JSNLOG_URL,serialize:c,enabled:!0}),(0,i.JL)().setOptions({appenders:[this.instance.currentAppender]}),this.instance.isJSNLogSetup=!0,this.instance.loggingSessionId=s,this.instance.info("JSNLog configured.")}}catch(l){console.error("Error configuring JSNLog: "),console.error(l),this.instance.disableLogger()}},e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.isInvalidResponse=function(e){return 401==e.status||403==e.status||404==e.status||0==e.status},e.prototype.canConfigureJSNLog=function(e,t){return e.session.sessionId!=t.loggingSessionId},e.prototype.isOpenViduBrowserLogsDebugActive=function(e){return e.sendBrowserLogs===o.OpenViduLoggerConfiguration.debug||e.sendBrowserLogs===o.OpenViduLoggerConfiguration.debug_app},e.prototype.getConsoleWithJSNLog=function(){return function(e){return{log:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.defaultConsoleLogger.log.apply(e.defaultConsoleLogger.logger,arguments),e.isJSNLogSetup&&(0,i.JL)().info(arguments)},info:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.defaultConsoleLogger.info.apply(e.defaultConsoleLogger.logger,arguments),e.isJSNLogSetup&&(0,i.JL)().info(arguments)},debug:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.defaultConsoleLogger.debug.apply(e.defaultConsoleLogger.logger,arguments)},warn:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.defaultConsoleLogger.warn.apply(e.defaultConsoleLogger.logger,arguments),e.isJSNLogSetup&&(0,i.JL)().warn(arguments)},error:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.defaultConsoleLogger.error.apply(e.defaultConsoleLogger.logger,arguments),e.isJSNLogSetup&&(0,i.JL)().error(arguments)}}}(this)},e.prototype.replaceWindowConsole=function(){globalThis.console=this.defaultConsoleLogger.logger,globalThis.console.log=this.getConsoleWithJSNLog().log,globalThis.console.info=this.getConsoleWithJSNLog().info,globalThis.console.debug=this.getConsoleWithJSNLog().debug,globalThis.console.warn=this.getConsoleWithJSNLog().warn,globalThis.console.error=this.getConsoleWithJSNLog().error},e.prototype.disableLogger=function(){i.JL.setOptions({enabled:!1}),this.isJSNLogSetup=!1,this.loggingSessionId=void 0,this.currentAppender=void 0,globalThis.console=this.defaultConsoleLogger.logger,globalThis.console.log=this.defaultConsoleLogger.log,globalThis.console.info=this.defaultConsoleLogger.info,globalThis.console.debug=this.defaultConsoleLogger.debug,globalThis.console.warn=this.defaultConsoleLogger.warn,globalThis.console.error=this.defaultConsoleLogger.error},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.defaultConsoleLogger.log.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,i.JL)().info(arguments)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.defaultConsoleLogger.debug.apply(this.defaultConsoleLogger.logger,arguments)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.defaultConsoleLogger.info.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,i.JL)().info(arguments)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.defaultConsoleLogger.warn.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,i.JL)().warn(arguments)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.defaultConsoleLogger.error.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&(0,i.JL)().error(arguments)},e.prototype.flush=function(){this.isJSNLogSetup&&null!=this.currentAppender&&this.currentAppender.sendBatch()},e.prototype.enableProdMode=function(){this.isProdMode=!0},e}();t.OpenViduLogger=s},f852:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,a[0]&&(s=0)),s)try{if(n=1,i&&(r=2&a[0]?i["return"]:a[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(c){a=[6,c],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebRtcStats=void 0;var o,s=n("f66e"),a=n("e237"),c=s.OpenViduLogger.getInstance(),l=function(){function e(e){this.stream=e,this.STATS_ITEM_NAME="webrtc-stats-config",this.webRtcStatsEnabled=!1,this.statsInterval=1,o=a.PlatformUtils.getInstance()}return e.prototype.isEnabled=function(){return this.webRtcStatsEnabled},e.prototype.initWebRtcStats=function(){var e=this,t=localStorage.getItem(this.STATS_ITEM_NAME);if(t){this.webRtcStatsEnabled=!0;var n=JSON.parse(t);c.warn("WebRtc stats enabled for stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId),c.warn("localStorage item: "+JSON.stringify(n)),this.POST_URL=n.httpEndpoint,this.statsInterval=n.interval,this.webRtcStatsIntervalId=setInterval((function(){return i(e,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.sendStatsToHttpEndpoint()];case 1:return e.sent(),[2]}}))}))}),1e3*this.statsInterval)}else c.debug("WebRtc stats not enabled")},e.prototype.getSelectedIceCandidateInfo=function(){var e=this;return new Promise((function(t,n){return i(e,void 0,void 0,(function(){var e,n,i,s,a,c,l,u,d,h,p,f,m,v,g,E,b,y,S,w,C,O;return r(this,(function(r){switch(r.label){case 0:return[4,this.stream.getRTCPeerConnection().getStats()];case 1:if(e=r.sent(),i=new Map,s=new Map,a=new Map,e.forEach((function(e){switch("transport"===e.type&&(o.isChromium()||o.isSafariBrowser()||o.isReactNative())&&(n=e),e.type){case"candidate-pair":i.set(e.id,e);break;case"local-candidate":s.set(e.id,e);break;case"remote-candidate":a.set(e.id,e);break}})),null!=n)l=n.selectedCandidatePairId,c=i.get(l);else for(u=i.size,d=i.values(),h=0;h<u;h++)if(p=d.next().value,p["selected"]){c=p;break}if(f=c.localCandidateId,m=c.remoteCandidateId,v=s.get(f),v)for(y=this.stream.getLocalIceCandidateList(),S=y.filter((function(e){return!!e.candidate&&(e.candidate.indexOf(v.ip)>=0||e.candidate.indexOf(v.address)>=0)&&e.candidate.indexOf(v.port)>=0})),v.raw=[],g=0,E=S;g<E.length;g++)O=E[g],v.raw.push(O.candidate);else v="ERROR: No active local ICE candidate. Probably ICE-TCP is being used";if(b=a.get(m),b)for(y=this.stream.getRemoteIceCandidateList(),S=y.filter((function(e){return!!e.candidate&&(e.candidate.indexOf(b.ip)>=0||e.candidate.indexOf(b.address)>=0)&&e.candidate.indexOf(b.port)>=0})),b.raw=[],w=0,C=S;w<C.length;w++)O=C[w],b.raw.push(O.candidate);else b="ERROR: No active remote ICE candidate. Probably ICE-TCP is being used";return[2,t({localCandidate:v,remoteCandidate:b})]}}))}))}))},e.prototype.stopWebRtcStats=function(){this.webRtcStatsEnabled&&(clearInterval(this.webRtcStatsIntervalId),c.warn("WebRtc stats stopped for disposed stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId))},e.prototype.sendStats=function(e,t){return i(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),n={headers:{"Content-type":"application/json"},body:JSON.stringify(t),method:"POST"},[4,fetch(e,n)];case 1:return r.sent(),[3,3];case 2:return i=r.sent(),c.error("sendStats error: ".concat(JSON.stringify(i))),[3,3];case 3:return[2]}}))}))},e.prototype.sendStatsToHttpEndpoint=function(){return i(this,void 0,void 0,(function(){var e,t,n;return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,this.getCommonStats()];case 1:return e=i.sent(),t=this.generateJSONStatsResponse(e),[4,this.sendStats(this.POST_URL,t)];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),c.log(n),[3,4];case 4:return[2]}}))}))},e.prototype.getCommonStats=function(){return i(this,void 0,void 0,(function(){var e=this;return r(this,(function(t){return[2,new Promise((function(t,n){return i(e,void 0,void 0,(function(){var e,i,o,s,a,l=this;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.stream.getRTCPeerConnection().getStats()];case 1:return e=r.sent(),i=this.getWebRtcStatsResponseOutline(),o=["framesReceived","framesDropped","framesSent","frameHeight","frameWidth"],s=["availableOutgoingBitrate","currentRoundTripTime"],e.forEach((function(e){var t=null!=e.mediaType?e.mediaType:e.kind,n=function(n,r){null!=e[r]&&null!=i[n]&&(!t&&o.indexOf(r)>-1&&(t="video"),null!=n&&null!=t&&null!=r&&null!=i[n][t]?i[n][t][r]=Number(e[r]):null!=n&&null!=r&&s.includes(r)&&(i[n][r]=Number(e[r])))};switch(e.type){case"outbound-rtp":n("outbound","bytesSent"),n("outbound","packetsSent"),n("outbound","framesEncoded"),n("outbound","nackCount"),n("outbound","firCount"),n("outbound","pliCount"),n("outbound","qpSum");break;case"inbound-rtp":n("inbound","bytesReceived"),n("inbound","packetsReceived"),n("inbound","packetsLost"),n("inbound","jitter"),n("inbound","framesDecoded"),n("inbound","nackCount"),n("inbound","firCount"),n("inbound","pliCount");break;case"track":n("inbound","jitterBufferDelay"),n("inbound","framesReceived"),n("outbound","framesDropped"),n("outbound","framesSent"),n(l.stream.isLocal()?"outbound":"inbound","frameHeight"),n(l.stream.isLocal()?"outbound":"inbound","frameWidth");break;case"candidate-pair":n("candidatepair","currentRoundTripTime"),n("candidatepair","availableOutgoingBitrate");break}})),(null===i||void 0===i?void 0:i.candidatepair)&&0!==Object.keys(i.candidatepair).length||delete i.candidatepair,[2,t(i)];case 2:return a=r.sent(),c.error("Error getting common stats: ",a),[2,n(a)];case 3:return[2]}}))}))}))]}))}))},e.prototype.generateJSONStatsResponse=function(e){return{"@timestamp":(new Date).toISOString(),participant_id:this.stream.connection.data,session_id:this.stream.session.sessionId,platform:o.getName(),platform_description:o.getDescription(),stream:"webRTC",webrtc_stats:e}},e.prototype.getWebRtcStatsResponseOutline=function(){return this.stream.isLocal()?{outbound:{audio:{},video:{}},candidatepair:{}}:{inbound:{audio:{},video:{}}}},e}();t.WebRtcStats=l},fa28:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.FilterEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i){var r=e.call(this,!1,t,n)||this;return r.data=i,r}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.FilterEvent=o},faa1:function(e,t,n){"use strict";var i,r="object"===typeof Reflect?Reflect:null,o=r&&"function"===typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};function s(e){console&&console.warn&&console.warn(e)}i=r&&"function"===typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!==e};function c(){c.init.call(this)}e.exports=c,e.exports.once=y,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var l=10;function u(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function h(e,t,n,i){var r,o,a;if(u(n),o=e._events,void 0===o?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"===typeof a?a=o[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),r=d(e),r>0&&a.length>r&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,s(c)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=p.bind(i);return r.listener=n,i.wrapFn=r,r}function m(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"===typeof r?n?[r.listener||r]:[r]:n?b(r):g(r,r.length)}function v(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function E(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function b(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function y(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"===typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}w(e,t,o,{once:!0}),"error"!==t&&S(e,r,{once:!0})}))}function S(e,t,n){"function"===typeof e.on&&w(e,"error",t,n)}function w(e,t,n,i){if("function"===typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(o){i.once&&e.removeEventListener(t,r),n(o)}))}}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return d(this)},c.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=r[e];if(void 0===c)return!1;if("function"===typeof c)o(c,this,t);else{var l=c.length,u=g(c,l);for(n=0;n<l;++n)o(u[n],this,t)}return!0},c.prototype.addListener=function(e,t){return h(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return h(this,e,t,!0)},c.prototype.once=function(e,t){return u(t),this.on(e,f(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,f(this,e,t)),this},c.prototype.removeListener=function(e,t){var n,i,r,o,s;if(u(t),i=this._events,void 0===i)return this;if(n=i[e],void 0===n)return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():E(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,void 0===n)return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)r=o[i],"removeListener"!==r&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],"function"===typeof t)this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},c.prototype.listeners=function(e){return m(this,e,!0)},c.prototype.rawListeners=function(e){return m(this,e,!1)},c.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},c.prototype.listenerCount=v,c.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},faac:function(e,t,n){(function(e,i){var r;
/*!
 * Platform.js v1.3.6
 * Copyright 2014-2020 Benjamin Tan
 * Copyright 2011-2013 John-David Dalton
 * Available under MIT license
 */(function(){"use strict";var o={function:!0,object:!0},s=o[typeof window]&&window||this,a=o[typeof t]&&t,c=o[typeof e]&&e&&!e.nodeType&&e,l=a&&c&&"object"==typeof i&&i;!l||l.global!==l&&l.window!==l&&l.self!==l||(s=l);var u=Math.pow(2,53)-1,d=/\bOpera/,h=Object.prototype,p=h.hasOwnProperty,f=h.toString;function m(e){return e=String(e),e.charAt(0).toUpperCase()+e.slice(1)}function v(e,t,n){var i={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(i=i[/[\d.]+$/.exec(e)])&&(e="Windows "+i),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=E(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0]),e}function g(e,t){var n=-1,i=e?e.length:0;if("number"==typeof i&&i>-1&&i<=u)while(++n<i)t(e[n],n,e);else b(e,t)}function E(e){return e=O(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:m(e)}function b(e,t){for(var n in e)p.call(e,n)&&t(e[n],n,e)}function y(e){return null==e?m(e):f.call(e).slice(8,-1)}function S(e,t){var n=null!=e?typeof e[t]:"number";return!/^(?:boolean|number|string|undefined)$/.test(n)&&("object"!=n||!!e[t])}function w(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function C(e,t){var n=null;return g(e,(function(i,r){n=t(n,i,r,e)})),n}function O(e){return String(e).replace(/^ +| +$/g,"")}function x(e){var t=s,n=e&&"object"==typeof e&&"String"!=y(e);n&&(t=e,e=null);var i=t.navigator||{},r=i.userAgent||"";e||(e=r);var o,a,c=n?!!i.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(f.toString()),l="Object",u=n?l:"ScriptBridgingProxyObject",h=n?l:"Environment",p=n&&t.java?"JavaPackage":y(t.java),m=n?l:"RuntimeObject",g=/\bJava/.test(p)&&t.java,R=g&&y(t.environment)==h,I=g?"a":"α",T=g?"b":"β",P=t.document||{},k=t.operamini||t.opera,_=d.test(_=n&&k?k["[[Class]]"]:y(k))?_:k=null,L=e,A=[],N=null,M=e==r,D=M&&k&&"function"==typeof k.version&&k.version(),V=z([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),B=W(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),j=X([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),F=H({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),U=G(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function z(t){return C(t,(function(t,n){return t||RegExp("\\b"+(n.pattern||w(n))+"\\b","i").exec(e)&&(n.label||n)}))}function H(t){return C(t,(function(t,n,i){return t||(n[j]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(j)]||RegExp("\\b"+w(i)+"(?:\\b|\\w*\\d)","i").exec(e))&&i}))}function W(t){return C(t,(function(t,n){return t||RegExp("\\b"+(n.pattern||w(n))+"\\b","i").exec(e)&&(n.label||n)}))}function G(t){return C(t,(function(t,n){var i=n.pattern||w(n);return!t&&(t=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(t=v(t,i,n.label||n)),t}))}function X(t){return C(t,(function(t,n){var i=n.pattern||w(n);return!t&&(t=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(e)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(n.label&&!RegExp(i,"i").test(n.label)?n.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),n=n.label||n,t=E(t[0].replace(RegExp(i,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),t}))}function q(t){return C(t,(function(t,n){return t||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null}))}function J(){return this.description||""}if(V&&(V=[V]),/\bAndroid\b/.test(U)&&!j&&(o=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(e))&&(j=O(o[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),F&&!j?j=X([F]):F&&j&&(j=j.replace(RegExp("^("+w(F)+")[-_.\\s]","i"),F+" ").replace(RegExp("^("+w(F)+")[-_.]?(\\w)","i"),F+" $2")),(o=/\bGoogle TV\b/.exec(j))&&(j=o[0]),/\bSimulator\b/i.test(e)&&(j=(j?j+" ":"")+"Simulator"),"Opera Mini"==B&&/\bOPiOS\b/.test(e)&&A.push("running in Turbo/Uncompressed mode"),"IE"==B&&/\blike iPhone OS\b/.test(e)?(o=x(e.replace(/like iPhone OS/,"")),F=o.manufacturer,j=o.product):/^iP/.test(j)?(B||(B="Safari"),U="iOS"+((o=/ OS ([\d_]+)/i.exec(e))?" "+o[1].replace(/_/g,"."):"")):"Konqueror"==B&&/^Linux\b/i.test(U)?U="Kubuntu":F&&"Google"!=F&&(/Chrome/.test(B)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(j))||/\bAndroid\b/.test(U)&&/^Chrome/.test(B)&&/\bVersion\//i.test(e)?(B="Android Browser",U=/\bAndroid\b/.test(U)?U:"Android"):"Silk"==B?(/\bMobi/i.test(e)||(U="Android",A.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&A.unshift("accelerated")):"UC Browser"==B&&/\bUCWEB\b/.test(e)?A.push("speed mode"):"PaleMoon"==B&&(o=/\bFirefox\/([\d.]+)\b/.exec(e))?A.push("identifying as Firefox "+o[1]):"Firefox"==B&&(o=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(U||(U="Firefox OS"),j||(j=o[1])):!B||(o=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(B))?(B&&!j&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(o+"/")+8))&&(B=null),(o=j||F||U)&&(j||F||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(U))&&(B=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(U)?U:o)+" Browser")):"Electron"==B&&(o=(/\bChrome\/([\d.]+)\b/.exec(e)||0)[1])&&A.push("Chromium "+o),D||(D=q(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",w(B),"(?:Firefox|Minefield|NetFront)"])),(o=("iCab"==V&&parseFloat(D)>3?"WebKit":/\bOpera\b/.test(B)&&(/\bOPR\b/.test(e)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(V)&&"WebKit"||!V&&/\bMSIE\b/i.test(e)&&("Mac OS"==U?"Tasman":"Trident")||"WebKit"==V&&/\bPlayStation\b(?! Vita\b)/i.test(B)&&"NetFront")&&(V=[o]),"IE"==B&&(o=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(B+=" Mobile",U="Windows Phone "+(/\+$/.test(o)?o:o+".x"),A.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(B="IE Mobile",U="Windows Phone 8.x",A.unshift("desktop mode"),D||(D=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=B&&"Trident"==V&&(o=/\brv:([\d.]+)/.exec(e))&&(B&&A.push("identifying as "+B+(D?" "+D:"")),B="IE",D=o[1]),M){if(S(t,"global"))if(g&&(o=g.lang.System,L=o.getProperty("os.arch"),U=U||o.getProperty("os.name")+" "+o.getProperty("os.version")),R){try{D=t.require("ringo/engine").version.join("."),B="RingoJS"}catch(Y){(o=t.system)&&o.global.system==t.system&&(B="Narwhal",U||(U=o[0].os||null))}B||(B="Rhino")}else"object"==typeof t.process&&!t.process.browser&&(o=t.process)&&("object"==typeof o.versions&&("string"==typeof o.versions.electron?(A.push("Node "+o.versions.node),B="Electron",D=o.versions.electron):"string"==typeof o.versions.nw&&(A.push("Chromium "+D,"Node "+o.versions.node),B="NW.js",D=o.versions.nw)),B||(B="Node.js",L=o.arch,U=o.platform,D=/[\d.]+/.exec(o.version),D=D?D[0]:null));else y(o=t.runtime)==u?(B="Adobe AIR",U=o.flash.system.Capabilities.os):y(o=t.phantom)==m?(B="PhantomJS",D=(o=o.version||null)&&o.major+"."+o.minor+"."+o.patch):"number"==typeof P.documentMode&&(o=/\bTrident\/(\d+)/i.exec(e))?(D=[D,P.documentMode],(o=+o[1]+4)!=D[1]&&(A.push("IE "+D[1]+" mode"),V&&(V[1]=""),D[1]=o),D="IE"==B?String(D[1].toFixed(1)):D[0]):"number"==typeof P.documentMode&&/^(?:Chrome|Firefox)\b/.test(B)&&(A.push("masking as "+B+" "+D),B="IE",D="11.0",V=["Trident"],U="Windows");U=U&&E(U)}if(D&&(o=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(D)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(M&&i.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(N=/b/i.test(o)?"beta":"alpha",D=D.replace(RegExp(o+"\\+?$"),"")+("beta"==N?T:I)+(/\d+\+?/.exec(o)||"")),"Fennec"==B||"Firefox"==B&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(U))B="Firefox Mobile";else if("Maxthon"==B&&D)D=D.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(j))"Xbox 360"==j&&(U=null),"Xbox 360"==j&&/\bIEMobile\b/.test(e)&&A.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(B)&&(!B||j||/Browser|Mobi/.test(B))||"Windows CE"!=U&&!/Mobi/i.test(e))if("IE"==B&&M)try{null===t.external&&A.unshift("platform preview")}catch(Y){A.unshift("embedded")}else(/\bBlackBerry\b/.test(j)||/\bBB10\b/.test(e))&&(o=(RegExp(j.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||D)?(o=[o,/BB10/.test(e)],U=(o[1]?(j=null,F="BlackBerry"):"Device Software")+" "+o[0],D=null):this!=b&&"Wii"!=j&&(M&&k||/Opera/.test(B)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==B&&/\bOS X (?:\d+\.){2,}/.test(U)||"IE"==B&&(U&&!/^Win/.test(U)&&D>5.5||/\bWindows XP\b/.test(U)&&D>8||8==D&&!/\bTrident\b/.test(e)))&&!d.test(o=x.call(b,e.replace(d,"")+";"))&&o.name&&(o="ing as "+o.name+((o=o.version)?" "+o:""),d.test(B)?(/\bIE\b/.test(o)&&"Mac OS"==U&&(U=null),o="identify"+o):(o="mask"+o,B=_?E(_.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(o)&&(U=null),M||(D=null)),V=["Presto"],A.push(o));else B+=" Mobile";(o=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(o=[parseFloat(o.replace(/\.(\d)$/,".0$1")),o],"Safari"==B&&"+"==o[1].slice(-1)?(B="WebKit Nightly",N="alpha",D=o[1].slice(0,-1)):D!=o[1]&&D!=(o[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(D=null),o[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(e)||0)[1],537.36==o[0]&&537.36==o[2]&&parseFloat(o[1])>=28&&"WebKit"==V&&(V=["Blink"]),M&&(c||o[1])?(V&&(V[1]="like Chrome"),o=o[1]||(o=o[0],o<530?1:o<532?2:o<532.05?3:o<533?4:o<534.03?5:o<534.07?6:o<534.1?7:o<534.13?8:o<534.16?9:o<534.24?10:o<534.3?11:o<535.01?12:o<535.02?"13+":o<535.07?15:o<535.11?16:o<535.19?17:o<536.05?18:o<536.1?19:o<537.01?20:o<537.11?"21+":o<537.13?23:o<537.18?24:o<537.24?25:o<537.36?26:"Blink"!=V?"27":"28")):(V&&(V[1]="like Safari"),o=o[0],o=o<400?1:o<500?2:o<526?3:o<533?4:o<534?"4+":o<535?5:o<537?6:o<538?7:o<601?8:o<602?9:o<604?10:o<606?11:o<608?12:"12"),V&&(V[1]+=" "+(o+="number"==typeof o?".x":/[.+]/.test(o)?"":"+")),"Safari"==B&&(!D||parseInt(D)>45)?D=o:"Chrome"==B&&/\bHeadlessChrome/i.test(e)&&A.unshift("headless")),"Opera"==B&&(o=/\bzbov|zvav$/.exec(U))?(B+=" ",A.unshift("desktop mode"),"zvav"==o?(B+="Mini",D=null):B+="Mobile",U=U.replace(RegExp(" *"+o+"$"),"")):"Safari"==B&&/\bChrome\b/.exec(V&&V[1])?(A.unshift("desktop mode"),B="Chrome Mobile",D=null,/\bOS X\b/.test(U)?(F="Apple",U="iOS 4.3+"):U=null):/\bSRWare Iron\b/.test(B)&&!D&&(D=q("Chrome")),D&&0==D.indexOf(o=/[\d.]+$/.exec(U))&&e.indexOf("/"+o+"-")>-1&&(U=O(U.replace(o,""))),U&&-1!=U.indexOf(B)&&!RegExp(B+" OS").test(U)&&(U=U.replace(RegExp(" *"+w(B)+" *"),"")),V&&!/\b(?:Avant|Nook)\b/.test(B)&&(/Browser|Lunascape|Maxthon/.test(B)||"Safari"!=B&&/^iOS/.test(U)&&/\bSafari\b/.test(V[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(B)&&V[1])&&(o=V[V.length-1])&&A.push(o),A.length&&(A=["("+A.join("; ")+")"]),F&&j&&j.indexOf(F)<0&&A.push("on "+F),j&&A.push((/^on /.test(A[A.length-1])?"":"on ")+j),U&&(o=/ ([\d.+]+)$/.exec(U),a=o&&"/"==U.charAt(U.length-o[0].length-1),U={architecture:32,family:o&&!a?U.replace(o[0],""):U,version:o?o[1]:null,toString:function(){var e=this.version;return this.family+(e&&!a?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(o=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(L))&&!/\bi686\b/i.test(L)?(U&&(U.architecture=64,U.family=U.family.replace(RegExp(" *"+o),"")),B&&(/\bWOW64\b/i.test(e)||M&&/\w(?:86|32)$/.test(i.cpuClass||i.platform)&&!/\bWin64; x64\b/i.test(e))&&A.unshift("32-bit")):U&&/^OS X/.test(U.family)&&"Chrome"==B&&parseFloat(D)>=39&&(U.architecture=64),e||(e=null);var $={};return $.description=e,$.layout=V&&V[0],$.manufacturer=F,$.name=B,$.prerelease=N,$.product=j,$.ua=e,$.version=B&&D,$.os=U||{architecture:null,family:null,version:null,toString:function(){return"null"}},$.parse=x,$.toString=J,$.version&&A.unshift(D),$.name&&A.unshift(B),U&&B&&(U!=String(U).split(" ")[0]||U!=B.split(" ")[0]&&!j)&&A.push(j?"("+U+")":"on "+U),A.length&&($.description=A.join(" ")),$}var R=x();s.platform=R,r=function(){return R}.call(t,n,t,e),void 0===r||(e.exports=r)}).call(this)}).call(this,n("62e4")(e),n("c8ba"))},fb6e:function(e,t){function n(e,t,n){var i={audio:!1,video:{mandatory:{chromeMediaSource:e?"screen":"desktop",maxWidth:globalThis.screen.width>1920?globalThis.screen.width:1920,maxHeight:globalThis.screen.height>1080?globalThis.screen.height:1080},optional:[]}};return n&&(i.audio={mandatory:{chromeMediaSource:e?"screen":"desktop"},optional:[]}),t&&(i.video.mandatory.chromeMediaSourceId=t,i.audio&&i.audio.mandatory&&(i.audio.mandatory.chromeMediaSourceId=t)),i}function i(e){r?r.isLoaded?e?e.forEach?r.contentWindow.postMessage({captureCustomSourceId:e},"*"):r.contentWindow.postMessage({captureSourceIdWithAudio:!0},"*"):r.contentWindow.postMessage({captureSourceId:!0},"*"):setTimeout((function(){i(e)}),100):o((function(){i(e)}))}var r;function o(e){r?e():(r=document.createElement("iframe"),r.onload=function(){r.isLoaded=!0,e()},r.src="https://openvidu.github.io/openvidu-screen-sharing-chrome-extension/",r.style.display="none",(document.body||document.documentElement).appendChild(r))}function s(){r?r.isLoaded?r.contentWindow.postMessage({getChromeExtensionStatus:!0},"*"):setTimeout(s,100):o(s)}globalThis.getScreenId=function(e,t,r){function o(e){e.data&&(e.data.chromeMediaSourceId&&("PermissionDeniedError"===e.data.chromeMediaSourceId?t("permission-denied"):t(null,e.data.chromeMediaSourceId,n(null,e.data.chromeMediaSourceId,e.data.canRequestAudioTrack)),globalThis.removeEventListener("message",o)),e.data.chromeExtensionStatus&&(t(e.data.chromeExtensionStatus,null,n(e.data.chromeExtensionStatus)),globalThis.removeEventListener("message",o)))}-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob?navigator.mozGetUserMedia?t(null,"firefox",{video:{mozMediaSource:e,mediaSource:e}}):(globalThis.addEventListener("message",o),r?setTimeout((function(){i(r)}),100):setTimeout(i,100)):t({video:!0})},globalThis.getScreenConstraints=function(e){o((function(){getScreenId((function(t,n,i){i||(i={video:!0}),e(t,i.video)}))}))},globalThis.getChromeExtensionStatus=function(e){function t(n){n.data&&n.data.chromeExtensionStatus&&(e(n.data.chromeExtensionStatus),globalThis.removeEventListener("message",t))}navigator.mozGetUserMedia?e("installed-enabled"):(globalThis.addEventListener("message",t),setTimeout(s,100))},t.getScreenId=globalThis.getScreenId},fdd2:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoInsertMode=void 0,function(e){e["AFTER"]="AFTER",e["APPEND"]="APPEND",e["BEFORE"]="BEFORE",e["PREPEND"]="PREPEND",e["REPLACE"]="REPLACE"}(t.VideoInsertMode||(t.VideoInsertMode={}))},fefe:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.SpeechToTextEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r,o,s){var a=e.call(this,!1,t,"speechToTextMessage")||this;return a.connection=n,a.text=i,a.reason=r,a.raw=o,a.lang=s,a}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.SpeechToTextEvent=o}}]);